<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Mixture models | Structural Bayesian Techniques for Experimental and Behavioral Economics</title>
  <meta name="description" content="7 Mixture models | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Mixture models | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Mixture models | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  
  
  

<meta name="author" content="James R. Bland" />


<meta name="date" content="2023-06-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="hierarchical-models.html"/>
<link rel="next" href="applications.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="section.html#section" id="toc-section"></a></li>
<li class="chapter" data-level="" data-path="setting-the-stage.html"><a href="setting-the-stage.html"><i class="fa fa-check"></i>Setting the stage</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-does-your-theory-say-about-your-data"><i class="fa fa-check"></i><b>1.1</b> What does your theory say about your data?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-do-your-data-say-about-your-theory"><i class="fa fa-check"></i><b>1.2</b> What do your data say about your theory?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-do-your-parameters-say-about-other-things"><i class="fa fa-check"></i><b>1.3</b> What do your parameters say about other things?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-does-your-expertise-say-about-your-parameters"><i class="fa fa-check"></i><b>1.4</b> What does your expertise say about your parameters?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html"><i class="fa fa-check"></i><b>2</b> Getting started in <em>Stan</em></a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#installation-in-r"><i class="fa fa-check"></i><b>2.1</b> Installation in <em>R</em></a></li>
<li class="chapter" data-level="2.2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#the-anatomy-of-a-stan-program"><i class="fa fa-check"></i><b>2.2</b> The anatomy of a <em>Stan</em> program</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#data-block"><i class="fa fa-check"></i><b>2.2.1</b> Data block</a></li>
<li class="chapter" data-level="2.2.2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#transformed-data-block"><i class="fa fa-check"></i><b>2.2.2</b> Transformed data block</a></li>
<li class="chapter" data-level="2.2.3" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#parameters-block"><i class="fa fa-check"></i><b>2.2.3</b> Parameters block</a></li>
<li class="chapter" data-level="2.2.4" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#model-block"><i class="fa fa-check"></i><b>2.2.4</b> Model block</a></li>
<li class="chapter" data-level="2.2.5" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#generated-quantities-block"><i class="fa fa-check"></i><b>2.2.5</b> Generated quantities block</a></li>
<li class="chapter" data-level="2.2.6" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#the-final-product"><i class="fa fa-check"></i><b>2.2.6</b> The final product</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#estimating-a-model"><i class="fa fa-check"></i><b>2.3</b> Estimating a model</a></li>
<li class="chapter" data-level="2.4" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#looking-at-the-results"><i class="fa fa-check"></i><b>2.4</b> Looking at the results</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html"><i class="fa fa-check"></i><b>3</b> Probabilistic models of behavior</a>
<ul>
<li class="chapter" data-level="3.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#the-problem-with-deterministic-models"><i class="fa fa-check"></i><b>3.1</b> The problem with deterministic models</a></li>
<li class="chapter" data-level="3.2" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#what-is-a-probabilistic-model"><i class="fa fa-check"></i><b>3.2</b> What <em>is</em> a probabilistic model?</a></li>
<li class="chapter" data-level="3.3" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#example-dataset-and-model"><i class="fa fa-check"></i><b>3.3</b> Example dataset and model</a></li>
<li class="chapter" data-level="3.4" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#optimal-choice-plus-an-error"><i class="fa fa-check"></i><b>3.4</b> Optimal choice plus an error</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#estimating-a-model-1"><i class="fa fa-check"></i><b>3.4.1</b> Estimating a model</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#utility-based-models"><i class="fa fa-check"></i><b>3.5</b> Utility-based models</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#estimating-a-model-2"><i class="fa fa-check"></i><b>3.5.1</b> Estimating a model</a></li>
<li class="chapter" data-level="3.5.2" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#doing-something-with-the-estimates"><i class="fa fa-check"></i><b>3.5.2</b> Doing something with the estimates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html"><i class="fa fa-check"></i><b>4</b> Considerations for choosing a prior</a>
<ul>
<li class="chapter" data-level="4.1" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#example-model-and-experiment"><i class="fa fa-check"></i><b>4.1</b> Example model and experiment</a></li>
<li class="chapter" data-level="4.2" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#getting-the-support-right"><i class="fa fa-check"></i><b>4.2</b> Getting the support right</a></li>
<li class="chapter" data-level="4.3" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#eliciting-reasonable-priors"><i class="fa fa-check"></i><b>4.3</b> Eliciting reasonable priors</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#parameter-values-and-the-prior-pushforward-check"><i class="fa fa-check"></i><b>4.3.1</b> Parameter values and the prior pushforward check</a></li>
<li class="chapter" data-level="4.3.2" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#predictions-and-other-derived-quantities-the-prior-predictive-check"><i class="fa fa-check"></i><b>4.3.2</b> Predictions and other derived quantities: The prior predictive check</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#assessing-the-sampling-performance-of-a-prior"><i class="fa fa-check"></i><b>4.4</b> Assessing the sampling performance of a prior</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#does-our-model-recover-its-parameters-well"><i class="fa fa-check"></i><b>4.4.1</b> Does our model recover its parameters well?</a></li>
<li class="chapter" data-level="4.4.2" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#do-we-see-any-pathologies-in-the-estimation-process"><i class="fa fa-check"></i><b>4.4.2</b> Do we see any pathologies in the estimation process?</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#r-code-used-for-this-chapter"><i class="fa fa-check"></i><b>4.5</b> <em>R</em> code used for this chapter</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="building-blocks.html"><a href="building-blocks.html"><i class="fa fa-check"></i>Building blocks</a></li>
<li class="chapter" data-level="5" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html"><i class="fa fa-check"></i><b>5</b> Representative agent and participant-specific models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#participant-specific-models"><i class="fa fa-check"></i><b>5.1</b> Participant-specific models</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#example-data-and-economic-model"><i class="fa fa-check"></i><b>5.1.1</b> Example data and economic model</a></li>
<li class="chapter" data-level="5.1.2" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#going-to-the-probabilistic-model"><i class="fa fa-check"></i><b>5.1.2</b> Going to the probabilistic model</a></li>
<li class="chapter" data-level="5.1.3" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#a-short-side-quest-into-canned-estimation-techniques"><i class="fa fa-check"></i><b>5.1.3</b> A short side quest into canned estimation techniques</a></li>
<li class="chapter" data-level="5.1.4" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#assigning-priors"><i class="fa fa-check"></i><b>5.1.4</b> Assigning priors</a></li>
<li class="chapter" data-level="5.1.5" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#estimating-the-model-for-one-participant"><i class="fa fa-check"></i><b>5.1.5</b> Estimating the model for one participant</a></li>
<li class="chapter" data-level="5.1.6" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#estimating-the-model-for-all-participants"><i class="fa fa-check"></i><b>5.1.6</b> Estimating the model for all participants</a></li>
<li class="chapter" data-level="5.1.7" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#but-we-could-be-learning-more"><i class="fa fa-check"></i><b>5.1.7</b> But we could be learning more!</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#actual-representative-agent-models-pooled-models"><i class="fa fa-check"></i><b>5.2</b> Actual representative agent models (pooled models)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="hierarchical-models.html"><a href="hierarchical-models.html"><i class="fa fa-check"></i><b>6</b> Hierarchical models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-random-sample-of-participants-walks-into-your-lab"><i class="fa fa-check"></i><b>6.1</b> A random sample of participants walks into your lab</a></li>
<li class="chapter" data-level="6.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#the-anatomy-of-a-basic-hierarchical-model"><i class="fa fa-check"></i><b>6.2</b> The anatomy of a basic hierarchical model</a></li>
<li class="chapter" data-level="6.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#accounting-for-unobserved-heterogeneity"><i class="fa fa-check"></i><b>6.3</b> Accounting for unobserved heterogeneity</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#the-last-time-you-will-integrate-the-likelihood-probably"><i class="fa fa-check"></i><b>6.3.1</b> The last time you will integrate the likelihood, probably</a></li>
<li class="chapter" data-level="6.3.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#data-augmentation"><i class="fa fa-check"></i><b>6.3.2</b> Data augmentation</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-multivariate-normal-hierarchical-model"><i class="fa fa-check"></i><b>6.4</b> A multivariate normal hierarchical model</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#decomposing-the-variance-covariance-matrix"><i class="fa fa-check"></i><b>6.4.1</b> Decomposing the variance-covariance matrix</a></li>
<li class="chapter" data-level="6.4.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#transformed-parameters-and-normal-distributions"><i class="fa fa-check"></i><b>6.4.2</b> Transformed parameters and normal distributions</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-again-with-bfs2019"><i class="fa fa-check"></i><b>6.5</b> Example: again with <span class="citation">Bruhin, Fehr, and Schunk (<span>2019</span>)</span></a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#no-correlation-between-individual-level-parameters"><i class="fa fa-check"></i><b>6.5.1</b> No correlation between individual-level parameters</a></li>
<li class="chapter" data-level="6.5.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#correlation-between-individual-level-parameters"><i class="fa fa-check"></i><b>6.5.2</b> Correlation between individual-level parameters</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="mixture-models.html"><a href="mixture-models.html"><i class="fa fa-check"></i><b>7</b> Mixture models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="mixture-models.html"><a href="mixture-models.html#a-menu-of-models"><i class="fa fa-check"></i><b>7.1</b> A menu of models</a></li>
<li class="chapter" data-level="7.2" data-path="mixture-models.html"><a href="mixture-models.html#dichotomous-and-toolbox-mixture-models"><i class="fa fa-check"></i><b>7.2</b> Dichotomous and toolbox mixture models</a></li>
<li class="chapter" data-level="7.3" data-path="mixture-models.html"><a href="mixture-models.html#coding-peculearities"><i class="fa fa-check"></i><b>7.3</b> Coding peculearities</a></li>
<li class="chapter" data-level="7.4" data-path="mixture-models.html"><a href="mixture-models.html#example-experiment-av2001"><i class="fa fa-check"></i><b>7.4</b> Example experiment: <span class="citation">Andreoni and Vesterlund (<span>2001</span>)</span></a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="mixture-models.html"><a href="mixture-models.html#as-basic-as-it-gets"><i class="fa fa-check"></i><b>7.4.1</b> As basic as it gets</a></li>
<li class="chapter" data-level="7.4.2" data-path="mixture-models.html"><a href="mixture-models.html#adding-some-heterogeneity"><i class="fa fa-check"></i><b>7.4.2</b> Adding some heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="mixture-models.html"><a href="mixture-models.html#some-code-used-to-estimate-the-models"><i class="fa fa-check"></i><b>7.5</b> Some code used to estimate the models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i>Applications</a></li>
<li class="chapter" data-level="8" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html"><i class="fa fa-check"></i><b>8</b> Application: Experience-Weighted Attraction</a>
<ul>
<li class="chapter" data-level="8.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-model-at-the-individual-level"><i class="fa fa-check"></i><b>8.1</b> The model at the individual level</a></li>
<li class="chapter" data-level="8.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#some-computational-and-coding-issues"><i class="fa fa-check"></i><b>8.2</b> Some computational and coding issues</a></li>
<li class="chapter" data-level="8.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#representative-agent-models"><i class="fa fa-check"></i><b>8.3</b> Representative agent models</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#prior-calibration"><i class="fa fa-check"></i><b>8.3.1</b> Prior calibration</a></li>
<li class="chapter" data-level="8.3.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-stan-model"><i class="fa fa-check"></i><b>8.3.2</b> The <em>Stan</em> model</a></li>
<li class="chapter" data-level="8.3.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#results"><i class="fa fa-check"></i><b>8.3.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#hierarchical-model"><i class="fa fa-check"></i><b>8.4</b> Hierarchical model</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#prior-calibration-1"><i class="fa fa-check"></i><b>8.4.1</b> Prior calibration</a></li>
<li class="chapter" data-level="8.4.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-stan-model-1"><i class="fa fa-check"></i><b>8.4.2</b> The <em>Stan</em> model</a></li>
<li class="chapter" data-level="8.4.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#results-1"><i class="fa fa-check"></i><b>8.4.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#some-code-used-to-estimate-the-models-1"><i class="fa fa-check"></i><b>8.5</b> Some code used to estimate the models</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#loading-the-data"><i class="fa fa-check"></i><b>8.5.1</b> Loading the data</a></li>
<li class="chapter" data-level="8.5.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#estimating-the-representative-agent-models"><i class="fa fa-check"></i><b>8.5.2</b> Estimating the representative agent models</a></li>
<li class="chapter" data-level="8.5.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#estimating-the-hierarchical-model"><i class="fa fa-check"></i><b>8.5.3</b> Estimating the hierarchical model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html"><i class="fa fa-check"></i><b>9</b> Application: Strategy Frequency Estimation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#simplifying-the-individual-likelihood-functions"><i class="fa fa-check"></i><b>9.1</b> Simplifying the individual likelihood functions</a></li>
<li class="chapter" data-level="9.2" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#example-experiment-dbf2011"><i class="fa fa-check"></i><b>9.2</b> Example experiment: <span class="citation">Dal Bó and Fréchette (<span>2011</span>)</span></a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#the-sfem-with-homogeneous-trembles"><i class="fa fa-check"></i><b>9.2.1</b> The SFEM with homogeneous trembles</a></li>
<li class="chapter" data-level="9.2.2" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#adding-heterogeneous-trembles-and-integrating-the-likelihood"><i class="fa fa-check"></i><b>9.2.2</b> Adding heterogeneous trembles and integrating the likelihood</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#r-code-to-do-these-estimations"><i class="fa fa-check"></i><b>9.3</b> <em>R</em> code to do these estimations</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html"><i class="fa fa-check"></i><b>10</b> Computing Quantal Response Equilibrium</a>
<ul>
<li class="chapter" data-level="10.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#overview-of-quantal-response-equilibrium"><i class="fa fa-check"></i><b>10.1</b> Overview of quantal response equilibrium</a></li>
<li class="chapter" data-level="10.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#computing-quantal-response-equilibrium-1"><i class="fa fa-check"></i><b>10.2</b> Computing Quantal Response Equilibrium</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#setting-up-the-problem"><i class="fa fa-check"></i><b>10.2.1</b> Setting up the problem</a></li>
<li class="chapter" data-level="10.2.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#a-predictor-corrector-algorithm"><i class="fa fa-check"></i><b>10.2.2</b> A predictor-corrector algorithm</a></li>
<li class="chapter" data-level="10.2.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#initial-conditions"><i class="fa fa-check"></i><b>10.2.3</b> Initial conditions</a></li>
<li class="chapter" data-level="10.2.4" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#algorithm-tuning"><i class="fa fa-check"></i><b>10.2.4</b> Algorithm tuning</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#the-predictor-corrector-algorithm-in-r"><i class="fa fa-check"></i><b>10.3</b> The predictor-corrector algorithm in <em>R</em></a></li>
<li class="chapter" data-level="10.4" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#some-example-games"><i class="fa fa-check"></i><b>10.4</b> Some example games</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#generalized-matching-pennies-ochs1995"><i class="fa fa-check"></i><b>10.4.1</b> Generalized matching pennies <span class="citation">(<span>Ochs 1995</span>)</span></a></li>
<li class="chapter" data-level="10.4.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#stag-hunt"><i class="fa fa-check"></i><b>10.4.2</b> Stag hunt</a></li>
<li class="chapter" data-level="10.4.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#n-player-volunteers-dilemma-imposing-symmetric-strategies"><i class="fa fa-check"></i><b>10.4.3</b> <span class="math inline">\(n\)</span>-player Volunteer’s Dilemma imposing symmetric strategies</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><i class="fa fa-check"></i><b>11</b> Application: Quantal Response Equilibrium and the Volunteer’s Dilemma <span class="citation">(<span>Goeree, Holt, and Smith 2017</span>)</span></a>
<ul>
<li class="chapter" data-level="11.1" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#solving-logit-qre-and-estimating-the-model"><i class="fa fa-check"></i><b>11.1</b> Solving logit QRE and estimating the model</a></li>
<li class="chapter" data-level="11.2" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#adding-some-heterogeneity-1"><i class="fa fa-check"></i><b>11.2</b> Adding some heterogeneity</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#computing-quantal-response-equilibrium-with-heterogeneous-parameters"><i class="fa fa-check"></i><b>11.2.1</b> Computing quantal response equilibrium with heterogeneous parameters</a></li>
<li class="chapter" data-level="11.2.2" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#warm-glow-volunteering"><i class="fa fa-check"></i><b>11.2.2</b> Warm glow volunteering</a></li>
<li class="chapter" data-level="11.2.3" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#duplicate-aversion"><i class="fa fa-check"></i><b>11.2.3</b> Duplicate aversion</a></li>
<li class="chapter" data-level="11.2.4" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#results-2"><i class="fa fa-check"></i><b>11.2.4</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#r-code-to-run-estimations"><i class="fa fa-check"></i><b>11.3</b> <em>R</em> code to run estimations</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="links-to-data.html"><a href="links-to-data.html"><i class="fa fa-check"></i>Links to data</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Structural Bayesian Techniques for Experimental and Behavioral Economics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mixture-models" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> Mixture models<a href="mixture-models.html#mixture-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Sometimes we are lucky enough to have more than one model of how people could behave in our experiment. While this opens up a whole lot of interesting research questions that we could ask, it also creates a whole lot of problems associated with assigning relative importance to each of these models. One early solution was to take a “horse race” approach: define some measure of goodness of fit, such as the log-likelihood or mean squared prediction error, then pick the model (i.e. the horse) that wins by this measure. Applications of this technique can be seen in the classification of participants in <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span> and <span class="citation">Andreoni and Miller (<a href="#ref-Andreoni2002" role="doc-biblioref">2002</a>)</span> into several types of other-regarding preferences using nonlinear least squares. They can also be seen in the classification of participants into different types of risk preferences in <span class="citation">Hey and Orme (<a href="#ref-Hey1994" role="doc-biblioref">1994</a>)</span> using the Akaike information criterion. When applied to data one participant at a time, as is done in these applications, this kind of classification can begin to shed light on the underlying <em>fractions</em> of the population that behave according to each model.</p>
<p>However when applied to a whole experiment with many participants, picking a winner makes less sense: it could be that <em>all</em>, or at least a fair number of, models are important for substantial fractions of the population, and classifying all of our data into just one will not acknowledge the richness of our data-generating process. The mixture model is a formal way of estimating these fractions in the population. Here, we will take a menu of models that could be important for certain slices of our data, and estimate the fraction of the data that are best characterized by each of these models.</p>
<div id="a-menu-of-models" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> A menu of models<a href="mixture-models.html#a-menu-of-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>So we have a menu of models that we would like to include in our estimation. As we are dealing with probabilistic models, each of these on their own will come with a likelihood function. Our job is to take these model-specific likelihood functions, and combine them into a “grand likelihood” for the mixture model. To fix ideas, suppose that for every observation indexed by participant <span class="math inline">\(i\)</span> and decision <span class="math inline">\(t\)</span>, the likelihood for model <span class="math inline">\(m\)</span> is <span class="math inline">\(p(y_{i,t}\mid\theta_i,m)\)</span>, where <span class="math inline">\(\theta_i\)</span> is a vector of participant-specific parameters and <span class="math inline">\(y_{i,t}\)</span> is the data. Now we introduce the mixing probabilities <span class="math inline">\(\{\rho_m\}_{m=1}^M\in \Delta^M\)</span>, which are the fraction of the data that are represented by each model. If this were our only observation, then our distribution of <span class="math inline">\(y_{i,t}\)</span> can be written as (for a mixture of <span class="math inline">\(M=3\)</span> models):</p>
<p><span class="math display">\[
\begin{aligned}
p(y_{i,t}\mid \theta_i,\rho)&amp;= \rho_1 p(y_{i,t}\mid\theta_i,m_1)+\rho_2 p(y_{i,t}\mid\theta_i,m_2)+\rho_3 p(y_{i,t}\mid\theta_i,m_3)
\end{aligned}
\]</span></p>
<p>That is, we have integrated out the uncertainty (measured by <span class="math inline">\(\rho\)</span>) associated with which model observation <span class="math inline">\(y_{i,t}\)</span> is coming from. This representation means that if we can estimate each of these (in this case) three models separately using our data, then in principle at least, we can combine them into a mixture model, and estimate the fraction of data that are generated by each model.</p>
<p>These fractions can be very useful quantities to know. They speak to the relative importance of each model on our menu. From my own use of them, I have been able to show for example that most participants narrowly bracket in games <span class="citation">(<a href="#ref-Bland2019JMP" role="doc-biblioref">Bland 2019</a>)</span> (as opposed to broadly bracketing), and that the majority of participants have Bayesian beliefs (as opposed to using multiple priors model) <span class="citation">(<a href="#ref-Bland2019learning" role="doc-biblioref">Bland and Rosokha 2019</a>)</span>.</p>
</div>
<div id="dichotomous-and-toolbox-mixture-models" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Dichotomous and toolbox mixture models<a href="mixture-models.html#dichotomous-and-toolbox-mixture-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I think of the typical types of structural mixture models taken to data from economic experiments falling into two categories. These relate to how the data may be sliced to divide up decisions as coming from one model or another. That is, data <em>within</em> a slice must be generated from the same model, but data <em>between</em> slices can be generated from different models. These two types of mixture model differ as to how the data can be sliced. In particular, they differ in whether data from one participant can be generated by only one, or more than one of the models on our menu.</p>
<p><span class="citation">Conte, Hey, and Moffatt (<a href="#ref-Conte2011" role="doc-biblioref">2011</a>)</span>, for example, assumes that the data can be sliced up to the participant level, but no further. An immediate implication of this is that participants have “types”: if they make one decision based on model <span class="math inline">\(B\)</span>, then they could <em>never</em> make decisions based on models <span class="math inline">\(A\)</span> or <span class="math inline">\(C\)</span>. Hence, we can interpret the mixing probabilities from this kind of model as the fraction of <em>participants</em> in the population who behave according to each model. I will refer to this kind of model as a “dichotomous” mixture model. When we are using a dichotomous mixture model with a menu of length <span class="math inline">\(M\)</span>, our grand log-likelihood will be:</p>
<p><span class="math display">\[
\begin{aligned}
\log p(y\mid \rho,\beta)&amp;=\sum_{i=1}^n\log\left(\sum_{m=1}^M\rho_m\exp\left(\sum_{t=1}^T\log p(y_{i,t}\mid \beta,m)\right)\right)
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(\beta\)</span> is a vector of parameters other than <span class="math inline">\(\rho\)</span>, and <span class="math inline">\(p(y_{i,t}\mid\beta,m)\)</span> is the likelihood for observation <span class="math inline">\(y_{i,t}\)</span> given that it was generated by model <span class="math inline">\(m\)</span>.<a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a></p>
<p><span class="citation">Harrison and Rutström (<a href="#ref-Harrison2009" role="doc-biblioref">2009</a>)</span>, on the other hand, assumes that the data can be sliced at the <em>decision</em> level. That is, participants can make some decisions based on model <span class="math inline">\(A\)</span>, some based on model <span class="math inline">\(B\)</span>, and so on. Following <span class="citation">Stahl (<a href="#ref-Stahl2018" role="doc-biblioref">2018</a>)</span>, I refer to these models as <em>toolbox</em> mixture models. When we are using a toolbox mixture model with a menu of length <span class="math inline">\(M\)</span>, our grand log-likelihood will be:</p>
<p><span class="math display">\[
\begin{aligned}
\log p(y\mid\rho,\beta)&amp;=\sum_{i=1}^n\sum_{t=1}^T\log\left(\sum_{m=1}^M\rho_m\exp\left(\log p(y_{i,t}\mid \beta,m)\right)\right)
\end{aligned}
\]</span></p>
<p>In particular, note how the ordering of the summations is different. However perhaps more importantly, note how <em>the interpretation of the mixing probabilities is different</em>. In the dichotomous model, we assume that a participant’s data can only be generated from one of the models on the menu. Hence in this case, it is appropriate to say that our participants have “types”, and that we can interpret the mixing probabilities <span class="math inline">\(\rho\)</span> as the fraction of <em>participants</em> whose decisions are best represented by each model. Hence we can say things like “<span class="math inline">\(100\rho_1\%\)</span> of participants use model 1”.
On the other hand in a toolbox mixture model, participants can use all of the models on the menu for different decisions. In the toolbox case we should therefore interpret <span class="math inline">\(\rho\)</span> as the fraction of <em>decisions</em> that are best represented by each model. Hence we can say things like “participants use model 1 <span class="math inline">\(100\rho_1\%\)</span> of the time”.</p>
</div>
<div id="coding-peculearities" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Coding peculearities<a href="mixture-models.html#coding-peculearities" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This is a situation where we need to understand a bit about the kind of parameters that <em>Stan</em> can simulate. Specifically, they must be continuous random variables. This throws a bit of a spanner in the works when writing our <em>Stan</em> model, as the easy way to simulate a posterior for a mixture model is to use data augmentation, with the augmented data being categorical variables for which model the observation is being generated from. However since <em>Stan</em> cannot handle categorical parameters, we will instead have to integrate the likelihood.<a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a></p>
<p>Another issue we will run into when computing the grand likelihood, we need to exponentiate the log-likelihood in order to incorporate the mixing probabilities, but then we need to then convert the grand likelihood back to log units in order to add it to <em>Stan</em>’s <code>target</code>. To avoid problems with exponentiating either very small or very large model likelihoods, we will use the following algebra trick:</p>
<p><span class="math display">\[
\begin{aligned}
\log\left(\sum_{m=1}^M\rho_m\exp(l_m)\right)
=\log\left(\sum_{m=1}^M\exp\left(\log\rho_m\right)\exp(l_m)\right)
=\log\left(\sum_{m=1}^M\exp(l_m+\log\rho_m)\right)
\end{aligned}
\]</span></p>
<p>which will allow us to use <em>Stan</em>’s <code>log_sum_exp</code> function to compute the grand likelihood.</p>
</div>
<div id="example-experiment-av2001" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Example experiment: <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span><a href="mixture-models.html#example-experiment-av2001" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span> investigate whether there are any differences in other-regarding preferences between male and female participants. In their experiment, each participant was presented with eight different budget sets, which are shown in Figure <a href="mixture-models.html#fig:MixtureAV2001BudgetSets">7.1</a>.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="mixture-models.html#cb95-1" aria-hidden="true" tabindex="-1"></a>AV2001choices<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;Data/AV2001choices.csv&quot;</span>)</span>
<span id="cb95-2"><a href="mixture-models.html#cb95-2" aria-hidden="true" tabindex="-1"></a>AV2001parameters<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;Data/AV2001parameters.csv&quot;</span>)</span>
<span id="cb95-3"><a href="mixture-models.html#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="mixture-models.html#cb95-4" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb95-5"><a href="mixture-models.html#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(AV2001parameters,</span>
<span id="cb95-6"><a href="mixture-models.html#cb95-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x=</span><span class="dv">0</span>,<span class="at">y=</span>income<span class="sc">*</span>pOther,</span>
<span id="cb95-7"><a href="mixture-models.html#cb95-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">xend =</span> income<span class="sc">*</span>pSelf,<span class="at">yend=</span><span class="dv">0</span>))</span>
<span id="cb95-8"><a href="mixture-models.html#cb95-8" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_segment</span>()</span>
<span id="cb95-9"><a href="mixture-models.html#cb95-9" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb95-10"><a href="mixture-models.html#cb95-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#+xlim(c(0,100))+ylim(c(0,100))</span></span>
<span id="cb95-11"><a href="mixture-models.html#cb95-11" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">coord_fixed</span>()</span>
<span id="cb95-12"><a href="mixture-models.html#cb95-12" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">0</span>,<span class="at">linewidth=</span><span class="dv">1</span>)</span>
<span id="cb95-13"><a href="mixture-models.html#cb95-13" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>,<span class="at">linewidth=</span><span class="dv">1</span>)</span>
<span id="cb95-14"><a href="mixture-models.html#cb95-14" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;Payoff to self&quot;</span>)</span>
<span id="cb95-15"><a href="mixture-models.html#cb95-15" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Payoff to other&quot;</span>)</span>
<span id="cb95-16"><a href="mixture-models.html#cb95-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:MixtureAV2001BudgetSets"></span>
<img src="index_files/figure-html/MixtureAV2001BudgetSets-1.png" alt="The eight budget sets presented to participants in Andreoni and Vesterlund (2001)." width="672" />
<p class="caption">
Figure 7.1: The eight budget sets presented to participants in Andreoni and Vesterlund (2001).
</p>
</div>
<p>For each of the budget sets, participants chose an allocation of money between themselves and another participant. As you can see, there is a good range of different trade-offs between the earnings of the self, and the earnings of the other. They frame this allocation task to participants as having an allocation of “tokens”, and allocating these between themselves (“holding” the tokens) and another participant (“passing” the tokens). The tokens are then exchanged for dollars at different rates, hence the different slopes and intercepts of the budget lines above. In keeping with the data as I have it, I will use the following notation to refer to elements of the dataset:</p>
<ul>
<li><span class="math inline">\(\mathrm{income}_{i,t}\)</span> is the endowment measured in tokens</li>
<li><span class="math inline">\(\mathrm{pSelf}_{i,t}\)</span> is the value of a token to the decision-maker (the “self”)</li>
<li><span class="math inline">\(\mathrm{pOther}_{i,t}\)</span> is the value of a token to the other participant (the “other”)</li>
<li><span class="math inline">\(y_{i,t}\)</span> is the fraction of tokens that the decision-maker kept.</li>
</ul>
<p>where <span class="math inline">\(i\in\{1, 2, \ldots, N=142\}\)</span> indexes the participants, and <span class="math inline">\(t\in\{1, 2, \ldots, T=8\}\)</span> indexes the budget set.</p>
<p>In their Section III.B,
<span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span> classify their participants into three types of other-regarding preferences. These three types are:</p>
<ul>
<li><em>Selfish</em> preferences. These participants only care about their own payoff, and so will choose the allocation that maximizes their own earnings.</li>
<li><em>Perfect substitutes</em> preferences. These participants care about the total group earnings, and so will choose the allocation that maximizes this quantity. Since the budget lines are linear, this means choosing at one of the endpoints of the budget lines, unless <span class="math inline">\(\mathrm{pSelf}_{i,t}=\mathrm{pOther}_{i,t}\)</span>, in which case anything is optimal.<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a></li>
<li><em>Perfect complements</em>, or <em>Leontief</em> preferences. These participants care about the minimum of their own and the other’s payoff. They will choose the allocation that is at the intersection of the budget line and the <span class="math inline">\(45^\circ\)</span> line.</li>
</ul>
<p>We can represent these preferences as utility functions as follows:</p>
<p><span class="math display">\[
\begin{aligned}
U^S(\pi_s,\pi_o)&amp;=\pi_s\quad &amp;\text{Selfish}\\
U^{PS}(\pi_s,\pi_o)&amp;=\pi_s+\pi_o\quad&amp;\text{Perfect substitutes}\\
U^{PC}(\pi_s,\pi_o)&amp;=\min\{\pi_s,\pi_o\}\quad &amp; \text{Perfect complements}
\end{aligned}
\]</span></p>
<p>These will be the three models that we will use for the mixture models below. <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span> classify their participants into one of these types by choosing the type that minimizes the Euclidean distance between the types’ predictions and observed behavior. For this application, I will show you how to specify and estimate a mixture model that estimates the fraction of each type present in the data.<a href="#fn30" class="footnote-ref" id="fnref30"><sup>30</sup></a></p>
<p>While the above utility functions are sufficient to make deterministic predictions about how a participant might behave in this experiment, in order to turn this into a probabilistic model, we need to specify a probabilistic decision rule. For this, I will assume the logit choice rule, which is:</p>
<p><span class="math display">\[
\begin{aligned}
p(y_{i,t}\mid \rho,\lambda,m)&amp;=\frac{\exp(\lambda U^m(\mathrm{income}_{i,t}y_{i,t}\mathrm{pSelf}_{i,t},\mathrm{income}_{i,t}(1-y_{i,t})\mathrm{pOther}_{i,t}  ))}{\sum_{j\in\{\mathrm{S},\mathrm{PS},\mathrm{PC}\}}\exp(\lambda U^j(\mathrm{income}_{i,t}y_{i,t}\mathrm{pSelf}_{i,t},\mathrm{income}_{i,t}(1-y_{i,t})\mathrm{pOther}_{i,t}  ))}
\end{aligned}
\]</span></p>
<p>Noting that all three of the utility functions are homogeneous of degree 1, you will see the following representation show up in my code, which is mathematically equivalent, but saves a bit of time typing out:</p>
<p><span class="math display">\[
\begin{aligned}
p(y_{i,t}\mid \rho,\lambda,m)&amp;=\frac{\exp(\lambda \mathrm{income}_{i,t}U^m(y_{i,t}\mathrm{pSelf}_{i,t},(1-y_{i,t})\mathrm{pOther}_{i,t}  ))}{\sum_{j\in\{\mathrm{S},\mathrm{PS},\mathrm{PC}\}}\exp(\lambda \mathrm{income}_{i,t}U^j(y_{i,t}\mathrm{pSelf}_{i,t},(1-y_{i,t})\mathrm{pOther}_{i,t}  ))}
\end{aligned}
\]</span></p>
<p>This probabilistic choice rule, an assumption that all choices are independently distributed, and the choice of whether we are using a dichotomous or toolbox mixture model, pins down the grand likelihood function. For the dichotomous case, this is:</p>
<p><span class="math display">\[
\begin{aligned}
\log p(y\mid \rho,\lambda)&amp;=\sum_{i=1}^n\log\left(\sum_{m\in\{\mathrm{S},\mathrm{PS},\mathrm{PC}\}}\exp\left(\sum_{t=1}^T\log p(y_{i,t}\mid \rho,\lambda,m)+\log\rho_m\right)\right)
\end{aligned}
\]</span></p>
<p>Here we are assuming that participants’ decisions can only ever be generated from one of the three models. This is why in dichotomous mixture models the individual models are often referred to as types: a participant is either either a selfish <em>type</em>, a perfect substitutes <em>type</em>, or a perfect complements <em>type</em>. This is not the case for the toolbox specification, where we allow participants to use all three models. In the case of the toolbox mixture model, the grand likelihood is:</p>
<p><span class="math display">\[
\begin{aligned}
\log p(y\mid \rho,\lambda)&amp;=\sum_{i=1}^n\sum_{t=1}^T\log\left(\sum_{m\in\{\mathrm{S},\mathrm{PS},\mathrm{PC}\}}\exp(\log p(y_{i,t}\mid \rho,\lambda,m)+\log \rho_m)\right)
\end{aligned}
\]</span></p>
<div id="as-basic-as-it-gets" class="section level3 hasAnchor" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> As basic as it gets<a href="mixture-models.html#as-basic-as-it-gets" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To begin with, I will assume that <span class="math inline">\(\lambda\)</span> is homogeneous so I can just show you how a mixture model is different from a representative agent model. This will probably lead to some strange results, as it is likely that participants are heterogeneous along this dimension, but it helps to see the actual mixture part of the mixture model.</p>
<p>Here is the <em>Stan</em> file I used for the dichotomous mixture model:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb96-1"><a href="mixture-models.html#cb96-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-2"><a href="mixture-models.html#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb96-3"><a href="mixture-models.html#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co">AV2001_3typesDichotomous.stan</span></span>
<span id="cb96-4"><a href="mixture-models.html#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="co">Mixture model assuming each participant is one type forever</span></span>
<span id="cb96-5"><a href="mixture-models.html#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb96-6"><a href="mixture-models.html#cb96-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-7"><a href="mixture-models.html#cb96-7" aria-hidden="true" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb96-8"><a href="mixture-models.html#cb96-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> N<span class="op">;</span></span>
<span id="cb96-9"><a href="mixture-models.html#cb96-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> nParticipants<span class="op">;</span></span>
<span id="cb96-10"><a href="mixture-models.html#cb96-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> id<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb96-11"><a href="mixture-models.html#cb96-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> idStart<span class="op">[</span>nParticipants<span class="op">];</span></span>
<span id="cb96-12"><a href="mixture-models.html#cb96-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> idEnd<span class="op">[</span>nParticipants<span class="op">];</span></span>
<span id="cb96-13"><a href="mixture-models.html#cb96-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-14"><a href="mixture-models.html#cb96-14" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>N<span class="op">]</span> income<span class="op">;</span></span>
<span id="cb96-15"><a href="mixture-models.html#cb96-15" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>N<span class="op">]</span> pSelf<span class="op">;</span></span>
<span id="cb96-16"><a href="mixture-models.html#cb96-16" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>N<span class="op">]</span> pOther<span class="op">;</span></span>
<span id="cb96-17"><a href="mixture-models.html#cb96-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-18"><a href="mixture-models.html#cb96-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> binLength<span class="op">;</span></span>
<span id="cb96-19"><a href="mixture-models.html#cb96-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-20"><a href="mixture-models.html#cb96-20" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>binLength<span class="op">]</span> bin_grid<span class="op">;</span></span>
<span id="cb96-21"><a href="mixture-models.html#cb96-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-22"><a href="mixture-models.html#cb96-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> bin_kept<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb96-23"><a href="mixture-models.html#cb96-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-24"><a href="mixture-models.html#cb96-24" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> prior_mix<span class="op">;</span></span>
<span id="cb96-25"><a href="mixture-models.html#cb96-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-26"><a href="mixture-models.html#cb96-26" aria-hidden="true" tabindex="-1"></a>  real prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb96-27"><a href="mixture-models.html#cb96-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb96-28"><a href="mixture-models.html#cb96-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-29"><a href="mixture-models.html#cb96-29" aria-hidden="true" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb96-30"><a href="mixture-models.html#cb96-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-31"><a href="mixture-models.html#cb96-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-32"><a href="mixture-models.html#cb96-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-33"><a href="mixture-models.html#cb96-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-34"><a href="mixture-models.html#cb96-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb96-35"><a href="mixture-models.html#cb96-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-36"><a href="mixture-models.html#cb96-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-37"><a href="mixture-models.html#cb96-37" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb96-38"><a href="mixture-models.html#cb96-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-39"><a href="mixture-models.html#cb96-39" aria-hidden="true" tabindex="-1"></a>  simplex<span class="op">[</span><span class="dv">3</span><span class="op">]</span> mix<span class="op">;</span></span>
<span id="cb96-40"><a href="mixture-models.html#cb96-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-41"><a href="mixture-models.html#cb96-41" aria-hidden="true" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> lambda<span class="op">;</span></span>
<span id="cb96-42"><a href="mixture-models.html#cb96-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-43"><a href="mixture-models.html#cb96-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb96-44"><a href="mixture-models.html#cb96-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-45"><a href="mixture-models.html#cb96-45" aria-hidden="true" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb96-46"><a href="mixture-models.html#cb96-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-47"><a href="mixture-models.html#cb96-47" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> like_i<span class="op">;</span></span>
<span id="cb96-48"><a href="mixture-models.html#cb96-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-49"><a href="mixture-models.html#cb96-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>N<span class="op">)</span> <span class="op">{</span></span>
<span id="cb96-50"><a href="mixture-models.html#cb96-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-51"><a href="mixture-models.html#cb96-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Selfish</span></span>
<span id="cb96-52"><a href="mixture-models.html#cb96-52" aria-hidden="true" tabindex="-1"></a>    like_i<span class="op">[</span>ii<span class="op">,</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> log_softmax<span class="op">(</span>lambda<span class="op">*</span>income<span class="op">[</span>ii<span class="op">]*</span>bin_grid<span class="op">*</span>pSelf<span class="op">[</span>ii<span class="op">])[</span>bin_kept<span class="op">[</span>ii<span class="op">]];</span></span>
<span id="cb96-53"><a href="mixture-models.html#cb96-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Perfect substituties</span></span>
<span id="cb96-54"><a href="mixture-models.html#cb96-54" aria-hidden="true" tabindex="-1"></a>    like_i<span class="op">[</span>ii<span class="op">,</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> log_softmax<span class="op">(</span>lambda<span class="op">*</span>income<span class="op">[</span>ii<span class="op">]*(</span>bin_grid<span class="op">*</span>pSelf<span class="op">[</span>ii<span class="op">]+(</span><span class="fl">1.0</span><span class="op">-</span>bin_grid<span class="op">)*</span>pOther<span class="op">[</span>ii<span class="op">]))[</span>bin_kept<span class="op">[</span>ii<span class="op">]];</span></span>
<span id="cb96-55"><a href="mixture-models.html#cb96-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Perfect complements</span></span>
<span id="cb96-56"><a href="mixture-models.html#cb96-56" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">[</span>binLength<span class="op">]</span> UPC<span class="op">;</span></span>
<span id="cb96-57"><a href="mixture-models.html#cb96-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-58"><a href="mixture-models.html#cb96-58" aria-hidden="true" tabindex="-1"></a>    UPC <span class="op">=</span> fmin<span class="op">(</span>bin_grid<span class="op">*</span>pSelf<span class="op">[</span>ii<span class="op">],(</span><span class="fl">1.0</span><span class="op">-</span>bin_grid<span class="op">)*</span>pOther<span class="op">[</span>ii<span class="op">]);</span></span>
<span id="cb96-59"><a href="mixture-models.html#cb96-59" aria-hidden="true" tabindex="-1"></a>    like_i<span class="op">[</span>ii<span class="op">,</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> log_softmax<span class="op">(</span>lambda<span class="op">*</span>income<span class="op">[</span>ii<span class="op">]*</span>UPC<span class="op">)[</span>bin_kept<span class="op">[</span>ii<span class="op">]];</span></span>
<span id="cb96-60"><a href="mixture-models.html#cb96-60" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb96-61"><a href="mixture-models.html#cb96-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-62"><a href="mixture-models.html#cb96-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-63"><a href="mixture-models.html#cb96-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nParticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb96-64"><a href="mixture-models.html#cb96-64" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> iStart <span class="op">=</span> idStart<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb96-65"><a href="mixture-models.html#cb96-65" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> iEnd   <span class="op">=</span> idEnd<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb96-66"><a href="mixture-models.html#cb96-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-67"><a href="mixture-models.html#cb96-67" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> like_type <span class="op">=</span> like_i<span class="op">[</span>iStart<span class="op">:</span>iEnd<span class="op">,]</span>&#39;<span class="op">*</span>rep_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>iEnd<span class="op">-</span>iStart<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb96-68"><a href="mixture-models.html#cb96-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb96-69"><a href="mixture-models.html#cb96-69" aria-hidden="true" tabindex="-1"></a>    target <span class="op">+=</span> log_sum_exp<span class="op">(</span>like_type <span class="op">+</span>log<span class="op">(</span>mix<span class="op">));</span></span>
<span id="cb96-70"><a href="mixture-models.html#cb96-70" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb96-71"><a href="mixture-models.html#cb96-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-72"><a href="mixture-models.html#cb96-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb96-73"><a href="mixture-models.html#cb96-73" aria-hidden="true" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb96-74"><a href="mixture-models.html#cb96-74" aria-hidden="true" tabindex="-1"></a>  mix <span class="op">~</span> dirichlet<span class="op">(</span>prior_mix<span class="op">);</span></span>
<span id="cb96-75"><a href="mixture-models.html#cb96-75" aria-hidden="true" tabindex="-1"></a>  lambda <span class="op">~</span> lognormal<span class="op">(</span>prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb96-76"><a href="mixture-models.html#cb96-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-77"><a href="mixture-models.html#cb96-77" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And here is the <em>Stan</em> file I used for the toolbox mixture model:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb97-1"><a href="mixture-models.html#cb97-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-2"><a href="mixture-models.html#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb97-3"><a href="mixture-models.html#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="co">AV2001_3types_toolbox.stan</span></span>
<span id="cb97-4"><a href="mixture-models.html#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="co">Mixture model assuming each decision is one type</span></span>
<span id="cb97-5"><a href="mixture-models.html#cb97-5" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb97-6"><a href="mixture-models.html#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="mixture-models.html#cb97-7" aria-hidden="true" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb97-8"><a href="mixture-models.html#cb97-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> N<span class="op">;</span></span>
<span id="cb97-9"><a href="mixture-models.html#cb97-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> nParticipants<span class="op">;</span></span>
<span id="cb97-10"><a href="mixture-models.html#cb97-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> id<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb97-11"><a href="mixture-models.html#cb97-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> idStart<span class="op">[</span>nParticipants<span class="op">];</span></span>
<span id="cb97-12"><a href="mixture-models.html#cb97-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> idEnd<span class="op">[</span>nParticipants<span class="op">];</span></span>
<span id="cb97-13"><a href="mixture-models.html#cb97-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-14"><a href="mixture-models.html#cb97-14" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>N<span class="op">]</span> income<span class="op">;</span></span>
<span id="cb97-15"><a href="mixture-models.html#cb97-15" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>N<span class="op">]</span> pSelf<span class="op">;</span></span>
<span id="cb97-16"><a href="mixture-models.html#cb97-16" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>N<span class="op">]</span> pOther<span class="op">;</span></span>
<span id="cb97-17"><a href="mixture-models.html#cb97-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-18"><a href="mixture-models.html#cb97-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> binLength<span class="op">;</span></span>
<span id="cb97-19"><a href="mixture-models.html#cb97-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-20"><a href="mixture-models.html#cb97-20" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>binLength<span class="op">]</span> bin_grid<span class="op">;</span></span>
<span id="cb97-21"><a href="mixture-models.html#cb97-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-22"><a href="mixture-models.html#cb97-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> bin_kept<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb97-23"><a href="mixture-models.html#cb97-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-24"><a href="mixture-models.html#cb97-24" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> prior_mix<span class="op">;</span></span>
<span id="cb97-25"><a href="mixture-models.html#cb97-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-26"><a href="mixture-models.html#cb97-26" aria-hidden="true" tabindex="-1"></a>  real prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb97-27"><a href="mixture-models.html#cb97-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb97-28"><a href="mixture-models.html#cb97-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-29"><a href="mixture-models.html#cb97-29" aria-hidden="true" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb97-30"><a href="mixture-models.html#cb97-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-31"><a href="mixture-models.html#cb97-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-32"><a href="mixture-models.html#cb97-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-33"><a href="mixture-models.html#cb97-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-34"><a href="mixture-models.html#cb97-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb97-35"><a href="mixture-models.html#cb97-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-36"><a href="mixture-models.html#cb97-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-37"><a href="mixture-models.html#cb97-37" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb97-38"><a href="mixture-models.html#cb97-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-39"><a href="mixture-models.html#cb97-39" aria-hidden="true" tabindex="-1"></a>  simplex<span class="op">[</span><span class="dv">3</span><span class="op">]</span> mix<span class="op">;</span></span>
<span id="cb97-40"><a href="mixture-models.html#cb97-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-41"><a href="mixture-models.html#cb97-41" aria-hidden="true" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> lambda<span class="op">;</span></span>
<span id="cb97-42"><a href="mixture-models.html#cb97-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-43"><a href="mixture-models.html#cb97-43" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb97-44"><a href="mixture-models.html#cb97-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-45"><a href="mixture-models.html#cb97-45" aria-hidden="true" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb97-46"><a href="mixture-models.html#cb97-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-47"><a href="mixture-models.html#cb97-47" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> like_i<span class="op">;</span></span>
<span id="cb97-48"><a href="mixture-models.html#cb97-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-49"><a href="mixture-models.html#cb97-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>N<span class="op">)</span> <span class="op">{</span></span>
<span id="cb97-50"><a href="mixture-models.html#cb97-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-51"><a href="mixture-models.html#cb97-51" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Selfish</span></span>
<span id="cb97-52"><a href="mixture-models.html#cb97-52" aria-hidden="true" tabindex="-1"></a>    like_i<span class="op">[</span>ii<span class="op">,</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> log_softmax<span class="op">(</span>lambda<span class="op">*</span>income<span class="op">[</span>ii<span class="op">]*</span>bin_grid<span class="op">*</span>pSelf<span class="op">[</span>ii<span class="op">])[</span>bin_kept<span class="op">[</span>ii<span class="op">]];</span></span>
<span id="cb97-53"><a href="mixture-models.html#cb97-53" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Perfect substituties</span></span>
<span id="cb97-54"><a href="mixture-models.html#cb97-54" aria-hidden="true" tabindex="-1"></a>    like_i<span class="op">[</span>ii<span class="op">,</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> log_softmax<span class="op">(</span>lambda<span class="op">*</span>income<span class="op">[</span>ii<span class="op">]*(</span>bin_grid<span class="op">*</span>pSelf<span class="op">[</span>ii<span class="op">]+(</span><span class="fl">1.0</span><span class="op">-</span>bin_grid<span class="op">)*</span>pOther<span class="op">[</span>ii<span class="op">]))[</span>bin_kept<span class="op">[</span>ii<span class="op">]];</span></span>
<span id="cb97-55"><a href="mixture-models.html#cb97-55" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Perfect complements</span></span>
<span id="cb97-56"><a href="mixture-models.html#cb97-56" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">[</span>binLength<span class="op">]</span> UPC<span class="op">;</span></span>
<span id="cb97-57"><a href="mixture-models.html#cb97-57" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-58"><a href="mixture-models.html#cb97-58" aria-hidden="true" tabindex="-1"></a>    UPC <span class="op">=</span> fmin<span class="op">(</span>bin_grid<span class="op">*</span>pSelf<span class="op">[</span>ii<span class="op">],(</span><span class="fl">1.0</span><span class="op">-</span>bin_grid<span class="op">)*</span>pOther<span class="op">[</span>ii<span class="op">]);</span></span>
<span id="cb97-59"><a href="mixture-models.html#cb97-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-60"><a href="mixture-models.html#cb97-60" aria-hidden="true" tabindex="-1"></a>    like_i<span class="op">[</span>ii<span class="op">,</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> log_softmax<span class="op">(</span>lambda<span class="op">*</span>income<span class="op">[</span>ii<span class="op">]*</span>UPC<span class="op">)[</span>bin_kept<span class="op">[</span>ii<span class="op">]];</span></span>
<span id="cb97-61"><a href="mixture-models.html#cb97-61" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-62"><a href="mixture-models.html#cb97-62" aria-hidden="true" tabindex="-1"></a>    target <span class="op">+=</span> log_sum_exp<span class="op">(</span>like_i<span class="op">[</span>ii<span class="op">,]</span>&#39;<span class="op">+</span>log<span class="op">(</span>mix<span class="op">));</span></span>
<span id="cb97-63"><a href="mixture-models.html#cb97-63" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb97-64"><a href="mixture-models.html#cb97-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-65"><a href="mixture-models.html#cb97-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-66"><a href="mixture-models.html#cb97-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb97-67"><a href="mixture-models.html#cb97-67" aria-hidden="true" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb97-68"><a href="mixture-models.html#cb97-68" aria-hidden="true" tabindex="-1"></a>  mix <span class="op">~</span> dirichlet<span class="op">(</span>prior_mix<span class="op">);</span></span>
<span id="cb97-69"><a href="mixture-models.html#cb97-69" aria-hidden="true" tabindex="-1"></a>  lambda <span class="op">~</span> lognormal<span class="op">(</span>prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb97-70"><a href="mixture-models.html#cb97-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-71"><a href="mixture-models.html#cb97-71" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>As you can see, there isn’t much of a difference between them: only the way the model-specific likelihoods enter the grand likelihood. Note that the only difference between them is in the <code>model</code> block, and even then after all of the likelihoods for the individual models are calculated.</p>
<p>A problem I ran into when coding this was that the token endowment was different for different decisions. As participants could choose an endowment in integer multiples of tokens, this means that the size of the choice set changes with the variable <code>income</code>. I decided to re-scale the problem by focusing on the derived variable <span class="math inline">\(y_{i,t}\)</span>, which is the <em>fraction</em> of tokens kept by the participant. I then discrietize this fraction into 20 evenly-spaced bins, which I call <code>bin_grid</code>, and generate the variable <code>bin_kept</code>, which identifies the closest fraction on the grid to the actual fraction <span class="math inline">\(y_{i,t}\)</span>.</p>
<p>Now that we have the models coded up, we can move on to thinking about priors. As you can see in the above code, I have chosen a log-normal prior for <span class="math inline">\(\lambda\)</span>. This makes sense because <span class="math inline">\(\lambda\)</span> must be greater than zero. For the mixing probabilities, their support is the 3-dimensional simplex. A good choice of prior when we have a parameter that has a simplex support is the <em>Dirichlet</em> distribution, which is a generalization of the Beta distribution to more than two categories. That is, the Beta distribution is to binary variables as the Dirichlet distribution is to categorical variables. For <span class="math inline">\(\rho\)</span> then, I choose a prior of:</p>
<p><span class="math display">\[
\rho \sim \mathrm{Dirichlet}\left(\begin{pmatrix}1&amp;1&amp;1\end{pmatrix}^\top\right)
\]</span></p>
<p>which is reasonably spread out. For perspective, the marginal prior for the any of the types implied by this distribution is:</p>
<p><span class="math display">\[
\rho^X\sim \mathrm{Beta}(1,2),\quad X\in\{\mathrm{S},\mathrm{PS},\mathrm{PC}\}
\]</span></p>
<p>which has a prior mean of <span class="math inline">\(E[\rho^X]=\frac{1}{1+2}=\frac13\)</span>, so on average each type is equally likely.</p>
<p>While we might be much more interested in our estimates of <span class="math inline">\(\rho\)</span>, we also need to be careful in choosing a prior for <span class="math inline">\(\lambda\)</span>. To investigate what reasonable values of <span class="math inline">\(\lambda\)</span> could be, we can plot the implied probability distribution of actions for several different values of <span class="math inline">\(\lambda\)</span>. To get a feel for an appropriate scale for <span class="math inline">\(\lambda\)</span>, I do this for several values of <span class="math inline">\(\lambda\)</span> for <span class="math inline">\(\mathrm{pSelf}=1\)</span>, <span class="math inline">\(\mathrm{pOther}=2\)</span> and <span class="math inline">\(\mathrm{income}=50\)</span>. This is shown in Figure <a href="mixture-models.html#fig:MixtureModelsLambdaCalibration">7.2</a>. Here it seems that there is enough plausible behavior happening in all of these panels, so we should choose a prior that does places a fair amount of mass over most of this range. The following prior achieves this, and centers the median prediction on the <span class="math inline">\(\lambda=1\)</span> panels:</p>
<p><span class="math display">\[
\log\lambda\sim N(\log1,1^2)
\]</span></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="mixture-models.html#cb98-1" aria-hidden="true" tabindex="-1"></a>pSelf<span class="ot">&lt;-</span><span class="dv">1</span></span>
<span id="cb98-2"><a href="mixture-models.html#cb98-2" aria-hidden="true" tabindex="-1"></a>pOther<span class="ot">&lt;-</span><span class="dv">2</span></span>
<span id="cb98-3"><a href="mixture-models.html#cb98-3" aria-hidden="true" tabindex="-1"></a>income<span class="ot">&lt;-</span><span class="dv">50</span></span>
<span id="cb98-4"><a href="mixture-models.html#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="mixture-models.html#cb98-5" aria-hidden="true" tabindex="-1"></a>d<span class="ot">&lt;-</span><span class="fu">expand_grid</span>(<span class="at">fraction_kept =</span> <span class="fu">seq</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>,<span class="at">by=</span><span class="fl">0.05</span>),</span>
<span id="cb98-6"><a href="mixture-models.html#cb98-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">lambda =</span> <span class="fu">c</span>(<span class="fl">0.01</span>,<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="dv">10</span>),</span>
<span id="cb98-7"><a href="mixture-models.html#cb98-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;S&quot;</span>,<span class="st">&quot;PS&quot;</span>,<span class="st">&quot;PC&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb98-8"><a href="mixture-models.html#cb98-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb98-9"><a href="mixture-models.html#cb98-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">LU =</span> <span class="fu">ifelse</span>(type<span class="sc">==</span><span class="st">&quot;S&quot;</span>,lambda<span class="sc">*</span>income<span class="sc">*</span>fraction_kept<span class="sc">*</span>pSelf,</span>
<span id="cb98-10"><a href="mixture-models.html#cb98-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ifelse</span>(type<span class="sc">==</span><span class="st">&quot;PS&quot;</span>,lambda<span class="sc">*</span>income<span class="sc">*</span>(fraction_kept<span class="sc">*</span>pSelf<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>fraction_kept)<span class="sc">*</span>pOther),</span>
<span id="cb98-11"><a href="mixture-models.html#cb98-11" aria-hidden="true" tabindex="-1"></a>                     lambda<span class="sc">*</span>income<span class="sc">*</span><span class="fu">min</span>(fraction_kept<span class="sc">*</span>pSelf,(<span class="dv">1</span><span class="sc">-</span>fraction_kept)<span class="sc">*</span>pOther))</span>
<span id="cb98-12"><a href="mixture-models.html#cb98-12" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb98-13"><a href="mixture-models.html#cb98-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb98-14"><a href="mixture-models.html#cb98-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb98-15"><a href="mixture-models.html#cb98-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(type,lambda,fraction_kept) <span class="sc">|&gt;</span></span>
<span id="cb98-16"><a href="mixture-models.html#cb98-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type,lambda) <span class="sc">|&gt;</span></span>
<span id="cb98-17"><a href="mixture-models.html#cb98-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">expLU =</span> <span class="fu">exp</span>(LU<span class="sc">-</span><span class="fu">max</span>(LU)),</span>
<span id="cb98-18"><a href="mixture-models.html#cb98-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">p =</span> expLU<span class="sc">/</span><span class="fu">sum</span>(expLU),</span>
<span id="cb98-19"><a href="mixture-models.html#cb98-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">lambda =</span> <span class="fu">paste</span>(<span class="st">&quot;\u03bb =&quot;</span>,lambda)</span>
<span id="cb98-20"><a href="mixture-models.html#cb98-20" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb98-21"><a href="mixture-models.html#cb98-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-22"><a href="mixture-models.html#cb98-22" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb98-23"><a href="mixture-models.html#cb98-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data=</span>d,<span class="fu">aes</span>(<span class="at">x=</span>fraction_kept,<span class="at">y=</span>p))</span>
<span id="cb98-24"><a href="mixture-models.html#cb98-24" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_path</span>()</span>
<span id="cb98-25"><a href="mixture-models.html#cb98-25" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">facet_grid</span>(lambda <span class="sc">~</span> type,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>)</span>
<span id="cb98-26"><a href="mixture-models.html#cb98-26" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb98-27"><a href="mixture-models.html#cb98-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-28"><a href="mixture-models.html#cb98-28" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:MixtureModelsLambdaCalibration"></span>
<img src="index_files/figure-html/MixtureModelsLambdaCalibration-1.png" alt="Implied choice probabilities for various values of $\lambda$." width="672" />
<p class="caption">
Figure 7.2: Implied choice probabilities for various values of <span class="math inline">\(\lambda\)</span>.
</p>
</div>
<p>Now that we have fully specified the likelihood and priors, we can go and estimate the model! Since <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span> were interested in differences in other-regarding preferences between male and female participants, I estimate both the dichotomous and toolbox models using all of the data, as well as estimating them just with the female participants, and just with the male participants. The estimates can be seen in Table <a href="mixture-models.html#tab:MixtureModelsHomogeneousTable">7.1</a>.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="mixture-models.html#cb99-1" aria-hidden="true" tabindex="-1"></a>rounding<span class="ot">&lt;-</span><span class="dv">3</span></span>
<span id="cb99-2"><a href="mixture-models.html#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="mixture-models.html#cb99-3" aria-hidden="true" tabindex="-1"></a>FileList<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">&quot;Code/MixtureModels&quot;</span>)</span>
<span id="cb99-4"><a href="mixture-models.html#cb99-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a href="mixture-models.html#cb99-5" aria-hidden="true" tabindex="-1"></a>FileList<span class="ot">&lt;-</span>FileList[<span class="fu">grepl</span>(<span class="st">&quot;AV2001Dichotomous&quot;</span>,FileList) <span class="sc">|</span> <span class="fu">grepl</span>(<span class="st">&quot;AV2001Toolbox&quot;</span>,FileList)]</span>
<span id="cb99-6"><a href="mixture-models.html#cb99-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-7"><a href="mixture-models.html#cb99-7" aria-hidden="true" tabindex="-1"></a>EstSum<span class="ot">&lt;-</span><span class="fu">data.frame</span>()</span>
<span id="cb99-8"><a href="mixture-models.html#cb99-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-9"><a href="mixture-models.html#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ff <span class="cf">in</span> FileList) {</span>
<span id="cb99-10"><a href="mixture-models.html#cb99-10" aria-hidden="true" tabindex="-1"></a>  EstSum<span class="ot">&lt;-</span><span class="fu">summary</span>(<span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;Code/MixtureModels/&quot;</span>,ff)))<span class="sc">$</span>summary <span class="sc">|&gt;</span></span>
<span id="cb99-11"><a href="mixture-models.html#cb99-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb99-12"><a href="mixture-models.html#cb99-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">file=</span>ff,</span>
<span id="cb99-13"><a href="mixture-models.html#cb99-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">parameter =</span> <span class="fu">c</span>(<span class="st">&quot;Mix: S&quot;</span>,<span class="st">&quot;Mix: PS&quot;</span>,<span class="st">&quot;Mix: PC&quot;</span>,<span class="st">&quot;lambda&quot;</span>,<span class="st">&quot;lp__&quot;</span>)</span>
<span id="cb99-14"><a href="mixture-models.html#cb99-14" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">|&gt;</span></span>
<span id="cb99-15"><a href="mixture-models.html#cb99-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(EstSum)</span>
<span id="cb99-16"><a href="mixture-models.html#cb99-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb99-17"><a href="mixture-models.html#cb99-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-18"><a href="mixture-models.html#cb99-18" aria-hidden="true" tabindex="-1"></a>EstSum<span class="ot">&lt;-</span>EstSum <span class="sc">|&gt;</span></span>
<span id="cb99-19"><a href="mixture-models.html#cb99-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb99-20"><a href="mixture-models.html#cb99-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Model type</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;Dichotomous&quot;</span>,file),<span class="st">&quot;Dichotomous&quot;</span>,<span class="st">&quot;Toolbox&quot;</span>),</span>
<span id="cb99-21"><a href="mixture-models.html#cb99-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Group =</span> <span class="fu">sub</span>(<span class="st">&quot;.rds&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="fu">sub</span>(<span class="st">&quot;.*_&quot;</span>,<span class="st">&quot;&quot;</span>,file)),</span>
<span id="cb99-22"><a href="mixture-models.html#cb99-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">msd =</span> <span class="fu">paste0</span>(</span>
<span id="cb99-23"><a href="mixture-models.html#cb99-23" aria-hidden="true" tabindex="-1"></a>      mean <span class="sc">|&gt;</span> <span class="fu">round</span>(rounding),</span>
<span id="cb99-24"><a href="mixture-models.html#cb99-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot; (&quot;</span>,sd <span class="sc">|&gt;</span> <span class="fu">round</span>(rounding),<span class="st">&quot;)&quot;</span></span>
<span id="cb99-25"><a href="mixture-models.html#cb99-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb99-26"><a href="mixture-models.html#cb99-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb99-27"><a href="mixture-models.html#cb99-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(parameter,<span class="st">`</span><span class="at">Model type</span><span class="st">`</span>,Group,msd)<span class="sc">|&gt;</span></span>
<span id="cb99-28"><a href="mixture-models.html#cb99-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">Model type</span><span class="st">`</span>,Group),<span class="at">values_from =</span> msd,<span class="at">names_sep=</span><span class="st">&quot; &quot;</span>)</span>
<span id="cb99-29"><a href="mixture-models.html#cb99-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-30"><a href="mixture-models.html#cb99-30" aria-hidden="true" tabindex="-1"></a>EstSum <span class="sc">|&gt;</span> <span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Estimates from the 3-type mixture model using data from Andreoni and Vesterlund (2001).&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">kable_classic</span>(<span class="at">full_width=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:MixtureModelsHomogeneousTable">Table 7.1: </span>Estimates from the 3-type mixture model using data from Andreoni and Vesterlund (2001).
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:left;">
Toolbox Male
</th>
<th style="text-align:left;">
Toolbox Female
</th>
<th style="text-align:left;">
Toolbox Both
</th>
<th style="text-align:left;">
Dichotomous Male
</th>
<th style="text-align:left;">
Dichotomous Female
</th>
<th style="text-align:left;">
Dichotomous Both
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Mix: S
</td>
<td style="text-align:left;">
0.468 (0.023)
</td>
<td style="text-align:left;">
0.386 (0.03)
</td>
<td style="text-align:left;">
0.44 (0.019)
</td>
<td style="text-align:left;">
0.01 (0.01)
</td>
<td style="text-align:left;">
0.507 (0.291)
</td>
<td style="text-align:left;">
0.453 (0.042)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mix: PS
</td>
<td style="text-align:left;">
0.192 (0.022)
</td>
<td style="text-align:left;">
0.044 (0.022)
</td>
<td style="text-align:left;">
0.148 (0.017)
</td>
<td style="text-align:left;">
0.01 (0.01)
</td>
<td style="text-align:left;">
0.473 (0.29)
</td>
<td style="text-align:left;">
0.153 (0.031)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mix: PC
</td>
<td style="text-align:left;">
0.34 (0.019)
</td>
<td style="text-align:left;">
0.57 (0.029)
</td>
<td style="text-align:left;">
0.412 (0.017)
</td>
<td style="text-align:left;">
0.98 (0.014)
</td>
<td style="text-align:left;">
0.02 (0.019)
</td>
<td style="text-align:left;">
0.394 (0.041)
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda
</td>
<td style="text-align:left;">
0.19 (0.009)
</td>
<td style="text-align:left;">
0.158 (0.011)
</td>
<td style="text-align:left;">
0.18 (0.007)
</td>
<td style="text-align:left;">
0.377 (0.039)
</td>
<td style="text-align:left;">
2.515 (2.131)
</td>
<td style="text-align:left;">
0.137 (0.004)
</td>
</tr>
<tr>
<td style="text-align:left;">
lp__
</td>
<td style="text-align:left;">
-1730.788 (1.208)
</td>
<td style="text-align:left;">
-919.796 (1.248)
</td>
<td style="text-align:left;">
-2666.643 (1.259)
</td>
<td style="text-align:left;">
-169.494 (1.271)
</td>
<td style="text-align:left;">
-9.075 (1.329)
</td>
<td style="text-align:left;">
-2334.515 (1.23)
</td>
</tr>
</tbody>
</table>
<p>Since the dichotomous models have a much more similar interpretation to the original nonlinear least squares classification of <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span>, I will focus on these estimates. In particular, they are most similar to the “Total” columns in their Table III. Overall, the “Dichotomous Both” model (rightmost column) is estimating that we have about 45% selfish, 15% perfect substitutes, and 40% perfect complements participants. This is compared to 43% selfish, 21% perfect substitutes, and 35% perfect complements classified in <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span>. Given some substantial differences in the estimation strategies used, these estimates are remarkably similar. However the similarity does not hold up when we slice the data by male and female participants. My dichotomous mixture model for example, estimates that almost all (98%) male participants are perfect complements types, whereas the equivalent number in <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span> is 25%. Also, for the female participants, I estimate about 47% are perfect substitutes types, but <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span> estimate this to be about 9%.</p>
<p>In this case, if I had to choose one of these estimation strategies, I would have gone with the original nonlinear least squares approach in <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span>. This is mainly because I suspect that the assumption in my model that <span class="math inline">\(\lambda\)</span> is homogeneous is a terrible one. In fact, <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span> note that they can classify 47% of male and 36% of female participants based on their choices <em>perfectly</em> matching one of the three types’ predictions. This, coupled with the remaining fractions <em>not</em> being classified by perfectly matching predictions, suggests that there should be substantial heterogeneity in <span class="math inline">\(\lambda\)</span>. I will extend the dichotomous model in the next section to account for this.</p>
</div>
<div id="adding-some-heterogeneity" class="section level3 hasAnchor" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> Adding some heterogeneity<a href="mixture-models.html#adding-some-heterogeneity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>From here, it is not too difficult to add some heterogeneity to <span class="math inline">\(\lambda\)</span> by including a hierarchical component. Using a log-normal distribution to ensure that each <span class="math inline">\(\lambda_i\)</span> is positive, the new population-level part of the model is:</p>
<p><span class="math display">\[
\log \lambda_i\sim N(\mu_\lambda,\sigma^2_\lambda)
\]</span></p>
<p>Since we now have this hierarchical structure on <span class="math inline">\(\lambda_i\)</span>, we need to choose priors for <span class="math inline">\(\mu_\lambda\)</span> and <span class="math inline">\(\sigma_\lambda\)</span>. For this application, I choose:</p>
<p><span class="math display">\[
\begin{aligned}
\mu_\lambda&amp;\sim N(0,1)\\
\sigma_\lambda&amp;\sim\mathrm{Cauchy}^+(0,0.05)
\end{aligned}
\]</span></p>
<p>Here is the <em>Stan</em> program that estimates the dichotomous model. For this section, I will just focus on the dichotomous model because it is most similar to the classification in <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span>.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb100-1"><a href="mixture-models.html#cb100-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-2"><a href="mixture-models.html#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb100-3"><a href="mixture-models.html#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co">AV2001_3types_dichotomous_hlambda.stan</span></span>
<span id="cb100-4"><a href="mixture-models.html#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co">Mixture model assuming each participant is one type forever</span></span>
<span id="cb100-5"><a href="mixture-models.html#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="co">lambda is participant specific and log-normally distributed</span></span>
<span id="cb100-6"><a href="mixture-models.html#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb100-7"><a href="mixture-models.html#cb100-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-8"><a href="mixture-models.html#cb100-8" aria-hidden="true" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb100-9"><a href="mixture-models.html#cb100-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> N<span class="op">;</span></span>
<span id="cb100-10"><a href="mixture-models.html#cb100-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> nParticipants<span class="op">;</span></span>
<span id="cb100-11"><a href="mixture-models.html#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> id<span class="op">[</span>N<span class="op">];</span> </span>
<span id="cb100-12"><a href="mixture-models.html#cb100-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> idStart<span class="op">[</span>nParticipants<span class="op">];</span></span>
<span id="cb100-13"><a href="mixture-models.html#cb100-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> idEnd<span class="op">[</span>nParticipants<span class="op">];</span></span>
<span id="cb100-14"><a href="mixture-models.html#cb100-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-15"><a href="mixture-models.html#cb100-15" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>N<span class="op">]</span> income<span class="op">;</span> </span>
<span id="cb100-16"><a href="mixture-models.html#cb100-16" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>N<span class="op">]</span> pSelf<span class="op">;</span></span>
<span id="cb100-17"><a href="mixture-models.html#cb100-17" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>N<span class="op">]</span> pOther<span class="op">;</span></span>
<span id="cb100-18"><a href="mixture-models.html#cb100-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-19"><a href="mixture-models.html#cb100-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> binLength<span class="op">;</span></span>
<span id="cb100-20"><a href="mixture-models.html#cb100-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-21"><a href="mixture-models.html#cb100-21" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>binLength<span class="op">]</span> bin_grid<span class="op">;</span></span>
<span id="cb100-22"><a href="mixture-models.html#cb100-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-23"><a href="mixture-models.html#cb100-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> bin_kept<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb100-24"><a href="mixture-models.html#cb100-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-25"><a href="mixture-models.html#cb100-25" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> prior_mix<span class="op">;</span></span>
<span id="cb100-26"><a href="mixture-models.html#cb100-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-27"><a href="mixture-models.html#cb100-27" aria-hidden="true" tabindex="-1"></a>  real prior_lambda_mean<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb100-28"><a href="mixture-models.html#cb100-28" aria-hidden="true" tabindex="-1"></a>  real prior_lambda_sd<span class="op">;</span></span>
<span id="cb100-29"><a href="mixture-models.html#cb100-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb100-30"><a href="mixture-models.html#cb100-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-31"><a href="mixture-models.html#cb100-31" aria-hidden="true" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb100-32"><a href="mixture-models.html#cb100-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-33"><a href="mixture-models.html#cb100-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-34"><a href="mixture-models.html#cb100-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-35"><a href="mixture-models.html#cb100-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-36"><a href="mixture-models.html#cb100-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb100-37"><a href="mixture-models.html#cb100-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-38"><a href="mixture-models.html#cb100-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-39"><a href="mixture-models.html#cb100-39" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb100-40"><a href="mixture-models.html#cb100-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-41"><a href="mixture-models.html#cb100-41" aria-hidden="true" tabindex="-1"></a>  simplex<span class="op">[</span><span class="dv">3</span><span class="op">]</span> mix<span class="op">;</span></span>
<span id="cb100-42"><a href="mixture-models.html#cb100-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-43"><a href="mixture-models.html#cb100-43" aria-hidden="true" tabindex="-1"></a>  real lambdaMean<span class="op">;</span></span>
<span id="cb100-44"><a href="mixture-models.html#cb100-44" aria-hidden="true" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> lambdaSD<span class="op">;</span></span>
<span id="cb100-45"><a href="mixture-models.html#cb100-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-46"><a href="mixture-models.html#cb100-46" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;[</span>nParticipants<span class="op">]</span> lambda<span class="op">;</span></span>
<span id="cb100-47"><a href="mixture-models.html#cb100-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-48"><a href="mixture-models.html#cb100-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb100-49"><a href="mixture-models.html#cb100-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-50"><a href="mixture-models.html#cb100-50" aria-hidden="true" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb100-51"><a href="mixture-models.html#cb100-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-52"><a href="mixture-models.html#cb100-52" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> like_i<span class="op">;</span></span>
<span id="cb100-53"><a href="mixture-models.html#cb100-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-54"><a href="mixture-models.html#cb100-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>N<span class="op">)</span> <span class="op">{</span></span>
<span id="cb100-55"><a href="mixture-models.html#cb100-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb100-56"><a href="mixture-models.html#cb100-56" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Selfish</span></span>
<span id="cb100-57"><a href="mixture-models.html#cb100-57" aria-hidden="true" tabindex="-1"></a>    like_i<span class="op">[</span>ii<span class="op">,</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> log_softmax<span class="op">(</span>lambda<span class="op">[</span>id<span class="op">[</span>ii<span class="op">]]*</span>income<span class="op">[</span>ii<span class="op">]*</span>bin_grid<span class="op">*</span>pSelf<span class="op">[</span>ii<span class="op">])[</span>bin_kept<span class="op">[</span>ii<span class="op">]];</span></span>
<span id="cb100-58"><a href="mixture-models.html#cb100-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Perfect substituties</span></span>
<span id="cb100-59"><a href="mixture-models.html#cb100-59" aria-hidden="true" tabindex="-1"></a>    like_i<span class="op">[</span>ii<span class="op">,</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> log_softmax<span class="op">(</span>lambda<span class="op">[</span>id<span class="op">[</span>ii<span class="op">]]*</span>income<span class="op">[</span>ii<span class="op">]*(</span>bin_grid<span class="op">*</span>pSelf<span class="op">[</span>ii<span class="op">]+(</span><span class="fl">1.0</span><span class="op">-</span>bin_grid<span class="op">)*</span>pOther<span class="op">[</span>ii<span class="op">]))[</span>bin_kept<span class="op">[</span>ii<span class="op">]];</span></span>
<span id="cb100-60"><a href="mixture-models.html#cb100-60" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Perfect complements</span></span>
<span id="cb100-61"><a href="mixture-models.html#cb100-61" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">[</span>binLength<span class="op">]</span> UPC<span class="op">;</span></span>
<span id="cb100-62"><a href="mixture-models.html#cb100-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb100-63"><a href="mixture-models.html#cb100-63" aria-hidden="true" tabindex="-1"></a>    UPC <span class="op">=</span> fmin<span class="op">(</span>bin_grid<span class="op">*</span>pSelf<span class="op">[</span>ii<span class="op">],(</span><span class="fl">1.0</span><span class="op">-</span>bin_grid<span class="op">)*</span>pOther<span class="op">[</span>ii<span class="op">]);</span></span>
<span id="cb100-64"><a href="mixture-models.html#cb100-64" aria-hidden="true" tabindex="-1"></a>    like_i<span class="op">[</span>ii<span class="op">,</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> log_softmax<span class="op">(</span>lambda<span class="op">[</span>id<span class="op">[</span>ii<span class="op">]]*</span>income<span class="op">[</span>ii<span class="op">]*</span>UPC<span class="op">)[</span>bin_kept<span class="op">[</span>ii<span class="op">]];</span></span>
<span id="cb100-65"><a href="mixture-models.html#cb100-65" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb100-66"><a href="mixture-models.html#cb100-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-67"><a href="mixture-models.html#cb100-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-68"><a href="mixture-models.html#cb100-68" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nParticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb100-69"><a href="mixture-models.html#cb100-69" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> iStart <span class="op">=</span> idStart<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb100-70"><a href="mixture-models.html#cb100-70" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> iEnd   <span class="op">=</span> idEnd<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb100-71"><a href="mixture-models.html#cb100-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb100-72"><a href="mixture-models.html#cb100-72" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> like_type <span class="op">=</span> like_i<span class="op">[</span>iStart<span class="op">:</span>iEnd<span class="op">,]</span>&#39;<span class="op">*</span>rep_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>iEnd<span class="op">-</span>iStart<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb100-73"><a href="mixture-models.html#cb100-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb100-74"><a href="mixture-models.html#cb100-74" aria-hidden="true" tabindex="-1"></a>    target <span class="op">+=</span> log_sum_exp<span class="op">(</span>like_type <span class="op">+</span>log<span class="op">(</span>mix<span class="op">));</span></span>
<span id="cb100-75"><a href="mixture-models.html#cb100-75" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb100-76"><a href="mixture-models.html#cb100-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-77"><a href="mixture-models.html#cb100-77" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-78"><a href="mixture-models.html#cb100-78" aria-hidden="true" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb100-79"><a href="mixture-models.html#cb100-79" aria-hidden="true" tabindex="-1"></a>  mix <span class="op">~</span> dirichlet<span class="op">(</span>prior_mix<span class="op">);</span></span>
<span id="cb100-80"><a href="mixture-models.html#cb100-80" aria-hidden="true" tabindex="-1"></a>  lambdaMean <span class="op">~</span> normal<span class="op">(</span>prior_lambda_mean<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda_mean<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb100-81"><a href="mixture-models.html#cb100-81" aria-hidden="true" tabindex="-1"></a>  lambdaSD <span class="op">~</span> cauchy<span class="op">(</span><span class="dv">0</span><span class="op">,</span>prior_lambda_sd<span class="op">);</span></span>
<span id="cb100-82"><a href="mixture-models.html#cb100-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-83"><a href="mixture-models.html#cb100-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-84"><a href="mixture-models.html#cb100-84" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Hierarchical structure</span></span>
<span id="cb100-85"><a href="mixture-models.html#cb100-85" aria-hidden="true" tabindex="-1"></a>  lambda <span class="op">~</span> lognormal<span class="op">(</span>lambdaMean<span class="op">,</span>lambdaSD<span class="op">);</span></span>
<span id="cb100-86"><a href="mixture-models.html#cb100-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-87"><a href="mixture-models.html#cb100-87" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>As before, I estimate the model using all of the data, as well as the data for male and female participants separately. Here is a posterior distribution summary table of these models:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="mixture-models.html#cb101-1" aria-hidden="true" tabindex="-1"></a>rounding<span class="ot">&lt;-</span><span class="dv">3</span></span>
<span id="cb101-2"><a href="mixture-models.html#cb101-2" aria-hidden="true" tabindex="-1"></a>FileList<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">&quot;Code/MixtureModels&quot;</span>)</span>
<span id="cb101-3"><a href="mixture-models.html#cb101-3" aria-hidden="true" tabindex="-1"></a>FileList<span class="ot">&lt;-</span>FileList[<span class="fu">grepl</span>(<span class="st">&quot;AV2001hlambdaDichotomous&quot;</span>,FileList)]</span>
<span id="cb101-4"><a href="mixture-models.html#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="mixture-models.html#cb101-5" aria-hidden="true" tabindex="-1"></a>EstSum<span class="ot">&lt;-</span><span class="fu">data.frame</span>()</span>
<span id="cb101-6"><a href="mixture-models.html#cb101-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-7"><a href="mixture-models.html#cb101-7" aria-hidden="true" tabindex="-1"></a>SelectThis<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;mix[1]&quot;</span>,<span class="st">&quot;mix[2]&quot;</span>,<span class="st">&quot;mix[3]&quot;</span>,<span class="st">&quot;lambdaMean&quot;</span>,<span class="st">&quot;lambdaSD&quot;</span>)</span>
<span id="cb101-8"><a href="mixture-models.html#cb101-8" aria-hidden="true" tabindex="-1"></a>labels<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;Mix: S&quot;</span>,<span class="st">&quot;Mix: PS&quot;</span>,<span class="st">&quot;Mix: PC&quot;</span>,<span class="st">&quot;\u03bb mean&quot;</span>,<span class="st">&quot;\u03bb sd&quot;</span>)</span>
<span id="cb101-9"><a href="mixture-models.html#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ff <span class="cf">in</span> FileList) {</span>
<span id="cb101-10"><a href="mixture-models.html#cb101-10" aria-hidden="true" tabindex="-1"></a>  EstSum<span class="ot">&lt;-</span><span class="fu">summary</span>(<span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;Code/MixtureModels/&quot;</span>,ff)))<span class="sc">$</span>summary[SelectThis,] <span class="sc">|&gt;</span></span>
<span id="cb101-11"><a href="mixture-models.html#cb101-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb101-12"><a href="mixture-models.html#cb101-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">parameter =</span> labels,</span>
<span id="cb101-13"><a href="mixture-models.html#cb101-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">file =</span> ff</span>
<span id="cb101-14"><a href="mixture-models.html#cb101-14" aria-hidden="true" tabindex="-1"></a>           ) <span class="sc">|&gt;</span></span>
<span id="cb101-15"><a href="mixture-models.html#cb101-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rbind</span>(EstSum)</span>
<span id="cb101-16"><a href="mixture-models.html#cb101-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb101-17"><a href="mixture-models.html#cb101-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-18"><a href="mixture-models.html#cb101-18" aria-hidden="true" tabindex="-1"></a>EstSum<span class="ot">&lt;-</span>EstSum <span class="sc">|&gt;</span></span>
<span id="cb101-19"><a href="mixture-models.html#cb101-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb101-20"><a href="mixture-models.html#cb101-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Model type</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">&quot;Dichotomous&quot;</span>,file),<span class="st">&quot;Dichotomous&quot;</span>,<span class="st">&quot;Toolbox&quot;</span>),</span>
<span id="cb101-21"><a href="mixture-models.html#cb101-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">Group =</span> <span class="fu">sub</span>(<span class="st">&quot;.rds&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="fu">sub</span>(<span class="st">&quot;.*_&quot;</span>,<span class="st">&quot;&quot;</span>,file)),</span>
<span id="cb101-22"><a href="mixture-models.html#cb101-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">msd =</span> <span class="fu">paste0</span>(</span>
<span id="cb101-23"><a href="mixture-models.html#cb101-23" aria-hidden="true" tabindex="-1"></a>      mean <span class="sc">|&gt;</span> <span class="fu">round</span>(rounding),</span>
<span id="cb101-24"><a href="mixture-models.html#cb101-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot; (&quot;</span>,sd <span class="sc">|&gt;</span> <span class="fu">round</span>(rounding),<span class="st">&quot;)&quot;</span></span>
<span id="cb101-25"><a href="mixture-models.html#cb101-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb101-26"><a href="mixture-models.html#cb101-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb101-27"><a href="mixture-models.html#cb101-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(parameter,Group,msd)<span class="sc">|&gt;</span></span>
<span id="cb101-28"><a href="mixture-models.html#cb101-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="fu">c</span>(Group),<span class="at">values_from =</span> msd) </span>
<span id="cb101-29"><a href="mixture-models.html#cb101-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-30"><a href="mixture-models.html#cb101-30" aria-hidden="true" tabindex="-1"></a>EstSum <span class="sc">|&gt;</span> <span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Estimates from the 3-type dichotomous mixture models with heterogeneous $</span><span class="sc">\\</span><span class="st">lambda$ using data from Andreoni and Vesterlund (2001). Note that reported $</span><span class="sc">\\</span><span class="st">lambda$ estimates are reported in log units.&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">kable_classic</span>(<span class="at">full_width=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:MixtureModelsHLambdaTable">Table 7.2: </span>Estimates from the 3-type dichotomous mixture models with heterogeneous <span class="math inline">\(\lambda\)</span> using data from Andreoni and Vesterlund (2001). Note that reported <span class="math inline">\(\lambda\)</span> estimates are reported in log units.
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:left;">
Male
</th>
<th style="text-align:left;">
Female
</th>
<th style="text-align:left;">
Both
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Mix: S
</td>
<td style="text-align:left;">
0.581 (0.055)
</td>
<td style="text-align:left;">
0.419 (0.073)
</td>
<td style="text-align:left;">
0.531 (0.045)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mix: PS
</td>
<td style="text-align:left;">
0.181 (0.043)
</td>
<td style="text-align:left;">
0.072 (0.039)
</td>
<td style="text-align:left;">
0.139 (0.03)
</td>
</tr>
<tr>
<td style="text-align:left;">
Mix: PC
</td>
<td style="text-align:left;">
0.238 (0.048)
</td>
<td style="text-align:left;">
0.509 (0.074)
</td>
<td style="text-align:left;">
0.33 (0.041)
</td>
</tr>
<tr>
<td style="text-align:left;">
λ mean
</td>
<td style="text-align:left;">
-1.112 (0.239)
</td>
<td style="text-align:left;">
-1.442 (0.237)
</td>
<td style="text-align:left;">
-1.278 (0.169)
</td>
</tr>
<tr>
<td style="text-align:left;">
λ sd
</td>
<td style="text-align:left;">
2.094 (0.255)
</td>
<td style="text-align:left;">
1.537 (0.234)
</td>
<td style="text-align:left;">
1.868 (0.171)
</td>
</tr>
</tbody>
</table>
<p>Table <a href="mixture-models.html#tab:MixtureModelsHLambdaTable">7.2</a> shows the estimates from the dichotomous mixture models that permit heterogeneity in choice precision <span class="math inline">\(\lambda\)</span>. Here we can especially see a change from the homogeneous models in the estimates that slice the data into male and female participants. Very few female participants are now estimated to be perfect substitutes types (7%, compared to 9% in <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span>), but a substantial fraction of male participants are this type (18%, compared to 27% in <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span>). The fraction of selfish types is also similar, with the mixture models estimating 42% of female participants (37% in <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span>) and 58% of male participants (47% in <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span>).</p>
</div>
</div>
<div id="some-code-used-to-estimate-the-models" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Some code used to estimate the models<a href="mixture-models.html#some-code-used-to-estimate-the-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="mixture-models.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb102-2"><a href="mixture-models.html#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb102-3"><a href="mixture-models.html#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb102-4"><a href="mixture-models.html#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb102-5"><a href="mixture-models.html#cb102-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-6"><a href="mixture-models.html#cb102-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-7"><a href="mixture-models.html#cb102-7" aria-hidden="true" tabindex="-1"></a>rounding_grid<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>,<span class="at">by=</span><span class="fl">0.05</span>)</span>
<span id="cb102-8"><a href="mixture-models.html#cb102-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-9"><a href="mixture-models.html#cb102-9" aria-hidden="true" tabindex="-1"></a>AV2001parameters<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;Data/AV2001parameters.csv&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb102-10"><a href="mixture-models.html#cb102-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">|&gt;</span></span>
<span id="cb102-11"><a href="mixture-models.html#cb102-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decision =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb102-12"><a href="mixture-models.html#cb102-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-13"><a href="mixture-models.html#cb102-13" aria-hidden="true" tabindex="-1"></a>AV2001<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">&quot;Data/AV2001choices.csv&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb102-14"><a href="mixture-models.html#cb102-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb102-15"><a href="mixture-models.html#cb102-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> keep1<span class="sc">:</span>keep8,</span>
<span id="cb102-16"><a href="mixture-models.html#cb102-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">&quot;keep&quot;</span>,</span>
<span id="cb102-17"><a href="mixture-models.html#cb102-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;decision&quot;</span>,</span>
<span id="cb102-18"><a href="mixture-models.html#cb102-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;amount_kept&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb102-19"><a href="mixture-models.html#cb102-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decision =</span> decision <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb102-20"><a href="mixture-models.html#cb102-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(AV2001parameters,<span class="at">by=</span><span class="st">&quot;decision&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb102-21"><a href="mixture-models.html#cb102-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rownum =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb102-22"><a href="mixture-models.html#cb102-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">fraction_kept =</span> amount_kept<span class="sc">/</span>income</span>
<span id="cb102-23"><a href="mixture-models.html#cb102-23" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span></span>
<span id="cb102-24"><a href="mixture-models.html#cb102-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb102-25"><a href="mixture-models.html#cb102-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bin_kept =</span> <span class="fu">which</span>(<span class="fu">abs</span>(rounding_grid<span class="sc">-</span>fraction_kept)<span class="sc">==</span><span class="fu">min</span>(<span class="fu">abs</span>(rounding_grid<span class="sc">-</span>fraction_kept)))[<span class="dv">1</span>])</span>
<span id="cb102-26"><a href="mixture-models.html#cb102-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-27"><a href="mixture-models.html#cb102-27" aria-hidden="true" tabindex="-1"></a>idstartend<span class="ot">&lt;-</span>AV2001 <span class="sc">|&gt;</span> <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb102-28"><a href="mixture-models.html#cb102-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">start =</span> <span class="fu">min</span>(rownum),<span class="at">end=</span><span class="fu">max</span>(rownum))</span>
<span id="cb102-29"><a href="mixture-models.html#cb102-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-30"><a href="mixture-models.html#cb102-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-31"><a href="mixture-models.html#cb102-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-32"><a href="mixture-models.html#cb102-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-33"><a href="mixture-models.html#cb102-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-34"><a href="mixture-models.html#cb102-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-35"><a href="mixture-models.html#cb102-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-36"><a href="mixture-models.html#cb102-36" aria-hidden="true" tabindex="-1"></a>Dichotomous<span class="ot">&lt;-</span><span class="fu">stan_model</span>(<span class="st">&quot;Code/MixtureModels/AV2001_3types_dichotomous.stan&quot;</span>)</span>
<span id="cb102-37"><a href="mixture-models.html#cb102-37" aria-hidden="true" tabindex="-1"></a>Toolbox<span class="ot">&lt;-</span><span class="fu">stan_model</span>(<span class="st">&quot;Code/MixtureModels/AV2001_3types_toolbox.stan&quot;</span>)</span>
<span id="cb102-38"><a href="mixture-models.html#cb102-38" aria-hidden="true" tabindex="-1"></a>Dichotomous_hlambda<span class="ot">&lt;-</span><span class="fu">stan_model</span>(<span class="st">&quot;Code/MixtureModels/AV2001_3types_dichotomous_hlambda.stan&quot;</span>)</span>
<span id="cb102-39"><a href="mixture-models.html#cb102-39" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################################</span></span>
<span id="cb102-40"><a href="mixture-models.html#cb102-40" aria-hidden="true" tabindex="-1"></a><span class="co">#  mixture models using all of the data</span></span>
<span id="cb102-41"><a href="mixture-models.html#cb102-41" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################################</span></span>
<span id="cb102-42"><a href="mixture-models.html#cb102-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-43"><a href="mixture-models.html#cb102-43" aria-hidden="true" tabindex="-1"></a>dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb102-44"><a href="mixture-models.html#cb102-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">dim</span>(AV2001)[<span class="dv">1</span>],</span>
<span id="cb102-45"><a href="mixture-models.html#cb102-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">nParticipants =</span> AV2001<span class="sc">$</span>id <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">length</span>(),</span>
<span id="cb102-46"><a href="mixture-models.html#cb102-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> AV2001<span class="sc">$</span>id,</span>
<span id="cb102-47"><a href="mixture-models.html#cb102-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">idStart =</span> idstartend<span class="sc">$</span>start,</span>
<span id="cb102-48"><a href="mixture-models.html#cb102-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">idEnd =</span> idstartend<span class="sc">$</span>end,</span>
<span id="cb102-49"><a href="mixture-models.html#cb102-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-50"><a href="mixture-models.html#cb102-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">income =</span> AV2001<span class="sc">$</span>income,</span>
<span id="cb102-51"><a href="mixture-models.html#cb102-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">pSelf =</span> AV2001<span class="sc">$</span>pSelf,</span>
<span id="cb102-52"><a href="mixture-models.html#cb102-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">pOther =</span> AV2001<span class="sc">$</span>pOther,</span>
<span id="cb102-53"><a href="mixture-models.html#cb102-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-54"><a href="mixture-models.html#cb102-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">binLength =</span> <span class="fu">length</span>(rounding_grid),</span>
<span id="cb102-55"><a href="mixture-models.html#cb102-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin_grid =</span> rounding_grid,</span>
<span id="cb102-56"><a href="mixture-models.html#cb102-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin_kept =</span> AV2001<span class="sc">$</span>bin_kept,</span>
<span id="cb102-57"><a href="mixture-models.html#cb102-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-58"><a href="mixture-models.html#cb102-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_mix =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb102-59"><a href="mixture-models.html#cb102-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_lambda =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="dv">1</span>),<span class="dv">1</span>),</span>
<span id="cb102-60"><a href="mixture-models.html#cb102-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-61"><a href="mixture-models.html#cb102-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_lambda_mean =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="dv">1</span>),<span class="dv">1</span>),</span>
<span id="cb102-62"><a href="mixture-models.html#cb102-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_lambda_sd =</span> <span class="fl">0.05</span></span>
<span id="cb102-63"><a href="mixture-models.html#cb102-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-64"><a href="mixture-models.html#cb102-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb102-65"><a href="mixture-models.html#cb102-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-66"><a href="mixture-models.html#cb102-66" aria-hidden="true" tabindex="-1"></a>file<span class="ot">&lt;-</span><span class="st">&quot;Code/MixtureModels/AV2001Dichotomous_Both.rds&quot;</span></span>
<span id="cb102-67"><a href="mixture-models.html#cb102-67" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) {</span>
<span id="cb102-68"><a href="mixture-models.html#cb102-68" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">sampling</span>(Dichotomous,<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb102-69"><a href="mixture-models.html#cb102-69" aria-hidden="true" tabindex="-1"></a>  Fit <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(file)</span>
<span id="cb102-70"><a href="mixture-models.html#cb102-70" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-71"><a href="mixture-models.html#cb102-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-72"><a href="mixture-models.html#cb102-72" aria-hidden="true" tabindex="-1"></a>file<span class="ot">&lt;-</span><span class="st">&quot;Code/MixtureModels/AV2001Toolbox_Both.rds&quot;</span></span>
<span id="cb102-73"><a href="mixture-models.html#cb102-73" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) {</span>
<span id="cb102-74"><a href="mixture-models.html#cb102-74" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">sampling</span>(Toolbox,<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb102-75"><a href="mixture-models.html#cb102-75" aria-hidden="true" tabindex="-1"></a>  Fit <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(file)</span>
<span id="cb102-76"><a href="mixture-models.html#cb102-76" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-77"><a href="mixture-models.html#cb102-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-78"><a href="mixture-models.html#cb102-78" aria-hidden="true" tabindex="-1"></a>file<span class="ot">&lt;-</span><span class="st">&quot;Code/MixtureModels/AV2001hlambdaDichotomous_Both.rds&quot;</span></span>
<span id="cb102-79"><a href="mixture-models.html#cb102-79" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) {</span>
<span id="cb102-80"><a href="mixture-models.html#cb102-80" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">sampling</span>(Dichotomous_hlambda,<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb102-81"><a href="mixture-models.html#cb102-81" aria-hidden="true" tabindex="-1"></a>  Fit <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(file)</span>
<span id="cb102-82"><a href="mixture-models.html#cb102-82" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-83"><a href="mixture-models.html#cb102-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-84"><a href="mixture-models.html#cb102-84" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################################</span></span>
<span id="cb102-85"><a href="mixture-models.html#cb102-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Mixture models using just the data from female participants</span></span>
<span id="cb102-86"><a href="mixture-models.html#cb102-86" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################################</span></span>
<span id="cb102-87"><a href="mixture-models.html#cb102-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-88"><a href="mixture-models.html#cb102-88" aria-hidden="true" tabindex="-1"></a>d<span class="ot">&lt;-</span>AV2001 <span class="sc">|&gt;</span></span>
<span id="cb102-89"><a href="mixture-models.html#cb102-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(female<span class="sc">==</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb102-90"><a href="mixture-models.html#cb102-90" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I need to re-number the id variables so they go from 1:n only</span></span>
<span id="cb102-91"><a href="mixture-models.html#cb102-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">idFull =</span> id) <span class="sc">|&gt;</span></span>
<span id="cb102-92"><a href="mixture-models.html#cb102-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb102-93"><a href="mixture-models.html#cb102-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">paste</span>(<span class="st">&quot;id&quot;</span>,idFull) <span class="sc">|&gt;</span> <span class="fu">as.factor</span>() <span class="sc">|&gt;</span> <span class="fu">as.integer</span>())</span>
<span id="cb102-94"><a href="mixture-models.html#cb102-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-95"><a href="mixture-models.html#cb102-95" aria-hidden="true" tabindex="-1"></a>idstartend<span class="ot">&lt;-</span>d <span class="sc">|&gt;</span></span>
<span id="cb102-96"><a href="mixture-models.html#cb102-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rownum =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb102-97"><a href="mixture-models.html#cb102-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb102-98"><a href="mixture-models.html#cb102-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">start =</span> <span class="fu">min</span>(rownum),<span class="at">end=</span><span class="fu">max</span>(rownum))</span>
<span id="cb102-99"><a href="mixture-models.html#cb102-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-100"><a href="mixture-models.html#cb102-100" aria-hidden="true" tabindex="-1"></a>dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb102-101"><a href="mixture-models.html#cb102-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">dim</span>(d)[<span class="dv">1</span>],</span>
<span id="cb102-102"><a href="mixture-models.html#cb102-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">nParticipants =</span> d<span class="sc">$</span>id <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">length</span>(),</span>
<span id="cb102-103"><a href="mixture-models.html#cb102-103" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> d<span class="sc">$</span>id,</span>
<span id="cb102-104"><a href="mixture-models.html#cb102-104" aria-hidden="true" tabindex="-1"></a>  <span class="at">idStart =</span> idstartend<span class="sc">$</span>start,</span>
<span id="cb102-105"><a href="mixture-models.html#cb102-105" aria-hidden="true" tabindex="-1"></a>  <span class="at">idEnd =</span> idstartend<span class="sc">$</span>end,</span>
<span id="cb102-106"><a href="mixture-models.html#cb102-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-107"><a href="mixture-models.html#cb102-107" aria-hidden="true" tabindex="-1"></a>  <span class="at">income =</span> d<span class="sc">$</span>income,</span>
<span id="cb102-108"><a href="mixture-models.html#cb102-108" aria-hidden="true" tabindex="-1"></a>  <span class="at">pSelf =</span> d<span class="sc">$</span>pSelf,</span>
<span id="cb102-109"><a href="mixture-models.html#cb102-109" aria-hidden="true" tabindex="-1"></a>  <span class="at">pOther =</span> d<span class="sc">$</span>pOther,</span>
<span id="cb102-110"><a href="mixture-models.html#cb102-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-111"><a href="mixture-models.html#cb102-111" aria-hidden="true" tabindex="-1"></a>  <span class="at">binLength =</span> <span class="fu">length</span>(rounding_grid),</span>
<span id="cb102-112"><a href="mixture-models.html#cb102-112" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin_grid =</span> rounding_grid,</span>
<span id="cb102-113"><a href="mixture-models.html#cb102-113" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin_kept =</span> d<span class="sc">$</span>bin_kept,</span>
<span id="cb102-114"><a href="mixture-models.html#cb102-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-115"><a href="mixture-models.html#cb102-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_mix =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb102-116"><a href="mixture-models.html#cb102-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_lambda =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="dv">1</span>),<span class="dv">1</span>),</span>
<span id="cb102-117"><a href="mixture-models.html#cb102-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-118"><a href="mixture-models.html#cb102-118" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_lambda_mean =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="dv">1</span>),<span class="dv">1</span>),</span>
<span id="cb102-119"><a href="mixture-models.html#cb102-119" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_lambda_sd =</span> <span class="fl">0.05</span></span>
<span id="cb102-120"><a href="mixture-models.html#cb102-120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-121"><a href="mixture-models.html#cb102-121" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb102-122"><a href="mixture-models.html#cb102-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-123"><a href="mixture-models.html#cb102-123" aria-hidden="true" tabindex="-1"></a>file<span class="ot">&lt;-</span><span class="st">&quot;Code/MixtureModels/AV2001Dichotomous_Female.rds&quot;</span></span>
<span id="cb102-124"><a href="mixture-models.html#cb102-124" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) {</span>
<span id="cb102-125"><a href="mixture-models.html#cb102-125" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">sampling</span>(Dichotomous,<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb102-126"><a href="mixture-models.html#cb102-126" aria-hidden="true" tabindex="-1"></a>  Fit <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(file)</span>
<span id="cb102-127"><a href="mixture-models.html#cb102-127" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-128"><a href="mixture-models.html#cb102-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-129"><a href="mixture-models.html#cb102-129" aria-hidden="true" tabindex="-1"></a>file<span class="ot">&lt;-</span><span class="st">&quot;Code/MixtureModels/AV2001Toolbox_Female.rds&quot;</span></span>
<span id="cb102-130"><a href="mixture-models.html#cb102-130" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) {</span>
<span id="cb102-131"><a href="mixture-models.html#cb102-131" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">sampling</span>(Toolbox,<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb102-132"><a href="mixture-models.html#cb102-132" aria-hidden="true" tabindex="-1"></a>  Fit <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(file)</span>
<span id="cb102-133"><a href="mixture-models.html#cb102-133" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-134"><a href="mixture-models.html#cb102-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-135"><a href="mixture-models.html#cb102-135" aria-hidden="true" tabindex="-1"></a>file<span class="ot">&lt;-</span><span class="st">&quot;Code/MixtureModels/AV2001hlambdaDichotomous_Female.rds&quot;</span></span>
<span id="cb102-136"><a href="mixture-models.html#cb102-136" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) {</span>
<span id="cb102-137"><a href="mixture-models.html#cb102-137" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">sampling</span>(Dichotomous_hlambda,<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb102-138"><a href="mixture-models.html#cb102-138" aria-hidden="true" tabindex="-1"></a>  Fit <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(file)</span>
<span id="cb102-139"><a href="mixture-models.html#cb102-139" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-140"><a href="mixture-models.html#cb102-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-141"><a href="mixture-models.html#cb102-141" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################################</span></span>
<span id="cb102-142"><a href="mixture-models.html#cb102-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Mixture models using just the data from male participants</span></span>
<span id="cb102-143"><a href="mixture-models.html#cb102-143" aria-hidden="true" tabindex="-1"></a><span class="do">###########################################################</span></span>
<span id="cb102-144"><a href="mixture-models.html#cb102-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-145"><a href="mixture-models.html#cb102-145" aria-hidden="true" tabindex="-1"></a>d<span class="ot">&lt;-</span>AV2001 <span class="sc">|&gt;</span></span>
<span id="cb102-146"><a href="mixture-models.html#cb102-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(female<span class="sc">==</span><span class="dv">0</span>) <span class="sc">|&gt;</span></span>
<span id="cb102-147"><a href="mixture-models.html#cb102-147" aria-hidden="true" tabindex="-1"></a>  <span class="co"># I need to re-number the id variables so they go from 1:n only</span></span>
<span id="cb102-148"><a href="mixture-models.html#cb102-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">idFull =</span> id) <span class="sc">|&gt;</span></span>
<span id="cb102-149"><a href="mixture-models.html#cb102-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb102-150"><a href="mixture-models.html#cb102-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">paste</span>(<span class="st">&quot;id&quot;</span>,idFull) <span class="sc">|&gt;</span> <span class="fu">as.factor</span>() <span class="sc">|&gt;</span> <span class="fu">as.integer</span>())</span>
<span id="cb102-151"><a href="mixture-models.html#cb102-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-152"><a href="mixture-models.html#cb102-152" aria-hidden="true" tabindex="-1"></a>idstartend<span class="ot">&lt;-</span>d <span class="sc">|&gt;</span></span>
<span id="cb102-153"><a href="mixture-models.html#cb102-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rownum =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb102-154"><a href="mixture-models.html#cb102-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb102-155"><a href="mixture-models.html#cb102-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">start =</span> <span class="fu">min</span>(rownum),<span class="at">end=</span><span class="fu">max</span>(rownum))</span>
<span id="cb102-156"><a href="mixture-models.html#cb102-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-157"><a href="mixture-models.html#cb102-157" aria-hidden="true" tabindex="-1"></a>dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb102-158"><a href="mixture-models.html#cb102-158" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">dim</span>(d)[<span class="dv">1</span>],</span>
<span id="cb102-159"><a href="mixture-models.html#cb102-159" aria-hidden="true" tabindex="-1"></a>  <span class="at">nParticipants =</span> d<span class="sc">$</span>id <span class="sc">|&gt;</span> <span class="fu">unique</span>() <span class="sc">|&gt;</span> <span class="fu">length</span>(),</span>
<span id="cb102-160"><a href="mixture-models.html#cb102-160" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> d<span class="sc">$</span>id,</span>
<span id="cb102-161"><a href="mixture-models.html#cb102-161" aria-hidden="true" tabindex="-1"></a>  <span class="at">idStart =</span> idstartend<span class="sc">$</span>start,</span>
<span id="cb102-162"><a href="mixture-models.html#cb102-162" aria-hidden="true" tabindex="-1"></a>  <span class="at">idEnd =</span> idstartend<span class="sc">$</span>end,</span>
<span id="cb102-163"><a href="mixture-models.html#cb102-163" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-164"><a href="mixture-models.html#cb102-164" aria-hidden="true" tabindex="-1"></a>  <span class="at">income =</span> d<span class="sc">$</span>income,</span>
<span id="cb102-165"><a href="mixture-models.html#cb102-165" aria-hidden="true" tabindex="-1"></a>  <span class="at">pSelf =</span> d<span class="sc">$</span>pSelf,</span>
<span id="cb102-166"><a href="mixture-models.html#cb102-166" aria-hidden="true" tabindex="-1"></a>  <span class="at">pOther =</span> d<span class="sc">$</span>pOther,</span>
<span id="cb102-167"><a href="mixture-models.html#cb102-167" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-168"><a href="mixture-models.html#cb102-168" aria-hidden="true" tabindex="-1"></a>  <span class="at">binLength =</span> <span class="fu">length</span>(rounding_grid),</span>
<span id="cb102-169"><a href="mixture-models.html#cb102-169" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin_grid =</span> rounding_grid,</span>
<span id="cb102-170"><a href="mixture-models.html#cb102-170" aria-hidden="true" tabindex="-1"></a>  <span class="at">bin_kept =</span> d<span class="sc">$</span>bin_kept,</span>
<span id="cb102-171"><a href="mixture-models.html#cb102-171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-172"><a href="mixture-models.html#cb102-172" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_mix =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb102-173"><a href="mixture-models.html#cb102-173" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_lambda =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="dv">1</span>),<span class="dv">1</span>),</span>
<span id="cb102-174"><a href="mixture-models.html#cb102-174" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-175"><a href="mixture-models.html#cb102-175" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_lambda_mean =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="dv">1</span>),<span class="dv">1</span>),</span>
<span id="cb102-176"><a href="mixture-models.html#cb102-176" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_lambda_sd =</span> <span class="fl">0.05</span></span>
<span id="cb102-177"><a href="mixture-models.html#cb102-177" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-178"><a href="mixture-models.html#cb102-178" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb102-179"><a href="mixture-models.html#cb102-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-180"><a href="mixture-models.html#cb102-180" aria-hidden="true" tabindex="-1"></a>file<span class="ot">&lt;-</span><span class="st">&quot;Code/MixtureModels/AV2001Dichotomous_Male.rds&quot;</span></span>
<span id="cb102-181"><a href="mixture-models.html#cb102-181" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) {</span>
<span id="cb102-182"><a href="mixture-models.html#cb102-182" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">sampling</span>(Dichotomous,<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb102-183"><a href="mixture-models.html#cb102-183" aria-hidden="true" tabindex="-1"></a>  Fit <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(file)</span>
<span id="cb102-184"><a href="mixture-models.html#cb102-184" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-185"><a href="mixture-models.html#cb102-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-186"><a href="mixture-models.html#cb102-186" aria-hidden="true" tabindex="-1"></a>file<span class="ot">&lt;-</span><span class="st">&quot;Code/MixtureModels/AV2001Toolbox_Male.rds&quot;</span></span>
<span id="cb102-187"><a href="mixture-models.html#cb102-187" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) {</span>
<span id="cb102-188"><a href="mixture-models.html#cb102-188" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">sampling</span>(Toolbox,<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb102-189"><a href="mixture-models.html#cb102-189" aria-hidden="true" tabindex="-1"></a>  Fit <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(file)</span>
<span id="cb102-190"><a href="mixture-models.html#cb102-190" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-191"><a href="mixture-models.html#cb102-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-192"><a href="mixture-models.html#cb102-192" aria-hidden="true" tabindex="-1"></a>file<span class="ot">&lt;-</span><span class="st">&quot;Code/MixtureModels/AV2001hlambdaDichotomous_Male.rds&quot;</span></span>
<span id="cb102-193"><a href="mixture-models.html#cb102-193" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) {</span>
<span id="cb102-194"><a href="mixture-models.html#cb102-194" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">sampling</span>(Dichotomous_hlambda,<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb102-195"><a href="mixture-models.html#cb102-195" aria-hidden="true" tabindex="-1"></a>  Fit <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(file)</span>
<span id="cb102-196"><a href="mixture-models.html#cb102-196" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<!--

## Not Bayes: A replication of parts of @AV2001

For my own sanity, I replicated some of the tables in @AV2001. It turns out that `pSelf` in the data is actually "Hold value" in their Table I, rather than $\pi_s$.  

### Table II


```r
D<-AV2001choices |>
  pivot_longer(cols=keep1:keep8,names_to = "decision",values_to = "tokens kept") |>
  mutate(decision = str_remove(decision,"keep") |> as.numeric()) |>
  rename(id=X) |>
  left_join(
    AV2001parameters |> rename(decision = X),
    by = "decision"
  ) |>
  rename(`Token endowment` = income)  |>
  mutate(pG = pSelf/pOther,
         Budget = `Token endowment`*pSelf/10,
         `Value kept` = `tokens kept`*pSelf/10) |>
  group_by(pG,decision,female) |>
  summarize(income = mean(Budget),pG = mean(pG),toOther = mean((`Token endowment`-`tokens kept`)*pOther/10)) |>
  arrange(pG,income) |>
  rename(`Price of giving` = pG) |>
  mutate(female = ifelse(female==1,"female","male")) |>
  pivot_wider(names_from = female,values_from = toOther)

D|> round(2) |> kbl(caption="Replication of (parts of) Table II of Andreoni & Vesterlund (2001) ") |> kable_classic(full_width=F) |>
  add_header_above(c(" "=3,"Mean payoff to other party"=2))
```

<table class=" lightable-classic" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<caption>(\#tab:MixtureModelsAV2001TableII)Replication of (parts of) Table II of Andreoni &amp; Vesterlund (2001) </caption>
 <thead>
<tr>
<th style="empty-cells: hide;" colspan="3"></th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="2"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">Mean payoff to other party</div></th>
</tr>
  <tr>
   <th style="text-align:right;"> Price of giving </th>
   <th style="text-align:right;"> decision </th>
   <th style="text-align:right;"> income </th>
   <th style="text-align:right;"> male </th>
   <th style="text-align:right;"> female </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:right;"> 0.33 </td>
   <td style="text-align:right;"> 2 </td>
   <td style="text-align:right;"> 4.0 </td>
   <td style="text-align:right;"> 4.18 </td>
   <td style="text-align:right;"> 3.01 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.50 </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 6.0 </td>
   <td style="text-align:right;"> 4.30 </td>
   <td style="text-align:right;"> 3.49 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 0.50 </td>
   <td style="text-align:right;"> 6 </td>
   <td style="text-align:right;"> 7.5 </td>
   <td style="text-align:right;"> 5.00 </td>
   <td style="text-align:right;"> 4.03 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 6.0 </td>
   <td style="text-align:right;"> 1.36 </td>
   <td style="text-align:right;"> 1.91 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;"> 10.0 </td>
   <td style="text-align:right;"> 2.33 </td>
   <td style="text-align:right;"> 2.92 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2.00 </td>
   <td style="text-align:right;"> 3 </td>
   <td style="text-align:right;"> 12.0 </td>
   <td style="text-align:right;"> 1.21 </td>
   <td style="text-align:right;"> 1.82 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 2.00 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 15.0 </td>
   <td style="text-align:right;"> 1.42 </td>
   <td style="text-align:right;"> 2.29 </td>
  </tr>
  <tr>
   <td style="text-align:right;"> 3.00 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 12.0 </td>
   <td style="text-align:right;"> 0.67 </td>
   <td style="text-align:right;"> 1.32 </td>
  </tr>
</tbody>
</table>

### Table III


```r
  D<-AV2001choices |>
  pivot_longer(cols=keep1:keep8,names_to = "decision",values_to = "tokens kept") |>
  mutate(decision = str_remove(decision,"keep") |> as.numeric()) |>
  rename(id=X) |>
  left_join(
    AV2001parameters |> rename(decision = X),
    by = "decision"
  ) |>
  # Add in the predictions here
  mutate(
    S = income,
    PS = ifelse(pSelf>pOther,income,
                ifelse(pSelf<pOther,0,income/2)),
    PC = income*pOther/(pSelf+pOther)
  ) |>
  pivot_longer(cols = c(S,PS,PC),names_to = "type",values_to="prediction") |>
  group_by(id,type,female) |>
  summarize(mse = mean((`tokens kept`-prediction)^2)) |>
  mutate(female = ifelse(female==1,"Female","Male")) 
  

dStrong<-D |>
  group_by(id,female) |>
  filter(mse==0) |>
  group_by(female,type) |>
  summarize(count = n()) |> 
  pivot_wider(names_from=female,values_from=count) 

dAll<-D |>
  group_by(id,female) |>
  filter(mse==min(mse)) |>
  group_by(female,type) |>
  summarize(count = n()) |> 
  pivot_wider(names_from=female,values_from=count) 

list(dStrong,dAll) |>
  kbl() |>
  kable_classic(full_width=F) |>
  add_header_above(c("Strong classification" = 1, "All" = 1))
```

<table class="kable_wrapper lightable-classic" style='font-family: "Arial Narrow", "Source Sans Pro", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<thead><tr>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="1"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">Strong classification</div></th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="1"><div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">All</div></th>
</tr></thead>
<tbody>
  <tr>
   <td> 

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> type </th>
   <th style="text-align:right;"> Female </th>
   <th style="text-align:right;"> Male </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> PC </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;"> 13 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> S </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;"> 24 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> PS </td>
   <td style="text-align:right;"> NA </td>
   <td style="text-align:right;"> 3 </td>
  </tr>
</tbody>
</table>

 </td>
   <td> 

<table>
 <thead>
  <tr>
   <th style="text-align:left;"> type </th>
   <th style="text-align:right;"> Female </th>
   <th style="text-align:right;"> Male </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> PC </td>
   <td style="text-align:right;"> 26 </td>
   <td style="text-align:right;"> 31 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> PS </td>
   <td style="text-align:right;"> 4 </td>
   <td style="text-align:right;"> 17 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> S </td>
   <td style="text-align:right;"> 18 </td>
   <td style="text-align:right;"> 47 </td>
  </tr>
</tbody>
</table>

 </td>
  </tr>
</tbody>
</table>

-->
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Andreoni2002" class="csl-entry">
Andreoni, James, and John Miller. 2002. <span>“Giving According to GARP: An Experimental Test of the Consistency of Preferences for Altruism.”</span> <em>Econometrica</em> 70 (2): 737–53. <a href="https://www.jstor.org/stable/2692289">https://www.jstor.org/stable/2692289</a>.
</div>
<div id="ref-AV2001" class="csl-entry">
Andreoni, James, and Lise Vesterlund. 2001. <span>“Which Is the Fair Sex? Gender Differences in Altruism.”</span> <em>The Quarterly Journal of Economics</em> 116 (1): 293–312. <a href="https://doi.org/10.1162/003355301556419">https://doi.org/10.1162/003355301556419</a>.
</div>
<div id="ref-Bland2019JMP" class="csl-entry">
Bland, James R. 2019. <span>“How Many Games Are We Playing? An Experimental Analysis of Choice Bracketing in Games.”</span> <em>Journal of Behavioral and Experimental Economics</em> 80: 80–91. <a href="https://doi.org/10.1016/j.socec.2019.03.011">https://doi.org/10.1016/j.socec.2019.03.011</a>.
</div>
<div id="ref-Bland2019learning" class="csl-entry">
Bland, James R., and Yaroslav Rosokha. 2019. <span>“Learning Under Uncertainty with Multiple Priors: Experimental Investigation.”</span> <em>Available at SSRN 3419020</em>.
</div>
<div id="ref-Conte2011" class="csl-entry">
Conte, Anna, John D Hey, and Peter G Moffatt. 2011. <span>“Mixture Models of Choice Under Risk.”</span> <em>Journal of Econometrics</em> 162 (1): 79–88.
</div>
<div id="ref-Harrison2009" class="csl-entry">
Harrison, Glenn W, and E Elisabet Rutström. 2009. <span>“Expected Utility Theory and Prospect Theory: One Wedding and a Decent Funeral.”</span> <em>Experimental Economics</em> 12 (2): 133–58.
</div>
<div id="ref-Hey1994" class="csl-entry">
Hey, John D, and Chris Orme. 1994. <span>“Investigating Generalizations of Expected Utility Theory Using Experimental Data.”</span> <em>Econometrica: Journal of the Econometric Society</em>, 1291–1326.
</div>
<div id="ref-Stahl2018" class="csl-entry">
Stahl, Dale O. 2018. <span>“Assessing the Forecast Performance of Models of Choice.”</span> <em>Journal of Behavioral and Experimental Economics</em> 73: 86–92.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="27">
<li id="fn27"><p>For simplicity, this assumes that all data are independent conditional on parameters <span class="math inline">\((\rho,\beta)\)</span> and all models.<a href="mixture-models.html#fnref27" class="footnote-back">↩︎</a></p></li>
<li id="fn28"><p>See the code in <span class="citation">Bland and Rosokha (<a href="#ref-Bland2019learning" role="doc-biblioref">2019</a>)</span> for an example of estimating a 4-type mixture model using data augmentation with a Metropolis-Hastings within Gibbs sampler. The mixture model part of this is really simple, but it is not a specification that <em>Stan</em> will permit.<a href="mixture-models.html#fnref28" class="footnote-back">↩︎</a></p></li>
<li id="fn29"><p>This “no unique optimizer” result is not a problem for the logit choice model I implement below (the distribution of actions will just be uniform), however it <em>is</em> a problem for the Euclidean distance classifier. As far as I can tell, <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span> assume that when <span class="math inline">\(\mathrm{pSelf}_{i,t}=\mathrm{pOther}_{i,t}\)</span> the participant will share the tokens equally.<a href="mixture-models.html#fnref29" class="footnote-back">↩︎</a></p></li>
<li id="fn30"><p>Using a very similar experiment design, <span class="citation">Andreoni and Miller (<a href="#ref-Andreoni2002" role="doc-biblioref">2002</a>)</span> also do this same classification of types. In and around their footnote 9, they report that “Bayesian algorithms” also yielded similar results.<a href="mixture-models.html#fnref30" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="hierarchical-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="applications.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

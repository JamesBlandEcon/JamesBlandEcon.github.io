<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>22 Application: choice bracketing | Structural Bayesian Techniques for Experimental and Behavioral Economics</title>
  <meta name="description" content="22 Application: choice bracketing | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="22 Application: choice bracketing | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="22 Application: choice bracketing | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  
  
  

<meta name="author" content="James R. Bland" />


<meta name="date" content="2025-12-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="application-meta-analysis-using-some-of-the-metaret-data.html"/>
<link rel="next" href="application-ranked-choices-and-the-thurstonian-model.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="section.html#section" id="toc-section"></a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="setting-the-stage.html"><a href="setting-the-stage.html"><i class="fa fa-check"></i>Setting the stage</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-does-your-theory-say-about-your-data"><i class="fa fa-check"></i><b>1.1</b> What does your theory say about your data?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-do-your-data-say-about-your-theory"><i class="fa fa-check"></i><b>1.2</b> What do your data say about your theory?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-do-your-parameters-say-about-other-things"><i class="fa fa-check"></i><b>1.3</b> What do your parameters say about other things?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-does-your-expertise-say-about-your-parameters"><i class="fa fa-check"></i><b>1.4</b> What does your expertise say about your parameters?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html"><i class="fa fa-check"></i><b>2</b> Getting started in <em>Stan</em></a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#installation-in-r"><i class="fa fa-check"></i><b>2.1</b> Installation in <em>R</em></a></li>
<li class="chapter" data-level="2.2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#the-anatomy-of-a-stan-program"><i class="fa fa-check"></i><b>2.2</b> The anatomy of a <em>Stan</em> program</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#data-block"><i class="fa fa-check"></i><b>2.2.1</b> Data block</a></li>
<li class="chapter" data-level="2.2.2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#transformed-data-block"><i class="fa fa-check"></i><b>2.2.2</b> Transformed data block</a></li>
<li class="chapter" data-level="2.2.3" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#parameters-block"><i class="fa fa-check"></i><b>2.2.3</b> Parameters block</a></li>
<li class="chapter" data-level="2.2.4" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#model-block"><i class="fa fa-check"></i><b>2.2.4</b> Model block</a></li>
<li class="chapter" data-level="2.2.5" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#generated-quantities-block"><i class="fa fa-check"></i><b>2.2.5</b> Generated quantities block</a></li>
<li class="chapter" data-level="2.2.6" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#the-final-product"><i class="fa fa-check"></i><b>2.2.6</b> The final product</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#estimating-a-model"><i class="fa fa-check"></i><b>2.3</b> Estimating a model</a></li>
<li class="chapter" data-level="2.4" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#looking-at-the-results"><i class="fa fa-check"></i><b>2.4</b> Looking at the results</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html"><i class="fa fa-check"></i><b>3</b> Probabilistic models of behavior</a>
<ul>
<li class="chapter" data-level="3.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#the-problem-with-deterministic-models"><i class="fa fa-check"></i><b>3.1</b> The problem with deterministic models</a></li>
<li class="chapter" data-level="3.2" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#what-is-a-probabilistic-model"><i class="fa fa-check"></i><b>3.2</b> What <em>is</em> a probabilistic model?</a></li>
<li class="chapter" data-level="3.3" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#example-dataset-and-model"><i class="fa fa-check"></i><b>3.3</b> Example dataset and model</a></li>
<li class="chapter" data-level="3.4" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#optimal-choice-plus-an-error"><i class="fa fa-check"></i><b>3.4</b> Optimal choice plus an error</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#estimating-a-model-1"><i class="fa fa-check"></i><b>3.4.1</b> Estimating a model</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#utility-based-models"><i class="fa fa-check"></i><b>3.5</b> Utility-based models</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#estimating-a-model-2"><i class="fa fa-check"></i><b>3.5.1</b> Estimating a model</a></li>
<li class="chapter" data-level="3.5.2" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#doing-something-with-the-estimates"><i class="fa fa-check"></i><b>3.5.2</b> Doing something with the estimates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html"><i class="fa fa-check"></i><b>4</b> Considerations for choosing a prior</a>
<ul>
<li class="chapter" data-level="4.1" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#example-model-and-experiment"><i class="fa fa-check"></i><b>4.1</b> Example model and experiment</a></li>
<li class="chapter" data-level="4.2" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#getting-the-support-right"><i class="fa fa-check"></i><b>4.2</b> Getting the support right</a></li>
<li class="chapter" data-level="4.3" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#eliciting-reasonable-priors"><i class="fa fa-check"></i><b>4.3</b> Eliciting reasonable priors</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#parameter-values-and-the-prior-pushforward-check"><i class="fa fa-check"></i><b>4.3.1</b> Parameter values and the prior pushforward check</a></li>
<li class="chapter" data-level="4.3.2" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#predictions-and-other-derived-quantities-the-prior-predictive-check"><i class="fa fa-check"></i><b>4.3.2</b> Predictions and other derived quantities: The prior predictive check</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#assessing-the-sampling-performance-of-a-prior"><i class="fa fa-check"></i><b>4.4</b> Assessing the sampling performance of a prior</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#does-our-model-recover-its-parameters-well"><i class="fa fa-check"></i><b>4.4.1</b> Does our model recover its parameters well?</a></li>
<li class="chapter" data-level="4.4.2" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#do-we-see-any-pathologies-in-the-estimation-process"><i class="fa fa-check"></i><b>4.4.2</b> Do we see any pathologies in the estimation process?</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#r-code-used-for-this-chapter"><i class="fa fa-check"></i><b>4.5</b> <em>R</em> code used for this chapter</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="building-blocks.html"><a href="building-blocks.html"><i class="fa fa-check"></i>Building blocks</a></li>
<li class="chapter" data-level="5" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html"><i class="fa fa-check"></i><b>5</b> Representative agent and participant-specific models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#participant-specific-models"><i class="fa fa-check"></i><b>5.1</b> Participant-specific models</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#example-data-and-economic-model"><i class="fa fa-check"></i><b>5.1.1</b> Example data and economic model</a></li>
<li class="chapter" data-level="5.1.2" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#going-to-the-probabilistic-model"><i class="fa fa-check"></i><b>5.1.2</b> Going to the probabilistic model</a></li>
<li class="chapter" data-level="5.1.3" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#a-short-side-quest-into-canned-estimation-techniques"><i class="fa fa-check"></i><b>5.1.3</b> A short side quest into canned estimation techniques</a></li>
<li class="chapter" data-level="5.1.4" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#assigning-priors"><i class="fa fa-check"></i><b>5.1.4</b> Assigning priors</a></li>
<li class="chapter" data-level="5.1.5" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#estimating-the-model-for-one-participant"><i class="fa fa-check"></i><b>5.1.5</b> Estimating the model for one participant</a></li>
<li class="chapter" data-level="5.1.6" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#estimating-the-model-for-all-participants"><i class="fa fa-check"></i><b>5.1.6</b> Estimating the model for all participants</a></li>
<li class="chapter" data-level="5.1.7" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#but-we-could-be-learning-more"><i class="fa fa-check"></i><b>5.1.7</b> But we could be learning more!</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#actual-representative-agent-models-pooled-models"><i class="fa fa-check"></i><b>5.2</b> Actual representative agent models (pooled models)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="hierarchical-models.html"><a href="hierarchical-models.html"><i class="fa fa-check"></i><b>6</b> Hierarchical models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-random-sample-of-participants-walks-into-your-lab"><i class="fa fa-check"></i><b>6.1</b> A random sample of participants walks into your lab</a></li>
<li class="chapter" data-level="6.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#the-anatomy-of-a-basic-hierarchical-model"><i class="fa fa-check"></i><b>6.2</b> The anatomy of a basic hierarchical model</a></li>
<li class="chapter" data-level="6.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#accounting-for-unobserved-heterogeneity"><i class="fa fa-check"></i><b>6.3</b> Accounting for unobserved heterogeneity</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#the-last-time-you-will-integrate-the-likelihood-probably"><i class="fa fa-check"></i><b>6.3.1</b> The last time you will integrate the likelihood, probably</a></li>
<li class="chapter" data-level="6.3.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#data-augmentation"><i class="fa fa-check"></i><b>6.3.2</b> Data augmentation</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-multivariate-normal-hierarchical-model"><i class="fa fa-check"></i><b>6.4</b> A multivariate normal hierarchical model</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#decomposing-the-variance-covariance-matrix"><i class="fa fa-check"></i><b>6.4.1</b> Decomposing the variance-covariance matrix</a></li>
<li class="chapter" data-level="6.4.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#transformed-parameters-and-normal-distributions"><i class="fa fa-check"></i><b>6.4.2</b> Transformed parameters and normal distributions</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-again-with-bfs2019"><i class="fa fa-check"></i><b>6.5</b> Example: again with <span class="citation">Bruhin, Fehr, and Schunk (2019)</span></a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#no-correlation-between-individual-level-parameters"><i class="fa fa-check"></i><b>6.5.1</b> No correlation between individual-level parameters</a></li>
<li class="chapter" data-level="6.5.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#correlation-between-individual-level-parameters"><i class="fa fa-check"></i><b>6.5.2</b> Correlation between individual-level parameters</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="mixture-models.html"><a href="mixture-models.html"><i class="fa fa-check"></i><b>7</b> Mixture models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="mixture-models.html"><a href="mixture-models.html#a-menu-of-models"><i class="fa fa-check"></i><b>7.1</b> A menu of models</a></li>
<li class="chapter" data-level="7.2" data-path="mixture-models.html"><a href="mixture-models.html#dichotomous-and-toolbox-mixture-models"><i class="fa fa-check"></i><b>7.2</b> Dichotomous and toolbox mixture models</a></li>
<li class="chapter" data-level="7.3" data-path="mixture-models.html"><a href="mixture-models.html#coding-peculearities"><i class="fa fa-check"></i><b>7.3</b> Coding peculearities</a></li>
<li class="chapter" data-level="7.4" data-path="mixture-models.html"><a href="mixture-models.html#example-experiment-av2001"><i class="fa fa-check"></i><b>7.4</b> Example experiment: <span class="citation">Andreoni and Vesterlund (2001)</span></a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="mixture-models.html"><a href="mixture-models.html#as-basic-as-it-gets"><i class="fa fa-check"></i><b>7.4.1</b> As basic as it gets</a></li>
<li class="chapter" data-level="7.4.2" data-path="mixture-models.html"><a href="mixture-models.html#adding-some-heterogeneity"><i class="fa fa-check"></i><b>7.4.2</b> Adding some heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="mixture-models.html"><a href="mixture-models.html#some-code-used-to-estimate-the-models"><i class="fa fa-check"></i><b>7.5</b> Some code used to estimate the models</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html"><i class="fa fa-check"></i><b>8</b> Filling in the blanks: Imputation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#example-model-and-dataset-yet-again-with-bfs2019"><i class="fa fa-check"></i><b>8.1</b> Example model and dataset: yet again with <span class="citation">Bruhin, Fehr, and Schunk (2019)</span></a></li>
<li class="chapter" data-level="8.2" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#how-is-this-going-to-work"><i class="fa fa-check"></i><b>8.2</b> How is this going to work?</a></li>
<li class="chapter" data-level="8.3" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#implementation"><i class="fa fa-check"></i><b>8.3</b> Implementation</a></li>
<li class="chapter" data-level="8.4" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#results"><i class="fa fa-check"></i><b>8.4</b> Results</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#using-the-correlation-matrix"><i class="fa fa-check"></i><b>8.4.1</b> Using the correlation matrix</a></li>
<li class="chapter" data-level="8.4.2" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#the-correlation-matrix-is-doing-a-lot-of-heavy-lifting-here"><i class="fa fa-check"></i><b>8.4.2</b> The correlation matrix is doing a lot of heavy lifting here</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#conclusion"><i class="fa fa-check"></i><b>8.5</b> Conclusion</a></li>
<li class="chapter" data-level="8.6" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#r-code-used-for-this-chapter-1"><i class="fa fa-check"></i><b>8.6</b> <em>R</em> code used for this chapter</a></li>
<li class="chapter" data-level="" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#acknowedgements"><i class="fa fa-check"></i>Acknowedgements</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><i class="fa fa-check"></i><b>9</b> Using your structural estimates as explanatory variables in regression models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#example-1-a-probit-model-with-risk-preferences-measured-by-holt2002."><i class="fa fa-check"></i><b>9.1</b> Example 1: a probit model with risk preferences measured by <span class="citation">Holt and Laury (2002)</span>.</a></li>
<li class="chapter" data-level="9.2" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#example-2-a-random-effects-logit-model-with-risk-and-time-preferences."><i class="fa fa-check"></i><b>9.2</b> Example 2: A random effects logit model with risk and time preferences.</a></li>
<li class="chapter" data-level="9.3" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#example-3-logit-and-ordered-logit-with-risk-preferences-from-gneezy1997"><i class="fa fa-check"></i><b>9.3</b> Example 3: Logit and ordered logit with risk preferences from <span class="citation">Gneezy and Potters (1997)</span></a></li>
<li class="chapter" data-level="9.4" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#a-note-of-caution"><i class="fa fa-check"></i><b>9.4</b> A note of caution</a></li>
<li class="chapter" data-level="9.5" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#conclusion-1"><i class="fa fa-check"></i><b>9.5</b> Conclusion</a></li>
<li class="chapter" data-level="9.6" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#r-code-used-for-this-chapter-2"><i class="fa fa-check"></i><b>9.6</b> <em>R</em> code used for this chapter</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#example-1"><i class="fa fa-check"></i><b>9.6.1</b> Example 1</a></li>
<li class="chapter" data-level="9.6.2" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#example-2"><i class="fa fa-check"></i><b>9.6.2</b> Example 2</a></li>
<li class="chapter" data-level="9.6.3" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#example-3"><i class="fa fa-check"></i><b>9.6.3</b> Example 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="model-evaluation.html"><a href="model-evaluation.html"><i class="fa fa-check"></i><b>10</b> Model evaluation</a>
<ul>
<li class="chapter" data-level="10.1" data-path="model-evaluation.html"><a href="model-evaluation.html#example-dataset-and-models"><i class="fa fa-check"></i><b>10.1</b> Example dataset and models</a></li>
<li class="chapter" data-level="10.2" data-path="model-evaluation.html"><a href="model-evaluation.html#model-posterior-probabilities"><i class="fa fa-check"></i><b>10.2</b> Model posterior probabilities</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="model-evaluation.html"><a href="model-evaluation.html#implementation-using-bridge-sampling-and-the-bridgesampling-library"><i class="fa fa-check"></i><b>10.2.1</b> Implementation using bridge sampling and the <code>bridgesampling</code> library</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="model-evaluation.html"><a href="model-evaluation.html#cross-validation"><i class="fa fa-check"></i><b>10.3</b> Cross-validation</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="model-evaluation.html"><a href="model-evaluation.html#expected-log-predicted-density-elpd-and-other-measures-of-goodness-of-fit"><i class="fa fa-check"></i><b>10.3.1</b> Expected Log Predicted Density (ELPD) and other measures of goodness of fit</a></li>
<li class="chapter" data-level="10.3.2" data-path="model-evaluation.html"><a href="model-evaluation.html#round-cross-validation"><i class="fa fa-check"></i><b>10.3.2</b> 1-round cross-validation</a></li>
<li class="chapter" data-level="10.3.3" data-path="model-evaluation.html"><a href="model-evaluation.html#leave-one-out-cross-validation-loo"><i class="fa fa-check"></i><b>10.3.3</b> Leave-one-out cross-validation (LOO)</a></li>
<li class="chapter" data-level="10.3.4" data-path="model-evaluation.html"><a href="model-evaluation.html#approximate-loo"><i class="fa fa-check"></i><b>10.3.4</b> Approximate LOO</a></li>
<li class="chapter" data-level="10.3.5" data-path="model-evaluation.html"><a href="model-evaluation.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>10.3.5</b> <span class="math inline">\(k\)</span>-fold cross-validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html"><i class="fa fa-check"></i><b>11</b> Speeding up your <em>Stan</em> code</a>
<ul>
<li class="chapter" data-level="11.1" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#example-dataset-and-model-1"><i class="fa fa-check"></i><b>11.1</b> Example dataset and model</a></li>
<li class="chapter" data-level="11.2" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#a-really-slow-way-to-estimate-the-model"><i class="fa fa-check"></i><b>11.2</b> A really slow way to estimate the model</a></li>
<li class="chapter" data-level="11.3" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#pre-computing-things"><i class="fa fa-check"></i><b>11.3</b> Pre-computing things</a></li>
<li class="chapter" data-level="11.4" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#vectorization"><i class="fa fa-check"></i><b>11.4</b> Vectorization</a></li>
<li class="chapter" data-level="11.5" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#within-chain-parallelization-with-reduce_sum"><i class="fa fa-check"></i><b>11.5</b> Within-chain parallelization with <code>reduce_sum()</code></a></li>
<li class="chapter" data-level="11.6" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#evaluating-the-implementations"><i class="fa fa-check"></i><b>11.6</b> Evaluating the implementations</a>
<ul>
<li class="chapter" data-level="11.6.1" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#pre-computing-and-vectorization"><i class="fa fa-check"></i><b>11.6.1</b> Pre-computing and vectorization</a></li>
<li class="chapter" data-level="11.6.2" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#within-chain-parallelization"><i class="fa fa-check"></i><b>11.6.2</b> Within-chain parallelization</a></li>
</ul></li>
<li class="chapter" data-level="11.7" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#r-code-to-estimate-models"><i class="fa fa-check"></i><b>11.7</b> <em>R</em> code to estimate models</a>
<ul>
<li class="chapter" data-level="11.7.1" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#slow-pre-computed-and-vectorized-models"><i class="fa fa-check"></i><b>11.7.1</b> Slow, pre-computed, and vectorized models</a></li>
<li class="chapter" data-level="11.7.2" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#parallelized-model"><i class="fa fa-check"></i><b>11.7.2</b> Parallelized model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i>Applications</a></li>
<li class="chapter" data-level="12" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html"><i class="fa fa-check"></i><b>12</b> Application: Experience-Weighted Attraction</a>
<ul>
<li class="chapter" data-level="12.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-model-at-the-individual-level"><i class="fa fa-check"></i><b>12.1</b> The model at the individual level</a></li>
<li class="chapter" data-level="12.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#some-computational-and-coding-issues"><i class="fa fa-check"></i><b>12.2</b> Some computational and coding issues</a></li>
<li class="chapter" data-level="12.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#representative-agent-models"><i class="fa fa-check"></i><b>12.3</b> Representative agent models</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#prior-calibration"><i class="fa fa-check"></i><b>12.3.1</b> Prior calibration</a></li>
<li class="chapter" data-level="12.3.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-stan-model"><i class="fa fa-check"></i><b>12.3.2</b> The <em>Stan</em> model</a></li>
<li class="chapter" data-level="12.3.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#results-1"><i class="fa fa-check"></i><b>12.3.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#hierarchical-model"><i class="fa fa-check"></i><b>12.4</b> Hierarchical model</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#prior-calibration-1"><i class="fa fa-check"></i><b>12.4.1</b> Prior calibration</a></li>
<li class="chapter" data-level="12.4.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-stan-model-1"><i class="fa fa-check"></i><b>12.4.2</b> The <em>Stan</em> model</a></li>
<li class="chapter" data-level="12.4.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#results-2"><i class="fa fa-check"></i><b>12.4.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#some-code-used-to-estimate-the-models-1"><i class="fa fa-check"></i><b>12.5</b> Some code used to estimate the models</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#loading-the-data"><i class="fa fa-check"></i><b>12.5.1</b> Loading the data</a></li>
<li class="chapter" data-level="12.5.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#estimating-the-representative-agent-models"><i class="fa fa-check"></i><b>12.5.2</b> Estimating the representative agent models</a></li>
<li class="chapter" data-level="12.5.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#estimating-the-hierarchical-model"><i class="fa fa-check"></i><b>12.5.3</b> Estimating the hierarchical model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html"><i class="fa fa-check"></i><b>13</b> Application: Strategy Frequency Estimation</a>
<ul>
<li class="chapter" data-level="13.1" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#simplifying-the-individual-likelihood-functions"><i class="fa fa-check"></i><b>13.1</b> Simplifying the individual likelihood functions</a></li>
<li class="chapter" data-level="13.2" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#example-experiment-dbf2011"><i class="fa fa-check"></i><b>13.2</b> Example experiment: <span class="citation">Dal Bó and Fréchette (2011)</span></a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#the-sfem-with-homogeneous-trembles"><i class="fa fa-check"></i><b>13.2.1</b> The SFEM with homogeneous trembles</a></li>
<li class="chapter" data-level="13.2.2" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#adding-heterogeneous-trembles-and-integrating-the-likelihood"><i class="fa fa-check"></i><b>13.2.2</b> Adding heterogeneous trembles and integrating the likelihood</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#r-code-to-do-these-estimations"><i class="fa fa-check"></i><b>13.3</b> <em>R</em> code to do these estimations</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><i class="fa fa-check"></i><b>14</b> Application: Strategy frequency estimation with a mixed strategy</a>
<ul>
<li class="chapter" data-level="14.1" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#example-dataset-and-strategies"><i class="fa fa-check"></i><b>14.1</b> Example dataset and strategies</a></li>
<li class="chapter" data-level="14.2" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#the-likelihood-function"><i class="fa fa-check"></i><b>14.2</b> The likelihood function</a></li>
<li class="chapter" data-level="14.3" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#implementation-in-stan"><i class="fa fa-check"></i><b>14.3</b> Implementation in <em>Stan</em></a></li>
<li class="chapter" data-level="14.4" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#results-3"><i class="fa fa-check"></i><b>14.4</b> Results</a></li>
<li class="chapter" data-level="14.5" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#r-code-used-to-estimate-the-models"><i class="fa fa-check"></i><b>14.5</b> <em>R</em> code used to estimate the models</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html"><i class="fa fa-check"></i><b>15</b> Computing Quantal Response Equilibrium</a>
<ul>
<li class="chapter" data-level="15.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#overview-of-quantal-response-equilibrium"><i class="fa fa-check"></i><b>15.1</b> Overview of quantal response equilibrium</a></li>
<li class="chapter" data-level="15.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#computing-quantal-response-equilibrium-1"><i class="fa fa-check"></i><b>15.2</b> Computing Quantal Response Equilibrium</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#setting-up-the-problem"><i class="fa fa-check"></i><b>15.2.1</b> Setting up the problem</a></li>
<li class="chapter" data-level="15.2.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#a-predictor-corrector-algorithm"><i class="fa fa-check"></i><b>15.2.2</b> A predictor-corrector algorithm</a></li>
<li class="chapter" data-level="15.2.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#initial-conditions"><i class="fa fa-check"></i><b>15.2.3</b> Initial conditions</a></li>
<li class="chapter" data-level="15.2.4" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#algorithm-tuning"><i class="fa fa-check"></i><b>15.2.4</b> Algorithm tuning</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#the-predictor-corrector-algorithm-in-r"><i class="fa fa-check"></i><b>15.3</b> The predictor-corrector algorithm in <em>R</em></a></li>
<li class="chapter" data-level="15.4" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#some-example-games"><i class="fa fa-check"></i><b>15.4</b> Some example games</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#generalized-matching-pennies-ochs1995"><i class="fa fa-check"></i><b>15.4.1</b> Generalized matching pennies <span class="citation">(Ochs 1995)</span></a></li>
<li class="chapter" data-level="15.4.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#stag-hunt"><i class="fa fa-check"></i><b>15.4.2</b> Stag hunt</a></li>
<li class="chapter" data-level="15.4.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#n-player-volunteers-dilemma-imposing-symmetric-strategies"><i class="fa fa-check"></i><b>15.4.3</b> <span class="math inline">\(n\)</span>-player Volunteer’s Dilemma imposing symmetric strategies</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><i class="fa fa-check"></i><b>16</b> Application: Quantal Response Equilibrium and the Volunteer’s Dilemma <span class="citation">(Goeree, Holt, and Smith 2017)</span></a>
<ul>
<li class="chapter" data-level="16.1" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#solving-logit-qre-and-estimating-the-model"><i class="fa fa-check"></i><b>16.1</b> Solving logit QRE and estimating the model</a></li>
<li class="chapter" data-level="16.2" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#adding-some-heterogeneity-1"><i class="fa fa-check"></i><b>16.2</b> Adding some heterogeneity</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#computing-quantal-response-equilibrium-with-heterogeneous-parameters"><i class="fa fa-check"></i><b>16.2.1</b> Computing quantal response equilibrium with heterogeneous parameters</a></li>
<li class="chapter" data-level="16.2.2" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#warm-glow-volunteering"><i class="fa fa-check"></i><b>16.2.2</b> Warm glow volunteering</a></li>
<li class="chapter" data-level="16.2.3" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#duplicate-aversion"><i class="fa fa-check"></i><b>16.2.3</b> Duplicate aversion</a></li>
<li class="chapter" data-level="16.2.4" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#results-4"><i class="fa fa-check"></i><b>16.2.4</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#r-code-to-run-estimations"><i class="fa fa-check"></i><b>16.3</b> <em>R</em> code to run estimations</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html"><i class="fa fa-check"></i><b>17</b> Application: A Quantal Response Equilibrium with discrete types</a>
<ul>
<li class="chapter" data-level="17.1" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#example-dataset-and-models-1"><i class="fa fa-check"></i><b>17.1</b> Example dataset and models</a></li>
<li class="chapter" data-level="17.2" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#a-note-on-replication"><i class="fa fa-check"></i><b>17.2</b> A note on replication</a></li>
<li class="chapter" data-level="17.3" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#three-models-that-make-different-assumptions-about-bracketing"><i class="fa fa-check"></i><b>17.3</b> Three models that make different assumptions about bracketing</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#broad-bracketing-only"><i class="fa fa-check"></i><b>17.3.1</b> Broad bracketing only</a></li>
<li class="chapter" data-level="17.3.2" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#narrow-bracketing-only"><i class="fa fa-check"></i><b>17.3.2</b> Narrow bracketing only</a></li>
<li class="chapter" data-level="17.3.3" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#a-mixture-of-broad-and-narrow-bracketing"><i class="fa fa-check"></i><b>17.3.3</b> A mixture of broad and narrow bracketing</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#results-5"><i class="fa fa-check"></i><b>17.4</b> Results</a></li>
<li class="chapter" data-level="17.5" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#r-code-used-to-estimate-these-models"><i class="fa fa-check"></i><b>17.5</b> <em>R</em> code used to estimate these models</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><i class="fa fa-check"></i><b>18</b> Application: QRE in a Bayesian game and cursed equilibrium</a>
<ul>
<li class="chapter" data-level="18.1" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#example-game-and-dataset"><i class="fa fa-check"></i><b>18.1</b> Example game and dataset</a></li>
<li class="chapter" data-level="18.2" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#solving-for-qre"><i class="fa fa-check"></i><b>18.2</b> Solving for QRE</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#baseline-model"><i class="fa fa-check"></i><b>18.2.1</b> Baseline model</a></li>
<li class="chapter" data-level="18.2.2" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#cursed-equilibrium"><i class="fa fa-check"></i><b>18.2.2</b> Cursed equilibrium</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#a-quick-prior-calibration-1"><i class="fa fa-check"></i><b>18.3</b> A quick prior calibration</a></li>
<li class="chapter" data-level="18.4" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#model-results"><i class="fa fa-check"></i><b>18.4</b> Model results</a></li>
<li class="chapter" data-level="18.5" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#model-evaluation-1"><i class="fa fa-check"></i><b>18.5</b> Model evaluation</a></li>
<li class="chapter" data-level="18.6" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#r-code-used-in-this-chapter"><i class="fa fa-check"></i><b>18.6</b> <em>R</em> code used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="application-level-k-models.html"><a href="application-level-k-models.html"><i class="fa fa-check"></i><b>19</b> Application: Level-<span class="math inline">\(k\)</span> models</a>
<ul>
<li class="chapter" data-level="19.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#data-and-game"><i class="fa fa-check"></i><b>19.1</b> Data and game</a></li>
<li class="chapter" data-level="19.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-level-k-model"><i class="fa fa-check"></i><b>19.2</b> The level-<span class="math inline">\(k\)</span> model</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-deterministic-component-of-the-model"><i class="fa fa-check"></i><b>19.2.1</b> The deterministic component of the model</a></li>
<li class="chapter" data-level="19.2.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#exact-and-probabilistic-play"><i class="fa fa-check"></i><b>19.2.2</b> Exact and probabilistic play</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#assigning-probabilities-to-types-for-each-participant-separately"><i class="fa fa-check"></i><b>19.3</b> Assigning probabilities to types for each participant separately</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-stan-program"><i class="fa fa-check"></i><b>19.3.1</b> The <em>Stan</em> program</a></li>
<li class="chapter" data-level="19.3.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#prior-calibration-2"><i class="fa fa-check"></i><b>19.3.2</b> Prior calibration</a></li>
<li class="chapter" data-level="19.3.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-6"><i class="fa fa-check"></i><b>19.3.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="application-level-k-models.html"><a href="application-level-k-models.html#doing-the-averaging-within-one-program"><i class="fa fa-check"></i><b>19.4</b> Doing the averaging within one program</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-stan-program-1"><i class="fa fa-check"></i><b>19.4.1</b> The <em>Stan</em> program</a></li>
<li class="chapter" data-level="19.4.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-7"><i class="fa fa-check"></i><b>19.4.2</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-mixture-model"><i class="fa fa-check"></i><b>19.5</b> A mixture model</a>
<ul>
<li class="chapter" data-level="19.5.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#stan-program"><i class="fa fa-check"></i><b>19.5.1</b> <em>Stan</em> program</a></li>
<li class="chapter" data-level="19.5.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-prior-for-psi"><i class="fa fa-check"></i><b>19.5.2</b> A prior for <span class="math inline">\(\psi\)</span></a></li>
<li class="chapter" data-level="19.5.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-8"><i class="fa fa-check"></i><b>19.5.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="19.6" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-mixture-over-levels-and-hierarchical-nuisance-parameters"><i class="fa fa-check"></i><b>19.6</b> A mixture over levels and hierarchical nuisance parameters</a>
<ul>
<li class="chapter" data-level="19.6.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#prior-calibration-3"><i class="fa fa-check"></i><b>19.6.1</b> Prior calibration</a></li>
<li class="chapter" data-level="19.6.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#stan-program-1"><i class="fa fa-check"></i><b>19.6.2</b> <em>Stan</em> program</a></li>
<li class="chapter" data-level="19.6.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-9"><i class="fa fa-check"></i><b>19.6.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="19.7" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-different-assumption-about-mixing"><i class="fa fa-check"></i><b>19.7</b> A different assumption about mixing</a>
<ul>
<li class="chapter" data-level="19.7.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#stan-program-2"><i class="fa fa-check"></i><b>19.7.1</b> <em>Stan</em> program</a></li>
<li class="chapter" data-level="19.7.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-10"><i class="fa fa-check"></i><b>19.7.2</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="19.8" data-path="application-level-k-models.html"><a href="application-level-k-models.html#r-code-to-estimate-the-models"><i class="fa fa-check"></i><b>19.8</b> <em>R</em> code to estimate the models</a>
<ul>
<li class="chapter" data-level="19.8.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#participant-specific-estimation-conditional-on-k-with-bayesian-model-averaging"><i class="fa fa-check"></i><b>19.8.1</b> Participant-specific estimation conditional on <span class="math inline">\(k\)</span> with Bayesian model averaging</a></li>
<li class="chapter" data-level="19.8.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#participant-specific-estimation-with-a-prior-over-k"><i class="fa fa-check"></i><b>19.8.2</b> Participant-specific estimation with a prior over <span class="math inline">\(k\)</span></a></li>
<li class="chapter" data-level="19.8.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#mixture-model"><i class="fa fa-check"></i><b>19.8.3</b> Mixture model</a></li>
<li class="chapter" data-level="19.8.4" data-path="application-level-k-models.html"><a href="application-level-k-models.html#hierarchical-model-1"><i class="fa fa-check"></i><b>19.8.4</b> Hierarchical model</a></li>
<li class="chapter" data-level="19.8.5" data-path="application-level-k-models.html"><a href="application-level-k-models.html#mixture-model-with-beliefs-consistent-with-truncated-type-distribution"><i class="fa fa-check"></i><b>19.8.5</b> Mixture model with beliefs consistent with truncated type distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html"><i class="fa fa-check"></i><b>20</b> Application: Estimating risk preferences</a>
<ul>
<li class="chapter" data-level="20.1" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#example-dataset"><i class="fa fa-check"></i><b>20.1</b> Example dataset</a></li>
<li class="chapter" data-level="20.2" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#we-might-not-just-be-interested-in-the-parameters"><i class="fa fa-check"></i><b>20.2</b> We might not just be interested in the parameters</a></li>
<li class="chapter" data-level="20.3" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#introducing-some-important-models"><i class="fa fa-check"></i><b>20.3</b> Introducing some important models</a>
<ul>
<li class="chapter" data-level="20.3.1" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#expected-utility-theory"><i class="fa fa-check"></i><b>20.3.1</b> Expected utility theory</a></li>
<li class="chapter" data-level="20.3.2" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#rank-dependent-utility-quiggin1982"><i class="fa fa-check"></i><b>20.3.2</b> Rank-dependent utility <span class="citation">(Quiggin 1982)</span></a></li>
<li class="chapter" data-level="20.3.3" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#comparing-the-certainty-equivalents-estimated-using-eut-and-rdu"><i class="fa fa-check"></i><b>20.3.3</b> Comparing the certainty equivalents estimated using EUT and RDU</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#a-hierarchical-specification"><i class="fa fa-check"></i><b>20.4</b> A hierarchical specification</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#population-level-estimates"><i class="fa fa-check"></i><b>20.4.1</b> Population-level estimates</a></li>
<li class="chapter" data-level="20.4.2" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#participant-level-estimates"><i class="fa fa-check"></i><b>20.4.2</b> Participant-level estimates</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#r-code-used-to-estimate-these-models-1"><i class="fa fa-check"></i><b>20.5</b> <em>R</em> code used to estimate these models</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html"><i class="fa fa-check"></i><b>21</b> Application: Meta-analysis using (some of) the METARET data</a>
<ul>
<li class="chapter" data-level="21.1" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#data"><i class="fa fa-check"></i><b>21.1</b> Data</a></li>
<li class="chapter" data-level="21.2" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#a-basic-model"><i class="fa fa-check"></i><b>21.2</b> A basic model</a></li>
<li class="chapter" data-level="21.3" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#but-the-data-are-really-interval-valued"><i class="fa fa-check"></i><b>21.3</b> But the data are really interval-valued!</a></li>
<li class="chapter" data-level="21.4" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#heterogeneous-standard-deviations"><i class="fa fa-check"></i><b>21.4</b> Heterogeneous standard deviations</a></li>
<li class="chapter" data-level="21.5" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#student-t-distributions-because-why-not"><i class="fa fa-check"></i><b>21.5</b> Student-<span class="math inline">\(t\)</span> distributions, because why not?</a></li>
<li class="chapter" data-level="21.6" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#r-code-to-estimate-the-models-1"><i class="fa fa-check"></i><b>21.6</b> <em>R</em> code to estimate the models</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html"><i class="fa fa-check"></i><b>22</b> Application: choice bracketing</a>
<ul>
<li class="chapter" data-level="22.1" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html#data-and-model"><i class="fa fa-check"></i><b>22.1</b> Data and model</a></li>
<li class="chapter" data-level="22.2" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html#representative-agent-and-individual-estimation"><i class="fa fa-check"></i><b>22.2</b> Representative agent and individual estimation</a></li>
<li class="chapter" data-level="22.3" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html#hierarchical-model-2"><i class="fa fa-check"></i><b>22.3</b> Hierarchical model</a></li>
<li class="chapter" data-level="22.4" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html#a-mixture-model-1"><i class="fa fa-check"></i><b>22.4</b> A mixture model</a></li>
<li class="chapter" data-level="22.5" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html#what-do-we-get-out-of-the-structural-models-and-what-could-we-miss"><i class="fa fa-check"></i><b>22.5</b> What do we get out of the structural models, and what could we miss?</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html"><i class="fa fa-check"></i><b>23</b> Application: Ranked choices and the Thurstonian model</a>
<ul>
<li class="chapter" data-level="23.1" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#the-thurstonian-model"><i class="fa fa-check"></i><b>23.1</b> The Thurstonian model</a></li>
<li class="chapter" data-level="23.2" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#computational-issues"><i class="fa fa-check"></i><b>23.2</b> Computational issues</a></li>
<li class="chapter" data-level="23.3" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#example-dataset-and-model-2"><i class="fa fa-check"></i><b>23.3</b> Example dataset and model</a></li>
<li class="chapter" data-level="23.4" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#a-representative-agent-model"><i class="fa fa-check"></i><b>23.4</b> A representative agent model</a></li>
<li class="chapter" data-level="23.5" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#a-hierarchical-model"><i class="fa fa-check"></i><b>23.5</b> A hierarchical model</a></li>
<li class="chapter" data-level="23.6" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#r-code-used-to-run-this"><i class="fa fa-check"></i><b>23.6</b> <em>R</em> code used to run this</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="links-to-data.html"><a href="links-to-data.html"><i class="fa fa-check"></i>Links to data</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Structural Bayesian Techniques for Experimental and Behavioral Economics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="application-choice-bracketing" class="section level1 hasAnchor" number="22">
<h1><span class="header-section-number">22</span> Application: choice bracketing<a href="application-choice-bracketing.html#application-choice-bracketing" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This topic evokes some strong (mostly good) feelings for me, as I wrote my job market paper on it <span class="citation">(<a href="#ref-Bland2019JMP">Bland 2019a</a>)</span>. Choice bracketing is the idea that people might partition (or “bracket”) their decisions into more than one group. When I was on the job market, I would use the analogy of choosing what to eat and drink at a restaurant. The (unboundedly) rational economic agent who brackets <em>broadly</em> picks their favorite <em>combination</em> of food and drink. However this may be a difficult problem if the food and drink menus are large. Instead, the decision-maker might look only at the food menu and pick their favorite food, then look only at the drink menu and pick their favorite drink. This behavior is called <em>narrow bracketing</em>, and can lead to mistakes relative to the rational model because the decision-maker ignores that food and drink can be complements. For example, a narrowly bracketing decision-maker runs the risk at a restaurant of choosing red wine with fish, which is often regarded as a poor pairing.<a href="#fn99" class="footnote-ref" id="fnref99"><sup>99</sup></a></p>
<p>While we as humans usually pay some attention to the combinations of food and drink we are consuming, we may be more likely to narrowly bracket in other domains. One domain that has received a lot of attention in the experimental/behavioral economics and psychology literature is choice under risk (see for example <span class="citation">Rabin and Weizsäcker (<a href="#ref-Rabin2009">2009</a>)</span>). In this environment “mistakes” are sometimes easier to recognize because they can be identified by (e.g. first-order stochastically) dominated choices. However <span class="citation">Ellis and Freeman (<a href="#ref-EF2024">2024</a>)</span> argue that the existing literature typically provides evidence against broad bracketing, rather than in favor of narrow bracketing. That is, the broad bracketing model does not organize the data well, but the narrow bracketing model does not make any testable predictions for existing experiments. It is this experiment of <span class="citation">Ellis and Freeman (<a href="#ref-EF2024">2024</a>)</span> that I use as the example dataset in this chapter.</p>
<div id="data-and-model" class="section level2 hasAnchor" number="22.1">
<h2><span class="header-section-number">22.1</span> Data and model<a href="application-choice-bracketing.html#data-and-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For this application, I use data from the social preferences experiment in <span class="citation">Ellis and Freeman (<a href="#ref-EF2024">2024</a>)</span>. In this experiment, made five decisions that involved allocating tokens to two other people. In decisions 2, 4, and 5, this was a simple convex budget set problem of allocating <span class="math inline">\(I\)</span> tokens between person A and person B. Tokens were worth <span class="math inline">\(\$v_A\)</span> to person A and <span class="math inline">\(\$v_B\)</span> to person B. Figure <a href="application-choice-bracketing.html#fig:EF2024-subj6narrow">22.1</a> shows these decisions along with dicisions 1 and 3, which I will get to later. For decisions 2, 4, and 5, the red line shows the budget line, and the red dot shows the choice made by participant 6 in the experiment. Here we can see that in decision 4 participants faced a choice where tokens were equally valuable to person A and person B. In this instance participant 6 chose to split them equally. This is also approximately true for decision 2 (where tokens were also equally valuable). On the other hand in decision 5, tokens are worth more to person B than person A, and participant 6 chose to give all of the tokens to person B.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="application-choice-bracketing.html#cb278-1" tabindex="-1"></a>lookup<span class="ot">&lt;-</span><span class="fu">rbind</span>(</span>
<span id="cb278-2"><a href="application-choice-bracketing.html#cb278-2" tabindex="-1"></a>  <span class="co"># decision  part  I vA  vB</span></span>
<span id="cb278-3"><a href="application-choice-bracketing.html#cb278-3" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">1</span>,<span class="fl">1.20</span>),</span>
<span id="cb278-4"><a href="application-choice-bracketing.html#cb278-4" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">16</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb278-5"><a href="application-choice-bracketing.html#cb278-5" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">14</span>,<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb278-6"><a href="application-choice-bracketing.html#cb278-6" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb278-7"><a href="application-choice-bracketing.html#cb278-7" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">10</span>,<span class="dv">1</span>,<span class="fl">1.20</span>),</span>
<span id="cb278-8"><a href="application-choice-bracketing.html#cb278-8" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">16</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb278-9"><a href="application-choice-bracketing.html#cb278-9" tabindex="-1"></a>  <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">1</span>,<span class="fl">1.20</span>)</span>
<span id="cb278-10"><a href="application-choice-bracketing.html#cb278-10" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb278-11"><a href="application-choice-bracketing.html#cb278-11" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span>
<span id="cb278-12"><a href="application-choice-bracketing.html#cb278-12" tabindex="-1"></a><span class="fu">colnames</span>(lookup)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;decision&quot;</span>,<span class="st">&quot;part&quot;</span>,<span class="st">&quot;I&quot;</span>,<span class="st">&quot;vA&quot;</span>,<span class="st">&quot;vB&quot;</span>)</span>
<span id="cb278-13"><a href="application-choice-bracketing.html#cb278-13" tabindex="-1"></a></span>
<span id="cb278-14"><a href="application-choice-bracketing.html#cb278-14" tabindex="-1"></a>D<span class="ot">&lt;-</span><span class="st">&quot;Data/EF2024/SocialExperimentData.csv&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb278-15"><a href="application-choice-bracketing.html#cb278-15" tabindex="-1"></a>  <span class="fu">read.csv</span>()<span class="sc">|&gt;</span></span>
<span id="cb278-16"><a href="application-choice-bracketing.html#cb278-16" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb278-17"><a href="application-choice-bracketing.html#cb278-17" tabindex="-1"></a>    <span class="at">uid =</span> <span class="fu">paste</span>(Location,Session,SubjectID) <span class="sc">|&gt;</span> <span class="fu">as.factor</span>() <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()</span>
<span id="cb278-18"><a href="application-choice-bracketing.html#cb278-18" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb278-19"><a href="application-choice-bracketing.html#cb278-19" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb278-20"><a href="application-choice-bracketing.html#cb278-20" tabindex="-1"></a>    <span class="at">cols =</span> R1A1.A<span class="sc">:</span>R5A1.B,</span>
<span id="cb278-21"><a href="application-choice-bracketing.html#cb278-21" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;name&quot;</span>,</span>
<span id="cb278-22"><a href="application-choice-bracketing.html#cb278-22" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;allocation&quot;</span></span>
<span id="cb278-23"><a href="application-choice-bracketing.html#cb278-23" tabindex="-1"></a>  )   <span class="sc">|&gt;</span></span>
<span id="cb278-24"><a href="application-choice-bracketing.html#cb278-24" tabindex="-1"></a>      <span class="fu">mutate</span>(</span>
<span id="cb278-25"><a href="application-choice-bracketing.html#cb278-25" tabindex="-1"></a>        <span class="at">decision =</span> <span class="fu">substr</span>(name,<span class="dv">2</span>,<span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>(),</span>
<span id="cb278-26"><a href="application-choice-bracketing.html#cb278-26" tabindex="-1"></a>        <span class="at">part =</span>  <span class="fu">substr</span>(name,<span class="dv">4</span>,<span class="dv">4</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>(),</span>
<span id="cb278-27"><a href="application-choice-bracketing.html#cb278-27" tabindex="-1"></a>        <span class="at">player =</span> <span class="fu">substr</span>(name,<span class="dv">6</span>,<span class="dv">6</span>)</span>
<span id="cb278-28"><a href="application-choice-bracketing.html#cb278-28" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb278-29"><a href="application-choice-bracketing.html#cb278-29" tabindex="-1"></a>  <span class="fu">filter</span>(player<span class="sc">==</span><span class="st">&quot;A&quot;</span>)<span class="sc">|&gt;</span></span>
<span id="cb278-30"><a href="application-choice-bracketing.html#cb278-30" tabindex="-1"></a>  <span class="fu">full_join</span>(lookup,<span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;decision&quot;</span>,<span class="st">&quot;part&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb278-31"><a href="application-choice-bracketing.html#cb278-31" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb278-32"><a href="application-choice-bracketing.html#cb278-32" tabindex="-1"></a>    <span class="at">decision =</span> <span class="fu">paste</span>(<span class="st">&quot;decision&quot;</span>,decision),</span>
<span id="cb278-33"><a href="application-choice-bracketing.html#cb278-33" tabindex="-1"></a>    <span class="at">part =</span> <span class="fu">paste</span>(<span class="st">&quot;part&quot;</span>,part)</span>
<span id="cb278-34"><a href="application-choice-bracketing.html#cb278-34" tabindex="-1"></a>  )</span>
<span id="cb278-35"><a href="application-choice-bracketing.html#cb278-35" tabindex="-1"></a></span>
<span id="cb278-36"><a href="application-choice-bracketing.html#cb278-36" tabindex="-1"></a></span>
<span id="cb278-37"><a href="application-choice-bracketing.html#cb278-37" tabindex="-1"></a>(</span>
<span id="cb278-38"><a href="application-choice-bracketing.html#cb278-38" tabindex="-1"></a>  <span class="fu">ggplot</span>(D <span class="sc">|&gt;</span> <span class="fu">filter</span>(uid<span class="sc">==</span><span class="dv">6</span>))</span>
<span id="cb278-39"><a href="application-choice-bracketing.html#cb278-39" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_segment</span>(</span>
<span id="cb278-40"><a href="application-choice-bracketing.html#cb278-40" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb278-41"><a href="application-choice-bracketing.html#cb278-41" tabindex="-1"></a>      <span class="at">x =</span> I<span class="sc">*</span>vA,<span class="at">y=</span><span class="dv">0</span>,</span>
<span id="cb278-42"><a href="application-choice-bracketing.html#cb278-42" tabindex="-1"></a>      <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">yend=</span>I<span class="sc">*</span>vB,</span>
<span id="cb278-43"><a href="application-choice-bracketing.html#cb278-43" tabindex="-1"></a>      <span class="at">color=</span>part</span>
<span id="cb278-44"><a href="application-choice-bracketing.html#cb278-44" tabindex="-1"></a>                ),<span class="at">linewidth=</span><span class="fl">0.5</span>)</span>
<span id="cb278-45"><a href="application-choice-bracketing.html#cb278-45" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>decision)</span>
<span id="cb278-46"><a href="application-choice-bracketing.html#cb278-46" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>allocation<span class="sc">*</span>vA,<span class="at">y=</span>(I<span class="sc">-</span>allocation)<span class="sc">*</span>vB,<span class="at">color=</span>part))</span>
<span id="cb278-47"><a href="application-choice-bracketing.html#cb278-47" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">0</span>)<span class="sc">+</span><span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>)</span>
<span id="cb278-48"><a href="application-choice-bracketing.html#cb278-48" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_minimal</span>()</span>
<span id="cb278-49"><a href="application-choice-bracketing.html#cb278-49" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;allocation to person A&quot;</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;allocation to person B&quot;</span>)</span>
<span id="cb278-50"><a href="application-choice-bracketing.html#cb278-50" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">coord_fixed</span>()</span>
<span id="cb278-51"><a href="application-choice-bracketing.html#cb278-51" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>))</span>
<span id="cb278-52"><a href="application-choice-bracketing.html#cb278-52" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb278-53"><a href="application-choice-bracketing.html#cb278-53" tabindex="-1"></a>  <span class="co">#+geom_abline(slope=1,intercept=0,linetype=&quot;dashed&quot;)</span></span>
<span id="cb278-54"><a href="application-choice-bracketing.html#cb278-54" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:EF2024-subj6narrow"></span>
<img src="index_files/figure-html/EF2024-subj6narrow-1.png" alt="Choice data for participant 6, narrow framing." width="672" />
<p class="caption">
Figure 22.1: Choice data for participant 6, narrow framing.
</p>
</div>
<p>Decisions 1 and 3 were slightly more complicated, in that the decision-maker faced <em>two</em> budget sets, with different endowments (<span class="math inline">\(I\)</span>) and values to each person (<span class="math inline">\(v_A\)</span>,<span class="math inline">\(v_B\)</span>). If one of these decisions was chosen for payment, then <em>both</em> parts of the decision would be added to person A and B’s earnings. For participant 6 in Figure <a href="application-choice-bracketing.html#fig:EF2024-subj6narrow">22.1</a> we can see that in decision 3, they allocated all of their part 2 tokens (blue) to person B, and all of their part 1 (red) tokens to person A.</p>
<p>To see how we might (qualitatively at least) distinguish between broad and narrow bracketing, I found it helpful to also look at the choice data for participant 1, which are shown in Figure <a href="application-choice-bracketing.html#fig:EF2024-subj1narrow">22.2</a>. In particular, note in decision 3 that this participant chose close to the equal split for both parts of this decision. This could be rationalized under narrow bracketing by assuming that participant 1 likes payoff to be equal. However is cannot be rationalized under broad bracketing if we also assume that, all else held equal, participant 1 would like person A and B to get more money. This is becuase participant 1 could have allocated more part 1 tokens to A and more part 2 tokens to B, and both A and B could have received more earnings.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="application-choice-bracketing.html#cb279-1" tabindex="-1"></a>(</span>
<span id="cb279-2"><a href="application-choice-bracketing.html#cb279-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(D <span class="sc">|&gt;</span> <span class="fu">filter</span>(uid<span class="sc">==</span><span class="dv">1</span>))</span>
<span id="cb279-3"><a href="application-choice-bracketing.html#cb279-3" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_segment</span>(</span>
<span id="cb279-4"><a href="application-choice-bracketing.html#cb279-4" tabindex="-1"></a>    <span class="fu">aes</span>(</span>
<span id="cb279-5"><a href="application-choice-bracketing.html#cb279-5" tabindex="-1"></a>      <span class="at">x =</span> I<span class="sc">*</span>vA,<span class="at">y=</span><span class="dv">0</span>,</span>
<span id="cb279-6"><a href="application-choice-bracketing.html#cb279-6" tabindex="-1"></a>      <span class="at">xend =</span> <span class="dv">0</span>, <span class="at">yend=</span>I<span class="sc">*</span>vB,</span>
<span id="cb279-7"><a href="application-choice-bracketing.html#cb279-7" tabindex="-1"></a>      <span class="at">color=</span>part</span>
<span id="cb279-8"><a href="application-choice-bracketing.html#cb279-8" tabindex="-1"></a>                ),<span class="at">linewidth=</span><span class="fl">0.5</span>)</span>
<span id="cb279-9"><a href="application-choice-bracketing.html#cb279-9" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>decision)</span>
<span id="cb279-10"><a href="application-choice-bracketing.html#cb279-10" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>allocation<span class="sc">*</span>vA,<span class="at">y=</span>(I<span class="sc">-</span>allocation)<span class="sc">*</span>vB,<span class="at">color=</span>part))</span>
<span id="cb279-11"><a href="application-choice-bracketing.html#cb279-11" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="dv">0</span>)<span class="sc">+</span><span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>)</span>
<span id="cb279-12"><a href="application-choice-bracketing.html#cb279-12" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_minimal</span>()</span>
<span id="cb279-13"><a href="application-choice-bracketing.html#cb279-13" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;allocation to person A&quot;</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;allocation to person B&quot;</span>)</span>
<span id="cb279-14"><a href="application-choice-bracketing.html#cb279-14" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">coord_fixed</span>()</span>
<span id="cb279-15"><a href="application-choice-bracketing.html#cb279-15" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>))</span>
<span id="cb279-16"><a href="application-choice-bracketing.html#cb279-16" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb279-17"><a href="application-choice-bracketing.html#cb279-17" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:EF2024-subj1narrow"></span>
<img src="index_files/figure-html/EF2024-subj1narrow-1.png" alt="Choice data for participant 1, narrow framing." width="672" />
<p class="caption">
Figure 22.2: Choice data for participant 1, narrow framing.
</p>
</div>
<p>In total, 102 participants made these five decisions. Choice sets were discretized to integer multiples of tokens, so in my analysis, I will assume logit choice over the discretized choice set.</p>
<p>So that’s the dataset, now we need a model for bracketing behavior. For this, I will use the <em><span class="math inline">\(\alpha\)</span>-partial bracketing</em> model (<span class="citation">Barberis, Huang, and Thaler (<a href="#ref-Barberis2006">2006</a>)</span>, <span class="citation">Barberis and Huang (<a href="#ref-Barberis2009">2009</a>)</span>, and <span class="citation">Rabin and Weizsäcker (<a href="#ref-Rabin2009">2009</a>)</span>). For this application, suppose that decision-makers have a utility function over earnings for person A and person B. which we denote <span class="math inline">\(u(x_A,x_B)\)</span>, where <span class="math inline">\(x_A\)</span> and <span class="math inline">\(x_B\)</span> are the monetary earnings of A and B, respectively. In a 1-part decision, the decision-maker’s utility-maximization problem is identical irrespective of how they bracket:
<span class="math display">\[
\begin{aligned}
\max_{y_A+y_B\leq I_d} u(v_{A,d}y_A,\ v_{B,d}y_B)
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(I_d\)</span> is token endowment in decision <span class="math inline">\(d\)</span>, and <span class="math inline">\(v_{A,d}\)</span> and <span class="math inline">\(v_{B,d}\)</span> are the values of these tokens to person A and person B, respectively (I am writing this as a continuous choice problem, but when I get to the econometric model this will of course be a discrete choice problem).</p>
<p>For the 2-part decisions, the decision-maker’s maximization problem if they broadly bracket is:
<span class="math display">\[
\begin{aligned}
\max_{y^1_A+y^1_B\leq I^1_d,\  y^2_A+y^2_B\leq I^2_d} u(v^1_{A,d}y^1_A+v^2_{A,d}y^2_A,\ v^1_{B,d}y^1_B+v^2_{B,d}y^2_B)
\end{aligned}
\]</span></p>
<p>That is, a broadly-bracketing decision-maker adds up the payoffs that each recipient will get from each part of the decision. A narrowly-bracketing decision-maker, on the other hand, maximizes utility for each part of the decision separately. Therefore we can write their maximization problem as:</p>
<p><span class="math display">\[
\begin{aligned}
\max_{y^1_A+y^1_B\leq I^1_d, \  y^2_A+y^2_B\leq I^2_d} u(v^1_{A,d}y^1_A,\ v^1_{B,d}y^1_B)+u(v^2_{A,d}y^2_A,\ v^2_{B,d}y^2_B)
\end{aligned}
\]</span></p>
<p>Note that, while I have written this as joint maximization over the sum of two utility functions, this problem can be solved in two parts because they are additively separable.</p>
<p>Now that we have a (deterministic) model of both narrow and broad bracketing, we can get to the partial bracketing part of the model. Here we just take a convex combination of the two utility functions:
<span class="math display">\[
\begin{aligned}
\max_{y^1_A+y^1_B\leq I^1_d,\  y^2_A+y^2_B\leq I^2_d} \alpha \left( u(v^1_{A,d}y^1_A,\ v^1_{B,d}y^1_B)+u(v^2_{A,d}y^2_A,\ v^2_{B,d}y^2_B)\right) + (1-\alpha )u(v^1_{A,d}y^1_A+v^2_{A,d}y^2_A,\ v^1_{B,d}y^1_B+v^2_{B,d}y^2_B)
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(\alpha \in[0,1]\)</span> is the extent of narrow bracketing, and <span class="math inline">\(\alpha=1\)</span> (<span class="math inline">\(\alpha=0\)</span>) corresponds to full narrow (broad) bracketing.</p>
<p>In order to make this an econometric model, we need to do two things. First, we need to assume a function form for <span class="math inline">\(u(\cdot,\cdot)\)</span>. I chose to go with a constant elasticity of substitution (CES) utility function here with equal weights on each of person A and B’s payoffs. Equal weights seems reasonable here because these were anonymous people in the lab, and so the decision-maker has no reason to value one of these people over another. Therefore, the functional form for the utility function will be:
<span class="math display">\[
u(x_A,x_B)=\left(x_A^\beta+x_B^\beta\right)^{\frac{1}{\beta}}
\]</span></p>
<p>where <span class="math inline">\(\beta&gt;0\)</span> is another parameter to be estimated.</p>
<p>Finally, we need to add a probabilistic component to this deterministic model. Here I am going to use logit choice over the action space, and use <span class="math inline">\(\lambda&gt;0\)</span> as the choice precision parameter.</p>
</div>
<div id="representative-agent-and-individual-estimation" class="section level2 hasAnchor" number="22.2">
<h2><span class="header-section-number">22.2</span> Representative agent and individual estimation<a href="application-choice-bracketing.html#representative-agent-and-individual-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To begin with, I estimate a representative agent model, which I then also use to estimate on each participants’ data separately. These can both use the same <em>Stan</em> program: we just pass different data to it. In the <em>Stan</em> program below, you can see that I chose to hard-code the payoffs for each of the five decisions in <em>Stan</em>. While I usually try to avoid this kind of thing, my previous iteration of this was having to re-construct the choice set and payoffs for every decision. This is because the size of the choice set varies between decision. As such, the data passed to <em>Stan</em> is the allocation of tokens made to Person A (<code>y1_1</code> and <code>y1_2</code> for decision 1, and so on). In order to avoid a mess of code in the <code>model</code> block, I added two functions in the <code>functions</code> block. <code>ll_1part</code> computes the log-likelihood of a decision for decisions with only one part, and <code>ll_2part</code> does the same for decisions with two parts.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb280-1"><a href="application-choice-bracketing.html#cb280-1" tabindex="-1"></a>functions <span class="op">{</span></span>
<span id="cb280-2"><a href="application-choice-bracketing.html#cb280-2" tabindex="-1"></a>  </span>
<span id="cb280-3"><a href="application-choice-bracketing.html#cb280-3" tabindex="-1"></a>    real ll_1part<span class="op">(</span></span>
<span id="cb280-4"><a href="application-choice-bracketing.html#cb280-4" tabindex="-1"></a>      data vector payA<span class="op">,</span> data vector payB<span class="op">,</span></span>
<span id="cb280-5"><a href="application-choice-bracketing.html#cb280-5" tabindex="-1"></a>      real beta<span class="op">,</span> real lambda<span class="op">,</span></span>
<span id="cb280-6"><a href="application-choice-bracketing.html#cb280-6" tabindex="-1"></a>      data <span class="dt">int</span> y</span>
<span id="cb280-7"><a href="application-choice-bracketing.html#cb280-7" tabindex="-1"></a>    <span class="op">)</span> <span class="op">{</span></span>
<span id="cb280-8"><a href="application-choice-bracketing.html#cb280-8" tabindex="-1"></a>      </span>
<span id="cb280-9"><a href="application-choice-bracketing.html#cb280-9" tabindex="-1"></a>      <span class="dt">int</span> dim <span class="op">=</span> dims<span class="op">(</span>payA<span class="op">)[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb280-10"><a href="application-choice-bracketing.html#cb280-10" tabindex="-1"></a>      </span>
<span id="cb280-11"><a href="application-choice-bracketing.html#cb280-11" tabindex="-1"></a>      vector<span class="op">[</span>dim<span class="op">]</span> U <span class="op">=</span> lambda<span class="op">*</span>pow<span class="op">(</span>pow<span class="op">(</span>payA<span class="op">,</span>beta<span class="op">)+</span>pow<span class="op">(</span>payB<span class="op">,</span>beta<span class="op">),</span><span class="fl">1.0</span><span class="op">/</span>beta<span class="op">);</span></span>
<span id="cb280-12"><a href="application-choice-bracketing.html#cb280-12" tabindex="-1"></a>      </span>
<span id="cb280-13"><a href="application-choice-bracketing.html#cb280-13" tabindex="-1"></a>      </span>
<span id="cb280-14"><a href="application-choice-bracketing.html#cb280-14" tabindex="-1"></a>      </span>
<span id="cb280-15"><a href="application-choice-bracketing.html#cb280-15" tabindex="-1"></a>      </span>
<span id="cb280-16"><a href="application-choice-bracketing.html#cb280-16" tabindex="-1"></a>      <span class="cf">return</span> log_softmax<span class="op">(</span>U<span class="op">)[</span>y<span class="op">+</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb280-17"><a href="application-choice-bracketing.html#cb280-17" tabindex="-1"></a>      </span>
<span id="cb280-18"><a href="application-choice-bracketing.html#cb280-18" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb280-19"><a href="application-choice-bracketing.html#cb280-19" tabindex="-1"></a>  </span>
<span id="cb280-20"><a href="application-choice-bracketing.html#cb280-20" tabindex="-1"></a>  </span>
<span id="cb280-21"><a href="application-choice-bracketing.html#cb280-21" tabindex="-1"></a>    real ll_2part<span class="op">(</span></span>
<span id="cb280-22"><a href="application-choice-bracketing.html#cb280-22" tabindex="-1"></a>      data matrix payA1<span class="op">,</span> data matrix payB1<span class="op">,</span></span>
<span id="cb280-23"><a href="application-choice-bracketing.html#cb280-23" tabindex="-1"></a>      data matrix payA2<span class="op">,</span> data matrix payB2<span class="op">,</span></span>
<span id="cb280-24"><a href="application-choice-bracketing.html#cb280-24" tabindex="-1"></a>      real alpha<span class="op">,</span> real beta<span class="op">,</span> real lambda<span class="op">,</span></span>
<span id="cb280-25"><a href="application-choice-bracketing.html#cb280-25" tabindex="-1"></a>      data <span class="dt">int</span> y1<span class="op">,</span> data <span class="dt">int</span> y2</span>
<span id="cb280-26"><a href="application-choice-bracketing.html#cb280-26" tabindex="-1"></a>    <span class="op">)</span>  <span class="op">{</span></span>
<span id="cb280-27"><a href="application-choice-bracketing.html#cb280-27" tabindex="-1"></a>      </span>
<span id="cb280-28"><a href="application-choice-bracketing.html#cb280-28" tabindex="-1"></a>      <span class="dt">int</span> dim<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> dims<span class="op">(</span>payA1<span class="op">);</span></span>
<span id="cb280-29"><a href="application-choice-bracketing.html#cb280-29" tabindex="-1"></a>      </span>
<span id="cb280-30"><a href="application-choice-bracketing.html#cb280-30" tabindex="-1"></a>      <span class="co">// utility if DM brackets broadly</span></span>
<span id="cb280-31"><a href="application-choice-bracketing.html#cb280-31" tabindex="-1"></a>      matrix<span class="op">[</span>dim<span class="op">[</span><span class="dv">1</span><span class="op">],</span>dim<span class="op">[</span><span class="dv">2</span><span class="op">]]</span> Ubroad <span class="op">=</span> pow<span class="op">(</span></span>
<span id="cb280-32"><a href="application-choice-bracketing.html#cb280-32" tabindex="-1"></a>        pow<span class="op">(</span>payA1<span class="op">+</span>payA2<span class="op">,</span>beta<span class="op">)+</span>pow<span class="op">(</span>payB1<span class="op">+</span>payB2<span class="op">,</span>beta<span class="op">)</span></span>
<span id="cb280-33"><a href="application-choice-bracketing.html#cb280-33" tabindex="-1"></a>      <span class="op">,</span><span class="fl">1.0</span><span class="op">/</span>beta<span class="op">);</span></span>
<span id="cb280-34"><a href="application-choice-bracketing.html#cb280-34" tabindex="-1"></a>      </span>
<span id="cb280-35"><a href="application-choice-bracketing.html#cb280-35" tabindex="-1"></a>      <span class="co">// utility if DB brackets narrowly</span></span>
<span id="cb280-36"><a href="application-choice-bracketing.html#cb280-36" tabindex="-1"></a>      matrix<span class="op">[</span>dim<span class="op">[</span><span class="dv">1</span><span class="op">],</span>dim<span class="op">[</span><span class="dv">2</span><span class="op">]]</span> Unarrow <span class="op">=</span> </span>
<span id="cb280-37"><a href="application-choice-bracketing.html#cb280-37" tabindex="-1"></a>        pow<span class="op">(</span>pow<span class="op">(</span>payA1<span class="op">,</span>beta<span class="op">)+</span>pow<span class="op">(</span>payB1<span class="op">,</span>beta<span class="op">),</span><span class="fl">1.0</span><span class="op">/</span>beta<span class="op">)</span></span>
<span id="cb280-38"><a href="application-choice-bracketing.html#cb280-38" tabindex="-1"></a>        <span class="op">+</span>pow<span class="op">(</span>pow<span class="op">(</span>payA2<span class="op">,</span>beta<span class="op">)+</span>pow<span class="op">(</span>payB2<span class="op">,</span>beta<span class="op">),</span><span class="fl">1.0</span><span class="op">/</span>beta<span class="op">)</span></span>
<span id="cb280-39"><a href="application-choice-bracketing.html#cb280-39" tabindex="-1"></a>        <span class="op">;</span></span>
<span id="cb280-40"><a href="application-choice-bracketing.html#cb280-40" tabindex="-1"></a>      </span>
<span id="cb280-41"><a href="application-choice-bracketing.html#cb280-41" tabindex="-1"></a>      <span class="co">// partial bracketing utility</span></span>
<span id="cb280-42"><a href="application-choice-bracketing.html#cb280-42" tabindex="-1"></a>      matrix<span class="op">[</span>dim<span class="op">[</span><span class="dv">1</span><span class="op">],</span>dim<span class="op">[</span><span class="dv">2</span><span class="op">]]</span> U <span class="op">=</span> lambda<span class="op">*(</span>alpha<span class="op">*</span>Unarrow<span class="op">+(</span><span class="fl">1.0</span><span class="op">-</span>alpha<span class="op">)*</span>Ubroad<span class="op">);</span></span>
<span id="cb280-43"><a href="application-choice-bracketing.html#cb280-43" tabindex="-1"></a></span>
<span id="cb280-44"><a href="application-choice-bracketing.html#cb280-44" tabindex="-1"></a>      <span class="cf">return</span> U<span class="op">[</span>y1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>y2<span class="op">+</span><span class="dv">1</span><span class="op">]-</span>log_sum_exp<span class="op">(</span>U<span class="op">);</span></span>
<span id="cb280-45"><a href="application-choice-bracketing.html#cb280-45" tabindex="-1"></a>      </span>
<span id="cb280-46"><a href="application-choice-bracketing.html#cb280-46" tabindex="-1"></a>    <span class="op">}</span> </span>
<span id="cb280-47"><a href="application-choice-bracketing.html#cb280-47" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb280-48"><a href="application-choice-bracketing.html#cb280-48" tabindex="-1"></a></span>
<span id="cb280-49"><a href="application-choice-bracketing.html#cb280-49" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb280-50"><a href="application-choice-bracketing.html#cb280-50" tabindex="-1"></a>  <span class="dt">int</span> N<span class="op">;</span></span>
<span id="cb280-51"><a href="application-choice-bracketing.html#cb280-51" tabindex="-1"></a>  </span>
<span id="cb280-52"><a href="application-choice-bracketing.html#cb280-52" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_alpha<span class="op">;</span></span>
<span id="cb280-53"><a href="application-choice-bracketing.html#cb280-53" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_beta<span class="op">;</span></span>
<span id="cb280-54"><a href="application-choice-bracketing.html#cb280-54" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_lambda<span class="op">;</span></span>
<span id="cb280-55"><a href="application-choice-bracketing.html#cb280-55" tabindex="-1"></a>  </span>
<span id="cb280-56"><a href="application-choice-bracketing.html#cb280-56" tabindex="-1"></a>  <span class="co">// allocations to player A</span></span>
<span id="cb280-57"><a href="application-choice-bracketing.html#cb280-57" tabindex="-1"></a>  <span class="dt">int</span> y1_1<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb280-58"><a href="application-choice-bracketing.html#cb280-58" tabindex="-1"></a>  <span class="dt">int</span> y1_2<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb280-59"><a href="application-choice-bracketing.html#cb280-59" tabindex="-1"></a>  <span class="dt">int</span> y2<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb280-60"><a href="application-choice-bracketing.html#cb280-60" tabindex="-1"></a>  <span class="dt">int</span> y3_1<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb280-61"><a href="application-choice-bracketing.html#cb280-61" tabindex="-1"></a>  <span class="dt">int</span> y3_2<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb280-62"><a href="application-choice-bracketing.html#cb280-62" tabindex="-1"></a>  <span class="dt">int</span> y4<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb280-63"><a href="application-choice-bracketing.html#cb280-63" tabindex="-1"></a>  <span class="dt">int</span> y5<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb280-64"><a href="application-choice-bracketing.html#cb280-64" tabindex="-1"></a>  </span>
<span id="cb280-65"><a href="application-choice-bracketing.html#cb280-65" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb280-66"><a href="application-choice-bracketing.html#cb280-66" tabindex="-1"></a></span>
<span id="cb280-67"><a href="application-choice-bracketing.html#cb280-67" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb280-68"><a href="application-choice-bracketing.html#cb280-68" tabindex="-1"></a>  </span>
<span id="cb280-69"><a href="application-choice-bracketing.html#cb280-69" tabindex="-1"></a>  <span class="co">/* Here I am going to hard-code the experiment parameters and choice sets</span></span>
<span id="cb280-70"><a href="application-choice-bracketing.html#cb280-70" tabindex="-1"></a><span class="co">  This is becuase each decision has different endowments (I), </span></span>
<span id="cb280-71"><a href="application-choice-bracketing.html#cb280-71" tabindex="-1"></a><span class="co">  and so it saves a lot of matrix-creation on the fly in the </span></span>
<span id="cb280-72"><a href="application-choice-bracketing.html#cb280-72" tabindex="-1"></a><span class="co">  model block</span></span>
<span id="cb280-73"><a href="application-choice-bracketing.html#cb280-73" tabindex="-1"></a><span class="co">  */</span></span>
<span id="cb280-74"><a href="application-choice-bracketing.html#cb280-74" tabindex="-1"></a>  </span>
<span id="cb280-75"><a href="application-choice-bracketing.html#cb280-75" tabindex="-1"></a>  <span class="co">// decision 1, 2 parts --------------------</span></span>
<span id="cb280-76"><a href="application-choice-bracketing.html#cb280-76" tabindex="-1"></a>  <span class="dt">int</span> I1_1 <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb280-77"><a href="application-choice-bracketing.html#cb280-77" tabindex="-1"></a>  <span class="dt">int</span> I1_2 <span class="op">=</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb280-78"><a href="application-choice-bracketing.html#cb280-78" tabindex="-1"></a>  real vA1_1 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb280-79"><a href="application-choice-bracketing.html#cb280-79" tabindex="-1"></a>  real vB1_1 <span class="op">=</span> <span class="fl">1.2</span><span class="op">;</span></span>
<span id="cb280-80"><a href="application-choice-bracketing.html#cb280-80" tabindex="-1"></a>  real vA1_2 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb280-81"><a href="application-choice-bracketing.html#cb280-81" tabindex="-1"></a>  real vB1_2 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb280-82"><a href="application-choice-bracketing.html#cb280-82" tabindex="-1"></a>  </span>
<span id="cb280-83"><a href="application-choice-bracketing.html#cb280-83" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X1_1 <span class="op">=</span> rep_matrix<span class="op">(</span>linspaced_vector<span class="op">(</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I1_1<span class="op">),</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb280-84"><a href="application-choice-bracketing.html#cb280-84" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X1_2 <span class="op">=</span> rep_matrix<span class="op">(</span>linspaced_row_vector<span class="op">(</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I1_2<span class="op">),</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb280-85"><a href="application-choice-bracketing.html#cb280-85" tabindex="-1"></a>  </span>
<span id="cb280-86"><a href="application-choice-bracketing.html#cb280-86" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA1_1 <span class="op">=</span> vA1_1<span class="op">*</span>X1_1<span class="op">;</span></span>
<span id="cb280-87"><a href="application-choice-bracketing.html#cb280-87" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB1_1 <span class="op">=</span> vB1_1<span class="op">*(</span>I1_1<span class="op">-</span>X1_1<span class="op">);</span></span>
<span id="cb280-88"><a href="application-choice-bracketing.html#cb280-88" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA1_2 <span class="op">=</span> vA1_2<span class="op">*</span>X1_2<span class="op">;</span></span>
<span id="cb280-89"><a href="application-choice-bracketing.html#cb280-89" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB1_2 <span class="op">=</span> vB1_2<span class="op">*(</span>I1_2<span class="op">-</span>X1_2<span class="op">);</span></span>
<span id="cb280-90"><a href="application-choice-bracketing.html#cb280-90" tabindex="-1"></a>  </span>
<span id="cb280-91"><a href="application-choice-bracketing.html#cb280-91" tabindex="-1"></a>  <span class="co">// decision 2, 1 part -------------------</span></span>
<span id="cb280-92"><a href="application-choice-bracketing.html#cb280-92" tabindex="-1"></a>  <span class="dt">int</span> I2 <span class="op">=</span> <span class="dv">14</span><span class="op">;</span></span>
<span id="cb280-93"><a href="application-choice-bracketing.html#cb280-93" tabindex="-1"></a>  real vA2 <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb280-94"><a href="application-choice-bracketing.html#cb280-94" tabindex="-1"></a>  real vB2 <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb280-95"><a href="application-choice-bracketing.html#cb280-95" tabindex="-1"></a>  </span>
<span id="cb280-96"><a href="application-choice-bracketing.html#cb280-96" tabindex="-1"></a>  vector<span class="op">[</span>I2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X2 <span class="op">=</span> linspaced_vector<span class="op">(</span>I2<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I2<span class="op">);</span></span>
<span id="cb280-97"><a href="application-choice-bracketing.html#cb280-97" tabindex="-1"></a>  </span>
<span id="cb280-98"><a href="application-choice-bracketing.html#cb280-98" tabindex="-1"></a>  vector<span class="op">[</span>I2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA2 <span class="op">=</span> vA2<span class="op">*</span>X2<span class="op">;</span></span>
<span id="cb280-99"><a href="application-choice-bracketing.html#cb280-99" tabindex="-1"></a>  vector<span class="op">[</span>I2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB2 <span class="op">=</span> vB2<span class="op">*(</span>I2<span class="op">-</span>X2<span class="op">);</span></span>
<span id="cb280-100"><a href="application-choice-bracketing.html#cb280-100" tabindex="-1"></a>  </span>
<span id="cb280-101"><a href="application-choice-bracketing.html#cb280-101" tabindex="-1"></a>  <span class="co">// decision 3, 2 parts --------------------</span></span>
<span id="cb280-102"><a href="application-choice-bracketing.html#cb280-102" tabindex="-1"></a>  <span class="dt">int</span> I3_1 <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb280-103"><a href="application-choice-bracketing.html#cb280-103" tabindex="-1"></a>  <span class="dt">int</span> I3_2 <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb280-104"><a href="application-choice-bracketing.html#cb280-104" tabindex="-1"></a>  real vA3_1 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb280-105"><a href="application-choice-bracketing.html#cb280-105" tabindex="-1"></a>  real vB3_1 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb280-106"><a href="application-choice-bracketing.html#cb280-106" tabindex="-1"></a>  real vA3_2 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb280-107"><a href="application-choice-bracketing.html#cb280-107" tabindex="-1"></a>  real vB3_2 <span class="op">=</span> <span class="fl">1.2</span><span class="op">;</span></span>
<span id="cb280-108"><a href="application-choice-bracketing.html#cb280-108" tabindex="-1"></a>  </span>
<span id="cb280-109"><a href="application-choice-bracketing.html#cb280-109" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X3_1 <span class="op">=</span> rep_matrix<span class="op">(</span>linspaced_vector<span class="op">(</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I3_1<span class="op">),</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb280-110"><a href="application-choice-bracketing.html#cb280-110" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X3_2 <span class="op">=</span> rep_matrix<span class="op">(</span>linspaced_row_vector<span class="op">(</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I3_2<span class="op">),</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb280-111"><a href="application-choice-bracketing.html#cb280-111" tabindex="-1"></a>  </span>
<span id="cb280-112"><a href="application-choice-bracketing.html#cb280-112" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA3_1 <span class="op">=</span> vA3_1<span class="op">*</span>X3_1<span class="op">;</span></span>
<span id="cb280-113"><a href="application-choice-bracketing.html#cb280-113" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB3_1 <span class="op">=</span> vB3_1<span class="op">*(</span>I3_1<span class="op">-</span>X3_1<span class="op">);</span></span>
<span id="cb280-114"><a href="application-choice-bracketing.html#cb280-114" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA3_2 <span class="op">=</span> vA3_2<span class="op">*</span>X3_2<span class="op">;</span></span>
<span id="cb280-115"><a href="application-choice-bracketing.html#cb280-115" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB3_2 <span class="op">=</span> vB3_2<span class="op">*(</span>I3_2<span class="op">-</span>X3_2<span class="op">);</span></span>
<span id="cb280-116"><a href="application-choice-bracketing.html#cb280-116" tabindex="-1"></a>  </span>
<span id="cb280-117"><a href="application-choice-bracketing.html#cb280-117" tabindex="-1"></a>  <span class="co">// decision 4, 1 part -------------------</span></span>
<span id="cb280-118"><a href="application-choice-bracketing.html#cb280-118" tabindex="-1"></a>  <span class="dt">int</span> I4 <span class="op">=</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb280-119"><a href="application-choice-bracketing.html#cb280-119" tabindex="-1"></a>  real vA4 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb280-120"><a href="application-choice-bracketing.html#cb280-120" tabindex="-1"></a>  real vB4 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb280-121"><a href="application-choice-bracketing.html#cb280-121" tabindex="-1"></a>  </span>
<span id="cb280-122"><a href="application-choice-bracketing.html#cb280-122" tabindex="-1"></a>  vector<span class="op">[</span>I4<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X4 <span class="op">=</span> linspaced_vector<span class="op">(</span>I4<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I4<span class="op">);</span></span>
<span id="cb280-123"><a href="application-choice-bracketing.html#cb280-123" tabindex="-1"></a>  </span>
<span id="cb280-124"><a href="application-choice-bracketing.html#cb280-124" tabindex="-1"></a>  vector<span class="op">[</span>I4<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA4 <span class="op">=</span> vA4<span class="op">*</span>X4<span class="op">;</span></span>
<span id="cb280-125"><a href="application-choice-bracketing.html#cb280-125" tabindex="-1"></a>  vector<span class="op">[</span>I4<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB4 <span class="op">=</span> vB4<span class="op">*(</span>I4<span class="op">-</span>X4<span class="op">);</span></span>
<span id="cb280-126"><a href="application-choice-bracketing.html#cb280-126" tabindex="-1"></a>  </span>
<span id="cb280-127"><a href="application-choice-bracketing.html#cb280-127" tabindex="-1"></a>   <span class="co">// decision 5, 1 part -------------------</span></span>
<span id="cb280-128"><a href="application-choice-bracketing.html#cb280-128" tabindex="-1"></a>  <span class="dt">int</span> I5 <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb280-129"><a href="application-choice-bracketing.html#cb280-129" tabindex="-1"></a>  real vA5 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb280-130"><a href="application-choice-bracketing.html#cb280-130" tabindex="-1"></a>  real vB5 <span class="op">=</span> <span class="fl">1.2</span><span class="op">;</span></span>
<span id="cb280-131"><a href="application-choice-bracketing.html#cb280-131" tabindex="-1"></a>  </span>
<span id="cb280-132"><a href="application-choice-bracketing.html#cb280-132" tabindex="-1"></a>  vector<span class="op">[</span>I5<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X5 <span class="op">=</span> linspaced_vector<span class="op">(</span>I5<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I5<span class="op">);</span></span>
<span id="cb280-133"><a href="application-choice-bracketing.html#cb280-133" tabindex="-1"></a>  </span>
<span id="cb280-134"><a href="application-choice-bracketing.html#cb280-134" tabindex="-1"></a>  vector<span class="op">[</span>I5<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA5 <span class="op">=</span> vA5<span class="op">*</span>X5<span class="op">;</span></span>
<span id="cb280-135"><a href="application-choice-bracketing.html#cb280-135" tabindex="-1"></a>  vector<span class="op">[</span>I5<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB5 <span class="op">=</span> vB5<span class="op">*(</span>I5<span class="op">-</span>X5<span class="op">);</span></span>
<span id="cb280-136"><a href="application-choice-bracketing.html#cb280-136" tabindex="-1"></a>  </span>
<span id="cb280-137"><a href="application-choice-bracketing.html#cb280-137" tabindex="-1"></a>  </span>
<span id="cb280-138"><a href="application-choice-bracketing.html#cb280-138" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb280-139"><a href="application-choice-bracketing.html#cb280-139" tabindex="-1"></a></span>
<span id="cb280-140"><a href="application-choice-bracketing.html#cb280-140" tabindex="-1"></a></span>
<span id="cb280-141"><a href="application-choice-bracketing.html#cb280-141" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb280-142"><a href="application-choice-bracketing.html#cb280-142" tabindex="-1"></a>  </span>
<span id="cb280-143"><a href="application-choice-bracketing.html#cb280-143" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">,</span>upper<span class="op">=</span><span class="dv">1</span><span class="op">&gt;</span> alpha<span class="op">;</span></span>
<span id="cb280-144"><a href="application-choice-bracketing.html#cb280-144" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> beta<span class="op">;</span></span>
<span id="cb280-145"><a href="application-choice-bracketing.html#cb280-145" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> lambda<span class="op">;</span></span>
<span id="cb280-146"><a href="application-choice-bracketing.html#cb280-146" tabindex="-1"></a></span>
<span id="cb280-147"><a href="application-choice-bracketing.html#cb280-147" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb280-148"><a href="application-choice-bracketing.html#cb280-148" tabindex="-1"></a></span>
<span id="cb280-149"><a href="application-choice-bracketing.html#cb280-149" tabindex="-1"></a></span>
<span id="cb280-150"><a href="application-choice-bracketing.html#cb280-150" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb280-151"><a href="application-choice-bracketing.html#cb280-151" tabindex="-1"></a>  </span>
<span id="cb280-152"><a href="application-choice-bracketing.html#cb280-152" tabindex="-1"></a>  <span class="co">// priors---------------------------------------------------------------------</span></span>
<span id="cb280-153"><a href="application-choice-bracketing.html#cb280-153" tabindex="-1"></a>  </span>
<span id="cb280-154"><a href="application-choice-bracketing.html#cb280-154" tabindex="-1"></a>  alpha <span class="op">~</span> beta<span class="op">(</span>prior_alpha<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_alpha<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb280-155"><a href="application-choice-bracketing.html#cb280-155" tabindex="-1"></a>  beta <span class="op">~</span> lognormal<span class="op">(</span>prior_beta<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_beta<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb280-156"><a href="application-choice-bracketing.html#cb280-156" tabindex="-1"></a>  lambda <span class="op">~</span> lognormal<span class="op">(</span>prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb280-157"><a href="application-choice-bracketing.html#cb280-157" tabindex="-1"></a>  </span>
<span id="cb280-158"><a href="application-choice-bracketing.html#cb280-158" tabindex="-1"></a>  <span class="co">// likelihood ----------------------------------------------------------------</span></span>
<span id="cb280-159"><a href="application-choice-bracketing.html#cb280-159" tabindex="-1"></a>  </span>
<span id="cb280-160"><a href="application-choice-bracketing.html#cb280-160" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>N<span class="op">)</span> <span class="op">{</span></span>
<span id="cb280-161"><a href="application-choice-bracketing.html#cb280-161" tabindex="-1"></a>    </span>
<span id="cb280-162"><a href="application-choice-bracketing.html#cb280-162" tabindex="-1"></a>    </span>
<span id="cb280-163"><a href="application-choice-bracketing.html#cb280-163" tabindex="-1"></a>    <span class="co">// decision 1, 2 parts</span></span>
<span id="cb280-164"><a href="application-choice-bracketing.html#cb280-164" tabindex="-1"></a>    target <span class="op">+=</span> ll_2part<span class="op">(</span></span>
<span id="cb280-165"><a href="application-choice-bracketing.html#cb280-165" tabindex="-1"></a>      payA1_1<span class="op">,</span> payB1_1<span class="op">,</span></span>
<span id="cb280-166"><a href="application-choice-bracketing.html#cb280-166" tabindex="-1"></a>      payA1_2<span class="op">,</span> payB1_2<span class="op">,</span></span>
<span id="cb280-167"><a href="application-choice-bracketing.html#cb280-167" tabindex="-1"></a>      alpha<span class="op">,</span>beta<span class="op">,</span>lambda<span class="op">,</span></span>
<span id="cb280-168"><a href="application-choice-bracketing.html#cb280-168" tabindex="-1"></a>      y1_1<span class="op">[</span>ii<span class="op">],</span>y1_2<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb280-169"><a href="application-choice-bracketing.html#cb280-169" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb280-170"><a href="application-choice-bracketing.html#cb280-170" tabindex="-1"></a>    </span>
<span id="cb280-171"><a href="application-choice-bracketing.html#cb280-171" tabindex="-1"></a>    </span>
<span id="cb280-172"><a href="application-choice-bracketing.html#cb280-172" tabindex="-1"></a>    </span>
<span id="cb280-173"><a href="application-choice-bracketing.html#cb280-173" tabindex="-1"></a>    <span class="co">// decision 2, 1 part</span></span>
<span id="cb280-174"><a href="application-choice-bracketing.html#cb280-174" tabindex="-1"></a>    target <span class="op">+=</span> ll_1part<span class="op">(</span></span>
<span id="cb280-175"><a href="application-choice-bracketing.html#cb280-175" tabindex="-1"></a>      payA2<span class="op">,</span> payB2<span class="op">,</span></span>
<span id="cb280-176"><a href="application-choice-bracketing.html#cb280-176" tabindex="-1"></a>      beta<span class="op">,</span> lambda<span class="op">,</span></span>
<span id="cb280-177"><a href="application-choice-bracketing.html#cb280-177" tabindex="-1"></a>      y2<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb280-178"><a href="application-choice-bracketing.html#cb280-178" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb280-179"><a href="application-choice-bracketing.html#cb280-179" tabindex="-1"></a>   </span>
<span id="cb280-180"><a href="application-choice-bracketing.html#cb280-180" tabindex="-1"></a>     <span class="co">// decision 3, 2 parts</span></span>
<span id="cb280-181"><a href="application-choice-bracketing.html#cb280-181" tabindex="-1"></a>    target <span class="op">+=</span> ll_2part<span class="op">(</span></span>
<span id="cb280-182"><a href="application-choice-bracketing.html#cb280-182" tabindex="-1"></a>      payA3_1<span class="op">,</span> payB3_1<span class="op">,</span></span>
<span id="cb280-183"><a href="application-choice-bracketing.html#cb280-183" tabindex="-1"></a>      payA3_2<span class="op">,</span> payB3_2<span class="op">,</span></span>
<span id="cb280-184"><a href="application-choice-bracketing.html#cb280-184" tabindex="-1"></a>      alpha<span class="op">,</span>beta<span class="op">,</span>lambda<span class="op">,</span></span>
<span id="cb280-185"><a href="application-choice-bracketing.html#cb280-185" tabindex="-1"></a>      y3_1<span class="op">[</span>ii<span class="op">],</span>y3_2<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb280-186"><a href="application-choice-bracketing.html#cb280-186" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb280-187"><a href="application-choice-bracketing.html#cb280-187" tabindex="-1"></a>    </span>
<span id="cb280-188"><a href="application-choice-bracketing.html#cb280-188" tabindex="-1"></a>    <span class="co">// decision 4, 1 part</span></span>
<span id="cb280-189"><a href="application-choice-bracketing.html#cb280-189" tabindex="-1"></a>    target <span class="op">+=</span> ll_1part<span class="op">(</span></span>
<span id="cb280-190"><a href="application-choice-bracketing.html#cb280-190" tabindex="-1"></a>      payA4<span class="op">,</span> payB4<span class="op">,</span></span>
<span id="cb280-191"><a href="application-choice-bracketing.html#cb280-191" tabindex="-1"></a>      beta<span class="op">,</span> lambda<span class="op">,</span></span>
<span id="cb280-192"><a href="application-choice-bracketing.html#cb280-192" tabindex="-1"></a>      y4<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb280-193"><a href="application-choice-bracketing.html#cb280-193" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb280-194"><a href="application-choice-bracketing.html#cb280-194" tabindex="-1"></a>    </span>
<span id="cb280-195"><a href="application-choice-bracketing.html#cb280-195" tabindex="-1"></a>    <span class="co">// decision 5, 1 part</span></span>
<span id="cb280-196"><a href="application-choice-bracketing.html#cb280-196" tabindex="-1"></a>    target <span class="op">+=</span> ll_1part<span class="op">(</span></span>
<span id="cb280-197"><a href="application-choice-bracketing.html#cb280-197" tabindex="-1"></a>      payA5<span class="op">,</span> payB5<span class="op">,</span></span>
<span id="cb280-198"><a href="application-choice-bracketing.html#cb280-198" tabindex="-1"></a>      beta<span class="op">,</span> lambda<span class="op">,</span></span>
<span id="cb280-199"><a href="application-choice-bracketing.html#cb280-199" tabindex="-1"></a>      y5<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb280-200"><a href="application-choice-bracketing.html#cb280-200" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb280-201"><a href="application-choice-bracketing.html#cb280-201" tabindex="-1"></a>    </span>
<span id="cb280-202"><a href="application-choice-bracketing.html#cb280-202" tabindex="-1"></a>    </span>
<span id="cb280-203"><a href="application-choice-bracketing.html#cb280-203" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb280-204"><a href="application-choice-bracketing.html#cb280-204" tabindex="-1"></a>  </span>
<span id="cb280-205"><a href="application-choice-bracketing.html#cb280-205" tabindex="-1"></a>  </span>
<span id="cb280-206"><a href="application-choice-bracketing.html#cb280-206" tabindex="-1"></a>  </span>
<span id="cb280-207"><a href="application-choice-bracketing.html#cb280-207" tabindex="-1"></a>  </span>
<span id="cb280-208"><a href="application-choice-bracketing.html#cb280-208" tabindex="-1"></a></span>
<span id="cb280-209"><a href="application-choice-bracketing.html#cb280-209" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Table <a href="application-choice-bracketing.html#tab:EF2024-repagent">22.1</a> summarizes the posterior distribution of the representative agent model. Of primary interest here is the estimate for <span class="math inline">\(\alpha\)</span>, which is fairly precisely estimated to be about 20%. That is, the representative agent partially brackets, but their behavior is closer to broad bracketing than narrow bracketing.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="application-choice-bracketing.html#cb281-1" tabindex="-1"></a><span class="st">&quot;Code/EF2024/social_repagent.csv&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb281-2"><a href="application-choice-bracketing.html#cb281-2" tabindex="-1"></a>  <span class="fu">read.csv</span>() <span class="sc">|&gt;</span></span>
<span id="cb281-3"><a href="application-choice-bracketing.html#cb281-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">|&gt;</span></span>
<span id="cb281-4"><a href="application-choice-bracketing.html#cb281-4" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">digits=</span><span class="dv">3</span>,<span class="at">caption =</span> <span class="st">&quot;Summary of posterior distribution from the representative agent model.&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb281-5"><a href="application-choice-bracketing.html#cb281-5" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb281-6"><a href="application-choice-bracketing.html#cb281-6" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;percentiles&quot;</span><span class="ot">=</span><span class="dv">5</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;&quot;</span>))</span></code></pre></div>
<table class=" lightable-classic" style="color: black; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:EF2024-repagent">Table 22.1: </span>Summary of posterior distribution from the representative agent model.
</caption>
<thead>
<tr>
<th style="empty-cells: hide;" colspan="1">
</th>
<th style="empty-cells: hide;" colspan="1">
</th>
<th style="empty-cells: hide;" colspan="1">
</th>
<th style="empty-cells: hide;" colspan="1">
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="5">
<div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
percentiles
</div>
</th>
<th style="empty-cells: hide;" colspan="1">
</th>
<th style="empty-cells: hide;" colspan="1">
</th>
</tr>
<tr>
<th style="text-align:left;">
par
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
se_mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
X2.5.
</th>
<th style="text-align:right;">
X25.
</th>
<th style="text-align:right;">
X50.
</th>
<th style="text-align:right;">
X75.
</th>
<th style="text-align:right;">
X97.5.
</th>
<th style="text-align:right;">
n_eff
</th>
<th style="text-align:right;">
Rhat
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
alpha
</td>
<td style="text-align:right;">
0.208
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
0.148
</td>
<td style="text-align:right;">
0.185
</td>
<td style="text-align:right;">
0.206
</td>
<td style="text-align:right;">
0.228
</td>
<td style="text-align:right;">
0.274
</td>
<td style="text-align:right;">
3830.117
</td>
<td style="text-align:right;">
1.002
</td>
</tr>
<tr>
<td style="text-align:left;">
beta
</td>
<td style="text-align:right;">
0.515
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.036
</td>
<td style="text-align:right;">
0.440
</td>
<td style="text-align:right;">
0.492
</td>
<td style="text-align:right;">
0.516
</td>
<td style="text-align:right;">
0.539
</td>
<td style="text-align:right;">
0.579
</td>
<td style="text-align:right;">
2897.681
</td>
<td style="text-align:right;">
1.005
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda
</td>
<td style="text-align:right;">
0.729
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.120
</td>
<td style="text-align:right;">
0.499
</td>
<td style="text-align:right;">
0.645
</td>
<td style="text-align:right;">
0.727
</td>
<td style="text-align:right;">
0.808
</td>
<td style="text-align:right;">
0.969
</td>
<td style="text-align:right;">
2970.372
</td>
<td style="text-align:right;">
1.005
</td>
</tr>
<tr>
<td style="text-align:left;">
lp__
</td>
<td style="text-align:right;">
-1514.550
</td>
<td style="text-align:right;">
0.022
</td>
<td style="text-align:right;">
1.253
</td>
<td style="text-align:right;">
-1517.772
</td>
<td style="text-align:right;">
-1515.102
</td>
<td style="text-align:right;">
-1514.220
</td>
<td style="text-align:right;">
-1513.636
</td>
<td style="text-align:right;">
-1513.127
</td>
<td style="text-align:right;">
3228.642
</td>
<td style="text-align:right;">
1.002
</td>
</tr>
</tbody>
</table>
<p>Next, I loop through each participant individually. Figure <a href="application-choice-bracketing.html#fig:EF2024-individualecdf">22.3</a> shows the empirical cumulative density function of the posterior mean estimates of <span class="math inline">\(\alpha\)</span>. Here we can see that the majority of participants narrowly bracket to an extent of at least 50%, but no participant is close to fully narrowly bracketing their decisions. There are also a few participants with <span class="math inline">\(\alpha\)</span> very close to zero, indicating that they broadly bracket their decisions.<a href="#fn100" class="footnote-ref" id="fnref100"><sup>100</sup></a></p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="application-choice-bracketing.html#cb282-1" tabindex="-1"></a>d<span class="ot">&lt;-</span><span class="st">&quot;Code/EF2024/social_individual.csv&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb282-2"><a href="application-choice-bracketing.html#cb282-2" tabindex="-1"></a>  <span class="fu">read.csv</span>() <span class="sc">|&gt;</span> </span>
<span id="cb282-3"><a href="application-choice-bracketing.html#cb282-3" tabindex="-1"></a>  <span class="fu">filter</span>(par<span class="sc">==</span><span class="st">&quot;alpha&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb282-4"><a href="application-choice-bracketing.html#cb282-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb282-5"><a href="application-choice-bracketing.html#cb282-5" tabindex="-1"></a>    <span class="at">cumul =</span> <span class="fu">rank</span>(mean)<span class="sc">/</span><span class="fu">n</span>()<span class="sc">-</span><span class="fl">0.5</span><span class="sc">/</span><span class="fu">n</span>()</span>
<span id="cb282-6"><a href="application-choice-bracketing.html#cb282-6" tabindex="-1"></a>  )</span>
<span id="cb282-7"><a href="application-choice-bracketing.html#cb282-7" tabindex="-1"></a></span>
<span id="cb282-8"><a href="application-choice-bracketing.html#cb282-8" tabindex="-1"></a>(</span>
<span id="cb282-9"><a href="application-choice-bracketing.html#cb282-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(d,<span class="fu">aes</span>(<span class="at">x=</span>mean))</span>
<span id="cb282-10"><a href="application-choice-bracketing.html#cb282-10" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">stat_ecdf</span>()</span>
<span id="cb282-11"><a href="application-choice-bracketing.html#cb282-11" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb282-12"><a href="application-choice-bracketing.html#cb282-12" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> X25.,<span class="at">xmax =</span> X75., <span class="at">y=</span>cumul),<span class="at">alpha=</span><span class="fl">0.5</span>,<span class="at">color=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb282-13"><a href="application-choice-bracketing.html#cb282-13" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb282-14"><a href="application-choice-bracketing.html#cb282-14" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="fu">expression</span>(alpha<span class="sc">~</span><span class="st">&quot;(extent of narrow bracketing)&quot;</span>))</span>
<span id="cb282-15"><a href="application-choice-bracketing.html#cb282-15" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;cumulative density of posterior mean&quot;</span>)</span>
<span id="cb282-16"><a href="application-choice-bracketing.html#cb282-16" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:EF2024-individualecdf"></span>
<img src="index_files/figure-html/EF2024-individualecdf-1.png" alt="Estimates of extent of narrow bracketing at the individual level. Black line shows the empirical cumulative distribution function of the posterior mean. Red error bars show 50% Bayesian credible regions (25th-75th percentile)" width="672" />
<p class="caption">
Figure 22.3: Estimates of extent of narrow bracketing at the individual level. Black line shows the empirical cumulative distribution function of the posterior mean. Red error bars show 50% Bayesian credible regions (25th-75th percentile)
</p>
</div>
<p>While we might not be too interested in the other parameters in the model, it doesn’t hurt to take a quick look at them and make sure that there are no surprises. While I don’t have much intuition about what a reasonable value for <span class="math inline">\(\lambda\)</span> is,<a href="#fn101" class="footnote-ref" id="fnref101"><sup>101</sup></a> <em>a priori</em> it seems like we should mostly be estimating <span class="math inline">\(0&lt;\beta&lt;1\)</span>. <span class="math inline">\(0&lt;\beta\)</span> will always be true because I encoded it into the prior, but <span class="math inline">\(\beta&lt;1\)</span> is particularly important becuase it indicates that the utility function is quasiconcave. For us, this means that our participants have convex preferences over person A and B’s earnings, which seems reasonable here. Let’s check it in Figure <a href="application-choice-bracketing.html#fig:EF2024-individualecdfbeta">22.4</a>:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="application-choice-bracketing.html#cb283-1" tabindex="-1"></a>d<span class="ot">&lt;-</span><span class="st">&quot;Code/EF2024/social_individual.csv&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb283-2"><a href="application-choice-bracketing.html#cb283-2" tabindex="-1"></a>  <span class="fu">read.csv</span>() <span class="sc">|&gt;</span> </span>
<span id="cb283-3"><a href="application-choice-bracketing.html#cb283-3" tabindex="-1"></a>  <span class="fu">filter</span>(par<span class="sc">==</span><span class="st">&quot;beta&quot;</span>)  <span class="sc">|&gt;</span></span>
<span id="cb283-4"><a href="application-choice-bracketing.html#cb283-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb283-5"><a href="application-choice-bracketing.html#cb283-5" tabindex="-1"></a>    <span class="at">cumul =</span> <span class="fu">rank</span>(mean)<span class="sc">/</span><span class="fu">n</span>()<span class="sc">-</span><span class="fl">0.5</span><span class="sc">/</span><span class="fu">n</span>()</span>
<span id="cb283-6"><a href="application-choice-bracketing.html#cb283-6" tabindex="-1"></a>  ) </span>
<span id="cb283-7"><a href="application-choice-bracketing.html#cb283-7" tabindex="-1"></a></span>
<span id="cb283-8"><a href="application-choice-bracketing.html#cb283-8" tabindex="-1"></a>(</span>
<span id="cb283-9"><a href="application-choice-bracketing.html#cb283-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(d,<span class="fu">aes</span>(<span class="at">x=</span>mean))</span>
<span id="cb283-10"><a href="application-choice-bracketing.html#cb283-10" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">stat_ecdf</span>()</span>
<span id="cb283-11"><a href="application-choice-bracketing.html#cb283-11" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb283-12"><a href="application-choice-bracketing.html#cb283-12" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> X25.,<span class="at">xmax =</span> X75., <span class="at">y=</span>cumul),<span class="at">alpha=</span><span class="fl">0.5</span>,<span class="at">color=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb283-13"><a href="application-choice-bracketing.html#cb283-13" tabindex="-1"></a>  <span class="co">#+xlim(c(0,1))</span></span>
<span id="cb283-14"><a href="application-choice-bracketing.html#cb283-14" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="fu">expression</span>(beta))</span>
<span id="cb283-15"><a href="application-choice-bracketing.html#cb283-15" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;cumulative density of posterior mean&quot;</span>)</span>
<span id="cb283-16"><a href="application-choice-bracketing.html#cb283-16" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:EF2024-individualecdfbeta"></span>
<img src="index_files/figure-html/EF2024-individualecdfbeta-1.png" alt="Estimates of $\beta$ at the individual level. Black line shows the empirical cumulative distribution function of the posterior mean. Red error bars show 50% Bayesian credible regions (25th-75th percentile)" width="672" />
<p class="caption">
Figure 22.4: Estimates of <span class="math inline">\(\beta\)</span> at the individual level. Black line shows the empirical cumulative distribution function of the posterior mean. Red error bars show 50% Bayesian credible regions (25th-75th percentile)
</p>
</div>
<p><span class="math inline">\(\beta&lt;1\)</span> for the vast majority of participants, good!</p>
<p>Before moving on to the hierarchical model, I want to stress an important thing that we would have missed if we only estimated the representative agent model. Recall that in the representative agent model we estimated <span class="math inline">\(\alpha\approx0.2\)</span>. However a quick-and-dirty sample mean of the posterior means from the individual-level estimations yields:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="application-choice-bracketing.html#cb284-1" tabindex="-1"></a>d<span class="sc">$</span>mean <span class="sc">|&gt;</span> <span class="fu">mean</span>()</span></code></pre></div>
<pre><code>## [1] 0.4122716</code></pre>
<p>So our conclusions about bracketing would be <em>vastly</em> different depending on which of these summary statistics we believed! The representative agent model would have us believe that narrow bracketing is only a little bit important, and that decisions are closer to broad bracketing. On the other hand, the individual-level estimation suggests that most people bracket substantially closer to narrow than broad.</p>
</div>
<div id="hierarchical-model-2" class="section level2 hasAnchor" number="22.3">
<h2><span class="header-section-number">22.3</span> Hierarchical model<a href="application-choice-bracketing.html#hierarchical-model-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here is the <em>Stan</em> program I wrote to estimate the hierarchical model. It of course looks very similar to the representative agent model except for the bits where the individual-level parameters go in. This is why I always want you to write and estimate the representative agent model first, even if you’re not going to use it: it is a very important stepping stone in getting to the richer hierarchical model, and will probably help you iron out a lot of the problems that are specific to your application (for this one, it was working out an efficient way to hard-code the experiment parameters).</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb286-1"><a href="application-choice-bracketing.html#cb286-1" tabindex="-1"></a>functions <span class="op">{</span></span>
<span id="cb286-2"><a href="application-choice-bracketing.html#cb286-2" tabindex="-1"></a>  </span>
<span id="cb286-3"><a href="application-choice-bracketing.html#cb286-3" tabindex="-1"></a>    real ll_1part<span class="op">(</span></span>
<span id="cb286-4"><a href="application-choice-bracketing.html#cb286-4" tabindex="-1"></a>      data vector payA<span class="op">,</span> data vector payB<span class="op">,</span></span>
<span id="cb286-5"><a href="application-choice-bracketing.html#cb286-5" tabindex="-1"></a>      real beta<span class="op">,</span> real lambda<span class="op">,</span></span>
<span id="cb286-6"><a href="application-choice-bracketing.html#cb286-6" tabindex="-1"></a>      data <span class="dt">int</span> y</span>
<span id="cb286-7"><a href="application-choice-bracketing.html#cb286-7" tabindex="-1"></a>    <span class="op">)</span> <span class="op">{</span></span>
<span id="cb286-8"><a href="application-choice-bracketing.html#cb286-8" tabindex="-1"></a>      </span>
<span id="cb286-9"><a href="application-choice-bracketing.html#cb286-9" tabindex="-1"></a>      <span class="dt">int</span> dim <span class="op">=</span> dims<span class="op">(</span>payA<span class="op">)[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb286-10"><a href="application-choice-bracketing.html#cb286-10" tabindex="-1"></a>      </span>
<span id="cb286-11"><a href="application-choice-bracketing.html#cb286-11" tabindex="-1"></a>      vector<span class="op">[</span>dim<span class="op">]</span> U <span class="op">=</span> lambda<span class="op">*</span>pow<span class="op">(</span>pow<span class="op">(</span>payA<span class="op">,</span>beta<span class="op">)+</span>pow<span class="op">(</span>payB<span class="op">,</span>beta<span class="op">),</span><span class="fl">1.0</span><span class="op">/</span>beta<span class="op">);</span></span>
<span id="cb286-12"><a href="application-choice-bracketing.html#cb286-12" tabindex="-1"></a>      </span>
<span id="cb286-13"><a href="application-choice-bracketing.html#cb286-13" tabindex="-1"></a>      </span>
<span id="cb286-14"><a href="application-choice-bracketing.html#cb286-14" tabindex="-1"></a>      </span>
<span id="cb286-15"><a href="application-choice-bracketing.html#cb286-15" tabindex="-1"></a>      </span>
<span id="cb286-16"><a href="application-choice-bracketing.html#cb286-16" tabindex="-1"></a>      <span class="cf">return</span> log_softmax<span class="op">(</span>U<span class="op">)[</span>y<span class="op">+</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb286-17"><a href="application-choice-bracketing.html#cb286-17" tabindex="-1"></a>      </span>
<span id="cb286-18"><a href="application-choice-bracketing.html#cb286-18" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb286-19"><a href="application-choice-bracketing.html#cb286-19" tabindex="-1"></a>  </span>
<span id="cb286-20"><a href="application-choice-bracketing.html#cb286-20" tabindex="-1"></a>  </span>
<span id="cb286-21"><a href="application-choice-bracketing.html#cb286-21" tabindex="-1"></a>    real ll_2part<span class="op">(</span></span>
<span id="cb286-22"><a href="application-choice-bracketing.html#cb286-22" tabindex="-1"></a>      data matrix payA1<span class="op">,</span> data matrix payB1<span class="op">,</span></span>
<span id="cb286-23"><a href="application-choice-bracketing.html#cb286-23" tabindex="-1"></a>      data matrix payA2<span class="op">,</span> data matrix payB2<span class="op">,</span></span>
<span id="cb286-24"><a href="application-choice-bracketing.html#cb286-24" tabindex="-1"></a>      real alpha<span class="op">,</span> real beta<span class="op">,</span> real lambda<span class="op">,</span></span>
<span id="cb286-25"><a href="application-choice-bracketing.html#cb286-25" tabindex="-1"></a>      data <span class="dt">int</span> y1<span class="op">,</span> data <span class="dt">int</span> y2</span>
<span id="cb286-26"><a href="application-choice-bracketing.html#cb286-26" tabindex="-1"></a>    <span class="op">)</span>  <span class="op">{</span></span>
<span id="cb286-27"><a href="application-choice-bracketing.html#cb286-27" tabindex="-1"></a>      </span>
<span id="cb286-28"><a href="application-choice-bracketing.html#cb286-28" tabindex="-1"></a>      <span class="dt">int</span> dim<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> dims<span class="op">(</span>payA1<span class="op">);</span></span>
<span id="cb286-29"><a href="application-choice-bracketing.html#cb286-29" tabindex="-1"></a>      </span>
<span id="cb286-30"><a href="application-choice-bracketing.html#cb286-30" tabindex="-1"></a>      <span class="co">// utility if DM brackets broadly</span></span>
<span id="cb286-31"><a href="application-choice-bracketing.html#cb286-31" tabindex="-1"></a>      matrix<span class="op">[</span>dim<span class="op">[</span><span class="dv">1</span><span class="op">],</span>dim<span class="op">[</span><span class="dv">2</span><span class="op">]]</span> Ubroad <span class="op">=</span> pow<span class="op">(</span></span>
<span id="cb286-32"><a href="application-choice-bracketing.html#cb286-32" tabindex="-1"></a>        pow<span class="op">(</span>payA1<span class="op">+</span>payA2<span class="op">,</span>beta<span class="op">)+</span>pow<span class="op">(</span>payB1<span class="op">+</span>payB2<span class="op">,</span>beta<span class="op">)</span></span>
<span id="cb286-33"><a href="application-choice-bracketing.html#cb286-33" tabindex="-1"></a>      <span class="op">,</span><span class="fl">1.0</span><span class="op">/</span>beta<span class="op">);</span></span>
<span id="cb286-34"><a href="application-choice-bracketing.html#cb286-34" tabindex="-1"></a>      </span>
<span id="cb286-35"><a href="application-choice-bracketing.html#cb286-35" tabindex="-1"></a>      <span class="co">// utility if DB brackets narrowly</span></span>
<span id="cb286-36"><a href="application-choice-bracketing.html#cb286-36" tabindex="-1"></a>      matrix<span class="op">[</span>dim<span class="op">[</span><span class="dv">1</span><span class="op">],</span>dim<span class="op">[</span><span class="dv">2</span><span class="op">]]</span> Unarrow <span class="op">=</span> </span>
<span id="cb286-37"><a href="application-choice-bracketing.html#cb286-37" tabindex="-1"></a>        pow<span class="op">(</span>pow<span class="op">(</span>payA1<span class="op">,</span>beta<span class="op">)+</span>pow<span class="op">(</span>payB1<span class="op">,</span>beta<span class="op">),</span><span class="fl">1.0</span><span class="op">/</span>beta<span class="op">)</span></span>
<span id="cb286-38"><a href="application-choice-bracketing.html#cb286-38" tabindex="-1"></a>        <span class="op">+</span>pow<span class="op">(</span>pow<span class="op">(</span>payA2<span class="op">,</span>beta<span class="op">)+</span>pow<span class="op">(</span>payB2<span class="op">,</span>beta<span class="op">),</span><span class="fl">1.0</span><span class="op">/</span>beta<span class="op">)</span></span>
<span id="cb286-39"><a href="application-choice-bracketing.html#cb286-39" tabindex="-1"></a>        <span class="op">;</span></span>
<span id="cb286-40"><a href="application-choice-bracketing.html#cb286-40" tabindex="-1"></a>      </span>
<span id="cb286-41"><a href="application-choice-bracketing.html#cb286-41" tabindex="-1"></a>      <span class="co">// partial bracketing utility</span></span>
<span id="cb286-42"><a href="application-choice-bracketing.html#cb286-42" tabindex="-1"></a>      matrix<span class="op">[</span>dim<span class="op">[</span><span class="dv">1</span><span class="op">],</span>dim<span class="op">[</span><span class="dv">2</span><span class="op">]]</span> U <span class="op">=</span> lambda<span class="op">*(</span>alpha<span class="op">*</span>Unarrow<span class="op">+(</span><span class="fl">1.0</span><span class="op">-</span>alpha<span class="op">)*</span>Ubroad<span class="op">);</span></span>
<span id="cb286-43"><a href="application-choice-bracketing.html#cb286-43" tabindex="-1"></a></span>
<span id="cb286-44"><a href="application-choice-bracketing.html#cb286-44" tabindex="-1"></a>      <span class="cf">return</span> U<span class="op">[</span>y1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>y2<span class="op">+</span><span class="dv">1</span><span class="op">]-</span>log_sum_exp<span class="op">(</span>U<span class="op">);</span></span>
<span id="cb286-45"><a href="application-choice-bracketing.html#cb286-45" tabindex="-1"></a>      </span>
<span id="cb286-46"><a href="application-choice-bracketing.html#cb286-46" tabindex="-1"></a>    <span class="op">}</span> </span>
<span id="cb286-47"><a href="application-choice-bracketing.html#cb286-47" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb286-48"><a href="application-choice-bracketing.html#cb286-48" tabindex="-1"></a></span>
<span id="cb286-49"><a href="application-choice-bracketing.html#cb286-49" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb286-50"><a href="application-choice-bracketing.html#cb286-50" tabindex="-1"></a>  <span class="dt">int</span> N<span class="op">;</span> <span class="co">// number of participants</span></span>
<span id="cb286-51"><a href="application-choice-bracketing.html#cb286-51" tabindex="-1"></a>  </span>
<span id="cb286-52"><a href="application-choice-bracketing.html#cb286-52" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> prior_MU<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb286-53"><a href="application-choice-bracketing.html#cb286-53" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> prior_TAU<span class="op">;</span></span>
<span id="cb286-54"><a href="application-choice-bracketing.html#cb286-54" tabindex="-1"></a>  real prior_Omega<span class="op">;</span></span>
<span id="cb286-55"><a href="application-choice-bracketing.html#cb286-55" tabindex="-1"></a>  </span>
<span id="cb286-56"><a href="application-choice-bracketing.html#cb286-56" tabindex="-1"></a>  <span class="co">// allocations to player A</span></span>
<span id="cb286-57"><a href="application-choice-bracketing.html#cb286-57" tabindex="-1"></a>  <span class="dt">int</span> y1_1<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb286-58"><a href="application-choice-bracketing.html#cb286-58" tabindex="-1"></a>  <span class="dt">int</span> y1_2<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb286-59"><a href="application-choice-bracketing.html#cb286-59" tabindex="-1"></a>  <span class="dt">int</span> y2<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb286-60"><a href="application-choice-bracketing.html#cb286-60" tabindex="-1"></a>  <span class="dt">int</span> y3_1<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb286-61"><a href="application-choice-bracketing.html#cb286-61" tabindex="-1"></a>  <span class="dt">int</span> y3_2<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb286-62"><a href="application-choice-bracketing.html#cb286-62" tabindex="-1"></a>  <span class="dt">int</span> y4<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb286-63"><a href="application-choice-bracketing.html#cb286-63" tabindex="-1"></a>  <span class="dt">int</span> y5<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb286-64"><a href="application-choice-bracketing.html#cb286-64" tabindex="-1"></a>  </span>
<span id="cb286-65"><a href="application-choice-bracketing.html#cb286-65" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb286-66"><a href="application-choice-bracketing.html#cb286-66" tabindex="-1"></a></span>
<span id="cb286-67"><a href="application-choice-bracketing.html#cb286-67" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb286-68"><a href="application-choice-bracketing.html#cb286-68" tabindex="-1"></a>  </span>
<span id="cb286-69"><a href="application-choice-bracketing.html#cb286-69" tabindex="-1"></a>  <span class="co">/* Here I am going to hard-code the experiment parameters and choice sets</span></span>
<span id="cb286-70"><a href="application-choice-bracketing.html#cb286-70" tabindex="-1"></a><span class="co">  This is becuase each decision has different endowments (I), </span></span>
<span id="cb286-71"><a href="application-choice-bracketing.html#cb286-71" tabindex="-1"></a><span class="co">  and so it saves a lot of matrix-creation on the fly in the </span></span>
<span id="cb286-72"><a href="application-choice-bracketing.html#cb286-72" tabindex="-1"></a><span class="co">  model block</span></span>
<span id="cb286-73"><a href="application-choice-bracketing.html#cb286-73" tabindex="-1"></a><span class="co">  */</span></span>
<span id="cb286-74"><a href="application-choice-bracketing.html#cb286-74" tabindex="-1"></a>  </span>
<span id="cb286-75"><a href="application-choice-bracketing.html#cb286-75" tabindex="-1"></a>  <span class="co">// decision 1, 2 parts --------------------</span></span>
<span id="cb286-76"><a href="application-choice-bracketing.html#cb286-76" tabindex="-1"></a>  <span class="dt">int</span> I1_1 <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb286-77"><a href="application-choice-bracketing.html#cb286-77" tabindex="-1"></a>  <span class="dt">int</span> I1_2 <span class="op">=</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb286-78"><a href="application-choice-bracketing.html#cb286-78" tabindex="-1"></a>  real vA1_1 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb286-79"><a href="application-choice-bracketing.html#cb286-79" tabindex="-1"></a>  real vB1_1 <span class="op">=</span> <span class="fl">1.2</span><span class="op">;</span></span>
<span id="cb286-80"><a href="application-choice-bracketing.html#cb286-80" tabindex="-1"></a>  real vA1_2 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb286-81"><a href="application-choice-bracketing.html#cb286-81" tabindex="-1"></a>  real vB1_2 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb286-82"><a href="application-choice-bracketing.html#cb286-82" tabindex="-1"></a>  </span>
<span id="cb286-83"><a href="application-choice-bracketing.html#cb286-83" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X1_1 <span class="op">=</span> rep_matrix<span class="op">(</span>linspaced_vector<span class="op">(</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I1_1<span class="op">),</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb286-84"><a href="application-choice-bracketing.html#cb286-84" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X1_2 <span class="op">=</span> rep_matrix<span class="op">(</span>linspaced_row_vector<span class="op">(</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I1_2<span class="op">),</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb286-85"><a href="application-choice-bracketing.html#cb286-85" tabindex="-1"></a>  </span>
<span id="cb286-86"><a href="application-choice-bracketing.html#cb286-86" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA1_1 <span class="op">=</span> vA1_1<span class="op">*</span>X1_1<span class="op">;</span></span>
<span id="cb286-87"><a href="application-choice-bracketing.html#cb286-87" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB1_1 <span class="op">=</span> vB1_1<span class="op">*(</span>I1_1<span class="op">-</span>X1_1<span class="op">);</span></span>
<span id="cb286-88"><a href="application-choice-bracketing.html#cb286-88" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA1_2 <span class="op">=</span> vA1_2<span class="op">*</span>X1_2<span class="op">;</span></span>
<span id="cb286-89"><a href="application-choice-bracketing.html#cb286-89" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB1_2 <span class="op">=</span> vB1_2<span class="op">*(</span>I1_2<span class="op">-</span>X1_2<span class="op">);</span></span>
<span id="cb286-90"><a href="application-choice-bracketing.html#cb286-90" tabindex="-1"></a>  </span>
<span id="cb286-91"><a href="application-choice-bracketing.html#cb286-91" tabindex="-1"></a>  <span class="co">// decision 2, 1 part -------------------</span></span>
<span id="cb286-92"><a href="application-choice-bracketing.html#cb286-92" tabindex="-1"></a>  <span class="dt">int</span> I2 <span class="op">=</span> <span class="dv">14</span><span class="op">;</span></span>
<span id="cb286-93"><a href="application-choice-bracketing.html#cb286-93" tabindex="-1"></a>  real vA2 <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb286-94"><a href="application-choice-bracketing.html#cb286-94" tabindex="-1"></a>  real vB2 <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb286-95"><a href="application-choice-bracketing.html#cb286-95" tabindex="-1"></a>  </span>
<span id="cb286-96"><a href="application-choice-bracketing.html#cb286-96" tabindex="-1"></a>  vector<span class="op">[</span>I2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X2 <span class="op">=</span> linspaced_vector<span class="op">(</span>I2<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I2<span class="op">);</span></span>
<span id="cb286-97"><a href="application-choice-bracketing.html#cb286-97" tabindex="-1"></a>  </span>
<span id="cb286-98"><a href="application-choice-bracketing.html#cb286-98" tabindex="-1"></a>  vector<span class="op">[</span>I2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA2 <span class="op">=</span> vA2<span class="op">*</span>X2<span class="op">;</span></span>
<span id="cb286-99"><a href="application-choice-bracketing.html#cb286-99" tabindex="-1"></a>  vector<span class="op">[</span>I2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB2 <span class="op">=</span> vB2<span class="op">*(</span>I2<span class="op">-</span>X2<span class="op">);</span></span>
<span id="cb286-100"><a href="application-choice-bracketing.html#cb286-100" tabindex="-1"></a>  </span>
<span id="cb286-101"><a href="application-choice-bracketing.html#cb286-101" tabindex="-1"></a>  <span class="co">// decision 3, 2 parts --------------------</span></span>
<span id="cb286-102"><a href="application-choice-bracketing.html#cb286-102" tabindex="-1"></a>  <span class="dt">int</span> I3_1 <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb286-103"><a href="application-choice-bracketing.html#cb286-103" tabindex="-1"></a>  <span class="dt">int</span> I3_2 <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb286-104"><a href="application-choice-bracketing.html#cb286-104" tabindex="-1"></a>  real vA3_1 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb286-105"><a href="application-choice-bracketing.html#cb286-105" tabindex="-1"></a>  real vB3_1 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb286-106"><a href="application-choice-bracketing.html#cb286-106" tabindex="-1"></a>  real vA3_2 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb286-107"><a href="application-choice-bracketing.html#cb286-107" tabindex="-1"></a>  real vB3_2 <span class="op">=</span> <span class="fl">1.2</span><span class="op">;</span></span>
<span id="cb286-108"><a href="application-choice-bracketing.html#cb286-108" tabindex="-1"></a>  </span>
<span id="cb286-109"><a href="application-choice-bracketing.html#cb286-109" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X3_1 <span class="op">=</span> rep_matrix<span class="op">(</span>linspaced_vector<span class="op">(</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I3_1<span class="op">),</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb286-110"><a href="application-choice-bracketing.html#cb286-110" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X3_2 <span class="op">=</span> rep_matrix<span class="op">(</span>linspaced_row_vector<span class="op">(</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I3_2<span class="op">),</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb286-111"><a href="application-choice-bracketing.html#cb286-111" tabindex="-1"></a>  </span>
<span id="cb286-112"><a href="application-choice-bracketing.html#cb286-112" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA3_1 <span class="op">=</span> vA3_1<span class="op">*</span>X3_1<span class="op">;</span></span>
<span id="cb286-113"><a href="application-choice-bracketing.html#cb286-113" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB3_1 <span class="op">=</span> vB3_1<span class="op">*(</span>I3_1<span class="op">-</span>X3_1<span class="op">);</span></span>
<span id="cb286-114"><a href="application-choice-bracketing.html#cb286-114" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA3_2 <span class="op">=</span> vA3_2<span class="op">*</span>X3_2<span class="op">;</span></span>
<span id="cb286-115"><a href="application-choice-bracketing.html#cb286-115" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB3_2 <span class="op">=</span> vB3_2<span class="op">*(</span>I3_2<span class="op">-</span>X3_2<span class="op">);</span></span>
<span id="cb286-116"><a href="application-choice-bracketing.html#cb286-116" tabindex="-1"></a>  </span>
<span id="cb286-117"><a href="application-choice-bracketing.html#cb286-117" tabindex="-1"></a>  <span class="co">// decision 4, 1 part -------------------</span></span>
<span id="cb286-118"><a href="application-choice-bracketing.html#cb286-118" tabindex="-1"></a>  <span class="dt">int</span> I4 <span class="op">=</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb286-119"><a href="application-choice-bracketing.html#cb286-119" tabindex="-1"></a>  real vA4 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb286-120"><a href="application-choice-bracketing.html#cb286-120" tabindex="-1"></a>  real vB4 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb286-121"><a href="application-choice-bracketing.html#cb286-121" tabindex="-1"></a>  </span>
<span id="cb286-122"><a href="application-choice-bracketing.html#cb286-122" tabindex="-1"></a>  vector<span class="op">[</span>I4<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X4 <span class="op">=</span> linspaced_vector<span class="op">(</span>I4<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I4<span class="op">);</span></span>
<span id="cb286-123"><a href="application-choice-bracketing.html#cb286-123" tabindex="-1"></a>  </span>
<span id="cb286-124"><a href="application-choice-bracketing.html#cb286-124" tabindex="-1"></a>  vector<span class="op">[</span>I4<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA4 <span class="op">=</span> vA4<span class="op">*</span>X4<span class="op">;</span></span>
<span id="cb286-125"><a href="application-choice-bracketing.html#cb286-125" tabindex="-1"></a>  vector<span class="op">[</span>I4<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB4 <span class="op">=</span> vB4<span class="op">*(</span>I4<span class="op">-</span>X4<span class="op">);</span></span>
<span id="cb286-126"><a href="application-choice-bracketing.html#cb286-126" tabindex="-1"></a>  </span>
<span id="cb286-127"><a href="application-choice-bracketing.html#cb286-127" tabindex="-1"></a>   <span class="co">// decision 5, 1 part -------------------</span></span>
<span id="cb286-128"><a href="application-choice-bracketing.html#cb286-128" tabindex="-1"></a>  <span class="dt">int</span> I5 <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb286-129"><a href="application-choice-bracketing.html#cb286-129" tabindex="-1"></a>  real vA5 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb286-130"><a href="application-choice-bracketing.html#cb286-130" tabindex="-1"></a>  real vB5 <span class="op">=</span> <span class="fl">1.2</span><span class="op">;</span></span>
<span id="cb286-131"><a href="application-choice-bracketing.html#cb286-131" tabindex="-1"></a>  </span>
<span id="cb286-132"><a href="application-choice-bracketing.html#cb286-132" tabindex="-1"></a>  vector<span class="op">[</span>I5<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X5 <span class="op">=</span> linspaced_vector<span class="op">(</span>I5<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I5<span class="op">);</span></span>
<span id="cb286-133"><a href="application-choice-bracketing.html#cb286-133" tabindex="-1"></a>  </span>
<span id="cb286-134"><a href="application-choice-bracketing.html#cb286-134" tabindex="-1"></a>  vector<span class="op">[</span>I5<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA5 <span class="op">=</span> vA5<span class="op">*</span>X5<span class="op">;</span></span>
<span id="cb286-135"><a href="application-choice-bracketing.html#cb286-135" tabindex="-1"></a>  vector<span class="op">[</span>I5<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB5 <span class="op">=</span> vB5<span class="op">*(</span>I5<span class="op">-</span>X5<span class="op">);</span></span>
<span id="cb286-136"><a href="application-choice-bracketing.html#cb286-136" tabindex="-1"></a>  </span>
<span id="cb286-137"><a href="application-choice-bracketing.html#cb286-137" tabindex="-1"></a>  </span>
<span id="cb286-138"><a href="application-choice-bracketing.html#cb286-138" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb286-139"><a href="application-choice-bracketing.html#cb286-139" tabindex="-1"></a></span>
<span id="cb286-140"><a href="application-choice-bracketing.html#cb286-140" tabindex="-1"></a></span>
<span id="cb286-141"><a href="application-choice-bracketing.html#cb286-141" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb286-142"><a href="application-choice-bracketing.html#cb286-142" tabindex="-1"></a>  </span>
<span id="cb286-143"><a href="application-choice-bracketing.html#cb286-143" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> MU<span class="op">;</span></span>
<span id="cb286-144"><a href="application-choice-bracketing.html#cb286-144" tabindex="-1"></a>  vector<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;[</span><span class="dv">3</span><span class="op">]</span> TAU<span class="op">;</span></span>
<span id="cb286-145"><a href="application-choice-bracketing.html#cb286-145" tabindex="-1"></a>  cholesky_factor_corr<span class="op">[</span><span class="dv">3</span><span class="op">]</span> L_Omega<span class="op">;</span></span>
<span id="cb286-146"><a href="application-choice-bracketing.html#cb286-146" tabindex="-1"></a>  </span>
<span id="cb286-147"><a href="application-choice-bracketing.html#cb286-147" tabindex="-1"></a>  matrix<span class="op">[</span><span class="dv">3</span><span class="op">,</span>N<span class="op">]</span> z<span class="op">;</span></span>
<span id="cb286-148"><a href="application-choice-bracketing.html#cb286-148" tabindex="-1"></a></span>
<span id="cb286-149"><a href="application-choice-bracketing.html#cb286-149" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb286-150"><a href="application-choice-bracketing.html#cb286-150" tabindex="-1"></a></span>
<span id="cb286-151"><a href="application-choice-bracketing.html#cb286-151" tabindex="-1"></a>transformed parameters <span class="op">{</span></span>
<span id="cb286-152"><a href="application-choice-bracketing.html#cb286-152" tabindex="-1"></a>  </span>
<span id="cb286-153"><a href="application-choice-bracketing.html#cb286-153" tabindex="-1"></a>  vector<span class="op">[</span>N<span class="op">]</span> alpha<span class="op">;</span></span>
<span id="cb286-154"><a href="application-choice-bracketing.html#cb286-154" tabindex="-1"></a>  vector<span class="op">[</span>N<span class="op">]</span> beta<span class="op">;</span></span>
<span id="cb286-155"><a href="application-choice-bracketing.html#cb286-155" tabindex="-1"></a>  vector<span class="op">[</span>N<span class="op">]</span> lambda<span class="op">;</span></span>
<span id="cb286-156"><a href="application-choice-bracketing.html#cb286-156" tabindex="-1"></a>  </span>
<span id="cb286-157"><a href="application-choice-bracketing.html#cb286-157" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb286-158"><a href="application-choice-bracketing.html#cb286-158" tabindex="-1"></a>    matrix<span class="op">[</span><span class="dv">3</span><span class="op">,</span>N<span class="op">]</span> theta <span class="op">=</span> rep_matrix<span class="op">(</span>MU<span class="op">,</span>N<span class="op">)</span></span>
<span id="cb286-159"><a href="application-choice-bracketing.html#cb286-159" tabindex="-1"></a>                    <span class="co">//+diag_matrix(TAU)*z;</span></span>
<span id="cb286-160"><a href="application-choice-bracketing.html#cb286-160" tabindex="-1"></a>                    <span class="op">+</span>diag_pre_multiply<span class="op">(</span>TAU<span class="op">,</span>L_Omega<span class="op">)*</span>z<span class="op">;</span></span>
<span id="cb286-161"><a href="application-choice-bracketing.html#cb286-161" tabindex="-1"></a>    </span>
<span id="cb286-162"><a href="application-choice-bracketing.html#cb286-162" tabindex="-1"></a>    alpha <span class="op">=</span> Phi_approx<span class="op">(</span>theta<span class="op">[</span><span class="dv">1</span><span class="op">,]</span><span class="ch">&#39;)</span><span class="er">;    </span></span>
<span id="cb286-163"><a href="application-choice-bracketing.html#cb286-163" tabindex="-1"></a>    beta <span class="op">=</span> exp<span class="op">(</span>theta<span class="op">[</span><span class="dv">2</span><span class="op">,]</span><span class="ch">&#39;)</span><span class="er">;</span></span>
<span id="cb286-164"><a href="application-choice-bracketing.html#cb286-164" tabindex="-1"></a>    lambda <span class="op">=</span> exp<span class="op">(</span>theta<span class="op">[</span><span class="dv">3</span><span class="op">,]</span><span class="ch">&#39;)</span><span class="er">;</span></span>
<span id="cb286-165"><a href="application-choice-bracketing.html#cb286-165" tabindex="-1"></a>    </span>
<span id="cb286-166"><a href="application-choice-bracketing.html#cb286-166" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb286-167"><a href="application-choice-bracketing.html#cb286-167" tabindex="-1"></a>  </span>
<span id="cb286-168"><a href="application-choice-bracketing.html#cb286-168" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb286-169"><a href="application-choice-bracketing.html#cb286-169" tabindex="-1"></a></span>
<span id="cb286-170"><a href="application-choice-bracketing.html#cb286-170" tabindex="-1"></a></span>
<span id="cb286-171"><a href="application-choice-bracketing.html#cb286-171" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb286-172"><a href="application-choice-bracketing.html#cb286-172" tabindex="-1"></a>  </span>
<span id="cb286-173"><a href="application-choice-bracketing.html#cb286-173" tabindex="-1"></a>  <span class="co">// hierarchical structure with noncentered parameterization ------------------</span></span>
<span id="cb286-174"><a href="application-choice-bracketing.html#cb286-174" tabindex="-1"></a>  to_vector<span class="op">(</span>z<span class="op">)</span> <span class="op">~</span> std_normal<span class="op">();</span></span>
<span id="cb286-175"><a href="application-choice-bracketing.html#cb286-175" tabindex="-1"></a>  </span>
<span id="cb286-176"><a href="application-choice-bracketing.html#cb286-176" tabindex="-1"></a>  <span class="co">// priors---------------------------------------------------------------------</span></span>
<span id="cb286-177"><a href="application-choice-bracketing.html#cb286-177" tabindex="-1"></a>  MU <span class="op">~</span> normal<span class="op">(</span>prior_MU<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_MU<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb286-178"><a href="application-choice-bracketing.html#cb286-178" tabindex="-1"></a>  TAU <span class="op">~</span> cauchy<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>prior_TAU<span class="op">);</span></span>
<span id="cb286-179"><a href="application-choice-bracketing.html#cb286-179" tabindex="-1"></a>  L_Omega <span class="op">~</span> lkj_corr_cholesky<span class="op">(</span>prior_Omega<span class="op">);</span></span>
<span id="cb286-180"><a href="application-choice-bracketing.html#cb286-180" tabindex="-1"></a>  </span>
<span id="cb286-181"><a href="application-choice-bracketing.html#cb286-181" tabindex="-1"></a>  </span>
<span id="cb286-182"><a href="application-choice-bracketing.html#cb286-182" tabindex="-1"></a>  <span class="co">// likelihood ----------------------------------------------------------------</span></span>
<span id="cb286-183"><a href="application-choice-bracketing.html#cb286-183" tabindex="-1"></a>  </span>
<span id="cb286-184"><a href="application-choice-bracketing.html#cb286-184" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>N<span class="op">)</span> <span class="op">{</span></span>
<span id="cb286-185"><a href="application-choice-bracketing.html#cb286-185" tabindex="-1"></a>    </span>
<span id="cb286-186"><a href="application-choice-bracketing.html#cb286-186" tabindex="-1"></a>    real a <span class="op">=</span> alpha<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb286-187"><a href="application-choice-bracketing.html#cb286-187" tabindex="-1"></a>    real b <span class="op">=</span> beta<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb286-188"><a href="application-choice-bracketing.html#cb286-188" tabindex="-1"></a>    real l <span class="op">=</span> lambda<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb286-189"><a href="application-choice-bracketing.html#cb286-189" tabindex="-1"></a>    </span>
<span id="cb286-190"><a href="application-choice-bracketing.html#cb286-190" tabindex="-1"></a>    <span class="co">// decision 1, 2 parts</span></span>
<span id="cb286-191"><a href="application-choice-bracketing.html#cb286-191" tabindex="-1"></a>    target <span class="op">+=</span> ll_2part<span class="op">(</span></span>
<span id="cb286-192"><a href="application-choice-bracketing.html#cb286-192" tabindex="-1"></a>      payA1_1<span class="op">,</span> payB1_1<span class="op">,</span></span>
<span id="cb286-193"><a href="application-choice-bracketing.html#cb286-193" tabindex="-1"></a>      payA1_2<span class="op">,</span> payB1_2<span class="op">,</span></span>
<span id="cb286-194"><a href="application-choice-bracketing.html#cb286-194" tabindex="-1"></a>      a<span class="op">,</span>b<span class="op">,</span>l<span class="op">,</span></span>
<span id="cb286-195"><a href="application-choice-bracketing.html#cb286-195" tabindex="-1"></a>      y1_1<span class="op">[</span>ii<span class="op">],</span>y1_2<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb286-196"><a href="application-choice-bracketing.html#cb286-196" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb286-197"><a href="application-choice-bracketing.html#cb286-197" tabindex="-1"></a>    </span>
<span id="cb286-198"><a href="application-choice-bracketing.html#cb286-198" tabindex="-1"></a>    </span>
<span id="cb286-199"><a href="application-choice-bracketing.html#cb286-199" tabindex="-1"></a>    </span>
<span id="cb286-200"><a href="application-choice-bracketing.html#cb286-200" tabindex="-1"></a>    <span class="co">// decision 2, 1 part</span></span>
<span id="cb286-201"><a href="application-choice-bracketing.html#cb286-201" tabindex="-1"></a>    target <span class="op">+=</span> ll_1part<span class="op">(</span></span>
<span id="cb286-202"><a href="application-choice-bracketing.html#cb286-202" tabindex="-1"></a>      payA2<span class="op">,</span> payB2<span class="op">,</span></span>
<span id="cb286-203"><a href="application-choice-bracketing.html#cb286-203" tabindex="-1"></a>      b<span class="op">,</span>l<span class="op">,</span></span>
<span id="cb286-204"><a href="application-choice-bracketing.html#cb286-204" tabindex="-1"></a>      y2<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb286-205"><a href="application-choice-bracketing.html#cb286-205" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb286-206"><a href="application-choice-bracketing.html#cb286-206" tabindex="-1"></a>   </span>
<span id="cb286-207"><a href="application-choice-bracketing.html#cb286-207" tabindex="-1"></a>     <span class="co">// decision 3, 2 parts</span></span>
<span id="cb286-208"><a href="application-choice-bracketing.html#cb286-208" tabindex="-1"></a>    target <span class="op">+=</span> ll_2part<span class="op">(</span></span>
<span id="cb286-209"><a href="application-choice-bracketing.html#cb286-209" tabindex="-1"></a>      payA3_1<span class="op">,</span> payB3_1<span class="op">,</span></span>
<span id="cb286-210"><a href="application-choice-bracketing.html#cb286-210" tabindex="-1"></a>      payA3_2<span class="op">,</span> payB3_2<span class="op">,</span></span>
<span id="cb286-211"><a href="application-choice-bracketing.html#cb286-211" tabindex="-1"></a>      a<span class="op">,</span>b<span class="op">,</span>l<span class="op">,</span></span>
<span id="cb286-212"><a href="application-choice-bracketing.html#cb286-212" tabindex="-1"></a>      y3_1<span class="op">[</span>ii<span class="op">],</span>y3_2<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb286-213"><a href="application-choice-bracketing.html#cb286-213" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb286-214"><a href="application-choice-bracketing.html#cb286-214" tabindex="-1"></a>    </span>
<span id="cb286-215"><a href="application-choice-bracketing.html#cb286-215" tabindex="-1"></a>    <span class="co">// decision 4, 1 part</span></span>
<span id="cb286-216"><a href="application-choice-bracketing.html#cb286-216" tabindex="-1"></a>    target <span class="op">+=</span> ll_1part<span class="op">(</span></span>
<span id="cb286-217"><a href="application-choice-bracketing.html#cb286-217" tabindex="-1"></a>      payA4<span class="op">,</span> payB4<span class="op">,</span></span>
<span id="cb286-218"><a href="application-choice-bracketing.html#cb286-218" tabindex="-1"></a>      b<span class="op">,</span>l<span class="op">,</span></span>
<span id="cb286-219"><a href="application-choice-bracketing.html#cb286-219" tabindex="-1"></a>      y4<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb286-220"><a href="application-choice-bracketing.html#cb286-220" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb286-221"><a href="application-choice-bracketing.html#cb286-221" tabindex="-1"></a>    </span>
<span id="cb286-222"><a href="application-choice-bracketing.html#cb286-222" tabindex="-1"></a>    <span class="co">// decision 5, 1 part</span></span>
<span id="cb286-223"><a href="application-choice-bracketing.html#cb286-223" tabindex="-1"></a>    target <span class="op">+=</span> ll_1part<span class="op">(</span></span>
<span id="cb286-224"><a href="application-choice-bracketing.html#cb286-224" tabindex="-1"></a>      payA5<span class="op">,</span> payB5<span class="op">,</span></span>
<span id="cb286-225"><a href="application-choice-bracketing.html#cb286-225" tabindex="-1"></a>      b<span class="op">,</span>l<span class="op">,</span></span>
<span id="cb286-226"><a href="application-choice-bracketing.html#cb286-226" tabindex="-1"></a>      y5<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb286-227"><a href="application-choice-bracketing.html#cb286-227" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb286-228"><a href="application-choice-bracketing.html#cb286-228" tabindex="-1"></a>    </span>
<span id="cb286-229"><a href="application-choice-bracketing.html#cb286-229" tabindex="-1"></a>    </span>
<span id="cb286-230"><a href="application-choice-bracketing.html#cb286-230" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb286-231"><a href="application-choice-bracketing.html#cb286-231" tabindex="-1"></a>  </span>
<span id="cb286-232"><a href="application-choice-bracketing.html#cb286-232" tabindex="-1"></a>  </span>
<span id="cb286-233"><a href="application-choice-bracketing.html#cb286-233" tabindex="-1"></a>  </span>
<span id="cb286-234"><a href="application-choice-bracketing.html#cb286-234" tabindex="-1"></a>  </span>
<span id="cb286-235"><a href="application-choice-bracketing.html#cb286-235" tabindex="-1"></a></span>
<span id="cb286-236"><a href="application-choice-bracketing.html#cb286-236" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Figure <a href="application-choice-bracketing.html#fig:EF2024-hierarchicalecdf">22.5</a> shows the shrinkage estimates for <span class="math inline">\(\alpha\)</span> from the hierarchical model. (These have the same interpretation as the individual-level estimates in Figure <a href="application-choice-bracketing.html#fig:EF2024-individualecdf">22.3</a>). What struck me as surprising here (and I really should have seen it when I looked at the individual-level estimates in Figure @ref(fig:EF2024-individualecdf,)) was the bi-modality of a distribution. In an ecdf you can see the modes of a distribution as very steep parts. There appears to be one at about <span class="math inline">\(\alpha=0.4\)</span>, and another at <span class="math inline">\(\alpha=0.75\)</span>. This may pose a problem for the hierarchical model, which (and I’m waving my hands a lot here) is really hoping for a uni-modal distribution, or even better yet, a continuous <em>normal</em> distribution (of the transformed variable). This can be addressed by selecting a more flexible distribution, but I will leave this for another day.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="application-choice-bracketing.html#cb287-1" tabindex="-1"></a>d<span class="ot">&lt;-</span><span class="st">&quot;Code/EF2024/social_hierarchical.csv&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb287-2"><a href="application-choice-bracketing.html#cb287-2" tabindex="-1"></a>  <span class="fu">read.csv</span>() <span class="sc">|&gt;</span> </span>
<span id="cb287-3"><a href="application-choice-bracketing.html#cb287-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;alpha&quot;</span>,par)) <span class="sc">|&gt;</span></span>
<span id="cb287-4"><a href="application-choice-bracketing.html#cb287-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb287-5"><a href="application-choice-bracketing.html#cb287-5" tabindex="-1"></a>    <span class="at">cumul =</span> <span class="fu">rank</span>(mean)<span class="sc">/</span><span class="fu">n</span>()<span class="sc">-</span><span class="fl">0.5</span><span class="sc">/</span><span class="fu">n</span>()</span>
<span id="cb287-6"><a href="application-choice-bracketing.html#cb287-6" tabindex="-1"></a>  )</span>
<span id="cb287-7"><a href="application-choice-bracketing.html#cb287-7" tabindex="-1"></a></span>
<span id="cb287-8"><a href="application-choice-bracketing.html#cb287-8" tabindex="-1"></a>(</span>
<span id="cb287-9"><a href="application-choice-bracketing.html#cb287-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(d,<span class="fu">aes</span>(<span class="at">x=</span>mean))</span>
<span id="cb287-10"><a href="application-choice-bracketing.html#cb287-10" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">stat_ecdf</span>()</span>
<span id="cb287-11"><a href="application-choice-bracketing.html#cb287-11" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb287-12"><a href="application-choice-bracketing.html#cb287-12" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> X25.,<span class="at">xmax =</span> X75., <span class="at">y=</span>cumul),<span class="at">alpha=</span><span class="fl">0.5</span>,<span class="at">color=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb287-13"><a href="application-choice-bracketing.html#cb287-13" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb287-14"><a href="application-choice-bracketing.html#cb287-14" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="fu">expression</span>(alpha<span class="sc">~</span><span class="st">&quot;(extent of narrow bracketing)&quot;</span>))</span>
<span id="cb287-15"><a href="application-choice-bracketing.html#cb287-15" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;cumulative density of posterior mean&quot;</span>)</span>
<span id="cb287-16"><a href="application-choice-bracketing.html#cb287-16" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:EF2024-hierarchicalecdf"></span>
<img src="index_files/figure-html/EF2024-hierarchicalecdf-1.png" alt="Shrinkage estimates of extent of narrow bracketing at the individual level from the hierarchical model. Black line shows the empirical cumulative distribution function of the posterior mean. Red error bars show 50% Bayesian credible regions (25th-75th percentile)" width="672" />
<p class="caption">
Figure 22.5: Shrinkage estimates of extent of narrow bracketing at the individual level from the hierarchical model. Black line shows the empirical cumulative distribution function of the posterior mean. Red error bars show 50% Bayesian credible regions (25th-75th percentile)
</p>
</div>
</div>
<div id="a-mixture-model-1" class="section level2 hasAnchor" number="22.4">
<h2><span class="header-section-number">22.4</span> A mixture model<a href="application-choice-bracketing.html#a-mixture-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One thing that I was worried about while doing the above work was that there were only five decisions per participant. Furthermore only two of these decisions had two parts, and so it was really only these decisions that provided us with information about <span class="math inline">\(\alpha\)</span>, the extent of narrow bracketing.<a href="#fn102" class="footnote-ref" id="fnref102"><sup>102</sup></a> This is certainly reflected in the large credible regions for <span class="math inline">\(\alpha\)</span> for the individual-level estimation (recall that these were only 50% credible regions), and so we are not estimating <span class="math inline">\(\alpha\)</span> particularly precisely. Instead of assuming the partial bracketing model, we could simplify things by instead assuming that participants either fully narrowly bracketed or fully broadly bracketed. That is, we have a 2-type (discrete) mixture model. At the individual level, this turns the problem from an <em>estimation</em> (of <span class="math inline">\(\alpha\)</span>) problem to a <em>classification</em> (into <span class="math inline">\(\alpha=0\)</span> or <span class="math inline">\(\alpha=1\)</span>) problem. Our model will now tell us the <em>fraction</em> of narrow bracketers in the population, and we will be able to assign a posterior probability to each participant that they are a narrow bracketer.</p>
<p>Here is the <em>Stan</em> program I wrote to estimate this mixture model. Importantly, I am preserving the hierarchical structure for the parameters <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\lambda\)</span>, which if we are just interested in bracketing behavior, could be considered nuisance parameters for this inferential goal.<a href="#fn103" class="footnote-ref" id="fnref103"><sup>103</sup></a> Hence, our model will be in some sense robust to participant-level heterogeneity in these parameters. Note that I have moved a lot of the calculations into the <code>transofrmed parameters</code> block so I can use the <code>ll</code> variable into both the <code>model</code> (to increment the log-posterior) and <code>generated quantities</code> (to calculate posterior type probabilities) blocks.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb288-1"><a href="application-choice-bracketing.html#cb288-1" tabindex="-1"></a>functions <span class="op">{</span></span>
<span id="cb288-2"><a href="application-choice-bracketing.html#cb288-2" tabindex="-1"></a>  </span>
<span id="cb288-3"><a href="application-choice-bracketing.html#cb288-3" tabindex="-1"></a>    real ll_1part<span class="op">(</span></span>
<span id="cb288-4"><a href="application-choice-bracketing.html#cb288-4" tabindex="-1"></a>      data vector payA<span class="op">,</span> data vector payB<span class="op">,</span></span>
<span id="cb288-5"><a href="application-choice-bracketing.html#cb288-5" tabindex="-1"></a>      real beta<span class="op">,</span> real lambda<span class="op">,</span></span>
<span id="cb288-6"><a href="application-choice-bracketing.html#cb288-6" tabindex="-1"></a>      data <span class="dt">int</span> y</span>
<span id="cb288-7"><a href="application-choice-bracketing.html#cb288-7" tabindex="-1"></a>    <span class="op">)</span> <span class="op">{</span></span>
<span id="cb288-8"><a href="application-choice-bracketing.html#cb288-8" tabindex="-1"></a>      </span>
<span id="cb288-9"><a href="application-choice-bracketing.html#cb288-9" tabindex="-1"></a>      <span class="dt">int</span> dim <span class="op">=</span> dims<span class="op">(</span>payA<span class="op">)[</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb288-10"><a href="application-choice-bracketing.html#cb288-10" tabindex="-1"></a>      </span>
<span id="cb288-11"><a href="application-choice-bracketing.html#cb288-11" tabindex="-1"></a>      vector<span class="op">[</span>dim<span class="op">]</span> U <span class="op">=</span> lambda<span class="op">*</span>pow<span class="op">(</span>pow<span class="op">(</span>payA<span class="op">,</span>beta<span class="op">)+</span>pow<span class="op">(</span>payB<span class="op">,</span>beta<span class="op">),</span><span class="fl">1.0</span><span class="op">/</span>beta<span class="op">);</span></span>
<span id="cb288-12"><a href="application-choice-bracketing.html#cb288-12" tabindex="-1"></a>      </span>
<span id="cb288-13"><a href="application-choice-bracketing.html#cb288-13" tabindex="-1"></a>      </span>
<span id="cb288-14"><a href="application-choice-bracketing.html#cb288-14" tabindex="-1"></a>      </span>
<span id="cb288-15"><a href="application-choice-bracketing.html#cb288-15" tabindex="-1"></a>      </span>
<span id="cb288-16"><a href="application-choice-bracketing.html#cb288-16" tabindex="-1"></a>      <span class="cf">return</span> log_softmax<span class="op">(</span>U<span class="op">)[</span>y<span class="op">+</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb288-17"><a href="application-choice-bracketing.html#cb288-17" tabindex="-1"></a>      </span>
<span id="cb288-18"><a href="application-choice-bracketing.html#cb288-18" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb288-19"><a href="application-choice-bracketing.html#cb288-19" tabindex="-1"></a>  </span>
<span id="cb288-20"><a href="application-choice-bracketing.html#cb288-20" tabindex="-1"></a>  </span>
<span id="cb288-21"><a href="application-choice-bracketing.html#cb288-21" tabindex="-1"></a>    real ll_2part<span class="op">(</span></span>
<span id="cb288-22"><a href="application-choice-bracketing.html#cb288-22" tabindex="-1"></a>      data matrix payA1<span class="op">,</span> data matrix payB1<span class="op">,</span></span>
<span id="cb288-23"><a href="application-choice-bracketing.html#cb288-23" tabindex="-1"></a>      data matrix payA2<span class="op">,</span> data matrix payB2<span class="op">,</span></span>
<span id="cb288-24"><a href="application-choice-bracketing.html#cb288-24" tabindex="-1"></a>      real alpha<span class="op">,</span> real beta<span class="op">,</span> real lambda<span class="op">,</span></span>
<span id="cb288-25"><a href="application-choice-bracketing.html#cb288-25" tabindex="-1"></a>      data <span class="dt">int</span> y1<span class="op">,</span> data <span class="dt">int</span> y2</span>
<span id="cb288-26"><a href="application-choice-bracketing.html#cb288-26" tabindex="-1"></a>    <span class="op">)</span>  <span class="op">{</span></span>
<span id="cb288-27"><a href="application-choice-bracketing.html#cb288-27" tabindex="-1"></a>      </span>
<span id="cb288-28"><a href="application-choice-bracketing.html#cb288-28" tabindex="-1"></a>      <span class="dt">int</span> dim<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> dims<span class="op">(</span>payA1<span class="op">);</span></span>
<span id="cb288-29"><a href="application-choice-bracketing.html#cb288-29" tabindex="-1"></a>      </span>
<span id="cb288-30"><a href="application-choice-bracketing.html#cb288-30" tabindex="-1"></a>      <span class="co">// utility if DM brackets broadly</span></span>
<span id="cb288-31"><a href="application-choice-bracketing.html#cb288-31" tabindex="-1"></a>      matrix<span class="op">[</span>dim<span class="op">[</span><span class="dv">1</span><span class="op">],</span>dim<span class="op">[</span><span class="dv">2</span><span class="op">]]</span> Ubroad <span class="op">=</span> pow<span class="op">(</span></span>
<span id="cb288-32"><a href="application-choice-bracketing.html#cb288-32" tabindex="-1"></a>        pow<span class="op">(</span>payA1<span class="op">+</span>payA2<span class="op">,</span>beta<span class="op">)+</span>pow<span class="op">(</span>payB1<span class="op">+</span>payB2<span class="op">,</span>beta<span class="op">)</span></span>
<span id="cb288-33"><a href="application-choice-bracketing.html#cb288-33" tabindex="-1"></a>      <span class="op">,</span><span class="fl">1.0</span><span class="op">/</span>beta<span class="op">);</span></span>
<span id="cb288-34"><a href="application-choice-bracketing.html#cb288-34" tabindex="-1"></a>      </span>
<span id="cb288-35"><a href="application-choice-bracketing.html#cb288-35" tabindex="-1"></a>      <span class="co">// utility if DB brackets narrowly</span></span>
<span id="cb288-36"><a href="application-choice-bracketing.html#cb288-36" tabindex="-1"></a>      matrix<span class="op">[</span>dim<span class="op">[</span><span class="dv">1</span><span class="op">],</span>dim<span class="op">[</span><span class="dv">2</span><span class="op">]]</span> Unarrow <span class="op">=</span> </span>
<span id="cb288-37"><a href="application-choice-bracketing.html#cb288-37" tabindex="-1"></a>        pow<span class="op">(</span>pow<span class="op">(</span>payA1<span class="op">,</span>beta<span class="op">)+</span>pow<span class="op">(</span>payB1<span class="op">,</span>beta<span class="op">),</span><span class="fl">1.0</span><span class="op">/</span>beta<span class="op">)</span></span>
<span id="cb288-38"><a href="application-choice-bracketing.html#cb288-38" tabindex="-1"></a>        <span class="op">+</span>pow<span class="op">(</span>pow<span class="op">(</span>payA2<span class="op">,</span>beta<span class="op">)+</span>pow<span class="op">(</span>payB2<span class="op">,</span>beta<span class="op">),</span><span class="fl">1.0</span><span class="op">/</span>beta<span class="op">)</span></span>
<span id="cb288-39"><a href="application-choice-bracketing.html#cb288-39" tabindex="-1"></a>        <span class="op">;</span></span>
<span id="cb288-40"><a href="application-choice-bracketing.html#cb288-40" tabindex="-1"></a>      </span>
<span id="cb288-41"><a href="application-choice-bracketing.html#cb288-41" tabindex="-1"></a>      <span class="co">// partial bracketing utility</span></span>
<span id="cb288-42"><a href="application-choice-bracketing.html#cb288-42" tabindex="-1"></a>      matrix<span class="op">[</span>dim<span class="op">[</span><span class="dv">1</span><span class="op">],</span>dim<span class="op">[</span><span class="dv">2</span><span class="op">]]</span> U <span class="op">=</span> lambda<span class="op">*(</span>alpha<span class="op">*</span>Unarrow<span class="op">+(</span><span class="fl">1.0</span><span class="op">-</span>alpha<span class="op">)*</span>Ubroad<span class="op">);</span></span>
<span id="cb288-43"><a href="application-choice-bracketing.html#cb288-43" tabindex="-1"></a></span>
<span id="cb288-44"><a href="application-choice-bracketing.html#cb288-44" tabindex="-1"></a>      <span class="cf">return</span> U<span class="op">[</span>y1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>y2<span class="op">+</span><span class="dv">1</span><span class="op">]-</span>log_sum_exp<span class="op">(</span>U<span class="op">);</span></span>
<span id="cb288-45"><a href="application-choice-bracketing.html#cb288-45" tabindex="-1"></a>      </span>
<span id="cb288-46"><a href="application-choice-bracketing.html#cb288-46" tabindex="-1"></a>    <span class="op">}</span> </span>
<span id="cb288-47"><a href="application-choice-bracketing.html#cb288-47" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb288-48"><a href="application-choice-bracketing.html#cb288-48" tabindex="-1"></a></span>
<span id="cb288-49"><a href="application-choice-bracketing.html#cb288-49" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb288-50"><a href="application-choice-bracketing.html#cb288-50" tabindex="-1"></a>  <span class="dt">int</span> N<span class="op">;</span> <span class="co">// number of participants</span></span>
<span id="cb288-51"><a href="application-choice-bracketing.html#cb288-51" tabindex="-1"></a>  </span>
<span id="cb288-52"><a href="application-choice-bracketing.html#cb288-52" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_MU<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb288-53"><a href="application-choice-bracketing.html#cb288-53" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_TAU<span class="op">;</span></span>
<span id="cb288-54"><a href="application-choice-bracketing.html#cb288-54" tabindex="-1"></a>  real prior_Omega<span class="op">;</span></span>
<span id="cb288-55"><a href="application-choice-bracketing.html#cb288-55" tabindex="-1"></a>  vector<span class="op">&lt;</span>lower<span class="op">=</span><span class="fl">0.0</span><span class="op">&gt;[</span><span class="dv">2</span><span class="op">]</span> prior_mix<span class="op">;</span></span>
<span id="cb288-56"><a href="application-choice-bracketing.html#cb288-56" tabindex="-1"></a>  </span>
<span id="cb288-57"><a href="application-choice-bracketing.html#cb288-57" tabindex="-1"></a>  <span class="co">// allocations to player A</span></span>
<span id="cb288-58"><a href="application-choice-bracketing.html#cb288-58" tabindex="-1"></a>  <span class="dt">int</span> y1_1<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb288-59"><a href="application-choice-bracketing.html#cb288-59" tabindex="-1"></a>  <span class="dt">int</span> y1_2<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb288-60"><a href="application-choice-bracketing.html#cb288-60" tabindex="-1"></a>  <span class="dt">int</span> y2<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb288-61"><a href="application-choice-bracketing.html#cb288-61" tabindex="-1"></a>  <span class="dt">int</span> y3_1<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb288-62"><a href="application-choice-bracketing.html#cb288-62" tabindex="-1"></a>  <span class="dt">int</span> y3_2<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb288-63"><a href="application-choice-bracketing.html#cb288-63" tabindex="-1"></a>  <span class="dt">int</span> y4<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb288-64"><a href="application-choice-bracketing.html#cb288-64" tabindex="-1"></a>  <span class="dt">int</span> y5<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb288-65"><a href="application-choice-bracketing.html#cb288-65" tabindex="-1"></a>  </span>
<span id="cb288-66"><a href="application-choice-bracketing.html#cb288-66" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb288-67"><a href="application-choice-bracketing.html#cb288-67" tabindex="-1"></a></span>
<span id="cb288-68"><a href="application-choice-bracketing.html#cb288-68" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb288-69"><a href="application-choice-bracketing.html#cb288-69" tabindex="-1"></a>  </span>
<span id="cb288-70"><a href="application-choice-bracketing.html#cb288-70" tabindex="-1"></a>  <span class="co">/* Here I am going to hard-code the experiment parameters and choice sets</span></span>
<span id="cb288-71"><a href="application-choice-bracketing.html#cb288-71" tabindex="-1"></a><span class="co">  This is becuase each decision has different endowments (I), </span></span>
<span id="cb288-72"><a href="application-choice-bracketing.html#cb288-72" tabindex="-1"></a><span class="co">  and so it saves a lot of matrix-creation on the fly in the </span></span>
<span id="cb288-73"><a href="application-choice-bracketing.html#cb288-73" tabindex="-1"></a><span class="co">  model block</span></span>
<span id="cb288-74"><a href="application-choice-bracketing.html#cb288-74" tabindex="-1"></a><span class="co">  */</span></span>
<span id="cb288-75"><a href="application-choice-bracketing.html#cb288-75" tabindex="-1"></a>  </span>
<span id="cb288-76"><a href="application-choice-bracketing.html#cb288-76" tabindex="-1"></a>  <span class="co">// decision 1, 2 parts --------------------</span></span>
<span id="cb288-77"><a href="application-choice-bracketing.html#cb288-77" tabindex="-1"></a>  <span class="dt">int</span> I1_1 <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb288-78"><a href="application-choice-bracketing.html#cb288-78" tabindex="-1"></a>  <span class="dt">int</span> I1_2 <span class="op">=</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb288-79"><a href="application-choice-bracketing.html#cb288-79" tabindex="-1"></a>  real vA1_1 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb288-80"><a href="application-choice-bracketing.html#cb288-80" tabindex="-1"></a>  real vB1_1 <span class="op">=</span> <span class="fl">1.2</span><span class="op">;</span></span>
<span id="cb288-81"><a href="application-choice-bracketing.html#cb288-81" tabindex="-1"></a>  real vA1_2 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb288-82"><a href="application-choice-bracketing.html#cb288-82" tabindex="-1"></a>  real vB1_2 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb288-83"><a href="application-choice-bracketing.html#cb288-83" tabindex="-1"></a>  </span>
<span id="cb288-84"><a href="application-choice-bracketing.html#cb288-84" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X1_1 <span class="op">=</span> rep_matrix<span class="op">(</span>linspaced_vector<span class="op">(</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I1_1<span class="op">),</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb288-85"><a href="application-choice-bracketing.html#cb288-85" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X1_2 <span class="op">=</span> rep_matrix<span class="op">(</span>linspaced_row_vector<span class="op">(</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I1_2<span class="op">),</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb288-86"><a href="application-choice-bracketing.html#cb288-86" tabindex="-1"></a>  </span>
<span id="cb288-87"><a href="application-choice-bracketing.html#cb288-87" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA1_1 <span class="op">=</span> vA1_1<span class="op">*</span>X1_1<span class="op">;</span></span>
<span id="cb288-88"><a href="application-choice-bracketing.html#cb288-88" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB1_1 <span class="op">=</span> vB1_1<span class="op">*(</span>I1_1<span class="op">-</span>X1_1<span class="op">);</span></span>
<span id="cb288-89"><a href="application-choice-bracketing.html#cb288-89" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA1_2 <span class="op">=</span> vA1_2<span class="op">*</span>X1_2<span class="op">;</span></span>
<span id="cb288-90"><a href="application-choice-bracketing.html#cb288-90" tabindex="-1"></a>  matrix<span class="op">[</span>I1_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I1_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB1_2 <span class="op">=</span> vB1_2<span class="op">*(</span>I1_2<span class="op">-</span>X1_2<span class="op">);</span></span>
<span id="cb288-91"><a href="application-choice-bracketing.html#cb288-91" tabindex="-1"></a>  </span>
<span id="cb288-92"><a href="application-choice-bracketing.html#cb288-92" tabindex="-1"></a>  <span class="co">// decision 2, 1 part -------------------</span></span>
<span id="cb288-93"><a href="application-choice-bracketing.html#cb288-93" tabindex="-1"></a>  <span class="dt">int</span> I2 <span class="op">=</span> <span class="dv">14</span><span class="op">;</span></span>
<span id="cb288-94"><a href="application-choice-bracketing.html#cb288-94" tabindex="-1"></a>  real vA2 <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb288-95"><a href="application-choice-bracketing.html#cb288-95" tabindex="-1"></a>  real vB2 <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb288-96"><a href="application-choice-bracketing.html#cb288-96" tabindex="-1"></a>  </span>
<span id="cb288-97"><a href="application-choice-bracketing.html#cb288-97" tabindex="-1"></a>  vector<span class="op">[</span>I2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X2 <span class="op">=</span> linspaced_vector<span class="op">(</span>I2<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I2<span class="op">);</span></span>
<span id="cb288-98"><a href="application-choice-bracketing.html#cb288-98" tabindex="-1"></a>  </span>
<span id="cb288-99"><a href="application-choice-bracketing.html#cb288-99" tabindex="-1"></a>  vector<span class="op">[</span>I2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA2 <span class="op">=</span> vA2<span class="op">*</span>X2<span class="op">;</span></span>
<span id="cb288-100"><a href="application-choice-bracketing.html#cb288-100" tabindex="-1"></a>  vector<span class="op">[</span>I2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB2 <span class="op">=</span> vB2<span class="op">*(</span>I2<span class="op">-</span>X2<span class="op">);</span></span>
<span id="cb288-101"><a href="application-choice-bracketing.html#cb288-101" tabindex="-1"></a>  </span>
<span id="cb288-102"><a href="application-choice-bracketing.html#cb288-102" tabindex="-1"></a>  <span class="co">// decision 3, 2 parts --------------------</span></span>
<span id="cb288-103"><a href="application-choice-bracketing.html#cb288-103" tabindex="-1"></a>  <span class="dt">int</span> I3_1 <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb288-104"><a href="application-choice-bracketing.html#cb288-104" tabindex="-1"></a>  <span class="dt">int</span> I3_2 <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb288-105"><a href="application-choice-bracketing.html#cb288-105" tabindex="-1"></a>  real vA3_1 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb288-106"><a href="application-choice-bracketing.html#cb288-106" tabindex="-1"></a>  real vB3_1 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb288-107"><a href="application-choice-bracketing.html#cb288-107" tabindex="-1"></a>  real vA3_2 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb288-108"><a href="application-choice-bracketing.html#cb288-108" tabindex="-1"></a>  real vB3_2 <span class="op">=</span> <span class="fl">1.2</span><span class="op">;</span></span>
<span id="cb288-109"><a href="application-choice-bracketing.html#cb288-109" tabindex="-1"></a>  </span>
<span id="cb288-110"><a href="application-choice-bracketing.html#cb288-110" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X3_1 <span class="op">=</span> rep_matrix<span class="op">(</span>linspaced_vector<span class="op">(</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I3_1<span class="op">),</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb288-111"><a href="application-choice-bracketing.html#cb288-111" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X3_2 <span class="op">=</span> rep_matrix<span class="op">(</span>linspaced_row_vector<span class="op">(</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I3_2<span class="op">),</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb288-112"><a href="application-choice-bracketing.html#cb288-112" tabindex="-1"></a>  </span>
<span id="cb288-113"><a href="application-choice-bracketing.html#cb288-113" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA3_1 <span class="op">=</span> vA3_1<span class="op">*</span>X3_1<span class="op">;</span></span>
<span id="cb288-114"><a href="application-choice-bracketing.html#cb288-114" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB3_1 <span class="op">=</span> vB3_1<span class="op">*(</span>I3_1<span class="op">-</span>X3_1<span class="op">);</span></span>
<span id="cb288-115"><a href="application-choice-bracketing.html#cb288-115" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA3_2 <span class="op">=</span> vA3_2<span class="op">*</span>X3_2<span class="op">;</span></span>
<span id="cb288-116"><a href="application-choice-bracketing.html#cb288-116" tabindex="-1"></a>  matrix<span class="op">[</span>I3_1<span class="op">+</span><span class="dv">1</span><span class="op">,</span>I3_2<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB3_2 <span class="op">=</span> vB3_2<span class="op">*(</span>I3_2<span class="op">-</span>X3_2<span class="op">);</span></span>
<span id="cb288-117"><a href="application-choice-bracketing.html#cb288-117" tabindex="-1"></a>  </span>
<span id="cb288-118"><a href="application-choice-bracketing.html#cb288-118" tabindex="-1"></a>  <span class="co">// decision 4, 1 part -------------------</span></span>
<span id="cb288-119"><a href="application-choice-bracketing.html#cb288-119" tabindex="-1"></a>  <span class="dt">int</span> I4 <span class="op">=</span> <span class="dv">16</span><span class="op">;</span></span>
<span id="cb288-120"><a href="application-choice-bracketing.html#cb288-120" tabindex="-1"></a>  real vA4 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb288-121"><a href="application-choice-bracketing.html#cb288-121" tabindex="-1"></a>  real vB4 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb288-122"><a href="application-choice-bracketing.html#cb288-122" tabindex="-1"></a>  </span>
<span id="cb288-123"><a href="application-choice-bracketing.html#cb288-123" tabindex="-1"></a>  vector<span class="op">[</span>I4<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X4 <span class="op">=</span> linspaced_vector<span class="op">(</span>I4<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I4<span class="op">);</span></span>
<span id="cb288-124"><a href="application-choice-bracketing.html#cb288-124" tabindex="-1"></a>  </span>
<span id="cb288-125"><a href="application-choice-bracketing.html#cb288-125" tabindex="-1"></a>  vector<span class="op">[</span>I4<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA4 <span class="op">=</span> vA4<span class="op">*</span>X4<span class="op">;</span></span>
<span id="cb288-126"><a href="application-choice-bracketing.html#cb288-126" tabindex="-1"></a>  vector<span class="op">[</span>I4<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB4 <span class="op">=</span> vB4<span class="op">*(</span>I4<span class="op">-</span>X4<span class="op">);</span></span>
<span id="cb288-127"><a href="application-choice-bracketing.html#cb288-127" tabindex="-1"></a>  </span>
<span id="cb288-128"><a href="application-choice-bracketing.html#cb288-128" tabindex="-1"></a>   <span class="co">// decision 5, 1 part -------------------</span></span>
<span id="cb288-129"><a href="application-choice-bracketing.html#cb288-129" tabindex="-1"></a>  <span class="dt">int</span> I5 <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb288-130"><a href="application-choice-bracketing.html#cb288-130" tabindex="-1"></a>  real vA5 <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb288-131"><a href="application-choice-bracketing.html#cb288-131" tabindex="-1"></a>  real vB5 <span class="op">=</span> <span class="fl">1.2</span><span class="op">;</span></span>
<span id="cb288-132"><a href="application-choice-bracketing.html#cb288-132" tabindex="-1"></a>  </span>
<span id="cb288-133"><a href="application-choice-bracketing.html#cb288-133" tabindex="-1"></a>  vector<span class="op">[</span>I5<span class="op">+</span><span class="dv">1</span><span class="op">]</span> X5 <span class="op">=</span> linspaced_vector<span class="op">(</span>I5<span class="op">+</span><span class="dv">1</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> I5<span class="op">);</span></span>
<span id="cb288-134"><a href="application-choice-bracketing.html#cb288-134" tabindex="-1"></a>  </span>
<span id="cb288-135"><a href="application-choice-bracketing.html#cb288-135" tabindex="-1"></a>  vector<span class="op">[</span>I5<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payA5 <span class="op">=</span> vA5<span class="op">*</span>X5<span class="op">;</span></span>
<span id="cb288-136"><a href="application-choice-bracketing.html#cb288-136" tabindex="-1"></a>  vector<span class="op">[</span>I5<span class="op">+</span><span class="dv">1</span><span class="op">]</span> payB5 <span class="op">=</span> vB5<span class="op">*(</span>I5<span class="op">-</span>X5<span class="op">);</span></span>
<span id="cb288-137"><a href="application-choice-bracketing.html#cb288-137" tabindex="-1"></a>  </span>
<span id="cb288-138"><a href="application-choice-bracketing.html#cb288-138" tabindex="-1"></a>  </span>
<span id="cb288-139"><a href="application-choice-bracketing.html#cb288-139" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb288-140"><a href="application-choice-bracketing.html#cb288-140" tabindex="-1"></a></span>
<span id="cb288-141"><a href="application-choice-bracketing.html#cb288-141" tabindex="-1"></a></span>
<span id="cb288-142"><a href="application-choice-bracketing.html#cb288-142" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb288-143"><a href="application-choice-bracketing.html#cb288-143" tabindex="-1"></a>  </span>
<span id="cb288-144"><a href="application-choice-bracketing.html#cb288-144" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> MU<span class="op">;</span></span>
<span id="cb288-145"><a href="application-choice-bracketing.html#cb288-145" tabindex="-1"></a>  vector<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;[</span><span class="dv">2</span><span class="op">]</span> TAU<span class="op">;</span></span>
<span id="cb288-146"><a href="application-choice-bracketing.html#cb288-146" tabindex="-1"></a>  cholesky_factor_corr<span class="op">[</span><span class="dv">2</span><span class="op">]</span> L_Omega<span class="op">;</span></span>
<span id="cb288-147"><a href="application-choice-bracketing.html#cb288-147" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">,</span>upper<span class="op">=</span><span class="dv">1</span><span class="op">&gt;</span> mix_narrow<span class="op">;</span></span>
<span id="cb288-148"><a href="application-choice-bracketing.html#cb288-148" tabindex="-1"></a>  </span>
<span id="cb288-149"><a href="application-choice-bracketing.html#cb288-149" tabindex="-1"></a>  matrix<span class="op">[</span><span class="dv">2</span><span class="op">,</span>N<span class="op">]</span> z<span class="op">;</span></span>
<span id="cb288-150"><a href="application-choice-bracketing.html#cb288-150" tabindex="-1"></a></span>
<span id="cb288-151"><a href="application-choice-bracketing.html#cb288-151" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb288-152"><a href="application-choice-bracketing.html#cb288-152" tabindex="-1"></a></span>
<span id="cb288-153"><a href="application-choice-bracketing.html#cb288-153" tabindex="-1"></a>transformed parameters <span class="op">{</span></span>
<span id="cb288-154"><a href="application-choice-bracketing.html#cb288-154" tabindex="-1"></a>  </span>
<span id="cb288-155"><a href="application-choice-bracketing.html#cb288-155" tabindex="-1"></a>  vector<span class="op">[</span>N<span class="op">]</span> beta<span class="op">;</span></span>
<span id="cb288-156"><a href="application-choice-bracketing.html#cb288-156" tabindex="-1"></a>  vector<span class="op">[</span>N<span class="op">]</span> lambda<span class="op">;</span></span>
<span id="cb288-157"><a href="application-choice-bracketing.html#cb288-157" tabindex="-1"></a>  </span>
<span id="cb288-158"><a href="application-choice-bracketing.html#cb288-158" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">2</span><span class="op">]</span> ll<span class="op">;</span></span>
<span id="cb288-159"><a href="application-choice-bracketing.html#cb288-159" tabindex="-1"></a>  </span>
<span id="cb288-160"><a href="application-choice-bracketing.html#cb288-160" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb288-161"><a href="application-choice-bracketing.html#cb288-161" tabindex="-1"></a>    matrix<span class="op">[</span><span class="dv">2</span><span class="op">,</span>N<span class="op">]</span> theta <span class="op">=</span> rep_matrix<span class="op">(</span>MU<span class="op">,</span>N<span class="op">)</span></span>
<span id="cb288-162"><a href="application-choice-bracketing.html#cb288-162" tabindex="-1"></a>                    <span class="co">//+diag_matrix(TAU)*z;</span></span>
<span id="cb288-163"><a href="application-choice-bracketing.html#cb288-163" tabindex="-1"></a>                    <span class="op">+</span>diag_pre_multiply<span class="op">(</span>TAU<span class="op">,</span>L_Omega<span class="op">)*</span>z<span class="op">;</span></span>
<span id="cb288-164"><a href="application-choice-bracketing.html#cb288-164" tabindex="-1"></a>    </span>
<span id="cb288-165"><a href="application-choice-bracketing.html#cb288-165" tabindex="-1"></a>    beta <span class="op">=</span> exp<span class="op">(</span>theta<span class="op">[</span><span class="dv">1</span><span class="op">,]</span><span class="ch">&#39;)</span><span class="er">;</span></span>
<span id="cb288-166"><a href="application-choice-bracketing.html#cb288-166" tabindex="-1"></a>    lambda <span class="op">=</span> exp<span class="op">(</span>theta<span class="op">[</span><span class="dv">2</span><span class="op">,]</span><span class="ch">&#39;)</span><span class="er">;</span></span>
<span id="cb288-167"><a href="application-choice-bracketing.html#cb288-167" tabindex="-1"></a>    </span>
<span id="cb288-168"><a href="application-choice-bracketing.html#cb288-168" tabindex="-1"></a>    </span>
<span id="cb288-169"><a href="application-choice-bracketing.html#cb288-169" tabindex="-1"></a>    </span>
<span id="cb288-170"><a href="application-choice-bracketing.html#cb288-170" tabindex="-1"></a>    <span class="co">// likelihood computation ----------------------------------------------------------------</span></span>
<span id="cb288-171"><a href="application-choice-bracketing.html#cb288-171" tabindex="-1"></a>  </span>
<span id="cb288-172"><a href="application-choice-bracketing.html#cb288-172" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>N<span class="op">)</span> <span class="op">{</span></span>
<span id="cb288-173"><a href="application-choice-bracketing.html#cb288-173" tabindex="-1"></a>    </span>
<span id="cb288-174"><a href="application-choice-bracketing.html#cb288-174" tabindex="-1"></a>    row_vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> ll_i <span class="op">=</span> <span class="op">[</span>log<span class="op">(</span>mix_narrow<span class="op">),</span>log<span class="op">(</span><span class="fl">1.0</span><span class="op">-</span>mix_narrow<span class="op">)];</span></span>
<span id="cb288-175"><a href="application-choice-bracketing.html#cb288-175" tabindex="-1"></a>    </span>
<span id="cb288-176"><a href="application-choice-bracketing.html#cb288-176" tabindex="-1"></a>    real b <span class="op">=</span> beta<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb288-177"><a href="application-choice-bracketing.html#cb288-177" tabindex="-1"></a>    real l <span class="op">=</span> lambda<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb288-178"><a href="application-choice-bracketing.html#cb288-178" tabindex="-1"></a>    </span>
<span id="cb288-179"><a href="application-choice-bracketing.html#cb288-179" tabindex="-1"></a>    <span class="co">// decision 1, 2 parts, </span></span>
<span id="cb288-180"><a href="application-choice-bracketing.html#cb288-180" tabindex="-1"></a>    <span class="co">//narrow</span></span>
<span id="cb288-181"><a href="application-choice-bracketing.html#cb288-181" tabindex="-1"></a>    ll_i<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">+=</span> ll_2part<span class="op">(</span></span>
<span id="cb288-182"><a href="application-choice-bracketing.html#cb288-182" tabindex="-1"></a>      payA1_1<span class="op">,</span> payB1_1<span class="op">,</span></span>
<span id="cb288-183"><a href="application-choice-bracketing.html#cb288-183" tabindex="-1"></a>      payA1_2<span class="op">,</span> payB1_2<span class="op">,</span></span>
<span id="cb288-184"><a href="application-choice-bracketing.html#cb288-184" tabindex="-1"></a>      <span class="fl">1.0</span><span class="op">,</span>b<span class="op">,</span>l<span class="op">,</span></span>
<span id="cb288-185"><a href="application-choice-bracketing.html#cb288-185" tabindex="-1"></a>      y1_1<span class="op">[</span>ii<span class="op">],</span>y1_2<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb288-186"><a href="application-choice-bracketing.html#cb288-186" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb288-187"><a href="application-choice-bracketing.html#cb288-187" tabindex="-1"></a>    <span class="co">// broad</span></span>
<span id="cb288-188"><a href="application-choice-bracketing.html#cb288-188" tabindex="-1"></a>    ll_i<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">+=</span> ll_2part<span class="op">(</span></span>
<span id="cb288-189"><a href="application-choice-bracketing.html#cb288-189" tabindex="-1"></a>      payA1_1<span class="op">,</span> payB1_1<span class="op">,</span></span>
<span id="cb288-190"><a href="application-choice-bracketing.html#cb288-190" tabindex="-1"></a>      payA1_2<span class="op">,</span> payB1_2<span class="op">,</span></span>
<span id="cb288-191"><a href="application-choice-bracketing.html#cb288-191" tabindex="-1"></a>      <span class="fl">0.0</span><span class="op">,</span>b<span class="op">,</span>l<span class="op">,</span></span>
<span id="cb288-192"><a href="application-choice-bracketing.html#cb288-192" tabindex="-1"></a>      y1_1<span class="op">[</span>ii<span class="op">],</span>y1_2<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb288-193"><a href="application-choice-bracketing.html#cb288-193" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb288-194"><a href="application-choice-bracketing.html#cb288-194" tabindex="-1"></a>    </span>
<span id="cb288-195"><a href="application-choice-bracketing.html#cb288-195" tabindex="-1"></a>    <span class="co">// decision 2, 1 part</span></span>
<span id="cb288-196"><a href="application-choice-bracketing.html#cb288-196" tabindex="-1"></a>    ll_i <span class="op">+=</span> ll_1part<span class="op">(</span></span>
<span id="cb288-197"><a href="application-choice-bracketing.html#cb288-197" tabindex="-1"></a>      payA2<span class="op">,</span> payB2<span class="op">,</span></span>
<span id="cb288-198"><a href="application-choice-bracketing.html#cb288-198" tabindex="-1"></a>      b<span class="op">,</span>l<span class="op">,</span></span>
<span id="cb288-199"><a href="application-choice-bracketing.html#cb288-199" tabindex="-1"></a>      y2<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb288-200"><a href="application-choice-bracketing.html#cb288-200" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb288-201"><a href="application-choice-bracketing.html#cb288-201" tabindex="-1"></a>   </span>
<span id="cb288-202"><a href="application-choice-bracketing.html#cb288-202" tabindex="-1"></a>     <span class="co">// decision 3, 2 parts</span></span>
<span id="cb288-203"><a href="application-choice-bracketing.html#cb288-203" tabindex="-1"></a>     <span class="co">// narrow</span></span>
<span id="cb288-204"><a href="application-choice-bracketing.html#cb288-204" tabindex="-1"></a>     ll_i<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">+=</span> ll_2part<span class="op">(</span></span>
<span id="cb288-205"><a href="application-choice-bracketing.html#cb288-205" tabindex="-1"></a>      payA3_1<span class="op">,</span> payB3_1<span class="op">,</span></span>
<span id="cb288-206"><a href="application-choice-bracketing.html#cb288-206" tabindex="-1"></a>      payA3_2<span class="op">,</span> payB3_2<span class="op">,</span></span>
<span id="cb288-207"><a href="application-choice-bracketing.html#cb288-207" tabindex="-1"></a>      <span class="fl">1.0</span><span class="op">,</span>b<span class="op">,</span>l<span class="op">,</span></span>
<span id="cb288-208"><a href="application-choice-bracketing.html#cb288-208" tabindex="-1"></a>      y3_1<span class="op">[</span>ii<span class="op">],</span>y3_2<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb288-209"><a href="application-choice-bracketing.html#cb288-209" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb288-210"><a href="application-choice-bracketing.html#cb288-210" tabindex="-1"></a>    <span class="co">// broad</span></span>
<span id="cb288-211"><a href="application-choice-bracketing.html#cb288-211" tabindex="-1"></a>     ll_i<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">+=</span> ll_2part<span class="op">(</span></span>
<span id="cb288-212"><a href="application-choice-bracketing.html#cb288-212" tabindex="-1"></a>      payA3_1<span class="op">,</span> payB3_1<span class="op">,</span></span>
<span id="cb288-213"><a href="application-choice-bracketing.html#cb288-213" tabindex="-1"></a>      payA3_2<span class="op">,</span> payB3_2<span class="op">,</span></span>
<span id="cb288-214"><a href="application-choice-bracketing.html#cb288-214" tabindex="-1"></a>      <span class="fl">0.0</span><span class="op">,</span>b<span class="op">,</span>l<span class="op">,</span></span>
<span id="cb288-215"><a href="application-choice-bracketing.html#cb288-215" tabindex="-1"></a>      y3_1<span class="op">[</span>ii<span class="op">],</span>y3_2<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb288-216"><a href="application-choice-bracketing.html#cb288-216" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb288-217"><a href="application-choice-bracketing.html#cb288-217" tabindex="-1"></a>    </span>
<span id="cb288-218"><a href="application-choice-bracketing.html#cb288-218" tabindex="-1"></a>    <span class="co">// decision 4, 1 part</span></span>
<span id="cb288-219"><a href="application-choice-bracketing.html#cb288-219" tabindex="-1"></a>    ll_i <span class="op">+=</span> ll_1part<span class="op">(</span></span>
<span id="cb288-220"><a href="application-choice-bracketing.html#cb288-220" tabindex="-1"></a>      payA4<span class="op">,</span> payB4<span class="op">,</span></span>
<span id="cb288-221"><a href="application-choice-bracketing.html#cb288-221" tabindex="-1"></a>      b<span class="op">,</span>l<span class="op">,</span></span>
<span id="cb288-222"><a href="application-choice-bracketing.html#cb288-222" tabindex="-1"></a>      y4<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb288-223"><a href="application-choice-bracketing.html#cb288-223" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb288-224"><a href="application-choice-bracketing.html#cb288-224" tabindex="-1"></a>    </span>
<span id="cb288-225"><a href="application-choice-bracketing.html#cb288-225" tabindex="-1"></a>    <span class="co">// decision 5, 1 part</span></span>
<span id="cb288-226"><a href="application-choice-bracketing.html#cb288-226" tabindex="-1"></a>    ll_i <span class="op">+=</span> ll_1part<span class="op">(</span></span>
<span id="cb288-227"><a href="application-choice-bracketing.html#cb288-227" tabindex="-1"></a>      payA5<span class="op">,</span> payB5<span class="op">,</span></span>
<span id="cb288-228"><a href="application-choice-bracketing.html#cb288-228" tabindex="-1"></a>      b<span class="op">,</span>l<span class="op">,</span></span>
<span id="cb288-229"><a href="application-choice-bracketing.html#cb288-229" tabindex="-1"></a>      y5<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb288-230"><a href="application-choice-bracketing.html#cb288-230" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb288-231"><a href="application-choice-bracketing.html#cb288-231" tabindex="-1"></a>    </span>
<span id="cb288-232"><a href="application-choice-bracketing.html#cb288-232" tabindex="-1"></a>    ll<span class="op">[</span>ii<span class="op">,]</span> <span class="op">=</span> ll_i<span class="op">;</span></span>
<span id="cb288-233"><a href="application-choice-bracketing.html#cb288-233" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb288-234"><a href="application-choice-bracketing.html#cb288-234" tabindex="-1"></a>    </span>
<span id="cb288-235"><a href="application-choice-bracketing.html#cb288-235" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb288-236"><a href="application-choice-bracketing.html#cb288-236" tabindex="-1"></a>  </span>
<span id="cb288-237"><a href="application-choice-bracketing.html#cb288-237" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb288-238"><a href="application-choice-bracketing.html#cb288-238" tabindex="-1"></a></span>
<span id="cb288-239"><a href="application-choice-bracketing.html#cb288-239" tabindex="-1"></a></span>
<span id="cb288-240"><a href="application-choice-bracketing.html#cb288-240" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb288-241"><a href="application-choice-bracketing.html#cb288-241" tabindex="-1"></a>  </span>
<span id="cb288-242"><a href="application-choice-bracketing.html#cb288-242" tabindex="-1"></a>  <span class="co">// hierarchical structure with noncentered parameterization ------------------</span></span>
<span id="cb288-243"><a href="application-choice-bracketing.html#cb288-243" tabindex="-1"></a>  to_vector<span class="op">(</span>z<span class="op">)</span> <span class="op">~</span> std_normal<span class="op">();</span></span>
<span id="cb288-244"><a href="application-choice-bracketing.html#cb288-244" tabindex="-1"></a>  </span>
<span id="cb288-245"><a href="application-choice-bracketing.html#cb288-245" tabindex="-1"></a>  <span class="co">// priors---------------------------------------------------------------------</span></span>
<span id="cb288-246"><a href="application-choice-bracketing.html#cb288-246" tabindex="-1"></a>  MU <span class="op">~</span> normal<span class="op">(</span>prior_MU<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_MU<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb288-247"><a href="application-choice-bracketing.html#cb288-247" tabindex="-1"></a>  TAU <span class="op">~</span> cauchy<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>prior_TAU<span class="op">);</span></span>
<span id="cb288-248"><a href="application-choice-bracketing.html#cb288-248" tabindex="-1"></a>  L_Omega <span class="op">~</span> lkj_corr_cholesky<span class="op">(</span>prior_Omega<span class="op">);</span></span>
<span id="cb288-249"><a href="application-choice-bracketing.html#cb288-249" tabindex="-1"></a>  mix_narrow <span class="op">~</span> beta<span class="op">(</span>prior_mix<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_mix<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb288-250"><a href="application-choice-bracketing.html#cb288-250" tabindex="-1"></a>  </span>
<span id="cb288-251"><a href="application-choice-bracketing.html#cb288-251" tabindex="-1"></a>  </span>
<span id="cb288-252"><a href="application-choice-bracketing.html#cb288-252" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>N<span class="op">)</span> <span class="op">{</span></span>
<span id="cb288-253"><a href="application-choice-bracketing.html#cb288-253" tabindex="-1"></a>    target<span class="op">+=</span> log_sum_exp<span class="op">(</span>ll<span class="op">[</span>ii<span class="op">,]);</span></span>
<span id="cb288-254"><a href="application-choice-bracketing.html#cb288-254" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb288-255"><a href="application-choice-bracketing.html#cb288-255" tabindex="-1"></a></span>
<span id="cb288-256"><a href="application-choice-bracketing.html#cb288-256" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb288-257"><a href="application-choice-bracketing.html#cb288-257" tabindex="-1"></a></span>
<span id="cb288-258"><a href="application-choice-bracketing.html#cb288-258" tabindex="-1"></a>generated quantities <span class="op">{</span></span>
<span id="cb288-259"><a href="application-choice-bracketing.html#cb288-259" tabindex="-1"></a>  </span>
<span id="cb288-260"><a href="application-choice-bracketing.html#cb288-260" tabindex="-1"></a>  vector<span class="op">[</span>N<span class="op">]</span> postprob_narrow<span class="op">;</span></span>
<span id="cb288-261"><a href="application-choice-bracketing.html#cb288-261" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>N<span class="op">)</span> <span class="op">{</span></span>
<span id="cb288-262"><a href="application-choice-bracketing.html#cb288-262" tabindex="-1"></a>    postprob_narrow<span class="op">[</span>ii<span class="op">]</span> <span class="op">=</span> softmax<span class="op">(</span>ll<span class="op">[</span>ii<span class="op">,]</span><span class="ch">&#39;)</span><span class="er">[1];</span></span>
<span id="cb288-263"><a href="application-choice-bracketing.html#cb288-263" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb288-264"><a href="application-choice-bracketing.html#cb288-264" tabindex="-1"></a>  </span>
<span id="cb288-265"><a href="application-choice-bracketing.html#cb288-265" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="application-choice-bracketing.html#cb289-1" tabindex="-1"></a>d<span class="ot">&lt;-</span><span class="st">&quot;Code/EF2024/social_mixture.csv&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb289-2"><a href="application-choice-bracketing.html#cb289-2" tabindex="-1"></a>  <span class="fu">read.csv</span>() <span class="sc">|&gt;</span></span>
<span id="cb289-3"><a href="application-choice-bracketing.html#cb289-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;postprob&quot;</span>,par))<span class="sc">|&gt;</span></span>
<span id="cb289-4"><a href="application-choice-bracketing.html#cb289-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb289-5"><a href="application-choice-bracketing.html#cb289-5" tabindex="-1"></a>    <span class="at">cumul =</span> <span class="fu">rank</span>(mean)<span class="sc">/</span><span class="fu">n</span>()<span class="sc">-</span><span class="fl">0.5</span><span class="sc">/</span><span class="fu">n</span>()</span>
<span id="cb289-6"><a href="application-choice-bracketing.html#cb289-6" tabindex="-1"></a>  )</span>
<span id="cb289-7"><a href="application-choice-bracketing.html#cb289-7" tabindex="-1"></a></span>
<span id="cb289-8"><a href="application-choice-bracketing.html#cb289-8" tabindex="-1"></a></span>
<span id="cb289-9"><a href="application-choice-bracketing.html#cb289-9" tabindex="-1"></a>(</span>
<span id="cb289-10"><a href="application-choice-bracketing.html#cb289-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(d,<span class="fu">aes</span>(<span class="at">x=</span>mean))</span>
<span id="cb289-11"><a href="application-choice-bracketing.html#cb289-11" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">stat_ecdf</span>()</span>
<span id="cb289-12"><a href="application-choice-bracketing.html#cb289-12" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb289-13"><a href="application-choice-bracketing.html#cb289-13" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> X2.<span class="fl">5.</span>,<span class="at">xmax =</span> X97.<span class="fl">5.</span>, <span class="at">y=</span>cumul),<span class="at">alpha=</span><span class="fl">0.5</span>,<span class="at">color=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb289-14"><a href="application-choice-bracketing.html#cb289-14" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb289-15"><a href="application-choice-bracketing.html#cb289-15" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="fu">expression</span>(alpha<span class="sc">~</span><span class="st">&quot;(extent of narrow bracketing)&quot;</span>))</span>
<span id="cb289-16"><a href="application-choice-bracketing.html#cb289-16" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;posterior probability of bracketing narrowly&quot;</span>)</span>
<span id="cb289-17"><a href="application-choice-bracketing.html#cb289-17" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/EF2024-postprob-1.png" width="672" /></p>
</div>
<div id="what-do-we-get-out-of-the-structural-models-and-what-could-we-miss" class="section level2 hasAnchor" number="22.5">
<h2><span class="header-section-number">22.5</span> What do we get out of the structural models, and what could we miss?<a href="application-choice-bracketing.html#what-do-we-get-out-of-the-structural-models-and-what-could-we-miss" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>I have analyzed these data in a <em>really</em> different way to <span class="citation">Ellis and Freeman (<a href="#ref-EF2024">2024</a>)</span>. There is no “Bayesian alternative to a maximum likelihood implementation” for me to do here like I can do for (say) strategy frequency estimation or structurally estimating risk preferences. <span class="citation">Ellis and Freeman (<a href="#ref-EF2024">2024</a>)</span> use nonparametric measures of mistakes to classify participants based on the number of mistakes they make relative to (say) Weak Axiom of Revealed Preference (WARP) predictions. Loosely speaking, this kind of analysis can put participants into <em>three</em> bins: (i) narrow bracketing, (ii) broad bracketing, and (iii) something else. This “something else” bin is <em>really</em> important, because it could be that participants are doing something other than narrowly or broadly bracketing. Ignoring this bin means that we will mis-classify these “something else” participants into one of the bracketing bins. This mis-classification may not be random, and so the resulting fractions may over- or under-state the prevalence of each bracketing behavior in the sample.</p>
<p>On the other hand, my approach forces every participant to be a partial bracketer (with different extents of bracketing, <span class="math inline">\(\alpha\)</span>), or in the case of the mixture model, forces everybody to be either a broad or narrow bracketer. Out of this we get an easily interpretable measure of bracketing behavior for each participant, but we cannot say anything about the “something else”. This is not to say that we couldn’t also include something else in the structural model, but it would have to be a <em>specific</em> “something else” in the form of another parametric model.</p>
<!--

# OLD STUFF BELOW HERE


## Data and model

For this chapter, I will be using the risky choice data from @EF2024. In this experiment, participants made five allocation decisions of an endowment between risky assets. The payoff from all assets were determined by a single die roll: there was one payoff if the die roll was a 1, 2, or 3, and another payoff if it was a 4, 5, or 6. Three of the five decisions just involved allocating one endowment between two assets. However the remaining two decisions each had two "parts", played simultaneously. That is, in each part of these decisions had participants allocating an endowment between two assets (so there were four assets in total for these decisions), and the payoff for these decisions was the earnings from all four assets. 

In the decisions with just one part, bracketing plays no role, because there is no aspect of the decision-making process that participants can bracket over. However in the two-part decisions, it may be natural for some participants to think about each part separately, thus ignoring that payoffs from both decisions will be added together. 

While @EF2024 analyze their data based on measures of optimality in convex budget set problems, I will instead take a structural model to the data and estimate the extent of narrow bracketing for each participant. Specifically, I will assume CRRA expected utility maximization, except that participants may partially bracket their decisions. 

To see how this works, let $I_{AB}$ be the endowment that a participant has to allocate between assets $A$ and $B$, and $I_{CD}$ be the endowment that they can allocate between assets $C$ and $D$. Asset $a\in\{A,B,C,D\}$ pays out $p_a^{123}$ if the die roll is a 1, 2, or 3, and pays out $p_a^{456}$ otherwise. The utility-maximization problem for a decision with a single part (so there are only assets $A$ and $B$) is:

$$
\begin{aligned}
\max_{x_A\in\{0,1,2,\ldots,I_{AB}\}} 0.5u\left(p_A^{123}x_A+p_B^{123}(I_{AB}-x_A)\right)+0.5u\left(p_A^{456}x_A+p_B^{456}(I_{AB}-x_A)\right)
\end{aligned}
$$

For a decision with two parts, we now have two allocations to make: (1) allocate $I_{AB}$ between assets $A$ and $B$, and (2) allocate $I_{CD}$ between assets $C$ and $D$. A *narrow* bracketer will see  these as two isolated decision problems:

$$
\begin{aligned}
(1)\quad \max_{x_A\in\{0,1,2,\ldots,I_{AB}\}}& 0.5u\left(p_A^{123}x_A+p_B^{123}(I_{AB}-x_A)\right)+0.5u\left(p_A^{456}x_A+p_B^{456}(I_{AB}-x_A)\right)\\
(2)\quad \max_{x_C\in\{0,1,2,\ldots,I_{CD}\}}& 0.5u\left(p_C^{123}x_C+p_D^{123}(I_{CD}-x_C)\right)+0.5u\left(p_C^{456}x_C+p_D^{456}(I_{CD}-x_C)\right)
\end{aligned}
$$

which is equivalent to the following joint maximization problem:

$$
\begin{aligned}
\max_{ x_A\in\{0,1,2,\ldots,I_{AB}\}\\ x_C\in\{0,1,2,\ldots,I_{CD}\}}0.5u\left(p_A^{123}x_A+p_B^{123}(I_{AB}-x_A)\right)+0.5u\left(p_A^{456}x_A+p_B^{456}(I_{AB}-x_A)\right)+0.5u\left(p_C^{123}x_C+p_D^{123}(I_{CD}-x_C)\right)+0.5u\left(p_C^{456}x_C+p_D^{456}(I_{CD}-x_C)\right)
\end{aligned}
$$

For ease of notation, I will let the maximand here be $U_\text{narrow}(x_A,x_C)$. 

On the other hand, a participant who brackets broadly recognizes that payoffs from each part will be added together, and so their maximization problem is:

$$
\begin{aligned}
\max_{ x_A\in\{0,1,2,\ldots,I_{AB}\}\\ x_C\in\{0,1,2,\ldots,I_{CD}\}}
0.5u\left(p_A^{123}x_A+p_B^{123}(I_{AB}-x_A)+p_C^{123}x_C+p_D^{123}(I_{CD}-x_C)\right)+0.5u\left(p_A^{456}x_A+p_B^{456}(I_{AB}-x_A)+p_C^{456}x_C+p_D^{456}(I_{CD}-x_C)\right)
\end{aligned}
$$
As this is also somewhat of a mouthful, I will denote this maximand $U_\text{broad}(x_A,x_C)$.

Following @EF2024, we can now  introduce the *partial bracketing* model, which nests both broad and narrow as its endpoints:

$$
\begin{aligned}
\max_{ x_A\in\{0,1,2,\ldots,I_{AB}\}\\ x_C\in\{0,1,2,\ldots,I_{CD}\}} \alpha  U_\text{narrow}(x_A,x_C)+(1-\alpha)U_\text{broad}(x_A,x_C)
\end{aligned}
$$
 where $\alpha\in[0,1]$ is the extent of narrow bracketing. That is, a participant narrowly brackets when $\alpha=1$, and broadly brackets when $\alpha =0$. 
 
 
## Representative agent model


``` c

data {
  
  int N; // number of rows in data
  
  // endowments
  int I_AB[N];
  int I_CD[N];
  
  // allocations made
  int alloc_A[N];
  int alloc_C[N];
  
  // prizes for each asset, in {123,456} form
  vector[2] pA[N];
  vector[2] pB[N];
  vector[2] pC[N];
  vector[2] pD[N];
  
  vector[2] prior_r;
  vector[2] prior_lambda;
  vector[2] prior_alpha;

}

parameters {
  
  real<lower=0> r; // risk aversion
  real<lower=0> lambda; // choice precision
  real<lower=0,upper=1> alpha; // extent of narrow bracketing.

}

model {
  
  // Priors --------------------------------------------------------------------
  r ~ lognormal(prior_r[1],prior_r[2]);
  lambda ~ lognormal(prior_lambda[1],prior_lambda[2]);
  alpha ~ beta(prior_alpha[1],prior_alpha[2]);
  
  // Likelihood computation ----------------------------------------------------
  
  for (ii in 1:N) {
    
    if (I_CD[ii]>0) {
      // case where there are 2 parts to a decision
      
      int i_AB = I_AB[ii];
      int i_CD = I_CD[ii];
      
      // choice sets of individual parts
      vector[i_AB+1] choiceset_AB = linspaced_vector(i_AB+1, 0, i_AB); 
      row_vector[i_CD+1] choiceset_CD = linspaced_row_vector(i_CD+1, 0, i_CD); 
      
      // payoffs for each part
      // note that I am using the convention that the AB assets go across rows, 
      // and the CD assets go across columns
      vector[i_AB+1] pay123AB = pA[ii][1]*choiceset_AB+pB[ii][1]*(i_AB-choiceset_AB);
      vector[i_AB+1] pay456AB = pA[ii][2]*choiceset_AB+pB[ii][2]*(i_AB-choiceset_AB);
      row_vector[i_CD+1] pay123CD = pC[ii][1]*choiceset_CD+pD[ii][1]*(i_CD-choiceset_CD);
      row_vector[i_CD+1] pay456CD = pC[ii][2]*choiceset_CD+pD[ii][2]*(i_CD-choiceset_CD);
      
      // broad bracketing payoffs
      matrix[i_AB+1,i_CD+1] broad_pay123 = rep_matrix(pay123AB,i_CD+1)+rep_matrix(pay123CD,i_AB+1);
      matrix[i_AB+1,i_CD+1] broad_pay456 = rep_matrix(pay456AB,i_CD+1)+rep_matrix(pay456CD,i_AB+1);
      // broad bracketing utilities
      matrix[i_AB+1,i_CD+1] Ubroad = 0.5*pow(broad_pay123,r)+0.5*pow(broad_pay456,r);
      
      // narrow bracketing utilities
      vector[i_AB+1] unarrowAB = 0.5*pow(pay123AB,r)+0.5*pow(pay456AB,r);
      row_vector[i_CD+1] unarrowCD = 0.5*pow(pay123CD,r)+0.5*pow(pay456CD,r);
      matrix[i_AB+1,i_CD+1] Unarrow = rep_matrix(unarrowAB,i_CD+1)+rep_matrix(unarrowCD,i_AB+1);
      
      // partial bracketing utility
      matrix[i_AB+1,i_CD+1] Upartial = alpha*Unarrow+(1.0-alpha)*Ubroad;
      // contextual utility normalization
      Upartial = lambda*Upartial/(max(Upartial)-min(Upartial));
      
      // increment the likelihood
      matrix[i_AB+1,i_CD+1] log_softmax_U = Upartial - log_sum_exp(Upartial);
      target += log_softmax_U[alloc_A[ii]+1,alloc_C[ii]+1];
      
      
    } else {
      // case where there is one part to a decision
       int i_AB = I_AB[ii];
       
       // the choice set (defined as allocaction to asset A)
       vector[i_AB+1] choiceset = linspaced_vector(i_AB+1, 0, i_AB);
       
       vector[i_AB+1] pay123 = pA[ii][1]*choiceset+pB[ii][1]*(i_AB-choiceset);
       vector[i_AB+1] pay456 = pA[ii][2]*choiceset+pB[ii][2]*(i_AB-choiceset);
       
       // utility of each allocation in choice set
       vector[i_AB+1] U = 0.5*pow(pay123,r)+0.5*pow(pay456,r);
       
       // contextual utility normalization
       U = U/(max(U)-min(U));
       
       // increment the likelihood
       target += log_softmax(lambda*U)[alloc_A[ii]+1];
      
    }
    
  }

}

```




``` r
"Code/EF2024/risk_repagent.csv" |>
  read.csv() |>
  rename(parameter=X) |>
  kbl(digits=3,caption = "Summary of the posterior distribution from the representative agent model.") |>
  kable_classic(full_width=FALSE)
```

<table class=" lightable-classic" style='color: black; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; width: auto !important; margin-left: auto; margin-right: auto;'>
<caption>(\#tab:EF2024-risk-repagent)Summary of the posterior distribution from the representative agent model.</caption>
 <thead>
  <tr>
   <th style="text-align:left;"> parameter </th>
   <th style="text-align:right;"> mean </th>
   <th style="text-align:right;"> se_mean </th>
   <th style="text-align:right;"> sd </th>
   <th style="text-align:right;"> X2.5. </th>
   <th style="text-align:right;"> X25. </th>
   <th style="text-align:right;"> X50. </th>
   <th style="text-align:right;"> X75. </th>
   <th style="text-align:right;"> X97.5. </th>
   <th style="text-align:right;"> n_eff </th>
   <th style="text-align:right;"> Rhat </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> r </td>
   <td style="text-align:right;"> 0.811 </td>
   <td style="text-align:right;"> 0.000 </td>
   <td style="text-align:right;"> 0.011 </td>
   <td style="text-align:right;"> 0.787 </td>
   <td style="text-align:right;"> 0.803 </td>
   <td style="text-align:right;"> 0.811 </td>
   <td style="text-align:right;"> 0.819 </td>
   <td style="text-align:right;"> 0.831 </td>
   <td style="text-align:right;"> 2563.333 </td>
   <td style="text-align:right;"> 1.001 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> lambda </td>
   <td style="text-align:right;"> 8.549 </td>
   <td style="text-align:right;"> 0.011 </td>
   <td style="text-align:right;"> 0.567 </td>
   <td style="text-align:right;"> 7.492 </td>
   <td style="text-align:right;"> 8.149 </td>
   <td style="text-align:right;"> 8.527 </td>
   <td style="text-align:right;"> 8.927 </td>
   <td style="text-align:right;"> 9.727 </td>
   <td style="text-align:right;"> 2595.676 </td>
   <td style="text-align:right;"> 1.000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> alpha </td>
   <td style="text-align:right;"> 0.916 </td>
   <td style="text-align:right;"> 0.001 </td>
   <td style="text-align:right;"> 0.064 </td>
   <td style="text-align:right;"> 0.761 </td>
   <td style="text-align:right;"> 0.877 </td>
   <td style="text-align:right;"> 0.929 </td>
   <td style="text-align:right;"> 0.968 </td>
   <td style="text-align:right;"> 0.997 </td>
   <td style="text-align:right;"> 2708.411 </td>
   <td style="text-align:right;"> 1.000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> lp__ </td>
   <td style="text-align:right;"> -1504.638 </td>
   <td style="text-align:right;"> 0.032 </td>
   <td style="text-align:right;"> 1.237 </td>
   <td style="text-align:right;"> -1507.744 </td>
   <td style="text-align:right;"> -1505.239 </td>
   <td style="text-align:right;"> -1504.337 </td>
   <td style="text-align:right;"> -1503.716 </td>
   <td style="text-align:right;"> -1503.162 </td>
   <td style="text-align:right;"> 1508.064 </td>
   <td style="text-align:right;"> 1.001 </td>
  </tr>
</tbody>
</table>

-->
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Barberis2009" class="csl-entry">
Barberis, Nicholas, and Ming Huang. 2009. <span>“Preferences with Frames: A New Utility Specification That Allows for the Framing of Risks.”</span> <em>Journal of Economic Dynamics and Control</em> 33 (8): 1555–76.
</div>
<div id="ref-Barberis2006" class="csl-entry">
Barberis, Nicholas, Ming Huang, and Richard H Thaler. 2006. <span>“Individual Preferences, Monetary Gambles, and Stock Market Participation: A Case for Narrow Framing.”</span> <em>American Economic Review</em> 96 (4): 1069–90.
</div>
<div id="ref-Bland2019JMP" class="csl-entry">
Bland, James R. 2019a. <span>“How Many Games Are We Playing? An Experimental Analysis of Choice Bracketing in Games.”</span> <em>Journal of Behavioral and Experimental Economics</em> 80: 80–91. <a href="https://doi.org/10.1016/j.socec.2019.03.011">https://doi.org/10.1016/j.socec.2019.03.011</a>.
</div>
<div id="ref-Bland2019" class="csl-entry">
———. 2019b. <span>“Measuring and Comparing Two Kinds of Rationalizable Opportunity Cost in Mixture Models.”</span> <em>Games</em> 11 (1): 1.
</div>
<div id="ref-EF2024" class="csl-entry">
Ellis, Andrew, and David J. Freeman. 2024. <span>“Revealing Choice Bracketing.”</span> <em>American Economic Review</em> 114 (9): 2668–2700. <a href="https://doi.org/10.1257/aer.20210877">https://doi.org/10.1257/aer.20210877</a>.
</div>
<div id="ref-Rabin2009" class="csl-entry">
Rabin, Matthew, and Georg Weizsäcker. 2009. <span>“Narrow Bracketing and Dominated Choices.”</span> <em>The American Economic Review</em> 99 (4): 1508–43.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="99">
<li id="fn99"><p>While I was on the job market, after giving this analogy, a former professor of mine interrupted my talk to very loudly proclaim: “James, red wine is <em>never</em> a mistake!” Another former professor later volunteered that while he was on the job market, he ended up ordering fish and Coca-Cola, which for him turned out to be a particularly bad pairing.<a href="application-choice-bracketing.html#fnref99" class="footnote-back">↩︎</a></p></li>
<li id="fn100"><p>The model would <em>never</em> estimate that a participant either fully brackets broadly (<span class="math inline">\(\alpha=0\)</span>) or fully brackets narrowly (<span class="math inline">\(\alpha =1\)</span>). This is becuase prior weight is placed on the interior of the unit interval.<a href="application-choice-bracketing.html#fnref100" class="footnote-back">↩︎</a></p></li>
<li id="fn101"><p>Read: “Today I am too lazy to make a few plots to help my intuition here.”<a href="application-choice-bracketing.html#fnref101" class="footnote-back">↩︎</a></p></li>
<li id="fn102"><p>It is not that the other three decisions provided us with nothing. They help pin down <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\lambda\)</span> so that less uncertainty in these variables propogates into uncertainty in <span class="math inline">\(\alpha\)</span>.<a href="application-choice-bracketing.html#fnref102" class="footnote-back">↩︎</a></p></li>
<li id="fn103"><p>If instead we wanted to (say) assign a welfare measure to narrow bracketing (e.g. “how much utility does someone give up by bracketing narrowly?”) then these might not be nuisance parameters. See <span class="citation">Bland (<a href="#ref-Bland2019JMP">2019a</a>)</span> and <span class="citation">Bland (<a href="#ref-Bland2019">2019b</a>)</span> for examples of this.<a href="application-choice-bracketing.html#fnref103" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="application-meta-analysis-using-some-of-the-metaret-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="application-ranked-choices-and-the-thurstonian-model.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": false,
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

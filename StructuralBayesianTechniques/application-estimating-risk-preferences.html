<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>19 Application: Estimating risk preferences | Structural Bayesian Techniques for Experimental and Behavioral Economics</title>
  <meta name="description" content="19 Application: Estimating risk preferences | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="19 Application: Estimating risk preferences | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="19 Application: Estimating risk preferences | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  
  
  

<meta name="author" content="James R. Bland" />


<meta name="date" content="2025-12-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="application-level-k-models.html"/>
<link rel="next" href="application-meta-analysis-using-some-of-the-metaret-data.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="section.html#section" id="toc-section"></a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="setting-the-stage.html"><a href="setting-the-stage.html"><i class="fa fa-check"></i>Setting the stage</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-does-your-theory-say-about-your-data"><i class="fa fa-check"></i><b>1.1</b> What does your theory say about your data?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-do-your-data-say-about-your-theory"><i class="fa fa-check"></i><b>1.2</b> What do your data say about your theory?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-do-your-parameters-say-about-other-things"><i class="fa fa-check"></i><b>1.3</b> What do your parameters say about other things?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-does-your-expertise-say-about-your-parameters"><i class="fa fa-check"></i><b>1.4</b> What does your expertise say about your parameters?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html"><i class="fa fa-check"></i><b>2</b> Getting started in <em>Stan</em></a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#installation-in-r"><i class="fa fa-check"></i><b>2.1</b> Installation in <em>R</em></a></li>
<li class="chapter" data-level="2.2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#the-anatomy-of-a-stan-program"><i class="fa fa-check"></i><b>2.2</b> The anatomy of a <em>Stan</em> program</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#data-block"><i class="fa fa-check"></i><b>2.2.1</b> Data block</a></li>
<li class="chapter" data-level="2.2.2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#transformed-data-block"><i class="fa fa-check"></i><b>2.2.2</b> Transformed data block</a></li>
<li class="chapter" data-level="2.2.3" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#parameters-block"><i class="fa fa-check"></i><b>2.2.3</b> Parameters block</a></li>
<li class="chapter" data-level="2.2.4" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#model-block"><i class="fa fa-check"></i><b>2.2.4</b> Model block</a></li>
<li class="chapter" data-level="2.2.5" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#generated-quantities-block"><i class="fa fa-check"></i><b>2.2.5</b> Generated quantities block</a></li>
<li class="chapter" data-level="2.2.6" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#the-final-product"><i class="fa fa-check"></i><b>2.2.6</b> The final product</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#estimating-a-model"><i class="fa fa-check"></i><b>2.3</b> Estimating a model</a></li>
<li class="chapter" data-level="2.4" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#looking-at-the-results"><i class="fa fa-check"></i><b>2.4</b> Looking at the results</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html"><i class="fa fa-check"></i><b>3</b> Probabilistic models of behavior</a>
<ul>
<li class="chapter" data-level="3.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#the-problem-with-deterministic-models"><i class="fa fa-check"></i><b>3.1</b> The problem with deterministic models</a></li>
<li class="chapter" data-level="3.2" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#what-is-a-probabilistic-model"><i class="fa fa-check"></i><b>3.2</b> What <em>is</em> a probabilistic model?</a></li>
<li class="chapter" data-level="3.3" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#example-dataset-and-model"><i class="fa fa-check"></i><b>3.3</b> Example dataset and model</a></li>
<li class="chapter" data-level="3.4" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#optimal-choice-plus-an-error"><i class="fa fa-check"></i><b>3.4</b> Optimal choice plus an error</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#estimating-a-model-1"><i class="fa fa-check"></i><b>3.4.1</b> Estimating a model</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#utility-based-models"><i class="fa fa-check"></i><b>3.5</b> Utility-based models</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#estimating-a-model-2"><i class="fa fa-check"></i><b>3.5.1</b> Estimating a model</a></li>
<li class="chapter" data-level="3.5.2" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#doing-something-with-the-estimates"><i class="fa fa-check"></i><b>3.5.2</b> Doing something with the estimates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html"><i class="fa fa-check"></i><b>4</b> Considerations for choosing a prior</a>
<ul>
<li class="chapter" data-level="4.1" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#example-model-and-experiment"><i class="fa fa-check"></i><b>4.1</b> Example model and experiment</a></li>
<li class="chapter" data-level="4.2" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#getting-the-support-right"><i class="fa fa-check"></i><b>4.2</b> Getting the support right</a></li>
<li class="chapter" data-level="4.3" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#eliciting-reasonable-priors"><i class="fa fa-check"></i><b>4.3</b> Eliciting reasonable priors</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#parameter-values-and-the-prior-pushforward-check"><i class="fa fa-check"></i><b>4.3.1</b> Parameter values and the prior pushforward check</a></li>
<li class="chapter" data-level="4.3.2" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#predictions-and-other-derived-quantities-the-prior-predictive-check"><i class="fa fa-check"></i><b>4.3.2</b> Predictions and other derived quantities: The prior predictive check</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#assessing-the-sampling-performance-of-a-prior"><i class="fa fa-check"></i><b>4.4</b> Assessing the sampling performance of a prior</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#does-our-model-recover-its-parameters-well"><i class="fa fa-check"></i><b>4.4.1</b> Does our model recover its parameters well?</a></li>
<li class="chapter" data-level="4.4.2" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#do-we-see-any-pathologies-in-the-estimation-process"><i class="fa fa-check"></i><b>4.4.2</b> Do we see any pathologies in the estimation process?</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#r-code-used-for-this-chapter"><i class="fa fa-check"></i><b>4.5</b> <em>R</em> code used for this chapter</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="building-blocks.html"><a href="building-blocks.html"><i class="fa fa-check"></i>Building blocks</a></li>
<li class="chapter" data-level="5" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html"><i class="fa fa-check"></i><b>5</b> Representative agent and participant-specific models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#participant-specific-models"><i class="fa fa-check"></i><b>5.1</b> Participant-specific models</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#example-data-and-economic-model"><i class="fa fa-check"></i><b>5.1.1</b> Example data and economic model</a></li>
<li class="chapter" data-level="5.1.2" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#going-to-the-probabilistic-model"><i class="fa fa-check"></i><b>5.1.2</b> Going to the probabilistic model</a></li>
<li class="chapter" data-level="5.1.3" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#a-short-side-quest-into-canned-estimation-techniques"><i class="fa fa-check"></i><b>5.1.3</b> A short side quest into canned estimation techniques</a></li>
<li class="chapter" data-level="5.1.4" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#assigning-priors"><i class="fa fa-check"></i><b>5.1.4</b> Assigning priors</a></li>
<li class="chapter" data-level="5.1.5" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#estimating-the-model-for-one-participant"><i class="fa fa-check"></i><b>5.1.5</b> Estimating the model for one participant</a></li>
<li class="chapter" data-level="5.1.6" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#estimating-the-model-for-all-participants"><i class="fa fa-check"></i><b>5.1.6</b> Estimating the model for all participants</a></li>
<li class="chapter" data-level="5.1.7" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#but-we-could-be-learning-more"><i class="fa fa-check"></i><b>5.1.7</b> But we could be learning more!</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#actual-representative-agent-models-pooled-models"><i class="fa fa-check"></i><b>5.2</b> Actual representative agent models (pooled models)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="hierarchical-models.html"><a href="hierarchical-models.html"><i class="fa fa-check"></i><b>6</b> Hierarchical models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-random-sample-of-participants-walks-into-your-lab"><i class="fa fa-check"></i><b>6.1</b> A random sample of participants walks into your lab</a></li>
<li class="chapter" data-level="6.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#the-anatomy-of-a-basic-hierarchical-model"><i class="fa fa-check"></i><b>6.2</b> The anatomy of a basic hierarchical model</a></li>
<li class="chapter" data-level="6.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#accounting-for-unobserved-heterogeneity"><i class="fa fa-check"></i><b>6.3</b> Accounting for unobserved heterogeneity</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#the-last-time-you-will-integrate-the-likelihood-probably"><i class="fa fa-check"></i><b>6.3.1</b> The last time you will integrate the likelihood, probably</a></li>
<li class="chapter" data-level="6.3.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#data-augmentation"><i class="fa fa-check"></i><b>6.3.2</b> Data augmentation</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-multivariate-normal-hierarchical-model"><i class="fa fa-check"></i><b>6.4</b> A multivariate normal hierarchical model</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#decomposing-the-variance-covariance-matrix"><i class="fa fa-check"></i><b>6.4.1</b> Decomposing the variance-covariance matrix</a></li>
<li class="chapter" data-level="6.4.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#transformed-parameters-and-normal-distributions"><i class="fa fa-check"></i><b>6.4.2</b> Transformed parameters and normal distributions</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-again-with-bfs2019"><i class="fa fa-check"></i><b>6.5</b> Example: again with <span class="citation">Bruhin, Fehr, and Schunk (2019)</span></a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#no-correlation-between-individual-level-parameters"><i class="fa fa-check"></i><b>6.5.1</b> No correlation between individual-level parameters</a></li>
<li class="chapter" data-level="6.5.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#correlation-between-individual-level-parameters"><i class="fa fa-check"></i><b>6.5.2</b> Correlation between individual-level parameters</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="mixture-models.html"><a href="mixture-models.html"><i class="fa fa-check"></i><b>7</b> Mixture models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="mixture-models.html"><a href="mixture-models.html#a-menu-of-models"><i class="fa fa-check"></i><b>7.1</b> A menu of models</a></li>
<li class="chapter" data-level="7.2" data-path="mixture-models.html"><a href="mixture-models.html#dichotomous-and-toolbox-mixture-models"><i class="fa fa-check"></i><b>7.2</b> Dichotomous and toolbox mixture models</a></li>
<li class="chapter" data-level="7.3" data-path="mixture-models.html"><a href="mixture-models.html#coding-peculearities"><i class="fa fa-check"></i><b>7.3</b> Coding peculearities</a></li>
<li class="chapter" data-level="7.4" data-path="mixture-models.html"><a href="mixture-models.html#example-experiment-av2001"><i class="fa fa-check"></i><b>7.4</b> Example experiment: <span class="citation">Andreoni and Vesterlund (2001)</span></a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="mixture-models.html"><a href="mixture-models.html#as-basic-as-it-gets"><i class="fa fa-check"></i><b>7.4.1</b> As basic as it gets</a></li>
<li class="chapter" data-level="7.4.2" data-path="mixture-models.html"><a href="mixture-models.html#adding-some-heterogeneity"><i class="fa fa-check"></i><b>7.4.2</b> Adding some heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="mixture-models.html"><a href="mixture-models.html#some-code-used-to-estimate-the-models"><i class="fa fa-check"></i><b>7.5</b> Some code used to estimate the models</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html"><i class="fa fa-check"></i><b>8</b> Filling in the blanks: Imputation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#example-model-and-dataset-yet-again-with-bfs2019"><i class="fa fa-check"></i><b>8.1</b> Example model and dataset: yet again with <span class="citation">Bruhin, Fehr, and Schunk (2019)</span></a></li>
<li class="chapter" data-level="8.2" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#how-is-this-going-to-work"><i class="fa fa-check"></i><b>8.2</b> How is this going to work?</a></li>
<li class="chapter" data-level="8.3" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#implementation"><i class="fa fa-check"></i><b>8.3</b> Implementation</a></li>
<li class="chapter" data-level="8.4" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#results"><i class="fa fa-check"></i><b>8.4</b> Results</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#using-the-correlation-matrix"><i class="fa fa-check"></i><b>8.4.1</b> Using the correlation matrix</a></li>
<li class="chapter" data-level="8.4.2" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#the-correlation-matrix-is-doing-a-lot-of-heavy-lifting-here"><i class="fa fa-check"></i><b>8.4.2</b> The correlation matrix is doing a lot of heavy lifting here</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#conclusion"><i class="fa fa-check"></i><b>8.5</b> Conclusion</a></li>
<li class="chapter" data-level="8.6" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#r-code-used-for-this-chapter-1"><i class="fa fa-check"></i><b>8.6</b> <em>R</em> code used for this chapter</a></li>
<li class="chapter" data-level="" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#acknowedgements"><i class="fa fa-check"></i>Acknowedgements</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="model-evaluation.html"><a href="model-evaluation.html"><i class="fa fa-check"></i><b>9</b> Model evaluation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="model-evaluation.html"><a href="model-evaluation.html#example-dataset-and-models"><i class="fa fa-check"></i><b>9.1</b> Example dataset and models</a></li>
<li class="chapter" data-level="9.2" data-path="model-evaluation.html"><a href="model-evaluation.html#model-posterior-probabilities"><i class="fa fa-check"></i><b>9.2</b> Model posterior probabilities</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="model-evaluation.html"><a href="model-evaluation.html#implementation-using-bridge-sampling-and-the-bridgesampling-library"><i class="fa fa-check"></i><b>9.2.1</b> Implementation using bridge sampling and the <code>bridgesampling</code> library</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="model-evaluation.html"><a href="model-evaluation.html#cross-validation"><i class="fa fa-check"></i><b>9.3</b> Cross-validation</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="model-evaluation.html"><a href="model-evaluation.html#expected-log-predicted-density-elpd-and-other-measures-of-goodness-of-fit"><i class="fa fa-check"></i><b>9.3.1</b> Expected Log Predicted Density (ELPD) and other measures of goodness of fit</a></li>
<li class="chapter" data-level="9.3.2" data-path="model-evaluation.html"><a href="model-evaluation.html#round-cross-validation"><i class="fa fa-check"></i><b>9.3.2</b> 1-round cross-validation</a></li>
<li class="chapter" data-level="9.3.3" data-path="model-evaluation.html"><a href="model-evaluation.html#leave-one-out-cross-validation-loo"><i class="fa fa-check"></i><b>9.3.3</b> Leave-one-out cross-validation (LOO)</a></li>
<li class="chapter" data-level="9.3.4" data-path="model-evaluation.html"><a href="model-evaluation.html#approximate-loo"><i class="fa fa-check"></i><b>9.3.4</b> Approximate LOO</a></li>
<li class="chapter" data-level="9.3.5" data-path="model-evaluation.html"><a href="model-evaluation.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>9.3.5</b> <span class="math inline">\(k\)</span>-fold cross-validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html"><i class="fa fa-check"></i><b>10</b> Speeding up your <em>Stan</em> code</a>
<ul>
<li class="chapter" data-level="10.1" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#example-dataset-and-model-1"><i class="fa fa-check"></i><b>10.1</b> Example dataset and model</a></li>
<li class="chapter" data-level="10.2" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#a-really-slow-way-to-estimate-the-model"><i class="fa fa-check"></i><b>10.2</b> A really slow way to estimate the model</a></li>
<li class="chapter" data-level="10.3" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#pre-computing-things"><i class="fa fa-check"></i><b>10.3</b> Pre-computing things</a></li>
<li class="chapter" data-level="10.4" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#vectorization"><i class="fa fa-check"></i><b>10.4</b> Vectorization</a></li>
<li class="chapter" data-level="10.5" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#within-chain-parallelization-with-reduce_sum"><i class="fa fa-check"></i><b>10.5</b> Within-chain parallelization with <code>reduce_sum()</code></a></li>
<li class="chapter" data-level="10.6" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#evaluating-the-implementations"><i class="fa fa-check"></i><b>10.6</b> Evaluating the implementations</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#pre-computing-and-vectorization"><i class="fa fa-check"></i><b>10.6.1</b> Pre-computing and vectorization</a></li>
<li class="chapter" data-level="10.6.2" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#within-chain-parallelization"><i class="fa fa-check"></i><b>10.6.2</b> Within-chain parallelization</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#r-code-to-estimate-models"><i class="fa fa-check"></i><b>10.7</b> <em>R</em> code to estimate models</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#slow-pre-computed-and-vectorized-models"><i class="fa fa-check"></i><b>10.7.1</b> Slow, pre-computed, and vectorized models</a></li>
<li class="chapter" data-level="10.7.2" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#parallelized-model"><i class="fa fa-check"></i><b>10.7.2</b> Parallelized model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i>Applications</a></li>
<li class="chapter" data-level="11" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html"><i class="fa fa-check"></i><b>11</b> Application: Experience-Weighted Attraction</a>
<ul>
<li class="chapter" data-level="11.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-model-at-the-individual-level"><i class="fa fa-check"></i><b>11.1</b> The model at the individual level</a></li>
<li class="chapter" data-level="11.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#some-computational-and-coding-issues"><i class="fa fa-check"></i><b>11.2</b> Some computational and coding issues</a></li>
<li class="chapter" data-level="11.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#representative-agent-models"><i class="fa fa-check"></i><b>11.3</b> Representative agent models</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#prior-calibration"><i class="fa fa-check"></i><b>11.3.1</b> Prior calibration</a></li>
<li class="chapter" data-level="11.3.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-stan-model"><i class="fa fa-check"></i><b>11.3.2</b> The <em>Stan</em> model</a></li>
<li class="chapter" data-level="11.3.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#results-1"><i class="fa fa-check"></i><b>11.3.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#hierarchical-model"><i class="fa fa-check"></i><b>11.4</b> Hierarchical model</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#prior-calibration-1"><i class="fa fa-check"></i><b>11.4.1</b> Prior calibration</a></li>
<li class="chapter" data-level="11.4.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-stan-model-1"><i class="fa fa-check"></i><b>11.4.2</b> The <em>Stan</em> model</a></li>
<li class="chapter" data-level="11.4.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#results-2"><i class="fa fa-check"></i><b>11.4.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#some-code-used-to-estimate-the-models-1"><i class="fa fa-check"></i><b>11.5</b> Some code used to estimate the models</a>
<ul>
<li class="chapter" data-level="11.5.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#loading-the-data"><i class="fa fa-check"></i><b>11.5.1</b> Loading the data</a></li>
<li class="chapter" data-level="11.5.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#estimating-the-representative-agent-models"><i class="fa fa-check"></i><b>11.5.2</b> Estimating the representative agent models</a></li>
<li class="chapter" data-level="11.5.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#estimating-the-hierarchical-model"><i class="fa fa-check"></i><b>11.5.3</b> Estimating the hierarchical model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html"><i class="fa fa-check"></i><b>12</b> Application: Strategy Frequency Estimation</a>
<ul>
<li class="chapter" data-level="12.1" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#simplifying-the-individual-likelihood-functions"><i class="fa fa-check"></i><b>12.1</b> Simplifying the individual likelihood functions</a></li>
<li class="chapter" data-level="12.2" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#example-experiment-dbf2011"><i class="fa fa-check"></i><b>12.2</b> Example experiment: <span class="citation">Dal Bó and Fréchette (2011)</span></a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#the-sfem-with-homogeneous-trembles"><i class="fa fa-check"></i><b>12.2.1</b> The SFEM with homogeneous trembles</a></li>
<li class="chapter" data-level="12.2.2" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#adding-heterogeneous-trembles-and-integrating-the-likelihood"><i class="fa fa-check"></i><b>12.2.2</b> Adding heterogeneous trembles and integrating the likelihood</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#r-code-to-do-these-estimations"><i class="fa fa-check"></i><b>12.3</b> <em>R</em> code to do these estimations</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><i class="fa fa-check"></i><b>13</b> Application: Strategy frequency estimation with a mixed strategy</a>
<ul>
<li class="chapter" data-level="13.1" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#example-dataset-and-strategies"><i class="fa fa-check"></i><b>13.1</b> Example dataset and strategies</a></li>
<li class="chapter" data-level="13.2" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#the-likelihood-function"><i class="fa fa-check"></i><b>13.2</b> The likelihood function</a></li>
<li class="chapter" data-level="13.3" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#implementation-in-stan"><i class="fa fa-check"></i><b>13.3</b> Implementation in <em>Stan</em></a></li>
<li class="chapter" data-level="13.4" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#results-3"><i class="fa fa-check"></i><b>13.4</b> Results</a></li>
<li class="chapter" data-level="13.5" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#r-code-used-to-estimate-the-models"><i class="fa fa-check"></i><b>13.5</b> <em>R</em> code used to estimate the models</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html"><i class="fa fa-check"></i><b>14</b> Computing Quantal Response Equilibrium</a>
<ul>
<li class="chapter" data-level="14.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#overview-of-quantal-response-equilibrium"><i class="fa fa-check"></i><b>14.1</b> Overview of quantal response equilibrium</a></li>
<li class="chapter" data-level="14.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#computing-quantal-response-equilibrium-1"><i class="fa fa-check"></i><b>14.2</b> Computing Quantal Response Equilibrium</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#setting-up-the-problem"><i class="fa fa-check"></i><b>14.2.1</b> Setting up the problem</a></li>
<li class="chapter" data-level="14.2.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#a-predictor-corrector-algorithm"><i class="fa fa-check"></i><b>14.2.2</b> A predictor-corrector algorithm</a></li>
<li class="chapter" data-level="14.2.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#initial-conditions"><i class="fa fa-check"></i><b>14.2.3</b> Initial conditions</a></li>
<li class="chapter" data-level="14.2.4" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#algorithm-tuning"><i class="fa fa-check"></i><b>14.2.4</b> Algorithm tuning</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#the-predictor-corrector-algorithm-in-r"><i class="fa fa-check"></i><b>14.3</b> The predictor-corrector algorithm in <em>R</em></a></li>
<li class="chapter" data-level="14.4" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#some-example-games"><i class="fa fa-check"></i><b>14.4</b> Some example games</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#generalized-matching-pennies-ochs1995"><i class="fa fa-check"></i><b>14.4.1</b> Generalized matching pennies <span class="citation">(Ochs 1995)</span></a></li>
<li class="chapter" data-level="14.4.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#stag-hunt"><i class="fa fa-check"></i><b>14.4.2</b> Stag hunt</a></li>
<li class="chapter" data-level="14.4.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#n-player-volunteers-dilemma-imposing-symmetric-strategies"><i class="fa fa-check"></i><b>14.4.3</b> <span class="math inline">\(n\)</span>-player Volunteer’s Dilemma imposing symmetric strategies</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><i class="fa fa-check"></i><b>15</b> Application: Quantal Response Equilibrium and the Volunteer’s Dilemma <span class="citation">(Goeree, Holt, and Smith 2017)</span></a>
<ul>
<li class="chapter" data-level="15.1" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#solving-logit-qre-and-estimating-the-model"><i class="fa fa-check"></i><b>15.1</b> Solving logit QRE and estimating the model</a></li>
<li class="chapter" data-level="15.2" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#adding-some-heterogeneity-1"><i class="fa fa-check"></i><b>15.2</b> Adding some heterogeneity</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#computing-quantal-response-equilibrium-with-heterogeneous-parameters"><i class="fa fa-check"></i><b>15.2.1</b> Computing quantal response equilibrium with heterogeneous parameters</a></li>
<li class="chapter" data-level="15.2.2" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#warm-glow-volunteering"><i class="fa fa-check"></i><b>15.2.2</b> Warm glow volunteering</a></li>
<li class="chapter" data-level="15.2.3" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#duplicate-aversion"><i class="fa fa-check"></i><b>15.2.3</b> Duplicate aversion</a></li>
<li class="chapter" data-level="15.2.4" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#results-4"><i class="fa fa-check"></i><b>15.2.4</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#r-code-to-run-estimations"><i class="fa fa-check"></i><b>15.3</b> <em>R</em> code to run estimations</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html"><i class="fa fa-check"></i><b>16</b> Application: A Quantal Response Equilibrium with discrete types</a>
<ul>
<li class="chapter" data-level="16.1" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#example-dataset-and-models-1"><i class="fa fa-check"></i><b>16.1</b> Example dataset and models</a></li>
<li class="chapter" data-level="16.2" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#a-note-on-replication"><i class="fa fa-check"></i><b>16.2</b> A note on replication</a></li>
<li class="chapter" data-level="16.3" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#three-models-that-make-different-assumptions-about-bracketing"><i class="fa fa-check"></i><b>16.3</b> Three models that make different assumptions about bracketing</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#broad-bracketing-only"><i class="fa fa-check"></i><b>16.3.1</b> Broad bracketing only</a></li>
<li class="chapter" data-level="16.3.2" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#narrow-bracketing-only"><i class="fa fa-check"></i><b>16.3.2</b> Narrow bracketing only</a></li>
<li class="chapter" data-level="16.3.3" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#a-mixture-of-broad-and-narrow-bracketing"><i class="fa fa-check"></i><b>16.3.3</b> A mixture of broad and narrow bracketing</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#results-5"><i class="fa fa-check"></i><b>16.4</b> Results</a></li>
<li class="chapter" data-level="16.5" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#r-code-used-to-estimate-these-models"><i class="fa fa-check"></i><b>16.5</b> <em>R</em> code used to estimate these models</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><i class="fa fa-check"></i><b>17</b> Application: QRE in a Bayesian game and cursed equilibrium</a>
<ul>
<li class="chapter" data-level="17.1" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#example-game-and-dataset"><i class="fa fa-check"></i><b>17.1</b> Example game and dataset</a></li>
<li class="chapter" data-level="17.2" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#solving-for-qre"><i class="fa fa-check"></i><b>17.2</b> Solving for QRE</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#baseline-model"><i class="fa fa-check"></i><b>17.2.1</b> Baseline model</a></li>
<li class="chapter" data-level="17.2.2" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#cursed-equilibrium"><i class="fa fa-check"></i><b>17.2.2</b> Cursed equilibrium</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#a-quick-prior-calibration-1"><i class="fa fa-check"></i><b>17.3</b> A quick prior calibration</a></li>
<li class="chapter" data-level="17.4" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#model-results"><i class="fa fa-check"></i><b>17.4</b> Model results</a></li>
<li class="chapter" data-level="17.5" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#model-evaluation-1"><i class="fa fa-check"></i><b>17.5</b> Model evaluation</a></li>
<li class="chapter" data-level="17.6" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#r-code-used-in-this-chapter"><i class="fa fa-check"></i><b>17.6</b> <em>R</em> code used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="application-level-k-models.html"><a href="application-level-k-models.html"><i class="fa fa-check"></i><b>18</b> Application: Level-<span class="math inline">\(k\)</span> models</a>
<ul>
<li class="chapter" data-level="18.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#data-and-game"><i class="fa fa-check"></i><b>18.1</b> Data and game</a></li>
<li class="chapter" data-level="18.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-level-k-model"><i class="fa fa-check"></i><b>18.2</b> The level-<span class="math inline">\(k\)</span> model</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-deterministic-component-of-the-model"><i class="fa fa-check"></i><b>18.2.1</b> The deterministic component of the model</a></li>
<li class="chapter" data-level="18.2.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#exact-and-probabilistic-play"><i class="fa fa-check"></i><b>18.2.2</b> Exact and probabilistic play</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#assigning-probabilities-to-types-for-each-participant-separately"><i class="fa fa-check"></i><b>18.3</b> Assigning probabilities to types for each participant separately</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-stan-program"><i class="fa fa-check"></i><b>18.3.1</b> The <em>Stan</em> program</a></li>
<li class="chapter" data-level="18.3.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#prior-calibration-2"><i class="fa fa-check"></i><b>18.3.2</b> Prior calibration</a></li>
<li class="chapter" data-level="18.3.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-6"><i class="fa fa-check"></i><b>18.3.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="application-level-k-models.html"><a href="application-level-k-models.html#doing-the-averaging-within-one-program"><i class="fa fa-check"></i><b>18.4</b> Doing the averaging within one program</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-stan-program-1"><i class="fa fa-check"></i><b>18.4.1</b> The <em>Stan</em> program</a></li>
<li class="chapter" data-level="18.4.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-7"><i class="fa fa-check"></i><b>18.4.2</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-mixture-model"><i class="fa fa-check"></i><b>18.5</b> A mixture model</a>
<ul>
<li class="chapter" data-level="18.5.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#stan-program"><i class="fa fa-check"></i><b>18.5.1</b> <em>Stan</em> program</a></li>
<li class="chapter" data-level="18.5.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-prior-for-psi"><i class="fa fa-check"></i><b>18.5.2</b> A prior for <span class="math inline">\(\psi\)</span></a></li>
<li class="chapter" data-level="18.5.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-8"><i class="fa fa-check"></i><b>18.5.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-mixture-over-levels-and-hierarchical-nuisance-parameters"><i class="fa fa-check"></i><b>18.6</b> A mixture over levels and hierarchical nuisance parameters</a>
<ul>
<li class="chapter" data-level="18.6.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#prior-calibration-3"><i class="fa fa-check"></i><b>18.6.1</b> Prior calibration</a></li>
<li class="chapter" data-level="18.6.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#stan-program-1"><i class="fa fa-check"></i><b>18.6.2</b> <em>Stan</em> program</a></li>
<li class="chapter" data-level="18.6.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-9"><i class="fa fa-check"></i><b>18.6.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="18.7" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-different-assumption-about-mixing"><i class="fa fa-check"></i><b>18.7</b> A different assumption about mixing</a>
<ul>
<li class="chapter" data-level="18.7.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#stan-program-2"><i class="fa fa-check"></i><b>18.7.1</b> <em>Stan</em> program</a></li>
<li class="chapter" data-level="18.7.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-10"><i class="fa fa-check"></i><b>18.7.2</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="18.8" data-path="application-level-k-models.html"><a href="application-level-k-models.html#r-code-to-estimate-the-models"><i class="fa fa-check"></i><b>18.8</b> <em>R</em> code to estimate the models</a>
<ul>
<li class="chapter" data-level="18.8.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#participant-specific-estimation-conditional-on-k-with-bayesian-model-averaging"><i class="fa fa-check"></i><b>18.8.1</b> Participant-specific estimation conditional on <span class="math inline">\(k\)</span> with Bayesian model averaging</a></li>
<li class="chapter" data-level="18.8.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#participant-specific-estimation-with-a-prior-over-k"><i class="fa fa-check"></i><b>18.8.2</b> Participant-specific estimation with a prior over <span class="math inline">\(k\)</span></a></li>
<li class="chapter" data-level="18.8.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#mixture-model"><i class="fa fa-check"></i><b>18.8.3</b> Mixture model</a></li>
<li class="chapter" data-level="18.8.4" data-path="application-level-k-models.html"><a href="application-level-k-models.html#hierarchical-model-1"><i class="fa fa-check"></i><b>18.8.4</b> Hierarchical model</a></li>
<li class="chapter" data-level="18.8.5" data-path="application-level-k-models.html"><a href="application-level-k-models.html#mixture-model-with-beliefs-consistent-with-truncated-type-distribution"><i class="fa fa-check"></i><b>18.8.5</b> Mixture model with beliefs consistent with truncated type distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="19" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html"><i class="fa fa-check"></i><b>19</b> Application: Estimating risk preferences</a>
<ul>
<li class="chapter" data-level="19.1" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#example-dataset"><i class="fa fa-check"></i><b>19.1</b> Example dataset</a></li>
<li class="chapter" data-level="19.2" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#we-might-not-just-be-interested-in-the-parameters"><i class="fa fa-check"></i><b>19.2</b> We might not just be interested in the parameters</a></li>
<li class="chapter" data-level="19.3" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#introducing-some-important-models"><i class="fa fa-check"></i><b>19.3</b> Introducing some important models</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#expected-utility-theory"><i class="fa fa-check"></i><b>19.3.1</b> Expected utility theory</a></li>
<li class="chapter" data-level="19.3.2" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#rank-dependent-utility-quiggin1982"><i class="fa fa-check"></i><b>19.3.2</b> Rank-dependent utility <span class="citation">(Quiggin 1982)</span></a></li>
<li class="chapter" data-level="19.3.3" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#comparing-the-certainty-equivalents-estimated-using-eut-and-rdu"><i class="fa fa-check"></i><b>19.3.3</b> Comparing the certainty equivalents estimated using EUT and RDU</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#a-hierarchical-specification"><i class="fa fa-check"></i><b>19.4</b> A hierarchical specification</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#population-level-estimates"><i class="fa fa-check"></i><b>19.4.1</b> Population-level estimates</a></li>
<li class="chapter" data-level="19.4.2" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#participant-level-estimates"><i class="fa fa-check"></i><b>19.4.2</b> Participant-level estimates</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#r-code-used-to-estimate-these-models-1"><i class="fa fa-check"></i><b>19.5</b> <em>R</em> code used to estimate these models</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html"><i class="fa fa-check"></i><b>20</b> Application: Meta-analysis using (some of) the METARET data</a>
<ul>
<li class="chapter" data-level="20.1" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#data"><i class="fa fa-check"></i><b>20.1</b> Data</a></li>
<li class="chapter" data-level="20.2" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#a-basic-model"><i class="fa fa-check"></i><b>20.2</b> A basic model</a></li>
<li class="chapter" data-level="20.3" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#but-the-data-are-really-interval-valued"><i class="fa fa-check"></i><b>20.3</b> But the data are really interval-valued!</a></li>
<li class="chapter" data-level="20.4" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#heterogeneous-standard-deviations"><i class="fa fa-check"></i><b>20.4</b> Heterogeneous standard deviations</a></li>
<li class="chapter" data-level="20.5" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#student-t-distributions-because-why-not"><i class="fa fa-check"></i><b>20.5</b> Student-<span class="math inline">\(t\)</span> distributions, because why not?</a></li>
<li class="chapter" data-level="20.6" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#r-code-to-estimate-the-models-1"><i class="fa fa-check"></i><b>20.6</b> <em>R</em> code to estimate the models</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html"><i class="fa fa-check"></i><b>21</b> Application: choice bracketing</a>
<ul>
<li class="chapter" data-level="21.1" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html#data-and-model"><i class="fa fa-check"></i><b>21.1</b> Data and model</a></li>
<li class="chapter" data-level="21.2" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html#representative-agent-and-individual-estimation"><i class="fa fa-check"></i><b>21.2</b> Representative agent and individual estimation</a></li>
<li class="chapter" data-level="21.3" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html#hierarchical-model-2"><i class="fa fa-check"></i><b>21.3</b> Hierarchical model</a></li>
<li class="chapter" data-level="21.4" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html#a-mixture-model-1"><i class="fa fa-check"></i><b>21.4</b> A mixture model</a></li>
<li class="chapter" data-level="21.5" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html#what-do-we-get-out-of-the-structural-models-and-what-could-we-miss"><i class="fa fa-check"></i><b>21.5</b> What do we get out of the structural models, and what could we miss?</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html"><i class="fa fa-check"></i><b>22</b> Application: Ranked choices and the Thurstonian model</a>
<ul>
<li class="chapter" data-level="22.1" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#the-thurstonian-model"><i class="fa fa-check"></i><b>22.1</b> The Thurstonian model</a></li>
<li class="chapter" data-level="22.2" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#computational-issues"><i class="fa fa-check"></i><b>22.2</b> Computational issues</a></li>
<li class="chapter" data-level="22.3" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#example-dataset-and-model-2"><i class="fa fa-check"></i><b>22.3</b> Example dataset and model</a></li>
<li class="chapter" data-level="22.4" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#a-representative-agent-model"><i class="fa fa-check"></i><b>22.4</b> A representative agent model</a></li>
<li class="chapter" data-level="22.5" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#a-hierarchical-model"><i class="fa fa-check"></i><b>22.5</b> A hierarchical model</a></li>
<li class="chapter" data-level="22.6" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#r-code-used-to-run-this"><i class="fa fa-check"></i><b>22.6</b> <em>R</em> code used to run this</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="links-to-data.html"><a href="links-to-data.html"><i class="fa fa-check"></i>Links to data</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Structural Bayesian Techniques for Experimental and Behavioral Economics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="application-estimating-risk-preferences" class="section level1 hasAnchor" number="19">
<h1><span class="header-section-number">19</span> Application: Estimating risk preferences<a href="application-estimating-risk-preferences.html#application-estimating-risk-preferences" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Perhaps the most common use of structural models in experimental economics is the estimation of risk preferences. I would therefore not be doing the field justice if I did not devote at least one chapter (and I suspect there will be more later) to this topic. In this chapter, I will show you how to estimate some of the popular specifications that are taken to data from the “battery” binary choice experiment design, where participants are presented with many choices between two lotteries. To my knowledge, this design was first used by <span class="citation">Hey and Di Cagno (<a href="#ref-HeyCagno1990">1990</a>)</span>, and has been the workhorse providing us with data to estimate risk preferences ever since.<a href="#fn83" class="footnote-ref" id="fnref83"><sup>83</sup></a></p>
<p>We can see individual-estimation of risk preferences using maximum likelihood estimation as early as <span class="citation">Hey and Orme (<a href="#ref-Hey1994">1994</a>)</span>, and the econometrics of this kind of experiment took a great leap forward as researchers started to meaningfully aggregate their participants’ decisions using mixture models with random parameters specifications <span class="citation">(<a href="#ref-Conte2011">Conte, Hey, and Moffatt 2011</a>)</span>, or exploiting correlation between parameters and observed participant characteristics <span class="citation">(<a href="#ref-Harrison2009">Harrison and Rutström 2009</a>)</span>. These aggregating models are particularly important for the battery design, because typical experiments are under-powered at distinguishing between alternative models <span class="citation">(<a href="#ref-Monroe2020">Monroe 2020</a>)</span>, but nonetheless can provide us with a <em>lot</em> of information about the population distribution. Furthermore, drawing inference about the population may in fact be a more satisfying answer to our research questions than being able to comment on how many participants are classified into each model individually.</p>
<div id="example-dataset" class="section level2 hasAnchor" number="19.1">
<h2><span class="header-section-number">19.1</span> Example dataset<a href="application-estimating-risk-preferences.html#example-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For this application, I will use data from <span class="citation">Harrison and Swarthout (<a href="#ref-Harrison2016cumulative">2023</a>)</span>. Specifically, I will use the subset of this dataset corresponding to undergraduate participants who played in the “house money” (as opposed to “earned endowment”) treatment. The 175 participants in this treatment each made 100 decisions over pairs of lotteries. These lotteries were over both gains and losses, however for simplicity here I add in the show-up fee and the pair’s “endowment” to ensure that all lottery prizes are strictly positive.
Because both lotteries in a pair share the same three prizes, we can represent each lottery pair in a probability triangle, which plots the probability of winning the lowest prize on the horizontal axis, and the probability of winning the highest prize on the vertical axis. This is shown in Figure <a href="application-estimating-risk-preferences.html#fig:RiskHS2023MMTri">19.1</a>.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="application-estimating-risk-preferences.html#cb233-1" tabindex="-1"></a>d<span class="ot">&lt;-</span><span class="st">&quot;Code/RiskPreferences/HS2023Cleaned.rds&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb233-2"><a href="application-estimating-risk-preferences.html#cb233-2" tabindex="-1"></a>  <span class="fu">readRDS</span>() <span class="sc">|&gt;</span></span>
<span id="cb233-3"><a href="application-estimating-risk-preferences.html#cb233-3" tabindex="-1"></a>  <span class="fu">filter</span>(id<span class="sc">==</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb233-4"><a href="application-estimating-risk-preferences.html#cb233-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">context =</span> <span class="fu">paste0</span>(<span class="st">&quot;$&quot;</span>,prize1,<span class="st">&quot; $&quot;</span>,prize2,<span class="st">&quot; $&quot;</span>,prize3))</span>
<span id="cb233-5"><a href="application-estimating-risk-preferences.html#cb233-5" tabindex="-1"></a></span>
<span id="cb233-6"><a href="application-estimating-risk-preferences.html#cb233-6" tabindex="-1"></a>mmTri<span class="ot">&lt;-</span><span class="fu">tibble</span>(</span>
<span id="cb233-7"><a href="application-estimating-risk-preferences.html#cb233-7" tabindex="-1"></a>  <span class="at">x    =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb233-8"><a href="application-estimating-risk-preferences.html#cb233-8" tabindex="-1"></a>  <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb233-9"><a href="application-estimating-risk-preferences.html#cb233-9" tabindex="-1"></a>  <span class="at">xend =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb233-10"><a href="application-estimating-risk-preferences.html#cb233-10" tabindex="-1"></a>  <span class="at">yend =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb233-11"><a href="application-estimating-risk-preferences.html#cb233-11" tabindex="-1"></a>)</span>
<span id="cb233-12"><a href="application-estimating-risk-preferences.html#cb233-12" tabindex="-1"></a></span>
<span id="cb233-13"><a href="application-estimating-risk-preferences.html#cb233-13" tabindex="-1"></a>(</span>
<span id="cb233-14"><a href="application-estimating-risk-preferences.html#cb233-14" tabindex="-1"></a>  <span class="fu">ggplot</span>(d,<span class="fu">aes</span>(<span class="at">x=</span>qL1,<span class="at">y=</span>qL3,<span class="at">xend=</span>qR1,<span class="at">yend=</span>qR3,<span class="at">color=</span>frame))</span>
<span id="cb233-15"><a href="application-estimating-risk-preferences.html#cb233-15" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_segment</span>()</span>
<span id="cb233-16"><a href="application-estimating-risk-preferences.html#cb233-16" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>context)</span>
<span id="cb233-17"><a href="application-estimating-risk-preferences.html#cb233-17" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_segment</span>(<span class="at">data=</span>mmTri,<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y,<span class="at">xend=</span>xend,<span class="at">yend=</span>yend),<span class="at">color=</span><span class="st">&quot;black&quot;</span>) </span>
<span id="cb233-18"><a href="application-estimating-risk-preferences.html#cb233-18" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb233-19"><a href="application-estimating-risk-preferences.html#cb233-19" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">coord_fixed</span>()</span>
<span id="cb233-20"><a href="application-estimating-risk-preferences.html#cb233-20" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;probability of winning smallest prize&quot;</span>)</span>
<span id="cb233-21"><a href="application-estimating-risk-preferences.html#cb233-21" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;probability of winning largest prize&quot;</span>)</span>
<span id="cb233-22"><a href="application-estimating-risk-preferences.html#cb233-22" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:RiskHS2023MMTri"></span>
<img src="index_files/figure-html/RiskHS2023MMTri-1.png" alt="The @Harrison2016cumulative experiment represented in the probability triangle. Prizes for each lottery pair, inclusive of the endowment and show-up fee, are shown at the top of each panel. Some lottery pairs are obscured because their connecting line segments overlap with a segment for another pair." width="672" />
<p class="caption">
Figure 19.1: The <span class="citation">Harrison and Swarthout (<a href="#ref-Harrison2016cumulative">2023</a>)</span> experiment represented in the probability triangle. Prizes for each lottery pair, inclusive of the endowment and show-up fee, are shown at the top of each panel. Some lottery pairs are obscured because their connecting line segments overlap with a segment for another pair.
</p>
</div>
<p>In Figure <a href="application-estimating-risk-preferences.html#fig:RiskHS2023MMTri">19.1</a>, we can see a lot of the popular features of this kind of experiment design. In particular if we just focus on the “<span class="math inline">\(\$10\ \$45\ \$80\)</span>” panel of this Figure, we can see that there is a wide range of slopes of the connecting line segments. If we were solely in the realm of Expected Utility Theory (EUT), this slope determines which of the two lotteries a participant will choose (if they choose without noise). Varying the slope allows participants with different amounts of risk-aversion to reveal their preferences to us. But there are also parallel line segments in this triangle. If participants choose according to EUT, then they should choose the lotteries at <em>the same end</em> of these parallel line segments.<a href="#fn84" class="footnote-ref" id="fnref84"><sup>84</sup></a> Hence, these parallel line segments provide participants with an opportunity to reveal to us that they are <em>not</em> making decisions according to EUT. Here we can also see that there are seven different “contexts” of lotteries presented. That is, the dollar amounts of the prizes are varied. This is a somewhat <em>less</em> common property of this class of experiment design,<a href="#fn85" class="footnote-ref" id="fnref85"><sup>85</sup></a> but this kind of variation is also useful because it allows us to observe behavior over a wider range of payoffs, possibly getting us a better estimate of the utility function over money.</p>
</div>
<div id="we-might-not-just-be-interested-in-the-parameters" class="section level2 hasAnchor" number="19.2">
<h2><span class="header-section-number">19.2</span> We might not just be interested in the parameters<a href="application-estimating-risk-preferences.html#we-might-not-just-be-interested-in-the-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Depending on what we want to get out of our model, the model’s parameters may not be the most interesting things to us. This is because economically meaningful quantities are sometimes <em>transformations</em> of a model’s fundamental parameters. The good news for us is that once we have a posterior simulation of our model’s fundamental parameters, it is very easy to get a posterior simulation of these transformations: we simply apply the transformation to the simulated fundamental parameters. In practice, this transformation can be done post estimation, or during estimation in the <code>generated quantities</code> block in <em>Stan</em>. I am very much in favor of doing this in the <code>generated quantities</code> block, because <em>Stan</em> will then provide convergence diagnostics for all of these quantities.</p>
<p>For models of decision-making under risk, these transformed quantities of interest could be things like <em>certainty equivalents</em>, which convert utility measured in the units von Neumann–Morgenstern (VNM) utility into units of currency. These are much easier to interpret and compare between participants. I also like to interpret the logit choice precision parameter <span class="math inline">\(\lambda\)</span> by transforming it into a predicted probability. For example, if <span class="math inline">\(\bar u\)</span> is the largest possible utility difference in an experiment, the following quantity is the upper bound on the probability that a participant chooses the action that maximizes their utility:</p>
<p><span class="math display">\[
\left(1+\exp(-\bar u \lambda)\right)^{-1}
\]</span></p>
<p>This converts the units of <span class="math inline">\(\lambda\)</span>, which are <em>inverse</em> utility to units, into a probability. I find this much easier to interpret and compare between participants.</p>
</div>
<div id="introducing-some-important-models" class="section level2 hasAnchor" number="19.3">
<h2><span class="header-section-number">19.3</span> Introducing some important models<a href="application-estimating-risk-preferences.html#introducing-some-important-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="expected-utility-theory" class="section level3 hasAnchor" number="19.3.1">
<h3><span class="header-section-number">19.3.1</span> Expected utility theory<a href="application-estimating-risk-preferences.html#expected-utility-theory" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A good place to start with modeling this kind of data is to assume that participants make choices according to expected utility theory (EUT). This means that we can write their maximization problem for their <span class="math inline">\(t\)</span>th decision as:</p>
<p><span class="math display">\[
\max_{y}E(u_i(X)\mid y)
\]</span></p>
<p>Where <span class="math inline">\(u(X)\)</span> is participant <span class="math inline">\(i\)</span>’s utility from monetary prize <span class="math inline">\(X\)</span>. The distribution <span class="math inline">\(X\mid y\)</span> is determined by the lottery they chose.</p>
<p>While there are many ways we could make a simplifying assumption about the utility function <span class="math inline">\(u_i(\cdot)\)</span>, a common choice is to assume the constant relative risk-aversion specification:</p>
<p><span class="math display">\[
u_i(x)=\frac{x^{1-r_i}}{1-r_i}
\]</span></p>
<p>where <span class="math inline">\(r_i\)</span> is the coefficient of relative risk-aversion. That is, the participant is risk-neutral if <span class="math inline">\(r_i=0\)</span>, risk-averse if <span class="math inline">\(r_i&gt;0\)</span>, and risk-loving when <span class="math inline">\(r_i&gt;0\)</span>.</p>
<p>The second parameter in the model comes from specifying a probabilistic choice rule. Here I will use logit choice with the contextual utility normalization <span class="citation">(<a href="#ref-Wilcox2011">Wilcox 2011</a>)</span>, so coding <span class="math inline">\(y_{i,t}=1\)</span> as indicating that the participant chose the left lottery, we have:</p>
<p><span class="math display">\[
\begin{aligned}
p(y_{i,t}\mid r_i,\lambda_i)&amp;=\Lambda\left(\lambda_i\left[\frac{E(u(X)\mid L_t)-E(u(X)\mid R_t)}{u_i(\overline x_t)-u_i(\underline x_t)}\right]\right)\\
\Lambda(x)&amp;=(1+\exp(-x))^{-1}
\end{aligned}
\]</span>
where <span class="math inline">\(\lambda_i&gt;0\)</span> is the choice precision parameter, and <span class="math inline">\(\overline x_t\)</span> and <span class="math inline">\(\underline x_t\)</span> are the largest and smallest prize in lottery pair <span class="math inline">\(t\)</span>, respectively.</p>
<p>While we might be interested in our estimates of parameters <span class="math inline">\(r_i\)</span> and <span class="math inline">\(\lambda_i\)</span> themselves, we might also like to know what they imply about other economically meaningful quantities. One of these quantities could be a <em>certainty equivalent</em> of a lottery, which is the amount of money a participant would be indifferent between taking and receiving a draw from the lottery. That is, we define the certainty equivalent <span class="math inline">\(C(L)\)</span> for lottery <span class="math inline">\(L\)</span> as:</p>
<p><span class="math display">\[
u(C(L))=E(u(X)\mid L)
\]</span></p>
<p>which for the CRRA EUT model we are using becomes:</p>
<p><span class="math display">\[
C(L)=\left(\sum_{k=1}^3x_{k}^{1-r_i}q_k^L\right)^{\frac{1}{1-r_i}}
\]</span></p>
<p>where <span class="math inline">\(\{x_k\}_{k=1}^3\)</span> are the three prizes for the lottery, and <span class="math inline">\(\{q_k\}_{k=1}^3\)</span> are the probabilities of winning those prizes. Certainty equivalents are good at communicating information about participants’ preferences over lotteries because they convert units of Von-Neumann Mogernetern utility, which are hard to interpret and impossible to compare between participants, into dollars, which are easy to interpret and compare. Since they are just a function of the model’s fundamental parameters, certainty equivalents are also very easy to calculate in <em>Stan</em>’s <code>generated quantities</code> block, so I will do this for all of the models I estimate. Specifically, I will calculate certainty equivalents for the following lotteries:<a href="#fn86" class="footnote-ref" id="fnref86"><sup>86</sup></a></p>
<p><span class="math display">\[
\begin{aligned}
L_1: &amp; \text{ a 95 percent chance of winning 10, and a 5 percent chance of winning 80}\\
L_2:  &amp; \text{ a 5 percent chance of winning 10, and a 95 percent chance of winning 80}\\
\end{aligned}
\]</span></p>
<p>In order to estimate this model at the individual level, or to estimate a pooled model, we need to choose priors for the parameters <span class="math inline">\(r\)</span> and <span class="math inline">\(\lambda\)</span>. As I discuss in detail in <span class="citation">Bland (<a href="#ref-Bland2023">2023b</a>)</span>, choosing priors for structural models (and particularly for estimating risk preferences) is not something we should take lightly. This is partly because there are many non-linearities in these models, but we should not take this problem less seriously for linear models.</p>
<p>A good first step in formalizing priors is to ask what are the possible values for a parameter, however unlikely. That is, we pin down the <em>support</em> of the distribution. For <span class="math inline">\(r\)</span>, the parameter in the CRRA utility function, any real number gives us a valid utility function.<a href="#fn87" class="footnote-ref" id="fnref87"><sup>87</sup></a>
In the case where we want our prior to cover the entire real number line, a good choice is to use the normal distribution:</p>
<p><span class="math display">\[
r_i\sim N(m_r,s_r^2)
\]</span></p>
<p>For the choice precision parameter <span class="math inline">\(\lambda_i\)</span>, we need a prior that restricts this to positive real numbers. This is because negative values imply that the participant will choose the lottery with the <em>smaller</em> expected utility more often than the lottery with the larger. While there are of course many families of distribution that cover positive real numbers, I like to choose <em>log-normal</em> priors for such parameters. This is mainly because it makes going to a hierarchical model very easy. Therefore, in order to pin down the <span class="math inline">\(\lambda_i&gt;0\)</span> restriction, we will choose:</p>
<p><span class="math display">\[
\log\lambda_i\sim N(m_\lambda,s^2_\lambda)
\]</span></p>
<p>We now need to choose values for <span class="math inline">\(m_r\)</span>, <span class="math inline">\(s_r\)</span>, <span class="math inline">\(m_\lambda\)</span>, and <span class="math inline">\(s_\lambda\)</span>. While this is an interesting exercise in itself, I will direct you to previous work I did in <span class="citation">Bland (<a href="#ref-Bland2023">2023b</a>)</span>, where I calibrated these priors to be:</p>
<p><span class="math display">\[
\begin{aligned}
r_i&amp;\sim N(0.27,0.36^2)\\
\log\lambda_i&amp;\sim N(3.45,0.59^2)
\end{aligned}
\]</span></p>
<p>For <span class="math inline">\(r_i\)</span>, this matches nicely with the distribution of estimates from <span class="citation">Holt and Laury (<a href="#ref-Holt2002">2002</a>)</span>. For <span class="math inline">\(\lambda_i\)</span>, this covers most of the interesting range of choice precisions when choosing between (i) the middle prize for sure and (ii) a 50-50 mix of the low and high prizes.<a href="#fn88" class="footnote-ref" id="fnref88"><sup>88</sup></a> Before moving on, let’s investigate one of the implications of this prior just to make sure that it is doing (at least approximately) what we think it is doing.<a href="#fn89" class="footnote-ref" id="fnref89"><sup>89</sup></a> Figure <a href="application-estimating-risk-preferences.html#fig:riskPriorCheck">19.2</a> shows the implied prior distribution of the probability of choosing a 50-50 mix of <span class="math inline">\(\$80\)</span> and <span class="math inline">\(\$10\)</span> over <span class="math inline">\(\$45\)</span> for sure. These prizes are for the most frequent context presented to participants in the experiment. Here we can see a large accumulation of mass at zero, which is to be expected, as the vast majority of the prior mass is in the risk-averse range. The rest of the distribution is reasonably spread out over the unit interval. At this point, if this plot looks surprising to you, you should go back and think about whether your prior is implying what you want it to.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="application-estimating-risk-preferences.html#cb234-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb234-2"><a href="application-estimating-risk-preferences.html#cb234-2" tabindex="-1"></a></span>
<span id="cb234-3"><a href="application-estimating-risk-preferences.html#cb234-3" tabindex="-1"></a>d<span class="ot">&lt;-</span><span class="fu">tibble</span>(</span>
<span id="cb234-4"><a href="application-estimating-risk-preferences.html#cb234-4" tabindex="-1"></a>  <span class="at">r =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>,<span class="at">mean=</span><span class="fl">0.27</span>,<span class="at">sd=</span><span class="fl">0.36</span>),</span>
<span id="cb234-5"><a href="application-estimating-risk-preferences.html#cb234-5" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="fu">rnorm</span>(<span class="dv">10000</span>,<span class="at">mean=</span><span class="fl">3.45</span>,<span class="at">sd=</span><span class="fl">0.59</span>) <span class="sc">|&gt;</span> <span class="fu">exp</span>()</span>
<span id="cb234-6"><a href="application-estimating-risk-preferences.html#cb234-6" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb234-7"><a href="application-estimating-risk-preferences.html#cb234-7" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb234-8"><a href="application-estimating-risk-preferences.html#cb234-8" tabindex="-1"></a>    <span class="at">uMin =</span> (<span class="dv">10</span><span class="sc">^</span>(<span class="dv">1</span><span class="sc">-</span>r))<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>r),</span>
<span id="cb234-9"><a href="application-estimating-risk-preferences.html#cb234-9" tabindex="-1"></a>    <span class="at">uMax =</span> (<span class="dv">80</span><span class="sc">^</span>(<span class="dv">1</span><span class="sc">-</span>r))<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>r),</span>
<span id="cb234-10"><a href="application-estimating-risk-preferences.html#cb234-10" tabindex="-1"></a>    <span class="at">uMid =</span> (<span class="dv">45</span><span class="sc">^</span>(<span class="dv">1</span><span class="sc">-</span>r))<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>r),</span>
<span id="cb234-11"><a href="application-estimating-risk-preferences.html#cb234-11" tabindex="-1"></a>    </span>
<span id="cb234-12"><a href="application-estimating-risk-preferences.html#cb234-12" tabindex="-1"></a>    <span class="at">lDU =</span> lambda<span class="sc">*</span>(<span class="fl">0.5</span><span class="sc">*</span>uMin<span class="fl">+0.5</span><span class="sc">*</span>uMax<span class="sc">-</span>uMid)<span class="sc">/</span>(uMax<span class="sc">-</span>uMin),</span>
<span id="cb234-13"><a href="application-estimating-risk-preferences.html#cb234-13" tabindex="-1"></a>    <span class="at">prob =</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="sc">-</span>lDU))</span>
<span id="cb234-14"><a href="application-estimating-risk-preferences.html#cb234-14" tabindex="-1"></a>  )</span>
<span id="cb234-15"><a href="application-estimating-risk-preferences.html#cb234-15" tabindex="-1"></a></span>
<span id="cb234-16"><a href="application-estimating-risk-preferences.html#cb234-16" tabindex="-1"></a>(</span>
<span id="cb234-17"><a href="application-estimating-risk-preferences.html#cb234-17" tabindex="-1"></a>  <span class="fu">ggplot</span>(d,<span class="fu">aes</span>(<span class="at">x=</span>prob))</span>
<span id="cb234-18"><a href="application-estimating-risk-preferences.html#cb234-18" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span><span class="fu">after_stat</span>(density)),<span class="at">bins=</span><span class="dv">30</span>)</span>
<span id="cb234-19"><a href="application-estimating-risk-preferences.html#cb234-19" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb234-20"><a href="application-estimating-risk-preferences.html#cb234-20" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:riskPriorCheck"></span>
<img src="index_files/figure-html/riskPriorCheck-1.png" alt="prior distribution of the probability of choosing a 50-50 mix of $80 and $10 over $45 for sure." width="672" />
<p class="caption">
Figure 19.2: prior distribution of the probability of choosing a 50-50 mix of $80 and $10 over $45 for sure.
</p>
</div>
<p>Now that we have fully specified the likelihood and prior, we can go ahead and estimate the model. Here is the <em>Stan</em> file I wrote to estimate the EUT representative agent model.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb235-1"><a href="application-estimating-risk-preferences.html#cb235-1" tabindex="-1"></a></span>
<span id="cb235-2"><a href="application-estimating-risk-preferences.html#cb235-2" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb235-3"><a href="application-estimating-risk-preferences.html#cb235-3" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> N<span class="op">;</span> <span class="co">// total number of decisions</span></span>
<span id="cb235-4"><a href="application-estimating-risk-preferences.html#cb235-4" tabindex="-1"></a>  </span>
<span id="cb235-5"><a href="application-estimating-risk-preferences.html#cb235-5" tabindex="-1"></a>  <span class="dt">int</span> Left<span class="op">[</span>N<span class="op">];</span> <span class="co">// indicator for chose the Left lottery</span></span>
<span id="cb235-6"><a href="application-estimating-risk-preferences.html#cb235-6" tabindex="-1"></a>  </span>
<span id="cb235-7"><a href="application-estimating-risk-preferences.html#cb235-7" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> pLeft<span class="op">;</span> </span>
<span id="cb235-8"><a href="application-estimating-risk-preferences.html#cb235-8" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> pRight<span class="op">;</span></span>
<span id="cb235-9"><a href="application-estimating-risk-preferences.html#cb235-9" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> prizes<span class="op">;</span></span>
<span id="cb235-10"><a href="application-estimating-risk-preferences.html#cb235-10" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">2</span><span class="op">]</span> prizerange<span class="op">;</span></span>
<span id="cb235-11"><a href="application-estimating-risk-preferences.html#cb235-11" tabindex="-1"></a>  </span>
<span id="cb235-12"><a href="application-estimating-risk-preferences.html#cb235-12" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_r<span class="op">;</span></span>
<span id="cb235-13"><a href="application-estimating-risk-preferences.html#cb235-13" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_lambda<span class="op">;</span></span>
<span id="cb235-14"><a href="application-estimating-risk-preferences.html#cb235-14" tabindex="-1"></a>  </span>
<span id="cb235-15"><a href="application-estimating-risk-preferences.html#cb235-15" tabindex="-1"></a>  </span>
<span id="cb235-16"><a href="application-estimating-risk-preferences.html#cb235-16" tabindex="-1"></a>  <span class="co">// information about the certainty equivalents</span></span>
<span id="cb235-17"><a href="application-estimating-risk-preferences.html#cb235-17" tabindex="-1"></a>  <span class="dt">int</span> nCE<span class="op">;</span> <span class="co">// number of certainty equivalents to evaluate</span></span>
<span id="cb235-18"><a href="application-estimating-risk-preferences.html#cb235-18" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> CEprizes<span class="op">[</span>nCE<span class="op">];</span> <span class="co">// prizes for the lottery for certainty equivalents</span></span>
<span id="cb235-19"><a href="application-estimating-risk-preferences.html#cb235-19" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> CEprobs<span class="op">[</span>nCE<span class="op">];</span> <span class="co">// probabilities for the lottery for certainty equivalents</span></span>
<span id="cb235-20"><a href="application-estimating-risk-preferences.html#cb235-20" tabindex="-1"></a>  </span>
<span id="cb235-21"><a href="application-estimating-risk-preferences.html#cb235-21" tabindex="-1"></a>  </span>
<span id="cb235-22"><a href="application-estimating-risk-preferences.html#cb235-22" tabindex="-1"></a>  </span>
<span id="cb235-23"><a href="application-estimating-risk-preferences.html#cb235-23" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb235-24"><a href="application-estimating-risk-preferences.html#cb235-24" tabindex="-1"></a></span>
<span id="cb235-25"><a href="application-estimating-risk-preferences.html#cb235-25" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb235-26"><a href="application-estimating-risk-preferences.html#cb235-26" tabindex="-1"></a>  <span class="co">// We are going to have to compute this difference a lot, so it is best to pre-compute it</span></span>
<span id="cb235-27"><a href="application-estimating-risk-preferences.html#cb235-27" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> dprob <span class="op">=</span> pLeft<span class="op">-</span>pRight<span class="op">;</span></span>
<span id="cb235-28"><a href="application-estimating-risk-preferences.html#cb235-28" tabindex="-1"></a>  </span>
<span id="cb235-29"><a href="application-estimating-risk-preferences.html#cb235-29" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb235-30"><a href="application-estimating-risk-preferences.html#cb235-30" tabindex="-1"></a></span>
<span id="cb235-31"><a href="application-estimating-risk-preferences.html#cb235-31" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb235-32"><a href="application-estimating-risk-preferences.html#cb235-32" tabindex="-1"></a>  </span>
<span id="cb235-33"><a href="application-estimating-risk-preferences.html#cb235-33" tabindex="-1"></a>  real r<span class="op">;</span></span>
<span id="cb235-34"><a href="application-estimating-risk-preferences.html#cb235-34" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> lambda<span class="op">;</span></span>
<span id="cb235-35"><a href="application-estimating-risk-preferences.html#cb235-35" tabindex="-1"></a> </span>
<span id="cb235-36"><a href="application-estimating-risk-preferences.html#cb235-36" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb235-37"><a href="application-estimating-risk-preferences.html#cb235-37" tabindex="-1"></a></span>
<span id="cb235-38"><a href="application-estimating-risk-preferences.html#cb235-38" tabindex="-1"></a></span>
<span id="cb235-39"><a href="application-estimating-risk-preferences.html#cb235-39" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb235-40"><a href="application-estimating-risk-preferences.html#cb235-40" tabindex="-1"></a>  </span>
<span id="cb235-41"><a href="application-estimating-risk-preferences.html#cb235-41" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb235-42"><a href="application-estimating-risk-preferences.html#cb235-42" tabindex="-1"></a>  target <span class="op">+=</span> normal_lpdf<span class="op">(</span>r <span class="op">|</span> prior_r<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_r<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb235-43"><a href="application-estimating-risk-preferences.html#cb235-43" tabindex="-1"></a>  target <span class="op">+=</span> lognormal_lpdf<span class="op">(</span>lambda <span class="op">|</span> prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb235-44"><a href="application-estimating-risk-preferences.html#cb235-44" tabindex="-1"></a>  </span>
<span id="cb235-45"><a href="application-estimating-risk-preferences.html#cb235-45" tabindex="-1"></a>  </span>
<span id="cb235-46"><a href="application-estimating-risk-preferences.html#cb235-46" tabindex="-1"></a>  <span class="co">// likelihood</span></span>
<span id="cb235-47"><a href="application-estimating-risk-preferences.html#cb235-47" tabindex="-1"></a>  </span>
<span id="cb235-48"><a href="application-estimating-risk-preferences.html#cb235-48" tabindex="-1"></a>  target <span class="op">+=</span> bernoulli_logit_lpmf<span class="op">(</span> Left <span class="op">|</span> </span>
<span id="cb235-49"><a href="application-estimating-risk-preferences.html#cb235-49" tabindex="-1"></a>    lambda <span class="op">*</span> <span class="op">((</span></span>
<span id="cb235-50"><a href="application-estimating-risk-preferences.html#cb235-50" tabindex="-1"></a>      dprob<span class="op">.*</span>pow<span class="op">(</span>prizes<span class="op">,</span><span class="fl">1.0</span><span class="op">-</span>r<span class="op">)</span></span>
<span id="cb235-51"><a href="application-estimating-risk-preferences.html#cb235-51" tabindex="-1"></a>    <span class="op">)*</span>rep_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span><span class="dv">3</span><span class="op">)</span></span>
<span id="cb235-52"><a href="application-estimating-risk-preferences.html#cb235-52" tabindex="-1"></a>    <span class="op">)</span> </span>
<span id="cb235-53"><a href="application-estimating-risk-preferences.html#cb235-53" tabindex="-1"></a>    <span class="op">./</span> <span class="co">// contextual utility normalization</span></span>
<span id="cb235-54"><a href="application-estimating-risk-preferences.html#cb235-54" tabindex="-1"></a>    <span class="op">(</span></span>
<span id="cb235-55"><a href="application-estimating-risk-preferences.html#cb235-55" tabindex="-1"></a>      pow<span class="op">(</span>prizerange<span class="op">[,</span><span class="dv">2</span><span class="op">],</span><span class="fl">1.0</span><span class="op">-</span>r<span class="op">)-</span>pow<span class="op">(</span>prizerange<span class="op">[,</span><span class="dv">1</span><span class="op">],</span><span class="fl">1.0</span><span class="op">-</span>r<span class="op">)</span></span>
<span id="cb235-56"><a href="application-estimating-risk-preferences.html#cb235-56" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb235-57"><a href="application-estimating-risk-preferences.html#cb235-57" tabindex="-1"></a>  <span class="op">);</span></span>
<span id="cb235-58"><a href="application-estimating-risk-preferences.html#cb235-58" tabindex="-1"></a>  </span>
<span id="cb235-59"><a href="application-estimating-risk-preferences.html#cb235-59" tabindex="-1"></a>  </span>
<span id="cb235-60"><a href="application-estimating-risk-preferences.html#cb235-60" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb235-61"><a href="application-estimating-risk-preferences.html#cb235-61" tabindex="-1"></a>generated quantities <span class="op">{</span></span>
<span id="cb235-62"><a href="application-estimating-risk-preferences.html#cb235-62" tabindex="-1"></a>  </span>
<span id="cb235-63"><a href="application-estimating-risk-preferences.html#cb235-63" tabindex="-1"></a>  <span class="co">// calculate certainty equivalents</span></span>
<span id="cb235-64"><a href="application-estimating-risk-preferences.html#cb235-64" tabindex="-1"></a>  </span>
<span id="cb235-65"><a href="application-estimating-risk-preferences.html#cb235-65" tabindex="-1"></a>  vector<span class="op">[</span>nCE<span class="op">]</span> CE<span class="op">;</span></span>
<span id="cb235-66"><a href="application-estimating-risk-preferences.html#cb235-66" tabindex="-1"></a>  </span>
<span id="cb235-67"><a href="application-estimating-risk-preferences.html#cb235-67" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>cc in <span class="dv">1</span><span class="op">:</span>nCE<span class="op">)</span> <span class="op">{</span></span>
<span id="cb235-68"><a href="application-estimating-risk-preferences.html#cb235-68" tabindex="-1"></a>    </span>
<span id="cb235-69"><a href="application-estimating-risk-preferences.html#cb235-69" tabindex="-1"></a>    CE<span class="op">[</span>cc<span class="op">]</span> <span class="op">=</span> pow<span class="op">(</span>pow<span class="op">(</span>CEprizes<span class="op">[</span>cc<span class="op">],</span><span class="fl">1.0</span><span class="op">-</span>r<span class="op">)</span><span class="ch">&#39;*</span><span class="er">CEprobs[cc],1.0/(1.0-r));</span></span>
<span id="cb235-70"><a href="application-estimating-risk-preferences.html#cb235-70" tabindex="-1"></a>    </span>
<span id="cb235-71"><a href="application-estimating-risk-preferences.html#cb235-71" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb235-72"><a href="application-estimating-risk-preferences.html#cb235-72" tabindex="-1"></a>  </span>
<span id="cb235-73"><a href="application-estimating-risk-preferences.html#cb235-73" tabindex="-1"></a>  </span>
<span id="cb235-74"><a href="application-estimating-risk-preferences.html#cb235-74" tabindex="-1"></a>  </span>
<span id="cb235-75"><a href="application-estimating-risk-preferences.html#cb235-75" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Figure <a href="application-estimating-risk-preferences.html#fig:RiskPreferencesEUTIndividual">19.3</a> summarizes the parameter estimates from the participant-specific estimations (black curves and red error bars), alongside the prior distribution (blue curves). Compared to the prior, we can see that participants are mostly <em>less</em> precise and <em>more</em> risk-averse than we expected. I would not read too much into this right now, as we will be taking a more flexible model to the data soon.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="application-estimating-risk-preferences.html#cb236-1" tabindex="-1"></a>EUTIndividual<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">&quot;Code/RiskPreferences/Estimates_individual.rds&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb236-2"><a href="application-estimating-risk-preferences.html#cb236-2" tabindex="-1"></a>  <span class="fu">filter</span>(model<span class="sc">==</span><span class="st">&quot;EUT&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb236-3"><a href="application-estimating-risk-preferences.html#cb236-3" tabindex="-1"></a>  <span class="fu">group_by</span>(parameter) <span class="sc">|&gt;</span></span>
<span id="cb236-4"><a href="application-estimating-risk-preferences.html#cb236-4" tabindex="-1"></a>  <span class="fu">arrange</span>(mean) <span class="sc">|&gt;</span></span>
<span id="cb236-5"><a href="application-estimating-risk-preferences.html#cb236-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cumulative =</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())<span class="sc">/</span><span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb236-6"><a href="application-estimating-risk-preferences.html#cb236-6" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb236-7"><a href="application-estimating-risk-preferences.html#cb236-7" tabindex="-1"></a></span>
<span id="cb236-8"><a href="application-estimating-risk-preferences.html#cb236-8" tabindex="-1"></a>prior<span class="ot">&lt;-</span><span class="fu">tibble</span>(</span>
<span id="cb236-9"><a href="application-estimating-risk-preferences.html#cb236-9" tabindex="-1"></a>  <span class="at">parameter =</span> <span class="st">&quot;r&quot;</span>,</span>
<span id="cb236-10"><a href="application-estimating-risk-preferences.html#cb236-10" tabindex="-1"></a>  <span class="at">x =</span>  <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">3</span>,<span class="at">length=</span><span class="dv">1001</span>),</span>
<span id="cb236-11"><a href="application-estimating-risk-preferences.html#cb236-11" tabindex="-1"></a>  <span class="at">cdf =</span> <span class="fu">pnorm</span>(x,<span class="at">mean=</span><span class="fl">0.27</span>,<span class="at">sd=</span><span class="fl">0.36</span>)</span>
<span id="cb236-12"><a href="application-estimating-risk-preferences.html#cb236-12" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb236-13"><a href="application-estimating-risk-preferences.html#cb236-13" tabindex="-1"></a>  <span class="fu">rbind</span>(</span>
<span id="cb236-14"><a href="application-estimating-risk-preferences.html#cb236-14" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb236-15"><a href="application-estimating-risk-preferences.html#cb236-15" tabindex="-1"></a>      <span class="at">parameter =</span> <span class="st">&quot;lambda&quot;</span>,</span>
<span id="cb236-16"><a href="application-estimating-risk-preferences.html#cb236-16" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">110</span>,<span class="at">length=</span><span class="dv">1001</span>),</span>
<span id="cb236-17"><a href="application-estimating-risk-preferences.html#cb236-17" tabindex="-1"></a>      <span class="at">cdf =</span> <span class="fu">pnorm</span>(<span class="fu">log</span>(x),<span class="at">mean=</span><span class="fl">3.45</span>,<span class="at">sd=</span><span class="fl">0.59</span>)</span>
<span id="cb236-18"><a href="application-estimating-risk-preferences.html#cb236-18" tabindex="-1"></a>    )</span>
<span id="cb236-19"><a href="application-estimating-risk-preferences.html#cb236-19" tabindex="-1"></a>  )</span>
<span id="cb236-20"><a href="application-estimating-risk-preferences.html#cb236-20" tabindex="-1"></a></span>
<span id="cb236-21"><a href="application-estimating-risk-preferences.html#cb236-21" tabindex="-1"></a>  </span>
<span id="cb236-22"><a href="application-estimating-risk-preferences.html#cb236-22" tabindex="-1"></a></span>
<span id="cb236-23"><a href="application-estimating-risk-preferences.html#cb236-23" tabindex="-1"></a>(</span>
<span id="cb236-24"><a href="application-estimating-risk-preferences.html#cb236-24" tabindex="-1"></a>  <span class="fu">ggplot</span>()</span>
<span id="cb236-25"><a href="application-estimating-risk-preferences.html#cb236-25" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">stat_ecdf</span>(<span class="at">data=</span>EUTIndividual <span class="sc">|&gt;</span> <span class="fu">filter</span>(parameter <span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>),<span class="fu">aes</span>(<span class="at">x=</span>mean))</span>
<span id="cb236-26"><a href="application-estimating-risk-preferences.html#cb236-26" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_line</span>(<span class="at">data=</span>prior,<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>cdf),<span class="at">color=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb236-27"><a href="application-estimating-risk-preferences.html#cb236-27" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb236-28"><a href="application-estimating-risk-preferences.html#cb236-28" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_errorbar</span>(<span class="at">alpha=</span><span class="fl">0.2</span>,<span class="at">color=</span><span class="st">&quot;red&quot;</span>,<span class="at">data=</span>EUTIndividual <span class="sc">|&gt;</span> <span class="fu">filter</span>(parameter <span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>),<span class="fu">aes</span>(<span class="at">y=</span>cumulative,<span class="at">xmin=</span>X25.,<span class="at">xmax=</span>X75.))</span>
<span id="cb236-29"><a href="application-estimating-risk-preferences.html#cb236-29" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>parameter,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>)</span>
<span id="cb236-30"><a href="application-estimating-risk-preferences.html#cb236-30" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Cumulative probability&quot;</span>)</span>
<span id="cb236-31"><a href="application-estimating-risk-preferences.html#cb236-31" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;Estimate&quot;</span>)</span>
<span id="cb236-32"><a href="application-estimating-risk-preferences.html#cb236-32" tabindex="-1"></a>) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:RiskPreferencesEUTIndividual"></span>
<img src="index_files/figure-html/RiskPreferencesEUTIndividual-1.png" alt="Estimates from individual estimation of the EUT model. Empirical cumulative density functions (black curves) of individual posterior means (black lines) and 50% Bayesian credible regions (red lines). Blue curves show the prior cumulative density functions. CE[1] is the certainty equivalent for a 95% channce of winning $10, $80 otherwise. CE[2] is the certainty equivalent for a 5% chance of winning $10, $80 otherwise." width="672" />
<p class="caption">
Figure 19.3: Estimates from individual estimation of the EUT model. Empirical cumulative density functions (black curves) of individual posterior means (black lines) and 50% Bayesian credible regions (red lines). Blue curves show the prior cumulative density functions. CE[1] is the certainty equivalent for a 95% channce of winning $10, $80 otherwise. CE[2] is the certainty equivalent for a 5% chance of winning $10, $80 otherwise.
</p>
</div>
</div>
<div id="rank-dependent-utility-quiggin1982" class="section level3 hasAnchor" number="19.3.2">
<h3><span class="header-section-number">19.3.2</span> Rank-dependent utility <span class="citation">(<a href="#ref-Quiggin1982">Quiggin 1982</a>)</span><a href="application-estimating-risk-preferences.html#rank-dependent-utility-quiggin1982" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>So where do we go from here? We will of course be estimating a hierarchical model using all of the data, but before then we will stay in the realm of single participant estimation, and estimate a more flexible model.
One such model is the <em>rank-dependent utility</em> (RDU) model <span class="citation">(<a href="#ref-Quiggin1982">Quiggin 1982</a>)</span>. Compared to the EUT model, where probabilities enter into the utility function <em>linearly</em> (hence the “expected” part), the RDU model weights probabilities. In particular, RDU participants distort the <em>cumulative</em> distribution of prizes relative to an EUT participant.
The RDU model uses a <em>probability weighting function</em>, which I will denote <span class="math inline">\(\omega_i(p)\)</span>, to distort these cumulative probabilities. That is, when the actual cumulative probability for a prize is <span class="math inline">\(p\)</span>, RDU participants will behave as if it is actually <span class="math inline">\(\omega_i\)</span>(p). In this application, I adopt the convention that prizes are ranked from lowest to highest, but in other applications the reverse is also common.</p>
<p>For this application, I will use the <span class="citation">Prelec (<a href="#ref-Prelec1998">1998</a>)</span> specification of the probability-weighting function:<a href="#fn90" class="footnote-ref" id="fnref90"><sup>90</sup></a></p>
<p><span class="math display">\[
\omega_i(p)=\exp(-\eta_i(-\log p)^{\psi_i})
\]</span></p>
<p>where <span class="math inline">\(\eta_i,\psi_i&gt;0\)</span> are the function’s parameters. When <span class="math inline">\(\eta_i=\psi_i=1\)</span> this function becomes <span class="math inline">\(\omega_i(p)=p\)</span>, which means that cumulative probabilities are <em>not</em> distorted, and so we are back to EUT.</p>
<p>These weighted cumulative probabilities are then converted into (de-cumulated, for want of a better word) “decision-weights” <span class="math inline">\(\pi_i\)</span>, which then enter into the decision-maker’s utility function as follows:</p>
<p><span class="math display">\[
\begin{aligned}
V_i(q,x)&amp;=\sum_{k=1}^K\pi_{i,k}(q)u_i(x_k)\\
\text{where: }\pi_{i,1}(q)&amp;=\omega_i(q_1)\\
\pi_{i,2}(q)&amp;=\omega_i(q_1+q_2)-\omega(q_1)\\
\pi_{i,k}(q)&amp;=\omega_i\left(\sum_{j=1}^kq_k\right)-\omega_i\left(\sum_{j=1}^{k-1}q_k\right)
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(q_k\)</span> and <span class="math inline">\(x_k\)</span> are the <span class="math inline">\(k\)</span>th probability and prize of the lottery, respectively.</p>
<p>I will use the same logit choice rule, CRRA parameterization of the utility function, and contextual utility normalization in this model as I do with the EUT models.</p>
<p>Before moving on to estimating the model, it is important to note a computational persnickety-ness that comes with using the Prelec weighting function: it will return an <code>Inf</code> or a <code>NaN</code> when we try to evaluate it at cumulative probabilities equal to zero or one. This is a real problem, because our lotteries will <em>always</em> have a cumulative probability equal to one, and many experiment designs, including <span class="citation">Hey (<a href="#ref-Hey2001">2001</a>)</span>, have cumulative probabilities equal to zero. Fortunately, the <em>limits</em> as cumulative probabilities approach these value are just zero and one, so we can do a bit of a computational monkey trick to fix the problem. Specifically, instead we can evaluate:</p>
<p><span class="math display">\[
\begin{aligned}
\omega_i&amp;\left[p+0.01(I(p=0)-I(p=1)\right](1-I(p=0)-I(p=1))+I(p=1)\\
&amp;=\begin{cases}
\omega_i(p)&amp;\text{if }p\in(0,1)\\
0&amp;\text{if }p=0\\
1&amp;\text{if }p=1
\end{cases}
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(I(\cdot)\)</span> is the indicator function. That is, inside the function <span class="math inline">\(\omega\)</span>, we add a little bit if <span class="math inline">\(p=0\)</span>, and we subtract a little bit if <span class="math inline">\(p=1\)</span>. We then correct this by ensuring the function returns exactly 0 or 1 in these cases. In practice, I have found it a bad idea to ask <em>Stan</em> whether a real-valued data element is exactly equal to something. This is because there can be minuscule rounding errors in the calculations that get to this number. Hence, you will see in the <em>Stan</em> file below I have <code>if</code> statements of the form <code>if (q&lt;tol)</code>, where <code>tol</code> is a very small positive number, instead of one of the form <code>if (p==0)</code>.</p>
<p>Before estimating this model, we need to do a quick prior calibration. Since <span class="math inline">\(r_i\)</span> and <span class="math inline">\(\lambda_i\)</span> have the same interpretation as the EUT model, I will keep these priors as:</p>
<p><span class="math display">\[
\begin{aligned}
r_i&amp;\sim N(0.27,0.36^2)\\
\log\lambda_i&amp;\sim N(3.45,0.59^2)
\end{aligned}
\]</span></p>
<p>For <span class="math inline">\(\eta_i\)</span> and <span class="math inline">\(\psi_i\)</span>, log-normal priors are appropriate because these parameters must be non-negative. Furthermore, centering their medians on <span class="math inline">\(\eta_i=\psi_i=1\)</span> will center these priors on the EUT model, which seems as good a place as any to start without considering any more information. I ended up using the following priors for these parameters:</p>
<p><span class="math display">\[
\begin{aligned}
\log\eta_i&amp;\sim N(\log(1),1^2)\\
\log\psi_i&amp;\sim N(\log(1),1^2)
\end{aligned}
\]</span></p>
<p>Here is the <em>Stan</em> file I wrote to estimate the RDU model and calculate the certainty equivalents:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb237-1"><a href="application-estimating-risk-preferences.html#cb237-1" tabindex="-1"></a></span>
<span id="cb237-2"><a href="application-estimating-risk-preferences.html#cb237-2" tabindex="-1"></a>functions <span class="op">{</span></span>
<span id="cb237-3"><a href="application-estimating-risk-preferences.html#cb237-3" tabindex="-1"></a>  </span>
<span id="cb237-4"><a href="application-estimating-risk-preferences.html#cb237-4" tabindex="-1"></a>  matrix decisionWeights<span class="op">(</span></span>
<span id="cb237-5"><a href="application-estimating-risk-preferences.html#cb237-5" tabindex="-1"></a>    real psi<span class="op">,</span> real eta<span class="op">,</span></span>
<span id="cb237-6"><a href="application-estimating-risk-preferences.html#cb237-6" tabindex="-1"></a>    data matrix cprob<span class="op">,</span> data matrix cprob0<span class="op">,</span> data matrix cprob1</span>
<span id="cb237-7"><a href="application-estimating-risk-preferences.html#cb237-7" tabindex="-1"></a>  <span class="op">)</span> <span class="op">{</span></span>
<span id="cb237-8"><a href="application-estimating-risk-preferences.html#cb237-8" tabindex="-1"></a>    </span>
<span id="cb237-9"><a href="application-estimating-risk-preferences.html#cb237-9" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> num_elements<span class="op">(</span>cprob<span class="op">)%/%</span><span class="dv">3</span><span class="op">;</span></span>
<span id="cb237-10"><a href="application-estimating-risk-preferences.html#cb237-10" tabindex="-1"></a>    </span>
<span id="cb237-11"><a href="application-estimating-risk-preferences.html#cb237-11" tabindex="-1"></a>    <span class="co">/* Weighted cumulative probabilities</span></span>
<span id="cb237-12"><a href="application-estimating-risk-preferences.html#cb237-12" tabindex="-1"></a><span class="co">    Here we need to watch out for p=0 and p=1 problems, where the weighting</span></span>
<span id="cb237-13"><a href="application-estimating-risk-preferences.html#cb237-13" tabindex="-1"></a><span class="co">    function is undefined, but is 0 and 1 in the limit respectively. Here</span></span>
<span id="cb237-14"><a href="application-estimating-risk-preferences.html#cb237-14" tabindex="-1"></a><span class="co">    I avoid getting NaNs by adding a little bit when p=0, and subtracting </span></span>
<span id="cb237-15"><a href="application-estimating-risk-preferences.html#cb237-15" tabindex="-1"></a><span class="co">    a little bit when p=1. I then substitute in the limit exactly just below</span></span>
<span id="cb237-16"><a href="application-estimating-risk-preferences.html#cb237-16" tabindex="-1"></a><span class="co">    this</span></span>
<span id="cb237-17"><a href="application-estimating-risk-preferences.html#cb237-17" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb237-18"><a href="application-estimating-risk-preferences.html#cb237-18" tabindex="-1"></a>    </span>
<span id="cb237-19"><a href="application-estimating-risk-preferences.html#cb237-19" tabindex="-1"></a>    matrix<span class="op">[</span>n<span class="op">,</span><span class="dv">3</span><span class="op">]</span> wcprob <span class="op">=</span> exp<span class="op">(</span></span>
<span id="cb237-20"><a href="application-estimating-risk-preferences.html#cb237-20" tabindex="-1"></a>      <span class="op">-</span>eta <span class="op">*</span> pow<span class="op">(-</span>log<span class="op">(</span>cprob<span class="op">+</span><span class="fl">0.01</span><span class="op">*(</span>cprob0<span class="op">-</span>cprob1<span class="op">)),</span>psi<span class="op">)</span></span>
<span id="cb237-21"><a href="application-estimating-risk-preferences.html#cb237-21" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb237-22"><a href="application-estimating-risk-preferences.html#cb237-22" tabindex="-1"></a>    wcprob <span class="op">=</span> wcprob<span class="op">.*(</span><span class="fl">1.0</span><span class="op">-</span>cprob0<span class="op">-</span>cprob1<span class="op">)+</span>cprob1<span class="op">;</span></span>
<span id="cb237-23"><a href="application-estimating-risk-preferences.html#cb237-23" tabindex="-1"></a>    </span>
<span id="cb237-24"><a href="application-estimating-risk-preferences.html#cb237-24" tabindex="-1"></a>    <span class="co">// convert to decision weights</span></span>
<span id="cb237-25"><a href="application-estimating-risk-preferences.html#cb237-25" tabindex="-1"></a>    </span>
<span id="cb237-26"><a href="application-estimating-risk-preferences.html#cb237-26" tabindex="-1"></a>    matrix<span class="op">[</span>n<span class="op">,</span><span class="dv">3</span><span class="op">]</span> wprob <span class="op">=</span> wcprob<span class="op">;</span></span>
<span id="cb237-27"><a href="application-estimating-risk-preferences.html#cb237-27" tabindex="-1"></a>    </span>
<span id="cb237-28"><a href="application-estimating-risk-preferences.html#cb237-28" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>kk in <span class="dv">2</span><span class="op">:</span><span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb237-29"><a href="application-estimating-risk-preferences.html#cb237-29" tabindex="-1"></a>      wprob<span class="op">[,</span>kk<span class="op">]</span> <span class="op">=</span> wcprob<span class="op">[,</span>kk<span class="op">]-</span>wcprob<span class="op">[,</span>kk<span class="op">-</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb237-30"><a href="application-estimating-risk-preferences.html#cb237-30" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb237-31"><a href="application-estimating-risk-preferences.html#cb237-31" tabindex="-1"></a>    </span>
<span id="cb237-32"><a href="application-estimating-risk-preferences.html#cb237-32" tabindex="-1"></a>    <span class="cf">return</span> wprob<span class="op">;</span></span>
<span id="cb237-33"><a href="application-estimating-risk-preferences.html#cb237-33" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb237-34"><a href="application-estimating-risk-preferences.html#cb237-34" tabindex="-1"></a>  </span>
<span id="cb237-35"><a href="application-estimating-risk-preferences.html#cb237-35" tabindex="-1"></a>  <span class="co">/* Calculating the certainty equivalent is a little more tricky for RDU, so</span></span>
<span id="cb237-36"><a href="application-estimating-risk-preferences.html#cb237-36" tabindex="-1"></a><span class="co">  I am writing a function to do it so as not to clutter up the generated quantities</span></span>
<span id="cb237-37"><a href="application-estimating-risk-preferences.html#cb237-37" tabindex="-1"></a><span class="co">  block</span></span>
<span id="cb237-38"><a href="application-estimating-risk-preferences.html#cb237-38" tabindex="-1"></a><span class="co">  */</span></span>
<span id="cb237-39"><a href="application-estimating-risk-preferences.html#cb237-39" tabindex="-1"></a>  </span>
<span id="cb237-40"><a href="application-estimating-risk-preferences.html#cb237-40" tabindex="-1"></a>  real calcCE<span class="op">(</span>vector probs<span class="op">,</span> vector prizes<span class="op">,</span>real r<span class="op">,</span> real psi<span class="op">,</span>real eta<span class="op">,</span>real tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb237-41"><a href="application-estimating-risk-preferences.html#cb237-41" tabindex="-1"></a>    </span>
<span id="cb237-42"><a href="application-estimating-risk-preferences.html#cb237-42" tabindex="-1"></a>    vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> cprobs <span class="op">=</span> probs<span class="op">;</span></span>
<span id="cb237-43"><a href="application-estimating-risk-preferences.html#cb237-43" tabindex="-1"></a>    </span>
<span id="cb237-44"><a href="application-estimating-risk-preferences.html#cb237-44" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>pp in <span class="dv">2</span><span class="op">:</span><span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb237-45"><a href="application-estimating-risk-preferences.html#cb237-45" tabindex="-1"></a>      </span>
<span id="cb237-46"><a href="application-estimating-risk-preferences.html#cb237-46" tabindex="-1"></a>      cprobs<span class="op">[</span>pp<span class="op">]</span> <span class="op">=</span> cprobs<span class="op">[</span>pp<span class="op">-</span><span class="dv">1</span><span class="op">]+</span>probs<span class="op">[</span>pp<span class="op">];</span></span>
<span id="cb237-47"><a href="application-estimating-risk-preferences.html#cb237-47" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb237-48"><a href="application-estimating-risk-preferences.html#cb237-48" tabindex="-1"></a>    </span>
<span id="cb237-49"><a href="application-estimating-risk-preferences.html#cb237-49" tabindex="-1"></a>    vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> wcprobs <span class="op">=</span> exp<span class="op">(</span></span>
<span id="cb237-50"><a href="application-estimating-risk-preferences.html#cb237-50" tabindex="-1"></a>      <span class="op">-</span>eta <span class="op">*</span> pow<span class="op">(-</span>log<span class="op">(</span>cprobs<span class="op">),</span>psi<span class="op">)</span></span>
<span id="cb237-51"><a href="application-estimating-risk-preferences.html#cb237-51" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb237-52"><a href="application-estimating-risk-preferences.html#cb237-52" tabindex="-1"></a>    </span>
<span id="cb237-53"><a href="application-estimating-risk-preferences.html#cb237-53" tabindex="-1"></a>    wcprobs<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span> <span class="co">// avoids getting a NaN. This mucst be 1</span></span>
<span id="cb237-54"><a href="application-estimating-risk-preferences.html#cb237-54" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>pp in <span class="dv">1</span><span class="op">:</span><span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb237-55"><a href="application-estimating-risk-preferences.html#cb237-55" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>wcprobs<span class="op">[</span>pp<span class="op">]&lt;</span>tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb237-56"><a href="application-estimating-risk-preferences.html#cb237-56" tabindex="-1"></a>        wcprobs<span class="op">[</span>pp<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb237-57"><a href="application-estimating-risk-preferences.html#cb237-57" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb237-58"><a href="application-estimating-risk-preferences.html#cb237-58" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb237-59"><a href="application-estimating-risk-preferences.html#cb237-59" tabindex="-1"></a>    </span>
<span id="cb237-60"><a href="application-estimating-risk-preferences.html#cb237-60" tabindex="-1"></a>    vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> wprobs <span class="op">=</span> wcprobs<span class="op">;</span></span>
<span id="cb237-61"><a href="application-estimating-risk-preferences.html#cb237-61" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>pp in <span class="dv">2</span><span class="op">:</span><span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb237-62"><a href="application-estimating-risk-preferences.html#cb237-62" tabindex="-1"></a>      wprobs<span class="op">[</span>pp<span class="op">]</span> <span class="op">=</span> wcprobs<span class="op">[</span>pp<span class="op">]-</span>wcprobs<span class="op">[</span>pp<span class="op">-</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb237-63"><a href="application-estimating-risk-preferences.html#cb237-63" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb237-64"><a href="application-estimating-risk-preferences.html#cb237-64" tabindex="-1"></a>    </span>
<span id="cb237-65"><a href="application-estimating-risk-preferences.html#cb237-65" tabindex="-1"></a>    </span>
<span id="cb237-66"><a href="application-estimating-risk-preferences.html#cb237-66" tabindex="-1"></a>    <span class="cf">return</span> pow<span class="op">(</span>pow<span class="op">(</span>prizes<span class="op">,</span><span class="fl">1.0</span><span class="op">-</span>r<span class="op">)</span><span class="ch">&#39;*</span><span class="er">wprobs,1.0/(1.0-r));</span></span>
<span id="cb237-67"><a href="application-estimating-risk-preferences.html#cb237-67" tabindex="-1"></a>    </span>
<span id="cb237-68"><a href="application-estimating-risk-preferences.html#cb237-68" tabindex="-1"></a>    </span>
<span id="cb237-69"><a href="application-estimating-risk-preferences.html#cb237-69" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb237-70"><a href="application-estimating-risk-preferences.html#cb237-70" tabindex="-1"></a>  </span>
<span id="cb237-71"><a href="application-estimating-risk-preferences.html#cb237-71" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb237-72"><a href="application-estimating-risk-preferences.html#cb237-72" tabindex="-1"></a></span>
<span id="cb237-73"><a href="application-estimating-risk-preferences.html#cb237-73" tabindex="-1"></a></span>
<span id="cb237-74"><a href="application-estimating-risk-preferences.html#cb237-74" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb237-75"><a href="application-estimating-risk-preferences.html#cb237-75" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> N<span class="op">;</span> <span class="co">// total number of decisions</span></span>
<span id="cb237-76"><a href="application-estimating-risk-preferences.html#cb237-76" tabindex="-1"></a>  </span>
<span id="cb237-77"><a href="application-estimating-risk-preferences.html#cb237-77" tabindex="-1"></a>  <span class="dt">int</span> Left<span class="op">[</span>N<span class="op">];</span> <span class="co">// indicator for chose the Left lottery</span></span>
<span id="cb237-78"><a href="application-estimating-risk-preferences.html#cb237-78" tabindex="-1"></a>  </span>
<span id="cb237-79"><a href="application-estimating-risk-preferences.html#cb237-79" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> pLeft<span class="op">;</span> </span>
<span id="cb237-80"><a href="application-estimating-risk-preferences.html#cb237-80" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> pRight<span class="op">;</span></span>
<span id="cb237-81"><a href="application-estimating-risk-preferences.html#cb237-81" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> prizes<span class="op">;</span></span>
<span id="cb237-82"><a href="application-estimating-risk-preferences.html#cb237-82" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">2</span><span class="op">]</span> prizerange<span class="op">;</span></span>
<span id="cb237-83"><a href="application-estimating-risk-preferences.html#cb237-83" tabindex="-1"></a>  </span>
<span id="cb237-84"><a href="application-estimating-risk-preferences.html#cb237-84" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_r<span class="op">;</span></span>
<span id="cb237-85"><a href="application-estimating-risk-preferences.html#cb237-85" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_lambda<span class="op">;</span></span>
<span id="cb237-86"><a href="application-estimating-risk-preferences.html#cb237-86" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_psi<span class="op">;</span></span>
<span id="cb237-87"><a href="application-estimating-risk-preferences.html#cb237-87" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_eta<span class="op">;</span></span>
<span id="cb237-88"><a href="application-estimating-risk-preferences.html#cb237-88" tabindex="-1"></a>  </span>
<span id="cb237-89"><a href="application-estimating-risk-preferences.html#cb237-89" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> tol<span class="op">;</span></span>
<span id="cb237-90"><a href="application-estimating-risk-preferences.html#cb237-90" tabindex="-1"></a>  </span>
<span id="cb237-91"><a href="application-estimating-risk-preferences.html#cb237-91" tabindex="-1"></a>  <span class="co">// information about the certainty equivalents</span></span>
<span id="cb237-92"><a href="application-estimating-risk-preferences.html#cb237-92" tabindex="-1"></a>  <span class="dt">int</span> nCE<span class="op">;</span> <span class="co">// number of certainty equivalents to evaluate</span></span>
<span id="cb237-93"><a href="application-estimating-risk-preferences.html#cb237-93" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> CEprizes<span class="op">[</span>nCE<span class="op">];</span> <span class="co">// prizes for the lottery for certainty equivalents</span></span>
<span id="cb237-94"><a href="application-estimating-risk-preferences.html#cb237-94" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> CEprobs<span class="op">[</span>nCE<span class="op">];</span> <span class="co">// probabilities for the lottery for certainty equivalents</span></span>
<span id="cb237-95"><a href="application-estimating-risk-preferences.html#cb237-95" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb237-96"><a href="application-estimating-risk-preferences.html#cb237-96" tabindex="-1"></a></span>
<span id="cb237-97"><a href="application-estimating-risk-preferences.html#cb237-97" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb237-98"><a href="application-estimating-risk-preferences.html#cb237-98" tabindex="-1"></a>  </span>
<span id="cb237-99"><a href="application-estimating-risk-preferences.html#cb237-99" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> cprobLeft <span class="op">=</span> pLeft<span class="op">;</span></span>
<span id="cb237-100"><a href="application-estimating-risk-preferences.html#cb237-100" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> cprobRight <span class="op">=</span> pRight<span class="op">;</span></span>
<span id="cb237-101"><a href="application-estimating-risk-preferences.html#cb237-101" tabindex="-1"></a>  </span>
<span id="cb237-102"><a href="application-estimating-risk-preferences.html#cb237-102" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> cprobLeft0 <span class="op">=</span> rep_matrix<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>N<span class="op">,</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb237-103"><a href="application-estimating-risk-preferences.html#cb237-103" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> cprobLeft1 <span class="op">=</span> rep_matrix<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>N<span class="op">,</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb237-104"><a href="application-estimating-risk-preferences.html#cb237-104" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> cprobRight0 <span class="op">=</span> rep_matrix<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>N<span class="op">,</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb237-105"><a href="application-estimating-risk-preferences.html#cb237-105" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> cprobRight1 <span class="op">=</span> rep_matrix<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>N<span class="op">,</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb237-106"><a href="application-estimating-risk-preferences.html#cb237-106" tabindex="-1"></a>  </span>
<span id="cb237-107"><a href="application-estimating-risk-preferences.html#cb237-107" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>kk in <span class="dv">2</span><span class="op">:</span><span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb237-108"><a href="application-estimating-risk-preferences.html#cb237-108" tabindex="-1"></a>    cprobLeft<span class="op">[,</span>kk<span class="op">]</span> <span class="op">=</span> cprobLeft<span class="op">[,</span>kk<span class="op">-</span><span class="dv">1</span><span class="op">]+</span>pLeft<span class="op">[,</span>kk<span class="op">];</span></span>
<span id="cb237-109"><a href="application-estimating-risk-preferences.html#cb237-109" tabindex="-1"></a>    cprobRight<span class="op">[,</span>kk<span class="op">]</span> <span class="op">=</span> cprobRight<span class="op">[,</span>kk<span class="op">-</span><span class="dv">1</span><span class="op">]+</span>pRight<span class="op">[,</span>kk<span class="op">];</span></span>
<span id="cb237-110"><a href="application-estimating-risk-preferences.html#cb237-110" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb237-111"><a href="application-estimating-risk-preferences.html#cb237-111" tabindex="-1"></a>  </span>
<span id="cb237-112"><a href="application-estimating-risk-preferences.html#cb237-112" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>N<span class="op">)</span> <span class="op">{</span></span>
<span id="cb237-113"><a href="application-estimating-risk-preferences.html#cb237-113" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>kk in <span class="dv">1</span><span class="op">:</span><span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb237-114"><a href="application-estimating-risk-preferences.html#cb237-114" tabindex="-1"></a>      </span>
<span id="cb237-115"><a href="application-estimating-risk-preferences.html#cb237-115" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>cprobLeft<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]&lt;</span>tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb237-116"><a href="application-estimating-risk-preferences.html#cb237-116" tabindex="-1"></a>        cprobLeft0<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb237-117"><a href="application-estimating-risk-preferences.html#cb237-117" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb237-118"><a href="application-estimating-risk-preferences.html#cb237-118" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>cprobLeft<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]&gt;(</span><span class="fl">1.0</span><span class="op">-</span>tol<span class="op">))</span> <span class="op">{</span></span>
<span id="cb237-119"><a href="application-estimating-risk-preferences.html#cb237-119" tabindex="-1"></a>        cprobLeft1<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb237-120"><a href="application-estimating-risk-preferences.html#cb237-120" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb237-121"><a href="application-estimating-risk-preferences.html#cb237-121" tabindex="-1"></a>      </span>
<span id="cb237-122"><a href="application-estimating-risk-preferences.html#cb237-122" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>cprobRight<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]&lt;</span>tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb237-123"><a href="application-estimating-risk-preferences.html#cb237-123" tabindex="-1"></a>        cprobRight0<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb237-124"><a href="application-estimating-risk-preferences.html#cb237-124" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb237-125"><a href="application-estimating-risk-preferences.html#cb237-125" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>cprobRight<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]&gt;(</span><span class="fl">1.0</span><span class="op">-</span>tol<span class="op">))</span> <span class="op">{</span></span>
<span id="cb237-126"><a href="application-estimating-risk-preferences.html#cb237-126" tabindex="-1"></a>        cprobRight1<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb237-127"><a href="application-estimating-risk-preferences.html#cb237-127" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb237-128"><a href="application-estimating-risk-preferences.html#cb237-128" tabindex="-1"></a>      </span>
<span id="cb237-129"><a href="application-estimating-risk-preferences.html#cb237-129" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb237-130"><a href="application-estimating-risk-preferences.html#cb237-130" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb237-131"><a href="application-estimating-risk-preferences.html#cb237-131" tabindex="-1"></a>  </span>
<span id="cb237-132"><a href="application-estimating-risk-preferences.html#cb237-132" tabindex="-1"></a>  </span>
<span id="cb237-133"><a href="application-estimating-risk-preferences.html#cb237-133" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb237-134"><a href="application-estimating-risk-preferences.html#cb237-134" tabindex="-1"></a></span>
<span id="cb237-135"><a href="application-estimating-risk-preferences.html#cb237-135" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb237-136"><a href="application-estimating-risk-preferences.html#cb237-136" tabindex="-1"></a>  </span>
<span id="cb237-137"><a href="application-estimating-risk-preferences.html#cb237-137" tabindex="-1"></a>  real r<span class="op">;</span></span>
<span id="cb237-138"><a href="application-estimating-risk-preferences.html#cb237-138" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> lambda<span class="op">;</span></span>
<span id="cb237-139"><a href="application-estimating-risk-preferences.html#cb237-139" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> psi<span class="op">;</span></span>
<span id="cb237-140"><a href="application-estimating-risk-preferences.html#cb237-140" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> eta<span class="op">;</span></span>
<span id="cb237-141"><a href="application-estimating-risk-preferences.html#cb237-141" tabindex="-1"></a> </span>
<span id="cb237-142"><a href="application-estimating-risk-preferences.html#cb237-142" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb237-143"><a href="application-estimating-risk-preferences.html#cb237-143" tabindex="-1"></a></span>
<span id="cb237-144"><a href="application-estimating-risk-preferences.html#cb237-144" tabindex="-1"></a></span>
<span id="cb237-145"><a href="application-estimating-risk-preferences.html#cb237-145" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb237-146"><a href="application-estimating-risk-preferences.html#cb237-146" tabindex="-1"></a>  </span>
<span id="cb237-147"><a href="application-estimating-risk-preferences.html#cb237-147" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb237-148"><a href="application-estimating-risk-preferences.html#cb237-148" tabindex="-1"></a>  target <span class="op">+=</span> normal_lpdf<span class="op">(</span>r <span class="op">|</span> prior_r<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_r<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb237-149"><a href="application-estimating-risk-preferences.html#cb237-149" tabindex="-1"></a>  target <span class="op">+=</span> lognormal_lpdf<span class="op">(</span>lambda <span class="op">|</span> prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb237-150"><a href="application-estimating-risk-preferences.html#cb237-150" tabindex="-1"></a>  target <span class="op">+=</span> lognormal_lpdf<span class="op">(</span>psi <span class="op">|</span> prior_psi<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_psi<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb237-151"><a href="application-estimating-risk-preferences.html#cb237-151" tabindex="-1"></a>  target <span class="op">+=</span> lognormal_lpdf<span class="op">(</span>eta <span class="op">|</span> prior_eta<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_eta<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb237-152"><a href="application-estimating-risk-preferences.html#cb237-152" tabindex="-1"></a>  </span>
<span id="cb237-153"><a href="application-estimating-risk-preferences.html#cb237-153" tabindex="-1"></a>  </span>
<span id="cb237-154"><a href="application-estimating-risk-preferences.html#cb237-154" tabindex="-1"></a>  <span class="co">// likelihood</span></span>
<span id="cb237-155"><a href="application-estimating-risk-preferences.html#cb237-155" tabindex="-1"></a>  </span>
<span id="cb237-156"><a href="application-estimating-risk-preferences.html#cb237-156" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> dprob <span class="op">=</span> </span>
<span id="cb237-157"><a href="application-estimating-risk-preferences.html#cb237-157" tabindex="-1"></a>    decisionWeights<span class="op">(</span>psi<span class="op">,</span> eta<span class="op">,</span> cprobLeft<span class="op">,</span> cprobLeft0<span class="op">,</span> cprobLeft1<span class="op">)</span></span>
<span id="cb237-158"><a href="application-estimating-risk-preferences.html#cb237-158" tabindex="-1"></a>     <span class="op">-</span> </span>
<span id="cb237-159"><a href="application-estimating-risk-preferences.html#cb237-159" tabindex="-1"></a>    decisionWeights<span class="op">(</span>psi<span class="op">,</span> eta<span class="op">,</span> cprobRight<span class="op">,</span> cprobRight0<span class="op">,</span> cprobRight1<span class="op">)</span></span>
<span id="cb237-160"><a href="application-estimating-risk-preferences.html#cb237-160" tabindex="-1"></a>    <span class="op">;</span> </span>
<span id="cb237-161"><a href="application-estimating-risk-preferences.html#cb237-161" tabindex="-1"></a>      </span>
<span id="cb237-162"><a href="application-estimating-risk-preferences.html#cb237-162" tabindex="-1"></a>  </span>
<span id="cb237-163"><a href="application-estimating-risk-preferences.html#cb237-163" tabindex="-1"></a>  </span>
<span id="cb237-164"><a href="application-estimating-risk-preferences.html#cb237-164" tabindex="-1"></a>  target <span class="op">+=</span> bernoulli_logit_lpmf<span class="op">(</span> Left <span class="op">|</span> </span>
<span id="cb237-165"><a href="application-estimating-risk-preferences.html#cb237-165" tabindex="-1"></a>    lambda <span class="op">*</span> <span class="op">((</span></span>
<span id="cb237-166"><a href="application-estimating-risk-preferences.html#cb237-166" tabindex="-1"></a>      dprob<span class="op">.*</span>pow<span class="op">(</span>prizes<span class="op">,</span><span class="fl">1.0</span><span class="op">-</span>r<span class="op">)</span></span>
<span id="cb237-167"><a href="application-estimating-risk-preferences.html#cb237-167" tabindex="-1"></a>    <span class="op">)*</span>rep_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span><span class="dv">3</span><span class="op">)</span></span>
<span id="cb237-168"><a href="application-estimating-risk-preferences.html#cb237-168" tabindex="-1"></a>    <span class="op">)</span> </span>
<span id="cb237-169"><a href="application-estimating-risk-preferences.html#cb237-169" tabindex="-1"></a>    <span class="op">./</span> <span class="co">// contextual utility normalization</span></span>
<span id="cb237-170"><a href="application-estimating-risk-preferences.html#cb237-170" tabindex="-1"></a>    <span class="op">(</span></span>
<span id="cb237-171"><a href="application-estimating-risk-preferences.html#cb237-171" tabindex="-1"></a>      pow<span class="op">(</span>prizerange<span class="op">[,</span><span class="dv">2</span><span class="op">],</span><span class="fl">1.0</span><span class="op">-</span>r<span class="op">)-</span>pow<span class="op">(</span>prizerange<span class="op">[,</span><span class="dv">1</span><span class="op">],</span><span class="fl">1.0</span><span class="op">-</span>r<span class="op">)</span></span>
<span id="cb237-172"><a href="application-estimating-risk-preferences.html#cb237-172" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb237-173"><a href="application-estimating-risk-preferences.html#cb237-173" tabindex="-1"></a>  <span class="op">);</span></span>
<span id="cb237-174"><a href="application-estimating-risk-preferences.html#cb237-174" tabindex="-1"></a>  </span>
<span id="cb237-175"><a href="application-estimating-risk-preferences.html#cb237-175" tabindex="-1"></a>  </span>
<span id="cb237-176"><a href="application-estimating-risk-preferences.html#cb237-176" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb237-177"><a href="application-estimating-risk-preferences.html#cb237-177" tabindex="-1"></a></span>
<span id="cb237-178"><a href="application-estimating-risk-preferences.html#cb237-178" tabindex="-1"></a>generated quantities <span class="op">{</span></span>
<span id="cb237-179"><a href="application-estimating-risk-preferences.html#cb237-179" tabindex="-1"></a>  </span>
<span id="cb237-180"><a href="application-estimating-risk-preferences.html#cb237-180" tabindex="-1"></a>  <span class="co">// calculate certainty equivalents</span></span>
<span id="cb237-181"><a href="application-estimating-risk-preferences.html#cb237-181" tabindex="-1"></a>  </span>
<span id="cb237-182"><a href="application-estimating-risk-preferences.html#cb237-182" tabindex="-1"></a>  vector<span class="op">[</span>nCE<span class="op">]</span> CE<span class="op">;</span></span>
<span id="cb237-183"><a href="application-estimating-risk-preferences.html#cb237-183" tabindex="-1"></a>  </span>
<span id="cb237-184"><a href="application-estimating-risk-preferences.html#cb237-184" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>cc in <span class="dv">1</span><span class="op">:</span>nCE<span class="op">)</span> <span class="op">{</span></span>
<span id="cb237-185"><a href="application-estimating-risk-preferences.html#cb237-185" tabindex="-1"></a>    </span>
<span id="cb237-186"><a href="application-estimating-risk-preferences.html#cb237-186" tabindex="-1"></a>    CE<span class="op">[</span>cc<span class="op">]</span> <span class="op">=</span> calcCE<span class="op">(</span>CEprobs<span class="op">[</span>cc<span class="op">],</span> CEprizes<span class="op">[</span>cc<span class="op">],</span>r<span class="op">,</span>psi<span class="op">,</span>eta<span class="op">,</span>tol<span class="op">);</span></span>
<span id="cb237-187"><a href="application-estimating-risk-preferences.html#cb237-187" tabindex="-1"></a>    </span>
<span id="cb237-188"><a href="application-estimating-risk-preferences.html#cb237-188" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb237-189"><a href="application-estimating-risk-preferences.html#cb237-189" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Figure <a href="application-estimating-risk-preferences.html#fig:RiskPreferencesRDUIndividual">19.4</a> summarizes the estimates from these participant-specific estimations. In particular note that there appears to be a large concentration of estimates of <span class="math inline">\(\eta_i\)</span> and <span class="math inline">\(\psi_i\)</span> around one, which you can see in this Figure as steep parts of the empirical cdf of posterior means (black lines). This suggests that, at least for a reasonable minority of participants, the <span class="math inline">\(\eta_i=\psi_i=1\)</span> restriction does not seem too bad.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="application-estimating-risk-preferences.html#cb238-1" tabindex="-1"></a>RDUIndividual<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">&quot;Code/RiskPreferences/Estimates_individual.rds&quot;</span>) <span class="sc">|&gt;</span> </span>
<span id="cb238-2"><a href="application-estimating-risk-preferences.html#cb238-2" tabindex="-1"></a>  <span class="fu">filter</span>(model<span class="sc">==</span><span class="st">&quot;RDU&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb238-3"><a href="application-estimating-risk-preferences.html#cb238-3" tabindex="-1"></a>  <span class="fu">arrange</span>(id,parameter) <span class="sc">|&gt;</span></span>
<span id="cb238-4"><a href="application-estimating-risk-preferences.html#cb238-4" tabindex="-1"></a>  <span class="fu">group_by</span>(parameter) <span class="sc">|&gt;</span></span>
<span id="cb238-5"><a href="application-estimating-risk-preferences.html#cb238-5" tabindex="-1"></a>  <span class="fu">arrange</span>(mean) <span class="sc">|&gt;</span></span>
<span id="cb238-6"><a href="application-estimating-risk-preferences.html#cb238-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cumulative =</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())<span class="sc">/</span><span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb238-7"><a href="application-estimating-risk-preferences.html#cb238-7" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb238-8"><a href="application-estimating-risk-preferences.html#cb238-8" tabindex="-1"></a></span>
<span id="cb238-9"><a href="application-estimating-risk-preferences.html#cb238-9" tabindex="-1"></a>prior<span class="ot">&lt;-</span><span class="fu">tibble</span>(</span>
<span id="cb238-10"><a href="application-estimating-risk-preferences.html#cb238-10" tabindex="-1"></a>  <span class="at">parameter =</span> <span class="st">&quot;r&quot;</span>,</span>
<span id="cb238-11"><a href="application-estimating-risk-preferences.html#cb238-11" tabindex="-1"></a>  <span class="at">x =</span>  <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">3</span>,<span class="at">length=</span><span class="dv">1001</span>),</span>
<span id="cb238-12"><a href="application-estimating-risk-preferences.html#cb238-12" tabindex="-1"></a>  <span class="at">cdf =</span> <span class="fu">pnorm</span>(x,<span class="at">mean=</span><span class="fl">0.27</span>,<span class="at">sd=</span><span class="fl">0.36</span>)</span>
<span id="cb238-13"><a href="application-estimating-risk-preferences.html#cb238-13" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb238-14"><a href="application-estimating-risk-preferences.html#cb238-14" tabindex="-1"></a>  <span class="fu">rbind</span>(</span>
<span id="cb238-15"><a href="application-estimating-risk-preferences.html#cb238-15" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb238-16"><a href="application-estimating-risk-preferences.html#cb238-16" tabindex="-1"></a>      <span class="at">parameter =</span> <span class="st">&quot;lambda&quot;</span>,</span>
<span id="cb238-17"><a href="application-estimating-risk-preferences.html#cb238-17" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">110</span>,<span class="at">length=</span><span class="dv">1001</span>),</span>
<span id="cb238-18"><a href="application-estimating-risk-preferences.html#cb238-18" tabindex="-1"></a>      <span class="at">cdf =</span> <span class="fu">pnorm</span>(<span class="fu">log</span>(x),<span class="at">mean=</span><span class="fl">3.45</span>,<span class="at">sd=</span><span class="fl">0.59</span>)</span>
<span id="cb238-19"><a href="application-estimating-risk-preferences.html#cb238-19" tabindex="-1"></a>    )</span>
<span id="cb238-20"><a href="application-estimating-risk-preferences.html#cb238-20" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">rbind</span>(</span>
<span id="cb238-21"><a href="application-estimating-risk-preferences.html#cb238-21" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb238-22"><a href="application-estimating-risk-preferences.html#cb238-22" tabindex="-1"></a>      <span class="at">parameter =</span> <span class="st">&quot;psi&quot;</span>,</span>
<span id="cb238-23"><a href="application-estimating-risk-preferences.html#cb238-23" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">3</span>,<span class="at">length=</span><span class="dv">1001</span>),</span>
<span id="cb238-24"><a href="application-estimating-risk-preferences.html#cb238-24" tabindex="-1"></a>      <span class="at">cdf =</span> <span class="fu">pnorm</span>(<span class="fu">log</span>(x),<span class="at">mean=</span><span class="dv">0</span>,<span class="at">sd=</span><span class="dv">1</span>)</span>
<span id="cb238-25"><a href="application-estimating-risk-preferences.html#cb238-25" tabindex="-1"></a>    )</span>
<span id="cb238-26"><a href="application-estimating-risk-preferences.html#cb238-26" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> <span class="fu">rbind</span>(</span>
<span id="cb238-27"><a href="application-estimating-risk-preferences.html#cb238-27" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb238-28"><a href="application-estimating-risk-preferences.html#cb238-28" tabindex="-1"></a>      <span class="at">parameter =</span> <span class="st">&quot;eta&quot;</span>, </span>
<span id="cb238-29"><a href="application-estimating-risk-preferences.html#cb238-29" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">8</span>,<span class="at">length=</span><span class="dv">1001</span>),</span>
<span id="cb238-30"><a href="application-estimating-risk-preferences.html#cb238-30" tabindex="-1"></a>      <span class="at">cdf =</span> <span class="fu">pnorm</span>(<span class="fu">log</span>(x),<span class="at">mean=</span><span class="dv">0</span>,<span class="at">sd=</span><span class="dv">1</span>)</span>
<span id="cb238-31"><a href="application-estimating-risk-preferences.html#cb238-31" tabindex="-1"></a>    )</span>
<span id="cb238-32"><a href="application-estimating-risk-preferences.html#cb238-32" tabindex="-1"></a>  )</span>
<span id="cb238-33"><a href="application-estimating-risk-preferences.html#cb238-33" tabindex="-1"></a></span>
<span id="cb238-34"><a href="application-estimating-risk-preferences.html#cb238-34" tabindex="-1"></a>  </span>
<span id="cb238-35"><a href="application-estimating-risk-preferences.html#cb238-35" tabindex="-1"></a></span>
<span id="cb238-36"><a href="application-estimating-risk-preferences.html#cb238-36" tabindex="-1"></a>(</span>
<span id="cb238-37"><a href="application-estimating-risk-preferences.html#cb238-37" tabindex="-1"></a>  <span class="fu">ggplot</span>()</span>
<span id="cb238-38"><a href="application-estimating-risk-preferences.html#cb238-38" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">stat_ecdf</span>(<span class="at">data=</span>RDUIndividual <span class="sc">|&gt;</span> <span class="fu">filter</span>(parameter <span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>),<span class="fu">aes</span>(<span class="at">x=</span>mean))</span>
<span id="cb238-39"><a href="application-estimating-risk-preferences.html#cb238-39" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_line</span>(<span class="at">data=</span>prior,<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>cdf),<span class="at">color=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb238-40"><a href="application-estimating-risk-preferences.html#cb238-40" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb238-41"><a href="application-estimating-risk-preferences.html#cb238-41" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_errorbar</span>(<span class="at">alpha=</span><span class="fl">0.3</span>,<span class="at">color=</span><span class="st">&quot;red&quot;</span>,<span class="at">data=</span>RDUIndividual <span class="sc">|&gt;</span> <span class="fu">filter</span>(parameter <span class="sc">!=</span><span class="st">&quot;lp__&quot;</span>),<span class="fu">aes</span>(<span class="at">y=</span>cumulative,<span class="at">xmin=</span>X25.,<span class="at">xmax=</span>X75.))</span>
<span id="cb238-42"><a href="application-estimating-risk-preferences.html#cb238-42" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>parameter,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>)</span>
<span id="cb238-43"><a href="application-estimating-risk-preferences.html#cb238-43" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Cumulative probability&quot;</span>)</span>
<span id="cb238-44"><a href="application-estimating-risk-preferences.html#cb238-44" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;Estimate&quot;</span>)</span>
<span id="cb238-45"><a href="application-estimating-risk-preferences.html#cb238-45" tabindex="-1"></a>) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:RiskPreferencesRDUIndividual"></span>
<img src="index_files/figure-html/RiskPreferencesRDUIndividual-1.png" alt="Estimates from individual estimation of the RDU model. Empirical cumulative density functions (black curves) of individual posterior means (black lines) and 50% Bayesian credible regions (red lines). Blue curves show the prior cumulative density functions.  CE[1] is the certainty equivalent for a 95% channce of winning $10, $80 otherwise. CE[2] is the certainty equivalent for a 5% chance of winning $10, $80 otherwise." width="672" />
<p class="caption">
Figure 19.4: Estimates from individual estimation of the RDU model. Empirical cumulative density functions (black curves) of individual posterior means (black lines) and 50% Bayesian credible regions (red lines). Blue curves show the prior cumulative density functions. CE[1] is the certainty equivalent for a 95% channce of winning $10, $80 otherwise. CE[2] is the certainty equivalent for a 5% chance of winning $10, $80 otherwise.
</p>
</div>
<p>However a closer look at the posterior means for these parameters in Figure <a href="application-estimating-risk-preferences.html#fig:RiskPreferencesEtaPsi">19.5</a> shows that there is no real concentration around <span class="math inline">\(\eta_i=\psi_i=1\)</span>. That is, it appears that the RDU model is implying substantially different behavior than EUT.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="application-estimating-risk-preferences.html#cb239-1" tabindex="-1"></a>plotThis<span class="ot">&lt;-</span>RDUIndividual <span class="sc">|&gt;</span></span>
<span id="cb239-2"><a href="application-estimating-risk-preferences.html#cb239-2" tabindex="-1"></a>  <span class="fu">filter</span>(parameter <span class="sc">==</span> <span class="st">&quot;eta&quot;</span> <span class="sc">|</span> parameter <span class="sc">==</span> <span class="st">&quot;psi&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb239-3"><a href="application-estimating-risk-preferences.html#cb239-3" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb239-4"><a href="application-estimating-risk-preferences.html#cb239-4" tabindex="-1"></a>    <span class="at">id_cols =</span> id,</span>
<span id="cb239-5"><a href="application-estimating-risk-preferences.html#cb239-5" tabindex="-1"></a>    <span class="at">names_from =</span> parameter,</span>
<span id="cb239-6"><a href="application-estimating-risk-preferences.html#cb239-6" tabindex="-1"></a>    <span class="at">values_from =</span>  <span class="fu">c</span>(mean,X25.,X75.)</span>
<span id="cb239-7"><a href="application-estimating-risk-preferences.html#cb239-7" tabindex="-1"></a>  )</span>
<span id="cb239-8"><a href="application-estimating-risk-preferences.html#cb239-8" tabindex="-1"></a></span>
<span id="cb239-9"><a href="application-estimating-risk-preferences.html#cb239-9" tabindex="-1"></a>(</span>
<span id="cb239-10"><a href="application-estimating-risk-preferences.html#cb239-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(plotThis,<span class="fu">aes</span>(<span class="at">x=</span>mean_eta,<span class="at">y=</span>mean_psi))</span>
<span id="cb239-11"><a href="application-estimating-risk-preferences.html#cb239-11" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_point</span>()</span>
<span id="cb239-12"><a href="application-estimating-risk-preferences.html#cb239-12" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> X25._eta,<span class="at">xmax=</span>X75._eta),<span class="at">alpha=</span><span class="fl">0.3</span>)</span>
<span id="cb239-13"><a href="application-estimating-risk-preferences.html#cb239-13" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X25._psi,<span class="at">ymax=</span>X75._psi),<span class="at">alpha=</span><span class="fl">0.3</span>)</span>
<span id="cb239-14"><a href="application-estimating-risk-preferences.html#cb239-14" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb239-15"><a href="application-estimating-risk-preferences.html#cb239-15" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="fu">expression</span>(eta))</span>
<span id="cb239-16"><a href="application-estimating-risk-preferences.html#cb239-16" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="fu">expression</span>(psi))</span>
<span id="cb239-17"><a href="application-estimating-risk-preferences.html#cb239-17" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">1.0</span>,<span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">1.0</span>,<span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb239-18"><a href="application-estimating-risk-preferences.html#cb239-18" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:RiskPreferencesEtaPsi"></span>
<img src="index_files/figure-html/RiskPreferencesEtaPsi-1.png" alt="Individual posterior means of $\eta_i$ and $\psi_i$ (error bars show a 50% Bayesian credible region) from the RDU model. When both of these parameters are equal to one, the RDU model nests EUT. " width="672" />
<p class="caption">
Figure 19.5: Individual posterior means of <span class="math inline">\(\eta_i\)</span> and <span class="math inline">\(\psi_i\)</span> (error bars show a 50% Bayesian credible region) from the RDU model. When both of these parameters are equal to one, the RDU model nests EUT.
</p>
</div>
</div>
<div id="comparing-the-certainty-equivalents-estimated-using-eut-and-rdu" class="section level3 hasAnchor" number="19.3.3">
<h3><span class="header-section-number">19.3.3</span> Comparing the certainty equivalents estimated using EUT and RDU<a href="application-estimating-risk-preferences.html#comparing-the-certainty-equivalents-estimated-using-eut-and-rdu" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Before we move on to the hierarchical model in the next section, I was interested to see how differently the EUT and RDU models estimated the certainty equivalent. That is, <em>a priori</em> it is not clear whether or not these will produce estimates that are substantially different. This could be for two reasons. Firstly, since EUT is a special case of RDU, it could be that the parameter estimates from the RDU model are close enough to the <span class="math inline">\(\eta_i=\psi_i=1\)</span> restriction that behavior is effectively EUT. Secondly, even if this parameter restriction does <em>not</em> approximately hold, it could be that the estimated preferences over the lotteries are similar, and so we would estimate similar certainty equivalents. To investigate this, Figure <a href="application-estimating-risk-preferences.html#fig:RiskPreferencesIndividualCE">19.6</a> plots the estimated certainty equivalents from the EUT model (horizontal coordinate) and the RDU model (vertical coordinate). The dashed red line is a <span class="math inline">\(45^\circ\)</span> line, and so if the estimates fall on or close to this line the models are estimating similar certainty equivalents. This is especially not the case for “CE[2]”, which is the certainty equivalent of a 5% chance of winning <span class="math inline">\(\$10\)</span>, and a 95% chance of winning <span class="math inline">\(\$80\)</span>. In this panel, we can see that the RDU model mostly estimates smaller certainty equivalents than the EUT model. Put differently, the EUT is over-valuing this lottery relative to the RDU model.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="application-estimating-risk-preferences.html#cb240-1" tabindex="-1"></a>d<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">&quot;Code/RiskPreferences/Estimates_individual.rds&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb240-2"><a href="application-estimating-risk-preferences.html#cb240-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;CE&quot;</span>,parameter)) <span class="sc">|&gt;</span></span>
<span id="cb240-3"><a href="application-estimating-risk-preferences.html#cb240-3" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb240-4"><a href="application-estimating-risk-preferences.html#cb240-4" tabindex="-1"></a>    <span class="at">id_cols =</span> <span class="fu">c</span>(id,parameter),</span>
<span id="cb240-5"><a href="application-estimating-risk-preferences.html#cb240-5" tabindex="-1"></a>    <span class="at">names_from =</span> model,</span>
<span id="cb240-6"><a href="application-estimating-risk-preferences.html#cb240-6" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(X25.,mean,X75.)</span>
<span id="cb240-7"><a href="application-estimating-risk-preferences.html#cb240-7" tabindex="-1"></a>  )</span>
<span id="cb240-8"><a href="application-estimating-risk-preferences.html#cb240-8" tabindex="-1"></a></span>
<span id="cb240-9"><a href="application-estimating-risk-preferences.html#cb240-9" tabindex="-1"></a></span>
<span id="cb240-10"><a href="application-estimating-risk-preferences.html#cb240-10" tabindex="-1"></a>(</span>
<span id="cb240-11"><a href="application-estimating-risk-preferences.html#cb240-11" tabindex="-1"></a>  <span class="fu">ggplot</span>(d,<span class="fu">aes</span>(<span class="at">x=</span>mean_EUT,<span class="at">y=</span>mean_RDU))</span>
<span id="cb240-12"><a href="application-estimating-risk-preferences.html#cb240-12" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>parameter,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>)</span>
<span id="cb240-13"><a href="application-estimating-risk-preferences.html#cb240-13" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> X25._RDU,<span class="at">ymax=</span>X75._RDU),<span class="at">alpha=</span><span class="fl">0.3</span>)</span>
<span id="cb240-14"><a href="application-estimating-risk-preferences.html#cb240-14" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin=</span>X25._EUT,<span class="at">xmax=</span>X75._EUT),<span class="at">alpha=</span><span class="fl">0.3</span>)</span>
<span id="cb240-15"><a href="application-estimating-risk-preferences.html#cb240-15" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb240-16"><a href="application-estimating-risk-preferences.html#cb240-16" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_point</span>()</span>
<span id="cb240-17"><a href="application-estimating-risk-preferences.html#cb240-17" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>,<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">color=</span><span class="st">&quot;red&quot;</span>,<span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb240-18"><a href="application-estimating-risk-preferences.html#cb240-18" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;Certainty equivalent estimated using EUT ($)&quot;</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Certainty equivalent estimated using RDU ($)&quot;</span>)</span>
<span id="cb240-19"><a href="application-estimating-risk-preferences.html#cb240-19" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:RiskPreferencesIndividualCE"></span>
<img src="index_files/figure-html/RiskPreferencesIndividualCE-1.png" alt="Certainty equivalents estimated using the EUT and RDU models. Dots show posterior means. Error bars show 50% Bayesian credible regions." width="672" />
<p class="caption">
Figure 19.6: Certainty equivalents estimated using the EUT and RDU models. Dots show posterior means. Error bars show 50% Bayesian credible regions.
</p>
</div>
</div>
</div>
<div id="a-hierarchical-specification" class="section level2 hasAnchor" number="19.4">
<h2><span class="header-section-number">19.4</span> A hierarchical specification<a href="application-estimating-risk-preferences.html#a-hierarchical-specification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Of course, this wouldn’t be the full Bayesian treatment without at least one hierarchical model. Here I am going to estimate the RDU model using data from all 175 participants, allowing each of the RDU model’s parameters to be participant-specific random draws from a (transformed) multivariate normal distribution. This specification therefore has the same likelihood as the individual-specific models (we just add up the likelihood contribution for each participant), and I will not be doing anything too novel by assuming a (transformed) multivariate normal distribution for these individual-level parameters:</p>
<p><span class="math display">\[
\begin{aligned}
\begin{pmatrix}
r_i\\ \log\lambda_i \\ \log\eta_i \\ \log \psi_i
\end{pmatrix}&amp;\sim N\left(\mu,\mathrm{diag\_matrix}(\tau)\Omega\mathrm{diag\_matrix}(\tau)\right)
\end{aligned}
\]</span></p>
<p>and then assign (hyper)-priors to the population-level parameters:</p>
<p><span class="math display">\[
\begin{aligned}
\mu_r&amp;\sim N(0.27,0.36^2)\\
\mu_\lambda&amp;\sim N(3.45,0.59^2)\\
\mu_\eta&amp;\sim N(0,1)\\
\mu_\psi&amp;\sim N(0,1)\\
\tau_r,\ \tau_\lambda,\ \tau_\eta,\ \tau_\psi &amp;\sim \mathrm{Cauchy}^+(0,1)\\
\Omega &amp;\sim \mathrm{LKJ}(4)
\end{aligned}
\]</span></p>
<p>Note that I have carried forward my priors for <span class="math inline">\(r\)</span>, <span class="math inline">\(\lambda\)</span>, <span class="math inline">\(\eta\)</span>, and <span class="math inline">\(\mu\)</span> in the participant-specific RDU model to be the priors for the relevant elements of <span class="math inline">\(\mu\)</span>. This means that the “representative agent” of the hierarchical model (i.e. the fictitious median participant with (transformed) parameters <span class="math inline">\(\mu\)</span>) has the same priors as the participant-specific model. Really I suspect that we could be <em>much</em> more “informative” about these, because they are measures of central tendency, rather than for an individual participant. However the participant-specific priors serve at least as a good starting point for forming a prior for <span class="math inline">\(\mu\)</span>. The <span class="math inline">\(\mathrm{Cauchy}^+(0,1)\)</span> (hyper)-priors for the standard deviation parameters (<span class="math inline">\(\tau\)</span>) actually cover a <em>lot</em> of the parameter space that implies a lot of dispersion in the individual-level parameters (especially for the parameters transformed by logs), so I am not too worried about being overly “informative” here. Finally, the <span class="math inline">\(\mathrm{LKJ}(4)\)</span> prior for <span class="math inline">\(\Omega\)</span> is centered on, and peaked at, zero correlation, but does not rule out large correlations too much.</p>
<p>Here is is the <em>Stan</em> program I wrote to estimate this model. While there is not much here that is not either taken straight from the participant-specific RDU model, or standard Bayesian hierarchical model stuff, it is importantan to note a few things. Firstly, I make sure that <span class="math inline">\(r_i\)</span>, <span class="math inline">\(\lambda_i\)</span>, <span class="math inline">\(\eta_i\)</span>, and <span class="math inline">\(\psi_i\)</span> are generated in the <code>transformed parameters</code> block so I can access them post estimation (this would not be the case if I calculated them in the <code>model</code> block). Also, I am using the data variable <code>idstatend</code> to keep track of where a participant’s data show up in the pooled data. This requires that the pooled data is sorted by participant.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb241-1"><a href="application-estimating-risk-preferences.html#cb241-1" tabindex="-1"></a></span>
<span id="cb241-2"><a href="application-estimating-risk-preferences.html#cb241-2" tabindex="-1"></a>functions <span class="op">{</span></span>
<span id="cb241-3"><a href="application-estimating-risk-preferences.html#cb241-3" tabindex="-1"></a>  </span>
<span id="cb241-4"><a href="application-estimating-risk-preferences.html#cb241-4" tabindex="-1"></a>  matrix decisionWeights<span class="op">(</span></span>
<span id="cb241-5"><a href="application-estimating-risk-preferences.html#cb241-5" tabindex="-1"></a>    real psi<span class="op">,</span> real eta<span class="op">,</span></span>
<span id="cb241-6"><a href="application-estimating-risk-preferences.html#cb241-6" tabindex="-1"></a>    data matrix cprob<span class="op">,</span> data matrix cprob0<span class="op">,</span> data matrix cprob1</span>
<span id="cb241-7"><a href="application-estimating-risk-preferences.html#cb241-7" tabindex="-1"></a>  <span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-8"><a href="application-estimating-risk-preferences.html#cb241-8" tabindex="-1"></a>    </span>
<span id="cb241-9"><a href="application-estimating-risk-preferences.html#cb241-9" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> num_elements<span class="op">(</span>cprob<span class="op">)%/%</span><span class="dv">3</span><span class="op">;</span></span>
<span id="cb241-10"><a href="application-estimating-risk-preferences.html#cb241-10" tabindex="-1"></a>    </span>
<span id="cb241-11"><a href="application-estimating-risk-preferences.html#cb241-11" tabindex="-1"></a>    <span class="co">/* Weighted cumulative probabilities</span></span>
<span id="cb241-12"><a href="application-estimating-risk-preferences.html#cb241-12" tabindex="-1"></a><span class="co">    Here we need to watch out for p=0 and p=1 problems, where the weighting</span></span>
<span id="cb241-13"><a href="application-estimating-risk-preferences.html#cb241-13" tabindex="-1"></a><span class="co">    function is undefined, but is 0 and 1 in the limit respectively. Here</span></span>
<span id="cb241-14"><a href="application-estimating-risk-preferences.html#cb241-14" tabindex="-1"></a><span class="co">    I avoid getting NaNs by adding a little bit when p=0, and subtracting </span></span>
<span id="cb241-15"><a href="application-estimating-risk-preferences.html#cb241-15" tabindex="-1"></a><span class="co">    a little bit when p=1. I then substitute in the limit exactly just below</span></span>
<span id="cb241-16"><a href="application-estimating-risk-preferences.html#cb241-16" tabindex="-1"></a><span class="co">    this</span></span>
<span id="cb241-17"><a href="application-estimating-risk-preferences.html#cb241-17" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb241-18"><a href="application-estimating-risk-preferences.html#cb241-18" tabindex="-1"></a>    </span>
<span id="cb241-19"><a href="application-estimating-risk-preferences.html#cb241-19" tabindex="-1"></a>    matrix<span class="op">[</span>n<span class="op">,</span><span class="dv">3</span><span class="op">]</span> wcprob <span class="op">=</span> exp<span class="op">(</span></span>
<span id="cb241-20"><a href="application-estimating-risk-preferences.html#cb241-20" tabindex="-1"></a>      <span class="op">-</span>eta <span class="op">*</span> pow<span class="op">(-</span>log<span class="op">(</span>cprob<span class="op">+</span><span class="fl">0.01</span><span class="op">*(</span>cprob0<span class="op">-</span>cprob1<span class="op">)),</span>psi<span class="op">)</span></span>
<span id="cb241-21"><a href="application-estimating-risk-preferences.html#cb241-21" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb241-22"><a href="application-estimating-risk-preferences.html#cb241-22" tabindex="-1"></a>    wcprob <span class="op">=</span> wcprob<span class="op">.*(</span><span class="fl">1.0</span><span class="op">-</span>cprob0<span class="op">-</span>cprob1<span class="op">)+</span>cprob1<span class="op">;</span></span>
<span id="cb241-23"><a href="application-estimating-risk-preferences.html#cb241-23" tabindex="-1"></a>    </span>
<span id="cb241-24"><a href="application-estimating-risk-preferences.html#cb241-24" tabindex="-1"></a>    <span class="co">// convert to decision weights</span></span>
<span id="cb241-25"><a href="application-estimating-risk-preferences.html#cb241-25" tabindex="-1"></a>    </span>
<span id="cb241-26"><a href="application-estimating-risk-preferences.html#cb241-26" tabindex="-1"></a>    matrix<span class="op">[</span>n<span class="op">,</span><span class="dv">3</span><span class="op">]</span> wprob <span class="op">=</span> wcprob<span class="op">;</span></span>
<span id="cb241-27"><a href="application-estimating-risk-preferences.html#cb241-27" tabindex="-1"></a>    </span>
<span id="cb241-28"><a href="application-estimating-risk-preferences.html#cb241-28" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>kk in <span class="dv">2</span><span class="op">:</span><span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-29"><a href="application-estimating-risk-preferences.html#cb241-29" tabindex="-1"></a>      wprob<span class="op">[,</span>kk<span class="op">]</span> <span class="op">=</span> wcprob<span class="op">[,</span>kk<span class="op">]-</span>wcprob<span class="op">[,</span>kk<span class="op">-</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb241-30"><a href="application-estimating-risk-preferences.html#cb241-30" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb241-31"><a href="application-estimating-risk-preferences.html#cb241-31" tabindex="-1"></a>    </span>
<span id="cb241-32"><a href="application-estimating-risk-preferences.html#cb241-32" tabindex="-1"></a>    <span class="cf">return</span> wprob<span class="op">;</span></span>
<span id="cb241-33"><a href="application-estimating-risk-preferences.html#cb241-33" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb241-34"><a href="application-estimating-risk-preferences.html#cb241-34" tabindex="-1"></a>  </span>
<span id="cb241-35"><a href="application-estimating-risk-preferences.html#cb241-35" tabindex="-1"></a>  <span class="co">/* Calculating the certainty equivalent is a little more tricky for RDU, so</span></span>
<span id="cb241-36"><a href="application-estimating-risk-preferences.html#cb241-36" tabindex="-1"></a><span class="co">  I am writing a function to do it so as not to clutter up the generated quantities</span></span>
<span id="cb241-37"><a href="application-estimating-risk-preferences.html#cb241-37" tabindex="-1"></a><span class="co">  block</span></span>
<span id="cb241-38"><a href="application-estimating-risk-preferences.html#cb241-38" tabindex="-1"></a><span class="co">  */</span></span>
<span id="cb241-39"><a href="application-estimating-risk-preferences.html#cb241-39" tabindex="-1"></a>  </span>
<span id="cb241-40"><a href="application-estimating-risk-preferences.html#cb241-40" tabindex="-1"></a>  real calcCE<span class="op">(</span>vector probs<span class="op">,</span> vector prizes<span class="op">,</span>real r<span class="op">,</span> real psi<span class="op">,</span>real eta<span class="op">,</span>real tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-41"><a href="application-estimating-risk-preferences.html#cb241-41" tabindex="-1"></a>    </span>
<span id="cb241-42"><a href="application-estimating-risk-preferences.html#cb241-42" tabindex="-1"></a>    vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> cprobs <span class="op">=</span> probs<span class="op">;</span></span>
<span id="cb241-43"><a href="application-estimating-risk-preferences.html#cb241-43" tabindex="-1"></a>    </span>
<span id="cb241-44"><a href="application-estimating-risk-preferences.html#cb241-44" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>pp in <span class="dv">2</span><span class="op">:</span><span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-45"><a href="application-estimating-risk-preferences.html#cb241-45" tabindex="-1"></a>      </span>
<span id="cb241-46"><a href="application-estimating-risk-preferences.html#cb241-46" tabindex="-1"></a>      cprobs<span class="op">[</span>pp<span class="op">]</span> <span class="op">=</span> cprobs<span class="op">[</span>pp<span class="op">-</span><span class="dv">1</span><span class="op">]+</span>probs<span class="op">[</span>pp<span class="op">];</span></span>
<span id="cb241-47"><a href="application-estimating-risk-preferences.html#cb241-47" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb241-48"><a href="application-estimating-risk-preferences.html#cb241-48" tabindex="-1"></a>    </span>
<span id="cb241-49"><a href="application-estimating-risk-preferences.html#cb241-49" tabindex="-1"></a>    vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> wcprobs <span class="op">=</span> exp<span class="op">(</span></span>
<span id="cb241-50"><a href="application-estimating-risk-preferences.html#cb241-50" tabindex="-1"></a>      <span class="op">-</span>eta <span class="op">*</span> pow<span class="op">(-</span>log<span class="op">(</span>cprobs<span class="op">),</span>psi<span class="op">)</span></span>
<span id="cb241-51"><a href="application-estimating-risk-preferences.html#cb241-51" tabindex="-1"></a>    <span class="op">);</span></span>
<span id="cb241-52"><a href="application-estimating-risk-preferences.html#cb241-52" tabindex="-1"></a>    </span>
<span id="cb241-53"><a href="application-estimating-risk-preferences.html#cb241-53" tabindex="-1"></a>    wcprobs<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span> <span class="co">// avoids getting a NaN. This mucst be 1</span></span>
<span id="cb241-54"><a href="application-estimating-risk-preferences.html#cb241-54" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>pp in <span class="dv">1</span><span class="op">:</span><span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-55"><a href="application-estimating-risk-preferences.html#cb241-55" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>wcprobs<span class="op">[</span>pp<span class="op">]&lt;</span>tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-56"><a href="application-estimating-risk-preferences.html#cb241-56" tabindex="-1"></a>        wcprobs<span class="op">[</span>pp<span class="op">]</span> <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb241-57"><a href="application-estimating-risk-preferences.html#cb241-57" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb241-58"><a href="application-estimating-risk-preferences.html#cb241-58" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb241-59"><a href="application-estimating-risk-preferences.html#cb241-59" tabindex="-1"></a>    </span>
<span id="cb241-60"><a href="application-estimating-risk-preferences.html#cb241-60" tabindex="-1"></a>    vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> wprobs <span class="op">=</span> wcprobs<span class="op">;</span></span>
<span id="cb241-61"><a href="application-estimating-risk-preferences.html#cb241-61" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>pp in <span class="dv">2</span><span class="op">:</span><span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-62"><a href="application-estimating-risk-preferences.html#cb241-62" tabindex="-1"></a>      wprobs<span class="op">[</span>pp<span class="op">]</span> <span class="op">=</span> wcprobs<span class="op">[</span>pp<span class="op">]-</span>wcprobs<span class="op">[</span>pp<span class="op">-</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb241-63"><a href="application-estimating-risk-preferences.html#cb241-63" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb241-64"><a href="application-estimating-risk-preferences.html#cb241-64" tabindex="-1"></a>    </span>
<span id="cb241-65"><a href="application-estimating-risk-preferences.html#cb241-65" tabindex="-1"></a>    </span>
<span id="cb241-66"><a href="application-estimating-risk-preferences.html#cb241-66" tabindex="-1"></a>    <span class="cf">return</span> pow<span class="op">(</span>pow<span class="op">(</span>prizes<span class="op">,</span><span class="fl">1.0</span><span class="op">-</span>r<span class="op">)</span><span class="ch">&#39;*</span><span class="er">wprobs,1.0/(1.0-r));</span></span>
<span id="cb241-67"><a href="application-estimating-risk-preferences.html#cb241-67" tabindex="-1"></a>    </span>
<span id="cb241-68"><a href="application-estimating-risk-preferences.html#cb241-68" tabindex="-1"></a>    </span>
<span id="cb241-69"><a href="application-estimating-risk-preferences.html#cb241-69" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb241-70"><a href="application-estimating-risk-preferences.html#cb241-70" tabindex="-1"></a>  </span>
<span id="cb241-71"><a href="application-estimating-risk-preferences.html#cb241-71" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb241-72"><a href="application-estimating-risk-preferences.html#cb241-72" tabindex="-1"></a></span>
<span id="cb241-73"><a href="application-estimating-risk-preferences.html#cb241-73" tabindex="-1"></a></span>
<span id="cb241-74"><a href="application-estimating-risk-preferences.html#cb241-74" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb241-75"><a href="application-estimating-risk-preferences.html#cb241-75" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> N<span class="op">;</span> <span class="co">// total number of decisions</span></span>
<span id="cb241-76"><a href="application-estimating-risk-preferences.html#cb241-76" tabindex="-1"></a>  </span>
<span id="cb241-77"><a href="application-estimating-risk-preferences.html#cb241-77" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> nparticipants<span class="op">;</span></span>
<span id="cb241-78"><a href="application-estimating-risk-preferences.html#cb241-78" tabindex="-1"></a>  <span class="dt">int</span> id<span class="op">[</span>N<span class="op">];</span></span>
<span id="cb241-79"><a href="application-estimating-risk-preferences.html#cb241-79" tabindex="-1"></a>  <span class="dt">int</span> idstartend<span class="op">[</span>nparticipants<span class="op">,</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb241-80"><a href="application-estimating-risk-preferences.html#cb241-80" tabindex="-1"></a>  </span>
<span id="cb241-81"><a href="application-estimating-risk-preferences.html#cb241-81" tabindex="-1"></a>  <span class="dt">int</span> Left<span class="op">[</span>N<span class="op">];</span> <span class="co">// indicator for chose the Left lottery</span></span>
<span id="cb241-82"><a href="application-estimating-risk-preferences.html#cb241-82" tabindex="-1"></a>  </span>
<span id="cb241-83"><a href="application-estimating-risk-preferences.html#cb241-83" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> pLeft<span class="op">;</span> </span>
<span id="cb241-84"><a href="application-estimating-risk-preferences.html#cb241-84" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> pRight<span class="op">;</span></span>
<span id="cb241-85"><a href="application-estimating-risk-preferences.html#cb241-85" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> prizes<span class="op">;</span></span>
<span id="cb241-86"><a href="application-estimating-risk-preferences.html#cb241-86" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">2</span><span class="op">]</span> prizerange<span class="op">;</span></span>
<span id="cb241-87"><a href="application-estimating-risk-preferences.html#cb241-87" tabindex="-1"></a>  </span>
<span id="cb241-88"><a href="application-estimating-risk-preferences.html#cb241-88" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_MU<span class="op">[</span><span class="dv">4</span><span class="op">];</span></span>
<span id="cb241-89"><a href="application-estimating-risk-preferences.html#cb241-89" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">4</span><span class="op">]</span> prior_TAU<span class="op">;</span></span>
<span id="cb241-90"><a href="application-estimating-risk-preferences.html#cb241-90" tabindex="-1"></a>  real prior_OMEGA<span class="op">;</span></span>
<span id="cb241-91"><a href="application-estimating-risk-preferences.html#cb241-91" tabindex="-1"></a>  </span>
<span id="cb241-92"><a href="application-estimating-risk-preferences.html#cb241-92" tabindex="-1"></a>  </span>
<span id="cb241-93"><a href="application-estimating-risk-preferences.html#cb241-93" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> tol<span class="op">;</span></span>
<span id="cb241-94"><a href="application-estimating-risk-preferences.html#cb241-94" tabindex="-1"></a>  </span>
<span id="cb241-95"><a href="application-estimating-risk-preferences.html#cb241-95" tabindex="-1"></a>  <span class="co">// information about the certainty equivalents</span></span>
<span id="cb241-96"><a href="application-estimating-risk-preferences.html#cb241-96" tabindex="-1"></a>  <span class="dt">int</span> nCE<span class="op">;</span> <span class="co">// number of certainty equivalents to evaluate</span></span>
<span id="cb241-97"><a href="application-estimating-risk-preferences.html#cb241-97" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> CEprizes<span class="op">[</span>nCE<span class="op">];</span> <span class="co">// prizes for the lottery for certainty equivalents</span></span>
<span id="cb241-98"><a href="application-estimating-risk-preferences.html#cb241-98" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">3</span><span class="op">]</span> CEprobs<span class="op">[</span>nCE<span class="op">];</span> <span class="co">// probabilities for the lottery for certainty equivalents</span></span>
<span id="cb241-99"><a href="application-estimating-risk-preferences.html#cb241-99" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb241-100"><a href="application-estimating-risk-preferences.html#cb241-100" tabindex="-1"></a></span>
<span id="cb241-101"><a href="application-estimating-risk-preferences.html#cb241-101" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb241-102"><a href="application-estimating-risk-preferences.html#cb241-102" tabindex="-1"></a>  </span>
<span id="cb241-103"><a href="application-estimating-risk-preferences.html#cb241-103" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> cprobLeft <span class="op">=</span> pLeft<span class="op">;</span></span>
<span id="cb241-104"><a href="application-estimating-risk-preferences.html#cb241-104" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> cprobRight <span class="op">=</span> pRight<span class="op">;</span></span>
<span id="cb241-105"><a href="application-estimating-risk-preferences.html#cb241-105" tabindex="-1"></a>  </span>
<span id="cb241-106"><a href="application-estimating-risk-preferences.html#cb241-106" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> cprobLeft0 <span class="op">=</span> rep_matrix<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>N<span class="op">,</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb241-107"><a href="application-estimating-risk-preferences.html#cb241-107" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> cprobLeft1 <span class="op">=</span> rep_matrix<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>N<span class="op">,</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb241-108"><a href="application-estimating-risk-preferences.html#cb241-108" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> cprobRight0 <span class="op">=</span> rep_matrix<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>N<span class="op">,</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb241-109"><a href="application-estimating-risk-preferences.html#cb241-109" tabindex="-1"></a>  matrix<span class="op">[</span>N<span class="op">,</span><span class="dv">3</span><span class="op">]</span> cprobRight1 <span class="op">=</span> rep_matrix<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>N<span class="op">,</span><span class="dv">3</span><span class="op">);</span></span>
<span id="cb241-110"><a href="application-estimating-risk-preferences.html#cb241-110" tabindex="-1"></a>  </span>
<span id="cb241-111"><a href="application-estimating-risk-preferences.html#cb241-111" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>kk in <span class="dv">2</span><span class="op">:</span><span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-112"><a href="application-estimating-risk-preferences.html#cb241-112" tabindex="-1"></a>    cprobLeft<span class="op">[,</span>kk<span class="op">]</span> <span class="op">=</span> cprobLeft<span class="op">[,</span>kk<span class="op">-</span><span class="dv">1</span><span class="op">]+</span>pLeft<span class="op">[,</span>kk<span class="op">];</span></span>
<span id="cb241-113"><a href="application-estimating-risk-preferences.html#cb241-113" tabindex="-1"></a>    cprobRight<span class="op">[,</span>kk<span class="op">]</span> <span class="op">=</span> cprobRight<span class="op">[,</span>kk<span class="op">-</span><span class="dv">1</span><span class="op">]+</span>pRight<span class="op">[,</span>kk<span class="op">];</span></span>
<span id="cb241-114"><a href="application-estimating-risk-preferences.html#cb241-114" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb241-115"><a href="application-estimating-risk-preferences.html#cb241-115" tabindex="-1"></a>  </span>
<span id="cb241-116"><a href="application-estimating-risk-preferences.html#cb241-116" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>N<span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-117"><a href="application-estimating-risk-preferences.html#cb241-117" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>kk in <span class="dv">1</span><span class="op">:</span><span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-118"><a href="application-estimating-risk-preferences.html#cb241-118" tabindex="-1"></a>      </span>
<span id="cb241-119"><a href="application-estimating-risk-preferences.html#cb241-119" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>cprobLeft<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]&lt;</span>tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-120"><a href="application-estimating-risk-preferences.html#cb241-120" tabindex="-1"></a>        cprobLeft0<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb241-121"><a href="application-estimating-risk-preferences.html#cb241-121" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb241-122"><a href="application-estimating-risk-preferences.html#cb241-122" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>cprobLeft<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]&gt;(</span><span class="fl">1.0</span><span class="op">-</span>tol<span class="op">))</span> <span class="op">{</span></span>
<span id="cb241-123"><a href="application-estimating-risk-preferences.html#cb241-123" tabindex="-1"></a>        cprobLeft1<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb241-124"><a href="application-estimating-risk-preferences.html#cb241-124" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb241-125"><a href="application-estimating-risk-preferences.html#cb241-125" tabindex="-1"></a>      </span>
<span id="cb241-126"><a href="application-estimating-risk-preferences.html#cb241-126" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>cprobRight<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]&lt;</span>tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-127"><a href="application-estimating-risk-preferences.html#cb241-127" tabindex="-1"></a>        cprobRight0<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb241-128"><a href="application-estimating-risk-preferences.html#cb241-128" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb241-129"><a href="application-estimating-risk-preferences.html#cb241-129" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>cprobRight<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]&gt;(</span><span class="fl">1.0</span><span class="op">-</span>tol<span class="op">))</span> <span class="op">{</span></span>
<span id="cb241-130"><a href="application-estimating-risk-preferences.html#cb241-130" tabindex="-1"></a>        cprobRight1<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb241-131"><a href="application-estimating-risk-preferences.html#cb241-131" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb241-132"><a href="application-estimating-risk-preferences.html#cb241-132" tabindex="-1"></a>      </span>
<span id="cb241-133"><a href="application-estimating-risk-preferences.html#cb241-133" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb241-134"><a href="application-estimating-risk-preferences.html#cb241-134" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb241-135"><a href="application-estimating-risk-preferences.html#cb241-135" tabindex="-1"></a>  </span>
<span id="cb241-136"><a href="application-estimating-risk-preferences.html#cb241-136" tabindex="-1"></a>  </span>
<span id="cb241-137"><a href="application-estimating-risk-preferences.html#cb241-137" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb241-138"><a href="application-estimating-risk-preferences.html#cb241-138" tabindex="-1"></a></span>
<span id="cb241-139"><a href="application-estimating-risk-preferences.html#cb241-139" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb241-140"><a href="application-estimating-risk-preferences.html#cb241-140" tabindex="-1"></a>  </span>
<span id="cb241-141"><a href="application-estimating-risk-preferences.html#cb241-141" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">4</span><span class="op">]</span> MU<span class="op">;</span></span>
<span id="cb241-142"><a href="application-estimating-risk-preferences.html#cb241-142" tabindex="-1"></a>  vector<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;[</span><span class="dv">4</span><span class="op">]</span> TAU<span class="op">;</span></span>
<span id="cb241-143"><a href="application-estimating-risk-preferences.html#cb241-143" tabindex="-1"></a>  cholesky_factor_corr<span class="op">[</span><span class="dv">4</span><span class="op">]</span> L_OMEGA<span class="op">;</span></span>
<span id="cb241-144"><a href="application-estimating-risk-preferences.html#cb241-144" tabindex="-1"></a>  </span>
<span id="cb241-145"><a href="application-estimating-risk-preferences.html#cb241-145" tabindex="-1"></a>  matrix<span class="op">[</span><span class="dv">4</span><span class="op">,</span>nparticipants<span class="op">]</span> z<span class="op">;</span></span>
<span id="cb241-146"><a href="application-estimating-risk-preferences.html#cb241-146" tabindex="-1"></a> </span>
<span id="cb241-147"><a href="application-estimating-risk-preferences.html#cb241-147" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb241-148"><a href="application-estimating-risk-preferences.html#cb241-148" tabindex="-1"></a></span>
<span id="cb241-149"><a href="application-estimating-risk-preferences.html#cb241-149" tabindex="-1"></a>transformed parameters <span class="op">{</span></span>
<span id="cb241-150"><a href="application-estimating-risk-preferences.html#cb241-150" tabindex="-1"></a>  </span>
<span id="cb241-151"><a href="application-estimating-risk-preferences.html#cb241-151" tabindex="-1"></a>  vector<span class="op">[</span>nparticipants<span class="op">]</span> r<span class="op">;</span></span>
<span id="cb241-152"><a href="application-estimating-risk-preferences.html#cb241-152" tabindex="-1"></a>  vector<span class="op">[</span>nparticipants<span class="op">]</span> lambda<span class="op">;</span></span>
<span id="cb241-153"><a href="application-estimating-risk-preferences.html#cb241-153" tabindex="-1"></a>  vector<span class="op">[</span>nparticipants<span class="op">]</span> eta<span class="op">;</span></span>
<span id="cb241-154"><a href="application-estimating-risk-preferences.html#cb241-154" tabindex="-1"></a>  vector<span class="op">[</span>nparticipants<span class="op">]</span> psi<span class="op">;</span></span>
<span id="cb241-155"><a href="application-estimating-risk-preferences.html#cb241-155" tabindex="-1"></a>  </span>
<span id="cb241-156"><a href="application-estimating-risk-preferences.html#cb241-156" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb241-157"><a href="application-estimating-risk-preferences.html#cb241-157" tabindex="-1"></a>    </span>
<span id="cb241-158"><a href="application-estimating-risk-preferences.html#cb241-158" tabindex="-1"></a>    matrix<span class="op">[</span><span class="dv">4</span><span class="op">,</span>nparticipants<span class="op">]</span> theta <span class="op">=</span> rep_matrix<span class="op">(</span>MU<span class="op">,</span>nparticipants<span class="op">)+</span> diag_pre_multiply<span class="op">(</span>TAU<span class="op">,</span>L_OMEGA<span class="op">)*</span>z<span class="op">;</span></span>
<span id="cb241-159"><a href="application-estimating-risk-preferences.html#cb241-159" tabindex="-1"></a>    </span>
<span id="cb241-160"><a href="application-estimating-risk-preferences.html#cb241-160" tabindex="-1"></a>    r <span class="op">=</span> theta<span class="op">[</span><span class="dv">1</span><span class="op">,]</span><span class="ch">&#39;;</span></span>
<span id="cb241-161"><a href="application-estimating-risk-preferences.html#cb241-161" tabindex="-1"></a>    lambda <span class="op">=</span> exp<span class="op">(</span>theta<span class="op">[</span><span class="dv">2</span><span class="op">,]</span><span class="ch">&#39;)</span><span class="er">;</span></span>
<span id="cb241-162"><a href="application-estimating-risk-preferences.html#cb241-162" tabindex="-1"></a>    eta <span class="op">=</span> exp<span class="op">(</span>theta<span class="op">[</span><span class="dv">3</span><span class="op">,]</span><span class="ch">&#39;)</span><span class="er">;</span></span>
<span id="cb241-163"><a href="application-estimating-risk-preferences.html#cb241-163" tabindex="-1"></a>    psi <span class="op">=</span> exp<span class="op">(</span>theta<span class="op">[</span><span class="dv">4</span><span class="op">,]</span><span class="ch">&#39;)</span><span class="er">;</span></span>
<span id="cb241-164"><a href="application-estimating-risk-preferences.html#cb241-164" tabindex="-1"></a>     </span>
<span id="cb241-165"><a href="application-estimating-risk-preferences.html#cb241-165" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb241-166"><a href="application-estimating-risk-preferences.html#cb241-166" tabindex="-1"></a>  </span>
<span id="cb241-167"><a href="application-estimating-risk-preferences.html#cb241-167" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb241-168"><a href="application-estimating-risk-preferences.html#cb241-168" tabindex="-1"></a></span>
<span id="cb241-169"><a href="application-estimating-risk-preferences.html#cb241-169" tabindex="-1"></a></span>
<span id="cb241-170"><a href="application-estimating-risk-preferences.html#cb241-170" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb241-171"><a href="application-estimating-risk-preferences.html#cb241-171" tabindex="-1"></a>  </span>
<span id="cb241-172"><a href="application-estimating-risk-preferences.html#cb241-172" tabindex="-1"></a>  to_vector<span class="op">(</span>z<span class="op">)</span> <span class="op">~</span> std_normal<span class="op">();</span></span>
<span id="cb241-173"><a href="application-estimating-risk-preferences.html#cb241-173" tabindex="-1"></a>  </span>
<span id="cb241-174"><a href="application-estimating-risk-preferences.html#cb241-174" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb241-175"><a href="application-estimating-risk-preferences.html#cb241-175" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>pp in <span class="dv">1</span><span class="op">:</span><span class="dv">4</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-176"><a href="application-estimating-risk-preferences.html#cb241-176" tabindex="-1"></a>    MU<span class="op">[</span>pp<span class="op">]</span> <span class="op">~</span> normal<span class="op">(</span>prior_MU<span class="op">[</span>pp<span class="op">][</span><span class="dv">1</span><span class="op">],</span>prior_MU<span class="op">[</span>pp<span class="op">][</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb241-177"><a href="application-estimating-risk-preferences.html#cb241-177" tabindex="-1"></a>    TAU<span class="op">[</span>pp<span class="op">]</span> <span class="op">~</span> cauchy<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>prior_TAU<span class="op">[</span>pp<span class="op">]);</span></span>
<span id="cb241-178"><a href="application-estimating-risk-preferences.html#cb241-178" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb241-179"><a href="application-estimating-risk-preferences.html#cb241-179" tabindex="-1"></a>  L_OMEGA <span class="op">~</span> lkj_corr_cholesky<span class="op">(</span>prior_OMEGA<span class="op">);</span></span>
<span id="cb241-180"><a href="application-estimating-risk-preferences.html#cb241-180" tabindex="-1"></a>  </span>
<span id="cb241-181"><a href="application-estimating-risk-preferences.html#cb241-181" tabindex="-1"></a>  </span>
<span id="cb241-182"><a href="application-estimating-risk-preferences.html#cb241-182" tabindex="-1"></a>  </span>
<span id="cb241-183"><a href="application-estimating-risk-preferences.html#cb241-183" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nparticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-184"><a href="application-estimating-risk-preferences.html#cb241-184" tabindex="-1"></a>    </span>
<span id="cb241-185"><a href="application-estimating-risk-preferences.html#cb241-185" tabindex="-1"></a>    <span class="dt">int</span> start <span class="op">=</span> idstartend<span class="op">[</span>ii<span class="op">,</span><span class="dv">1</span><span class="op">];</span></span>
<span id="cb241-186"><a href="application-estimating-risk-preferences.html#cb241-186" tabindex="-1"></a>    <span class="dt">int</span> end <span class="op">=</span> idstartend<span class="op">[</span>ii<span class="op">,</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb241-187"><a href="application-estimating-risk-preferences.html#cb241-187" tabindex="-1"></a>    </span>
<span id="cb241-188"><a href="application-estimating-risk-preferences.html#cb241-188" tabindex="-1"></a>    real ri <span class="op">=</span> r<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb241-189"><a href="application-estimating-risk-preferences.html#cb241-189" tabindex="-1"></a>    real lambdai <span class="op">=</span> lambda<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb241-190"><a href="application-estimating-risk-preferences.html#cb241-190" tabindex="-1"></a>    real etai <span class="op">=</span> eta<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb241-191"><a href="application-estimating-risk-preferences.html#cb241-191" tabindex="-1"></a>    real psii <span class="op">=</span> psi<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb241-192"><a href="application-estimating-risk-preferences.html#cb241-192" tabindex="-1"></a>    </span>
<span id="cb241-193"><a href="application-estimating-risk-preferences.html#cb241-193" tabindex="-1"></a>    matrix<span class="op">[</span>end<span class="op">-</span>start<span class="op">+</span><span class="dv">1</span><span class="op">,</span><span class="dv">3</span><span class="op">]</span> dprob <span class="op">=</span> </span>
<span id="cb241-194"><a href="application-estimating-risk-preferences.html#cb241-194" tabindex="-1"></a>    decisionWeights<span class="op">(</span>psii<span class="op">,</span> etai<span class="op">,</span> cprobLeft<span class="op">[</span>start<span class="op">:</span>end<span class="op">,],</span> cprobLeft0<span class="op">[</span>start<span class="op">:</span>end<span class="op">,],</span> cprobLeft1<span class="op">[</span>start<span class="op">:</span>end<span class="op">,])</span></span>
<span id="cb241-195"><a href="application-estimating-risk-preferences.html#cb241-195" tabindex="-1"></a>     <span class="op">-</span> </span>
<span id="cb241-196"><a href="application-estimating-risk-preferences.html#cb241-196" tabindex="-1"></a>    decisionWeights<span class="op">(</span>psii<span class="op">,</span> etai<span class="op">,</span> cprobRight<span class="op">[</span>start<span class="op">:</span>end<span class="op">,],</span> cprobRight0<span class="op">[</span>start<span class="op">:</span>end<span class="op">,],</span> cprobRight1<span class="op">[</span>start<span class="op">:</span>end<span class="op">,])</span></span>
<span id="cb241-197"><a href="application-estimating-risk-preferences.html#cb241-197" tabindex="-1"></a>    <span class="op">;</span> </span>
<span id="cb241-198"><a href="application-estimating-risk-preferences.html#cb241-198" tabindex="-1"></a>    </span>
<span id="cb241-199"><a href="application-estimating-risk-preferences.html#cb241-199" tabindex="-1"></a>    target <span class="op">+=</span>  bernoulli_logit_lpmf<span class="op">(</span> Left<span class="op">[</span>start<span class="op">:</span>end<span class="op">]</span> <span class="op">|</span> </span>
<span id="cb241-200"><a href="application-estimating-risk-preferences.html#cb241-200" tabindex="-1"></a>    lambdai <span class="op">*</span> <span class="op">((</span></span>
<span id="cb241-201"><a href="application-estimating-risk-preferences.html#cb241-201" tabindex="-1"></a>      dprob<span class="op">.*</span>pow<span class="op">(</span>prizes<span class="op">[</span>start<span class="op">:</span>end<span class="op">,],</span><span class="fl">1.0</span><span class="op">-</span>ri<span class="op">)</span></span>
<span id="cb241-202"><a href="application-estimating-risk-preferences.html#cb241-202" tabindex="-1"></a>    <span class="op">)*</span>rep_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span><span class="dv">3</span><span class="op">)</span></span>
<span id="cb241-203"><a href="application-estimating-risk-preferences.html#cb241-203" tabindex="-1"></a>    <span class="op">)</span> </span>
<span id="cb241-204"><a href="application-estimating-risk-preferences.html#cb241-204" tabindex="-1"></a>    <span class="op">./</span> <span class="co">// contextual utility normalization</span></span>
<span id="cb241-205"><a href="application-estimating-risk-preferences.html#cb241-205" tabindex="-1"></a>    <span class="op">(</span></span>
<span id="cb241-206"><a href="application-estimating-risk-preferences.html#cb241-206" tabindex="-1"></a>      pow<span class="op">(</span>prizerange<span class="op">[</span>start<span class="op">:</span>end<span class="op">,</span><span class="dv">2</span><span class="op">],</span><span class="fl">1.0</span><span class="op">-</span>ri<span class="op">)-</span>pow<span class="op">(</span>prizerange<span class="op">[</span>start<span class="op">:</span>end<span class="op">,</span><span class="dv">1</span><span class="op">],</span><span class="fl">1.0</span><span class="op">-</span>ri<span class="op">)</span></span>
<span id="cb241-207"><a href="application-estimating-risk-preferences.html#cb241-207" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb241-208"><a href="application-estimating-risk-preferences.html#cb241-208" tabindex="-1"></a>  <span class="op">);</span></span>
<span id="cb241-209"><a href="application-estimating-risk-preferences.html#cb241-209" tabindex="-1"></a>    </span>
<span id="cb241-210"><a href="application-estimating-risk-preferences.html#cb241-210" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb241-211"><a href="application-estimating-risk-preferences.html#cb241-211" tabindex="-1"></a>  </span>
<span id="cb241-212"><a href="application-estimating-risk-preferences.html#cb241-212" tabindex="-1"></a>  </span>
<span id="cb241-213"><a href="application-estimating-risk-preferences.html#cb241-213" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb241-214"><a href="application-estimating-risk-preferences.html#cb241-214" tabindex="-1"></a></span>
<span id="cb241-215"><a href="application-estimating-risk-preferences.html#cb241-215" tabindex="-1"></a>generated quantities <span class="op">{</span></span>
<span id="cb241-216"><a href="application-estimating-risk-preferences.html#cb241-216" tabindex="-1"></a>  </span>
<span id="cb241-217"><a href="application-estimating-risk-preferences.html#cb241-217" tabindex="-1"></a>  matrix<span class="op">[</span><span class="dv">4</span><span class="op">,</span><span class="dv">4</span><span class="op">]</span> OMEGA <span class="op">=</span> L_OMEGA<span class="op">*</span>L_OMEGA<span class="ch">&#39;;</span></span>
<span id="cb241-218"><a href="application-estimating-risk-preferences.html#cb241-218" tabindex="-1"></a>  </span>
<span id="cb241-219"><a href="application-estimating-risk-preferences.html#cb241-219" tabindex="-1"></a>  <span class="co">// calculate certainty equivalents</span></span>
<span id="cb241-220"><a href="application-estimating-risk-preferences.html#cb241-220" tabindex="-1"></a>  </span>
<span id="cb241-221"><a href="application-estimating-risk-preferences.html#cb241-221" tabindex="-1"></a>  vector<span class="op">[</span>nCE<span class="op">]</span> CE<span class="op">[</span>nparticipants<span class="op">];</span></span>
<span id="cb241-222"><a href="application-estimating-risk-preferences.html#cb241-222" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nparticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-223"><a href="application-estimating-risk-preferences.html#cb241-223" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>cc in <span class="dv">1</span><span class="op">:</span>nCE<span class="op">)</span> <span class="op">{</span></span>
<span id="cb241-224"><a href="application-estimating-risk-preferences.html#cb241-224" tabindex="-1"></a>    </span>
<span id="cb241-225"><a href="application-estimating-risk-preferences.html#cb241-225" tabindex="-1"></a>      CE<span class="op">[</span>ii<span class="op">][</span>cc<span class="op">]</span> <span class="op">=</span> calcCE<span class="op">(</span>CEprobs<span class="op">[</span>cc<span class="op">],</span> CEprizes<span class="op">[</span>cc<span class="op">],</span>r<span class="op">[</span>ii<span class="op">],</span>psi<span class="op">[</span>ii<span class="op">],</span>eta<span class="op">[</span>ii<span class="op">],</span>tol<span class="op">);</span></span>
<span id="cb241-226"><a href="application-estimating-risk-preferences.html#cb241-226" tabindex="-1"></a>    </span>
<span id="cb241-227"><a href="application-estimating-risk-preferences.html#cb241-227" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb241-228"><a href="application-estimating-risk-preferences.html#cb241-228" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb241-229"><a href="application-estimating-risk-preferences.html#cb241-229" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<div id="population-level-estimates" class="section level3 hasAnchor" number="19.4.1">
<h3><span class="header-section-number">19.4.1</span> Population-level estimates<a href="application-estimating-risk-preferences.html#population-level-estimates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Table <a href="application-estimating-risk-preferences.html#tab:RiskProeferencesHierarchicalRDUTable">19.1</a> shows posterior moments of the population-level parameters. Since all of the individual-level parameters except for <span class="math inline">\(r_i\)</span> have <em>transformed</em> normal distributions, it is difficult to interpret the numbers corresponding to these parameters, so I will attempt to put them in context below. For <span class="math inline">\(r_i\)</span>, we can see that the mean level of risk-aversion (1.439) is solidly in the “stay in bed” category defined by <span class="citation">Holt and Laury (<a href="#ref-Holt2002">2002</a>)</span>, although the standard deviation is large enough that its distribution will cover a wide range of risk preferences. We will check on this later when we look at the individual-level estimates.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="application-estimating-risk-preferences.html#cb242-1" tabindex="-1"></a>rounding<span class="ot">&lt;-</span><span class="dv">3</span></span>
<span id="cb242-2"><a href="application-estimating-risk-preferences.html#cb242-2" tabindex="-1"></a></span>
<span id="cb242-3"><a href="application-estimating-risk-preferences.html#cb242-3" tabindex="-1"></a>RDU<span class="ot">&lt;-</span><span class="st">&quot;Code/RiskPreferences/FitRDU.rds&quot;</span> <span class="sc">|&gt;</span><span class="fu">readRDS</span>()</span>
<span id="cb242-4"><a href="application-estimating-risk-preferences.html#cb242-4" tabindex="-1"></a></span>
<span id="cb242-5"><a href="application-estimating-risk-preferences.html#cb242-5" tabindex="-1"></a>parlabels<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="at">r=</span><span class="st">&quot;$r$&quot;</span>,<span class="at">lambda=</span><span class="st">&quot;$</span><span class="sc">\\</span><span class="st">lambda$&quot;</span>,<span class="at">eta=</span><span class="st">&quot;$</span><span class="sc">\\</span><span class="st">eta$&quot;</span>,<span class="at">psi=</span><span class="st">&quot;$</span><span class="sc">\\</span><span class="st">psi$&quot;</span>)</span>
<span id="cb242-6"><a href="application-estimating-risk-preferences.html#cb242-6" tabindex="-1"></a>partxt<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="at">r=</span><span class="st">&quot;r&quot;</span>,<span class="at">lambda=</span><span class="st">&quot;\u03bb&quot;</span>,<span class="at">eta =</span> <span class="st">&quot;\u03b7&quot;</span>,<span class="at">psi =</span> <span class="st">&quot;\u03c8&quot;</span>)</span>
<span id="cb242-7"><a href="application-estimating-risk-preferences.html#cb242-7" tabindex="-1"></a>popparlabels<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="at">MU =</span> <span class="st">&quot;$</span><span class="sc">\\</span><span class="st">mu$&quot;</span>, <span class="at">TAU =</span> <span class="st">&quot;$</span><span class="sc">\\</span><span class="st">tau$&quot;</span>)</span>
<span id="cb242-8"><a href="application-estimating-risk-preferences.html#cb242-8" tabindex="-1"></a></span>
<span id="cb242-9"><a href="application-estimating-risk-preferences.html#cb242-9" tabindex="-1"></a>RDUsummary<span class="ot">&lt;-</span><span class="fu">summary</span>(RDU)<span class="sc">$</span>summary <span class="sc">|&gt;</span> </span>
<span id="cb242-10"><a href="application-estimating-risk-preferences.html#cb242-10" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb242-11"><a href="application-estimating-risk-preferences.html#cb242-11" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;par&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb242-12"><a href="application-estimating-risk-preferences.html#cb242-12" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb242-13"><a href="application-estimating-risk-preferences.html#cb242-13" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="fu">gsub</span>(<span class="st">&quot;[^A-Za-z]+&quot;</span>, <span class="st">&quot;&quot;</span>, par),</span>
<span id="cb242-14"><a href="application-estimating-risk-preferences.html#cb242-14" tabindex="-1"></a>    <span class="at">parameter_index =</span> <span class="fu">parse_number</span>(par),</span>
<span id="cb242-15"><a href="application-estimating-risk-preferences.html#cb242-15" tabindex="-1"></a>    <span class="at">msd =</span> <span class="fu">paste0</span>(mean <span class="sc">|&gt;</span> <span class="fu">round</span>(rounding),<span class="st">&quot; (&quot;</span>,sd <span class="sc">|&gt;</span> <span class="fu">round</span>(rounding),<span class="st">&quot;)&quot;</span>)</span>
<span id="cb242-16"><a href="application-estimating-risk-preferences.html#cb242-16" tabindex="-1"></a>  ) </span>
<span id="cb242-17"><a href="application-estimating-risk-preferences.html#cb242-17" tabindex="-1"></a></span>
<span id="cb242-18"><a href="application-estimating-risk-preferences.html#cb242-18" tabindex="-1"></a>RDUpopulation<span class="ot">&lt;-</span>RDUsummary <span class="sc">|&gt;</span></span>
<span id="cb242-19"><a href="application-estimating-risk-preferences.html#cb242-19" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;MU&quot;</span> <span class="sc">|</span> parameter <span class="sc">==</span> <span class="st">&quot;TAU&quot;</span> <span class="sc">|</span> parameter<span class="sc">==</span><span class="st">&quot;OMEGA&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb242-20"><a href="application-estimating-risk-preferences.html#cb242-20" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb242-21"><a href="application-estimating-risk-preferences.html#cb242-21" tabindex="-1"></a>    <span class="at">parlabel =</span> parlabels[parameter_index]</span>
<span id="cb242-22"><a href="application-estimating-risk-preferences.html#cb242-22" tabindex="-1"></a>  )</span>
<span id="cb242-23"><a href="application-estimating-risk-preferences.html#cb242-23" tabindex="-1"></a></span>
<span id="cb242-24"><a href="application-estimating-risk-preferences.html#cb242-24" tabindex="-1"></a>OMEGA<span class="ot">&lt;-</span>RDUpopulation <span class="sc">|&gt;</span></span>
<span id="cb242-25"><a href="application-estimating-risk-preferences.html#cb242-25" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;OMEGA&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb242-26"><a href="application-estimating-risk-preferences.html#cb242-26" tabindex="-1"></a>  <span class="co"># get the right row and column indices</span></span>
<span id="cb242-27"><a href="application-estimating-risk-preferences.html#cb242-27" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb242-28"><a href="application-estimating-risk-preferences.html#cb242-28" tabindex="-1"></a>    <span class="at">row =</span> <span class="fu">floor</span>(parameter_index<span class="sc">/</span><span class="dv">10</span>),</span>
<span id="cb242-29"><a href="application-estimating-risk-preferences.html#cb242-29" tabindex="-1"></a>    <span class="at">col =</span> parameter_index<span class="dv">-10</span><span class="sc">*</span>row</span>
<span id="cb242-30"><a href="application-estimating-risk-preferences.html#cb242-30" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb242-31"><a href="application-estimating-risk-preferences.html#cb242-31" tabindex="-1"></a>  <span class="fu">filter</span>(row<span class="sc">&lt;=</span>col) <span class="sc">|&gt;</span></span>
<span id="cb242-32"><a href="application-estimating-risk-preferences.html#cb242-32" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb242-33"><a href="application-estimating-risk-preferences.html#cb242-33" tabindex="-1"></a>    <span class="at">rowlabel =</span> parlabels[row],</span>
<span id="cb242-34"><a href="application-estimating-risk-preferences.html#cb242-34" tabindex="-1"></a>    <span class="at">collabel =</span> parlabels[col]</span>
<span id="cb242-35"><a href="application-estimating-risk-preferences.html#cb242-35" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb242-36"><a href="application-estimating-risk-preferences.html#cb242-36" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb242-37"><a href="application-estimating-risk-preferences.html#cb242-37" tabindex="-1"></a>    <span class="at">id_cols =</span> rowlabel,</span>
<span id="cb242-38"><a href="application-estimating-risk-preferences.html#cb242-38" tabindex="-1"></a>    <span class="at">names_from =</span> collabel,</span>
<span id="cb242-39"><a href="application-estimating-risk-preferences.html#cb242-39" tabindex="-1"></a>    <span class="at">values_from =</span> msd,</span>
<span id="cb242-40"><a href="application-estimating-risk-preferences.html#cb242-40" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb242-41"><a href="application-estimating-risk-preferences.html#cb242-41" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb242-42"><a href="application-estimating-risk-preferences.html#cb242-42" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb242-43"><a href="application-estimating-risk-preferences.html#cb242-43" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="fu">paste</span>(<span class="st">&quot;$</span><span class="sc">\\</span><span class="st">Omega$&quot;</span>,<span class="st">&quot; - &quot;</span>,rowlabel)</span>
<span id="cb242-44"><a href="application-estimating-risk-preferences.html#cb242-44" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb242-45"><a href="application-estimating-risk-preferences.html#cb242-45" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>rowlabel)</span>
<span id="cb242-46"><a href="application-estimating-risk-preferences.html#cb242-46" tabindex="-1"></a></span>
<span id="cb242-47"><a href="application-estimating-risk-preferences.html#cb242-47" tabindex="-1"></a></span>
<span id="cb242-48"><a href="application-estimating-risk-preferences.html#cb242-48" tabindex="-1"></a>TAB<span class="ot">&lt;-</span> RDUpopulation <span class="sc">|&gt;</span></span>
<span id="cb242-49"><a href="application-estimating-risk-preferences.html#cb242-49" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">!=</span><span class="st">&quot;OMEGA&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb242-50"><a href="application-estimating-risk-preferences.html#cb242-50" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> parameter,</span>
<span id="cb242-51"><a href="application-estimating-risk-preferences.html#cb242-51" tabindex="-1"></a>              <span class="at">names_from =</span> parlabel,</span>
<span id="cb242-52"><a href="application-estimating-risk-preferences.html#cb242-52" tabindex="-1"></a>              <span class="at">values_from =</span> msd</span>
<span id="cb242-53"><a href="application-estimating-risk-preferences.html#cb242-53" tabindex="-1"></a>              ) <span class="sc">|&gt;</span></span>
<span id="cb242-54"><a href="application-estimating-risk-preferences.html#cb242-54" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parameter =</span> popparlabels[parameter]) <span class="sc">|&gt;</span></span>
<span id="cb242-55"><a href="application-estimating-risk-preferences.html#cb242-55" tabindex="-1"></a>  <span class="fu">rbind</span>(OMEGA)</span>
<span id="cb242-56"><a href="application-estimating-risk-preferences.html#cb242-56" tabindex="-1"></a></span>
<span id="cb242-57"><a href="application-estimating-risk-preferences.html#cb242-57" tabindex="-1"></a>TAB <span class="sc">|&gt;</span></span>
<span id="cb242-58"><a href="application-estimating-risk-preferences.html#cb242-58" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Population level estimates (posterior means with standard deviations in parentheses) from the hierarchical RDU model.&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb242-59"><a href="application-estimating-risk-preferences.html#cb242-59" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb242-60"><a href="application-estimating-risk-preferences.html#cb242-60" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">2</span>,<span class="at">hline_after =</span> T,<span class="at">extra_css =</span> <span class="st">&quot;border-bottom: 1px solid&quot;</span>)</span></code></pre></div>
<table class=" lightable-classic" style="color: black; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:RiskProeferencesHierarchicalRDUTable">Table 19.1: </span>Population level estimates (posterior means with standard deviations in parentheses) from the hierarchical RDU model.
</caption>
<thead>
<tr>
<th style="text-align:left;">
parameter
</th>
<th style="text-align:left;">
<span class="math inline">\(r\)</span>
</th>
<th style="text-align:left;">
<span class="math inline">\(\lambda\)</span>
</th>
<th style="text-align:left;">
<span class="math inline">\(\eta\)</span>
</th>
<th style="text-align:left;">
<span class="math inline">\(\psi\)</span>
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\mu\)</span>
</td>
<td style="text-align:left;">
1.439 (0.073)
</td>
<td style="text-align:left;">
2.662 (0.04)
</td>
<td style="text-align:left;">
0.361 (0.03)
</td>
<td style="text-align:left;">
-0.391 (0.032)
</td>
</tr>
<tr>
<td style="text-align:left;border-bottom: 1px solid">
<span class="math inline">\(\tau\)</span>
</td>
<td style="text-align:left;border-bottom: 1px solid">
0.835 (0.065)
</td>
<td style="text-align:left;border-bottom: 1px solid">
0.446 (0.036)
</td>
<td style="text-align:left;border-bottom: 1px solid">
0.287 (0.03)
</td>
<td style="text-align:left;border-bottom: 1px solid">
0.361 (0.029)
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\Omega\)</span> - <span class="math inline">\(r\)</span>
</td>
<td style="text-align:left;">
1 (0)
</td>
<td style="text-align:left;">
0.162 (0.1)
</td>
<td style="text-align:left;">
0.214 (0.111)
</td>
<td style="text-align:left;">
-0.114 (0.097)
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\Omega\)</span> - <span class="math inline">\(\lambda\)</span>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
1 (0)
</td>
<td style="text-align:left;">
0.065 (0.123)
</td>
<td style="text-align:left;">
-0.084 (0.112)
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\Omega\)</span> - <span class="math inline">\(\eta\)</span>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
1 (0)
</td>
<td style="text-align:left;">
0.14 (0.127)
</td>
</tr>
<tr>
<td style="text-align:left;">
<span class="math inline">\(\Omega\)</span> - <span class="math inline">\(\psi\)</span>
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
1 (0)
</td>
</tr>
</tbody>
</table>
<p>Table <a href="application-estimating-risk-preferences.html#tab:RiskProeferencesHierarchicalRDUTable">19.1</a> also shows the estimated correlations between the (transformed) parameters, however it is difficult to determine from this Table whether or not these are substantially different to zero. Figure <a href="application-estimating-risk-preferences.html#fig:RiskPreferencesOMEGA95">19.7</a> shows 95% Bayesian credible regions for these correlation parameters. All of them cover zero.<a href="#fn91" class="footnote-ref" id="fnref91"><sup>91</sup></a></p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="application-estimating-risk-preferences.html#cb243-1" tabindex="-1"></a>OMEGA<span class="ot">&lt;-</span>RDUpopulation <span class="sc">|&gt;</span></span>
<span id="cb243-2"><a href="application-estimating-risk-preferences.html#cb243-2" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;OMEGA&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb243-3"><a href="application-estimating-risk-preferences.html#cb243-3" tabindex="-1"></a>  <span class="co"># get the right row and column indices</span></span>
<span id="cb243-4"><a href="application-estimating-risk-preferences.html#cb243-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb243-5"><a href="application-estimating-risk-preferences.html#cb243-5" tabindex="-1"></a>    <span class="at">row =</span> <span class="fu">floor</span>(parameter_index<span class="sc">/</span><span class="dv">10</span>),</span>
<span id="cb243-6"><a href="application-estimating-risk-preferences.html#cb243-6" tabindex="-1"></a>    <span class="at">col =</span> parameter_index<span class="dv">-10</span><span class="sc">*</span>row,</span>
<span id="cb243-7"><a href="application-estimating-risk-preferences.html#cb243-7" tabindex="-1"></a>    <span class="at">correlation =</span> <span class="fu">paste</span>(partxt[row],<span class="st">&quot;-&quot;</span>,partxt[col])</span>
<span id="cb243-8"><a href="application-estimating-risk-preferences.html#cb243-8" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb243-9"><a href="application-estimating-risk-preferences.html#cb243-9" tabindex="-1"></a>  <span class="fu">filter</span>(row<span class="sc">&lt;</span>col) </span>
<span id="cb243-10"><a href="application-estimating-risk-preferences.html#cb243-10" tabindex="-1"></a></span>
<span id="cb243-11"><a href="application-estimating-risk-preferences.html#cb243-11" tabindex="-1"></a>(</span>
<span id="cb243-12"><a href="application-estimating-risk-preferences.html#cb243-12" tabindex="-1"></a>  <span class="fu">ggplot</span>(OMEGA,<span class="fu">aes</span>(<span class="at">x=</span>correlation,<span class="at">ymin=</span>X2.<span class="fl">5.</span>,<span class="at">ymax =</span> X97.<span class="fl">5.</span>))</span>
<span id="cb243-13"><a href="application-estimating-risk-preferences.html#cb243-13" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_errorbar</span>()</span>
<span id="cb243-14"><a href="application-estimating-risk-preferences.html#cb243-14" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb243-15"><a href="application-estimating-risk-preferences.html#cb243-15" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_hline</span>(<span class="at">yintercept=</span><span class="dv">0</span>,<span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb243-16"><a href="application-estimating-risk-preferences.html#cb243-16" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:RiskPreferencesOMEGA95"></span>
<img src="index_files/figure-html/RiskPreferencesOMEGA95-1.png" alt="95% Bayesian credible regions (2.5th-95th percentile) for the correlation parameters $\Omega$" width="672" />
<p class="caption">
Figure 19.7: 95% Bayesian credible regions (2.5th-95th percentile) for the correlation parameters <span class="math inline">\(\Omega\)</span>
</p>
</div>
<p>Before turning to the individual-level estimates, it is sometimes useful to investigate what these population-level parameters imply about the median or “representative agent” participant in the model. To show you how to do this, we will look at the implications of these estimates for the probability weighting function. Figure <a href="application-estimating-risk-preferences.html#fig:RiskPreferencesWeightingRepAgent">19.8</a> shows the estimated probability weighting function for this representative agent. Here we can see that most cumulative probabilities are under-weighted, especially those cumulative probabilities close to one.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="application-estimating-risk-preferences.html#cb244-1" tabindex="-1"></a><span class="co"># a probability-weighting function for every step of the posterior sample</span></span>
<span id="cb244-2"><a href="application-estimating-risk-preferences.html#cb244-2" tabindex="-1"></a>d<span class="ot">&lt;-</span><span class="fu">tibble</span>(</span>
<span id="cb244-3"><a href="application-estimating-risk-preferences.html#cb244-3" tabindex="-1"></a>  <span class="at">eta=</span><span class="fu">exp</span>(<span class="fu">extract</span>(RDU)<span class="sc">$</span>MU[,<span class="dv">3</span>]),</span>
<span id="cb244-4"><a href="application-estimating-risk-preferences.html#cb244-4" tabindex="-1"></a>  <span class="at">psi=</span><span class="fu">exp</span>(<span class="fu">extract</span>(RDU)<span class="sc">$</span>MU[,<span class="dv">4</span>])</span>
<span id="cb244-5"><a href="application-estimating-risk-preferences.html#cb244-5" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb244-6"><a href="application-estimating-risk-preferences.html#cb244-6" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb244-7"><a href="application-estimating-risk-preferences.html#cb244-7" tabindex="-1"></a>    <span class="at">s =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()</span>
<span id="cb244-8"><a href="application-estimating-risk-preferences.html#cb244-8" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb244-9"><a href="application-estimating-risk-preferences.html#cb244-9" tabindex="-1"></a>  <span class="fu">expand_grid</span>(</span>
<span id="cb244-10"><a href="application-estimating-risk-preferences.html#cb244-10" tabindex="-1"></a>    <span class="at">p =</span> <span class="fu">c</span>(<span class="fl">0.001</span>,<span class="fu">seq</span>(<span class="fl">0.01</span>,<span class="fl">0.99</span>,<span class="at">length=</span><span class="dv">99</span>),<span class="fl">0.999</span>)</span>
<span id="cb244-11"><a href="application-estimating-risk-preferences.html#cb244-11" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb244-12"><a href="application-estimating-risk-preferences.html#cb244-12" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb244-13"><a href="application-estimating-risk-preferences.html#cb244-13" tabindex="-1"></a>    <span class="at">w =</span> <span class="fu">exp</span>(<span class="sc">-</span>eta<span class="sc">*</span>(<span class="sc">-</span><span class="fu">log</span>(p))<span class="sc">^</span>psi)</span>
<span id="cb244-14"><a href="application-estimating-risk-preferences.html#cb244-14" tabindex="-1"></a>  )</span>
<span id="cb244-15"><a href="application-estimating-risk-preferences.html#cb244-15" tabindex="-1"></a><span class="co"># a summary of the posterior sample</span></span>
<span id="cb244-16"><a href="application-estimating-risk-preferences.html#cb244-16" tabindex="-1"></a>dsum<span class="ot">&lt;-</span>d <span class="sc">|&gt;</span></span>
<span id="cb244-17"><a href="application-estimating-risk-preferences.html#cb244-17" tabindex="-1"></a>  <span class="fu">group_by</span>(p) <span class="sc">|&gt;</span></span>
<span id="cb244-18"><a href="application-estimating-risk-preferences.html#cb244-18" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb244-19"><a href="application-estimating-risk-preferences.html#cb244-19" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">mean</span>(w),</span>
<span id="cb244-20"><a href="application-estimating-risk-preferences.html#cb244-20" tabindex="-1"></a>    <span class="at">min95 =</span> <span class="fu">quantile</span>(w,<span class="fl">0.025</span>),</span>
<span id="cb244-21"><a href="application-estimating-risk-preferences.html#cb244-21" tabindex="-1"></a>    <span class="at">max95 =</span> <span class="fu">quantile</span>(w,<span class="fl">0.975</span>)</span>
<span id="cb244-22"><a href="application-estimating-risk-preferences.html#cb244-22" tabindex="-1"></a>  )</span>
<span id="cb244-23"><a href="application-estimating-risk-preferences.html#cb244-23" tabindex="-1"></a></span>
<span id="cb244-24"><a href="application-estimating-risk-preferences.html#cb244-24" tabindex="-1"></a></span>
<span id="cb244-25"><a href="application-estimating-risk-preferences.html#cb244-25" tabindex="-1"></a>(</span>
<span id="cb244-26"><a href="application-estimating-risk-preferences.html#cb244-26" tabindex="-1"></a>  <span class="fu">ggplot</span>()</span>
<span id="cb244-27"><a href="application-estimating-risk-preferences.html#cb244-27" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb244-28"><a href="application-estimating-risk-preferences.html#cb244-28" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_line</span>(<span class="at">data=</span>dsum,<span class="fu">aes</span>(<span class="at">x=</span>p,<span class="at">y=</span>mean))</span>
<span id="cb244-29"><a href="application-estimating-risk-preferences.html#cb244-29" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_ribbon</span>(<span class="at">data=</span>dsum,<span class="fu">aes</span>(<span class="at">x=</span>p,<span class="at">ymin=</span>min95,<span class="at">ymax=</span>max95),<span class="at">fill=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span><span class="fl">0.2</span>)</span>
<span id="cb244-30"><a href="application-estimating-risk-preferences.html#cb244-30" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>,<span class="at">intercept=</span><span class="dv">0</span>,<span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>,<span class="at">color=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb244-31"><a href="application-estimating-risk-preferences.html#cb244-31" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="fu">expression</span>(<span class="fu">omega</span>(p)))</span>
<span id="cb244-32"><a href="application-estimating-risk-preferences.html#cb244-32" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:RiskPreferencesWeightingRepAgent"></span>
<img src="index_files/figure-html/RiskPreferencesWeightingRepAgent-1.png" alt="Probability weighting function for the median ('representative agent') participant in the hierarchical RDU model. Black curve shows the posterior mean. The shaded region is a 95% Bayesian credible region (2.5th-97.5th percentile), and the blue dashed line is a $45^\circ$ line. The $45^\circ$ line is also the probability weighting function for an EUT participant. " width="672" />
<p class="caption">
Figure 19.8: Probability weighting function for the median (‘representative agent’) participant in the hierarchical RDU model. Black curve shows the posterior mean. The shaded region is a 95% Bayesian credible region (2.5th-97.5th percentile), and the blue dashed line is a <span class="math inline">\(45^\circ\)</span> line. The <span class="math inline">\(45^\circ\)</span> line is also the probability weighting function for an EUT participant.
</p>
</div>
</div>
<div id="participant-level-estimates" class="section level3 hasAnchor" number="19.4.2">
<h3><span class="header-section-number">19.4.2</span> Participant-level estimates<a href="application-estimating-risk-preferences.html#participant-level-estimates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>But hierarchical models also provide us with estimates for the participant-level parameters. In fact, we may be <em>more</em> interested in these, and the population-level parameters could just be means to an end in estimating participant-level quantities.<a href="#fn92" class="footnote-ref" id="fnref92"><sup>92</sup></a>
Figure <a href="application-estimating-risk-preferences.html#fig:RiskPreferencesRDUindividualparams">19.9</a> shows the individual-level estimates (black curves and red error bars) alongside the estimated population distributions (blue shaded regions, i.e. those implied by <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau\)</span>). The interpretation of these estimates (excluding the estimated population distributions) is similar to those shown in Figure <a href="application-estimating-risk-preferences.html#fig:RiskPreferencesRDUIndividual">19.4</a>, which is from the participant-specific estimation done using the RDU model. In this case, though, our posterior estimates for each participant are informed by <em>all</em> of the data, not just the data from that participant. That is, we learn something about participant <span class="math inline">\(i\)</span>’s parameters not just through <span class="math inline">\(i\)</span>’s own decisions, but also because all the other participants <span class="math inline">\(j\neq i\)</span> help inform our prior for estimating <span class="math inline">\(i\)</span>’s parameters.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="application-estimating-risk-preferences.html#cb245-1" tabindex="-1"></a>RDUi<span class="ot">&lt;-</span>RDUsummary <span class="sc">|&gt;</span></span>
<span id="cb245-2"><a href="application-estimating-risk-preferences.html#cb245-2" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb245-3"><a href="application-estimating-risk-preferences.html#cb245-3" tabindex="-1"></a>    parameter <span class="sc">==</span> <span class="st">&quot;r&quot;</span> <span class="sc">|</span> parameter <span class="sc">==</span> <span class="st">&quot;lambda&quot;</span> <span class="sc">|</span> parameter <span class="sc">==</span> <span class="st">&quot;eta&quot;</span> <span class="sc">|</span> parameter<span class="sc">==</span><span class="st">&quot;psi&quot;</span> <span class="sc">|</span> parameter <span class="sc">==</span> <span class="st">&quot;CE&quot;</span></span>
<span id="cb245-4"><a href="application-estimating-risk-preferences.html#cb245-4" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb245-5"><a href="application-estimating-risk-preferences.html#cb245-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb245-6"><a href="application-estimating-risk-preferences.html#cb245-6" tabindex="-1"></a>    <span class="at">id =</span> <span class="fu">ifelse</span>(parameter<span class="sc">==</span><span class="st">&quot;CE&quot;</span>,</span>
<span id="cb245-7"><a href="application-estimating-risk-preferences.html#cb245-7" tabindex="-1"></a>                <span class="fu">floor</span>(parameter_index<span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb245-8"><a href="application-estimating-risk-preferences.html#cb245-8" tabindex="-1"></a>                ,</span>
<span id="cb245-9"><a href="application-estimating-risk-preferences.html#cb245-9" tabindex="-1"></a>                parameter_index</span>
<span id="cb245-10"><a href="application-estimating-risk-preferences.html#cb245-10" tabindex="-1"></a>                ),</span>
<span id="cb245-11"><a href="application-estimating-risk-preferences.html#cb245-11" tabindex="-1"></a>    <span class="at">CEindex =</span> <span class="fu">ifelse</span>(parameter<span class="sc">==</span><span class="st">&quot;CE&quot;</span>,</span>
<span id="cb245-12"><a href="application-estimating-risk-preferences.html#cb245-12" tabindex="-1"></a>                     parameter_index <span class="sc">-</span> <span class="fu">floor</span>(parameter_index<span class="sc">/</span><span class="dv">10</span>)<span class="sc">*</span><span class="dv">10</span>,</span>
<span id="cb245-13"><a href="application-estimating-risk-preferences.html#cb245-13" tabindex="-1"></a>                     <span class="cn">NA</span></span>
<span id="cb245-14"><a href="application-estimating-risk-preferences.html#cb245-14" tabindex="-1"></a>                     ),</span>
<span id="cb245-15"><a href="application-estimating-risk-preferences.html#cb245-15" tabindex="-1"></a>    <span class="at">parlabel =</span> <span class="fu">ifelse</span>(parameter<span class="sc">==</span><span class="st">&quot;CE&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;CE[&quot;</span>,CEindex,<span class="st">&quot;]&quot;</span>),</span>
<span id="cb245-16"><a href="application-estimating-risk-preferences.html#cb245-16" tabindex="-1"></a>                      partxt[parameter]</span>
<span id="cb245-17"><a href="application-estimating-risk-preferences.html#cb245-17" tabindex="-1"></a>    )</span>
<span id="cb245-18"><a href="application-estimating-risk-preferences.html#cb245-18" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb245-19"><a href="application-estimating-risk-preferences.html#cb245-19" tabindex="-1"></a>  <span class="fu">group_by</span>(parlabel) <span class="sc">|&gt;</span></span>
<span id="cb245-20"><a href="application-estimating-risk-preferences.html#cb245-20" tabindex="-1"></a>  <span class="fu">arrange</span>(mean) <span class="sc">|&gt;</span></span>
<span id="cb245-21"><a href="application-estimating-risk-preferences.html#cb245-21" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb245-22"><a href="application-estimating-risk-preferences.html#cb245-22" tabindex="-1"></a>    <span class="at">cumul =</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())<span class="sc">/</span><span class="fu">n</span>()</span>
<span id="cb245-23"><a href="application-estimating-risk-preferences.html#cb245-23" tabindex="-1"></a>  )</span>
<span id="cb245-24"><a href="application-estimating-risk-preferences.html#cb245-24" tabindex="-1"></a></span>
<span id="cb245-25"><a href="application-estimating-risk-preferences.html#cb245-25" tabindex="-1"></a>popcdf_MU<span class="ot">&lt;-</span><span class="fu">tibble</span>(</span>
<span id="cb245-26"><a href="application-estimating-risk-preferences.html#cb245-26" tabindex="-1"></a>  <span class="at">MU_r =</span> <span class="fu">extract</span>(RDU)<span class="sc">$</span>MU[,<span class="dv">1</span>],</span>
<span id="cb245-27"><a href="application-estimating-risk-preferences.html#cb245-27" tabindex="-1"></a>  <span class="at">MU_lambda =</span> <span class="fu">extract</span>(RDU)<span class="sc">$</span>MU[,<span class="dv">2</span>],</span>
<span id="cb245-28"><a href="application-estimating-risk-preferences.html#cb245-28" tabindex="-1"></a>  <span class="at">MU_eta =</span> <span class="fu">extract</span>(RDU)<span class="sc">$</span>MU[,<span class="dv">3</span>],</span>
<span id="cb245-29"><a href="application-estimating-risk-preferences.html#cb245-29" tabindex="-1"></a>  <span class="at">MU_psi =</span> <span class="fu">extract</span>(RDU)<span class="sc">$</span>MU[,<span class="dv">4</span>]</span>
<span id="cb245-30"><a href="application-estimating-risk-preferences.html#cb245-30" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb245-31"><a href="application-estimating-risk-preferences.html#cb245-31" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb245-32"><a href="application-estimating-risk-preferences.html#cb245-32" tabindex="-1"></a>    <span class="at">s =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()</span>
<span id="cb245-33"><a href="application-estimating-risk-preferences.html#cb245-33" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb245-34"><a href="application-estimating-risk-preferences.html#cb245-34" tabindex="-1"></a>  <span class="fu">expand_grid</span>(</span>
<span id="cb245-35"><a href="application-estimating-risk-preferences.html#cb245-35" tabindex="-1"></a>    <span class="at">p =</span> <span class="fu">seq</span>(<span class="fl">0.01</span>,<span class="fl">0.99</span>,<span class="at">length=</span><span class="dv">99</span>)</span>
<span id="cb245-36"><a href="application-estimating-risk-preferences.html#cb245-36" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb245-37"><a href="application-estimating-risk-preferences.html#cb245-37" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb245-38"><a href="application-estimating-risk-preferences.html#cb245-38" tabindex="-1"></a>    <span class="at">cols =</span> MU_r<span class="sc">:</span>MU_psi,</span>
<span id="cb245-39"><a href="application-estimating-risk-preferences.html#cb245-39" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;parameter&quot;</span>,</span>
<span id="cb245-40"><a href="application-estimating-risk-preferences.html#cb245-40" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;MU&quot;</span></span>
<span id="cb245-41"><a href="application-estimating-risk-preferences.html#cb245-41" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb245-42"><a href="application-estimating-risk-preferences.html#cb245-42" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb245-43"><a href="application-estimating-risk-preferences.html#cb245-43" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="fu">str_replace</span>(parameter,<span class="st">&quot;MU_&quot;</span>,<span class="st">&quot;&quot;</span>)</span>
<span id="cb245-44"><a href="application-estimating-risk-preferences.html#cb245-44" tabindex="-1"></a>  )</span>
<span id="cb245-45"><a href="application-estimating-risk-preferences.html#cb245-45" tabindex="-1"></a></span>
<span id="cb245-46"><a href="application-estimating-risk-preferences.html#cb245-46" tabindex="-1"></a></span>
<span id="cb245-47"><a href="application-estimating-risk-preferences.html#cb245-47" tabindex="-1"></a>popcdf_TAU<span class="ot">&lt;-</span><span class="fu">tibble</span>(</span>
<span id="cb245-48"><a href="application-estimating-risk-preferences.html#cb245-48" tabindex="-1"></a>  <span class="at">TAU_r =</span> <span class="fu">extract</span>(RDU)<span class="sc">$</span>TAU[,<span class="dv">1</span>],</span>
<span id="cb245-49"><a href="application-estimating-risk-preferences.html#cb245-49" tabindex="-1"></a>  <span class="at">TAU_lambda =</span> <span class="fu">extract</span>(RDU)<span class="sc">$</span>TAU[,<span class="dv">2</span>],</span>
<span id="cb245-50"><a href="application-estimating-risk-preferences.html#cb245-50" tabindex="-1"></a>  <span class="at">TAU_eta =</span> <span class="fu">extract</span>(RDU)<span class="sc">$</span>TAU[,<span class="dv">3</span>],</span>
<span id="cb245-51"><a href="application-estimating-risk-preferences.html#cb245-51" tabindex="-1"></a>  <span class="at">TAU_psi =</span> <span class="fu">extract</span>(RDU)<span class="sc">$</span>TAU[,<span class="dv">4</span>]</span>
<span id="cb245-52"><a href="application-estimating-risk-preferences.html#cb245-52" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb245-53"><a href="application-estimating-risk-preferences.html#cb245-53" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb245-54"><a href="application-estimating-risk-preferences.html#cb245-54" tabindex="-1"></a>    <span class="at">s =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()</span>
<span id="cb245-55"><a href="application-estimating-risk-preferences.html#cb245-55" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb245-56"><a href="application-estimating-risk-preferences.html#cb245-56" tabindex="-1"></a>  <span class="fu">expand_grid</span>(</span>
<span id="cb245-57"><a href="application-estimating-risk-preferences.html#cb245-57" tabindex="-1"></a>    <span class="at">p =</span> <span class="fu">seq</span>(<span class="fl">0.01</span>,<span class="fl">0.99</span>,<span class="at">length=</span><span class="dv">99</span>)</span>
<span id="cb245-58"><a href="application-estimating-risk-preferences.html#cb245-58" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb245-59"><a href="application-estimating-risk-preferences.html#cb245-59" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb245-60"><a href="application-estimating-risk-preferences.html#cb245-60" tabindex="-1"></a>    <span class="at">cols =</span> TAU_r<span class="sc">:</span>TAU_psi,</span>
<span id="cb245-61"><a href="application-estimating-risk-preferences.html#cb245-61" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">&quot;parameter&quot;</span>,</span>
<span id="cb245-62"><a href="application-estimating-risk-preferences.html#cb245-62" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">&quot;TAU&quot;</span></span>
<span id="cb245-63"><a href="application-estimating-risk-preferences.html#cb245-63" tabindex="-1"></a>  )<span class="sc">|&gt;</span></span>
<span id="cb245-64"><a href="application-estimating-risk-preferences.html#cb245-64" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb245-65"><a href="application-estimating-risk-preferences.html#cb245-65" tabindex="-1"></a>    <span class="at">parameter =</span> <span class="fu">str_replace</span>(parameter,<span class="st">&quot;TAU_&quot;</span>,<span class="st">&quot;&quot;</span>)</span>
<span id="cb245-66"><a href="application-estimating-risk-preferences.html#cb245-66" tabindex="-1"></a>  )</span>
<span id="cb245-67"><a href="application-estimating-risk-preferences.html#cb245-67" tabindex="-1"></a></span>
<span id="cb245-68"><a href="application-estimating-risk-preferences.html#cb245-68" tabindex="-1"></a>pltlims<span class="ot">&lt;-</span>RDUi <span class="sc">|&gt;</span></span>
<span id="cb245-69"><a href="application-estimating-risk-preferences.html#cb245-69" tabindex="-1"></a>  <span class="fu">group_by</span>(parameter) <span class="sc">|&gt;</span></span>
<span id="cb245-70"><a href="application-estimating-risk-preferences.html#cb245-70" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb245-71"><a href="application-estimating-risk-preferences.html#cb245-71" tabindex="-1"></a>    <span class="at">min =</span> <span class="fu">min</span>(X25.),</span>
<span id="cb245-72"><a href="application-estimating-risk-preferences.html#cb245-72" tabindex="-1"></a>    <span class="at">max =</span> <span class="fu">max</span>(X75.)</span>
<span id="cb245-73"><a href="application-estimating-risk-preferences.html#cb245-73" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb245-74"><a href="application-estimating-risk-preferences.html#cb245-74" tabindex="-1"></a>  <span class="fu">filter</span>(parameter<span class="sc">!=</span><span class="st">&quot;CE&quot;</span>)</span>
<span id="cb245-75"><a href="application-estimating-risk-preferences.html#cb245-75" tabindex="-1"></a></span>
<span id="cb245-76"><a href="application-estimating-risk-preferences.html#cb245-76" tabindex="-1"></a>popcdf<span class="ot">&lt;-</span>popcdf_MU <span class="sc">|&gt;</span> </span>
<span id="cb245-77"><a href="application-estimating-risk-preferences.html#cb245-77" tabindex="-1"></a>  <span class="fu">full_join</span>(popcdf_TAU,</span>
<span id="cb245-78"><a href="application-estimating-risk-preferences.html#cb245-78" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;s&quot;</span>,<span class="st">&quot;p&quot;</span>,<span class="st">&quot;parameter&quot;</span>)</span>
<span id="cb245-79"><a href="application-estimating-risk-preferences.html#cb245-79" tabindex="-1"></a>            ) <span class="sc">|&gt;</span></span>
<span id="cb245-80"><a href="application-estimating-risk-preferences.html#cb245-80" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb245-81"><a href="application-estimating-risk-preferences.html#cb245-81" tabindex="-1"></a>    pltlims,</span>
<span id="cb245-82"><a href="application-estimating-risk-preferences.html#cb245-82" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;parameter&quot;</span></span>
<span id="cb245-83"><a href="application-estimating-risk-preferences.html#cb245-83" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb245-84"><a href="application-estimating-risk-preferences.html#cb245-84" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb245-85"><a href="application-estimating-risk-preferences.html#cb245-85" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">ifelse</span>(parameter<span class="sc">==</span><span class="st">&quot;r&quot;</span>,min <span class="sc">+</span>(max<span class="sc">-</span>min)<span class="sc">*</span>p,<span class="fu">log</span>(min <span class="sc">+</span>(max<span class="sc">-</span>min)<span class="sc">*</span>p)),</span>
<span id="cb245-86"><a href="application-estimating-risk-preferences.html#cb245-86" tabindex="-1"></a>    <span class="at">cdf =</span> <span class="fu">pnorm</span>((x<span class="sc">-</span>MU)<span class="sc">/</span>TAU),</span>
<span id="cb245-87"><a href="application-estimating-risk-preferences.html#cb245-87" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">ifelse</span>(parameter<span class="sc">==</span><span class="st">&quot;r&quot;</span>,x,<span class="fu">exp</span>(x))</span>
<span id="cb245-88"><a href="application-estimating-risk-preferences.html#cb245-88" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb245-89"><a href="application-estimating-risk-preferences.html#cb245-89" tabindex="-1"></a>  <span class="fu">group_by</span>(parameter,x) <span class="sc">|&gt;</span></span>
<span id="cb245-90"><a href="application-estimating-risk-preferences.html#cb245-90" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb245-91"><a href="application-estimating-risk-preferences.html#cb245-91" tabindex="-1"></a>    <span class="at">cdf_LB =</span> <span class="fu">quantile</span>(cdf,<span class="at">probs=</span><span class="fl">0.025</span>),</span>
<span id="cb245-92"><a href="application-estimating-risk-preferences.html#cb245-92" tabindex="-1"></a>    <span class="at">cdf_UB =</span> <span class="fu">quantile</span>(cdf,<span class="at">probs=</span><span class="fl">0.975</span>)</span>
<span id="cb245-93"><a href="application-estimating-risk-preferences.html#cb245-93" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb245-94"><a href="application-estimating-risk-preferences.html#cb245-94" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb245-95"><a href="application-estimating-risk-preferences.html#cb245-95" tabindex="-1"></a>    <span class="at">parlabel =</span> partxt[parameter]</span>
<span id="cb245-96"><a href="application-estimating-risk-preferences.html#cb245-96" tabindex="-1"></a>  )</span>
<span id="cb245-97"><a href="application-estimating-risk-preferences.html#cb245-97" tabindex="-1"></a></span>
<span id="cb245-98"><a href="application-estimating-risk-preferences.html#cb245-98" tabindex="-1"></a>(</span>
<span id="cb245-99"><a href="application-estimating-risk-preferences.html#cb245-99" tabindex="-1"></a>  <span class="fu">ggplot</span>(RDUi,<span class="fu">aes</span>(<span class="at">x=</span>mean))</span>
<span id="cb245-100"><a href="application-estimating-risk-preferences.html#cb245-100" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">stat_ecdf</span>()</span>
<span id="cb245-101"><a href="application-estimating-risk-preferences.html#cb245-101" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> X25.,<span class="at">xmax =</span> X75.,<span class="at">y=</span>cumul),<span class="at">color=</span><span class="st">&quot;red&quot;</span>,<span class="at">alpha =</span> <span class="fl">0.3</span>)</span>
<span id="cb245-102"><a href="application-estimating-risk-preferences.html#cb245-102" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_ribbon</span>(<span class="at">data=</span>popcdf,<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">ymin=</span>cdf_LB,<span class="at">ymax=</span>cdf_UB),<span class="at">alpha =</span> <span class="fl">0.2</span>,<span class="at">fill=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb245-103"><a href="application-estimating-risk-preferences.html#cb245-103" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>parlabel,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>)</span>
<span id="cb245-104"><a href="application-estimating-risk-preferences.html#cb245-104" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb245-105"><a href="application-estimating-risk-preferences.html#cb245-105" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;Estimate&quot;</span>)</span>
<span id="cb245-106"><a href="application-estimating-risk-preferences.html#cb245-106" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Cumulative density&quot;</span>)</span>
<span id="cb245-107"><a href="application-estimating-risk-preferences.html#cb245-107" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:RiskPreferencesRDUindividualparams"></span>
<img src="index_files/figure-html/RiskPreferencesRDUindividualparams-1.png" alt="Participant-level parameter estimates from the hierarchical RDU model. The black curve shows the empirical cumulative density of posterior means. Red error bars are a 50% Bayesian credible region (25th-75th percentile). Blue shaded region is a 95% Bayesian credible region (2.5th-97.5th percentile) for the poplation cumulative density function for each parameter (not shown for certainty equivalets)." width="672" />
<p class="caption">
Figure 19.9: Participant-level parameter estimates from the hierarchical RDU model. The black curve shows the empirical cumulative density of posterior means. Red error bars are a 50% Bayesian credible region (25th-75th percentile). Blue shaded region is a 95% Bayesian credible region (2.5th-97.5th percentile) for the poplation cumulative density function for each parameter (not shown for certainty equivalets).
</p>
</div>
<!--

## Extending the model with a Student's $t$ distribution

One thing that you may have onticed with Figure \@ref(fig:RiskPreferencesRDUindividualparams) is that the estimated population cdfs (blue shaded regions) do not entirely match the empirical cumulative densities of the posterior means of participants' estimnates (black curves). They shouldn't *perfectly* match, because they are measuring separate things, and the participant-specific estimates are for a *sample* of participants from the population, not the whole population. But it may also be that the multivariate normal distribution is just not a good approximation of the true population distribution. There are many ways we could go in relaxing this assumption. Here I will show you a simple 1-parameter extension that assumes the participant-specific parameters come from a multivariate Student's $t$ distribution. That is, we will instead assume that:

$$
\begin{pmatrix}
r_i\\ \log\lambda_i \\ \log \eta_i \\ \log\psi_i
\end{pmatrix}
\sim \mathrm{Student\ t}\left(\nu,\mu ,\mathrm{diag\_matrix}(\tau)\Omega\mathrm{diag\_matrix}(\tau) \right)
$$

Where $\nu>0$ is the single, scalar, new parameter. 

This is a really simple extension to the *Stan* file, which you will see below, but before doing this it is important to understand how the normal and Student's $t$ distribution relate. To see this, consider just the univariate $t$ distribution. This is a generalization of the normal distribution, in that as $\nu\to\infty$ the $t$ distribution approaches the normal. For smaller values of $\nu$, the $t$ has fatter tails. A rule of thumb for the $t$ distribution is that if $\nu>30$, the distribution will closely resemble the normal, however we should be careful in taking this too seriously. 

But let's use this rule of thumb to form a prior for $\nu$. If we assume a half-Cauchy distribution, then the cdf of $\nu$ will be:

$$
F_\nu(x)=\frac{2}{\pi}\arctan\left(\frac{x}{g}\right)I(x>0)
$$

where $g>0$ is the parameter in the half-Cauchy distribution. The inverse of this cdf is:

$$
F^{-1}_\nu(p)=g\tan\left(\frac{\pi p}{2}\right)
$$
So the 95th percentile of this distribution is:

$$
F^{-1}_\nu(0.95)=g\mathrm{tan}\left(\frac{0.95\pi}{2}\right)=12.7g
$$

We can use this to calibrate our prior so that $p(\nu<30)=0.95$, specifically:

$$
\nu \sim \mathrm{Cauchy}^+(0,30/12.7)
$$

My thinking behind this is that if Student's $t$ distribution is a substantially better approximation of the population distribution than then normal, then we should be looking for parameter values in the $0<\nu<30$ range. 

Here is the *Stan* file I wrote to implement this model. Note that almost everything is the same as the hierarchical model assuming a multivariate normal distribution, except for the following:

1. I couldn't use the standardized parameters (called `z` in that model) here because I cannot easily get things expressed as normal distributions anymore.
2. *Stan*'s `multi_student_t()` sampling statement takes an array of vectors on the left-hand side, so I had to re-fromat the parameter `theta` to be an array of vectors (rather than a matrix), and
3. I had to specify a prior for `nu`.


``` c

functions {
  
  matrix decisionWeights(
    real psi, real eta,
    data matrix cprob, data matrix cprob0, data matrix cprob1
  ) {
    
    int n = num_elements(cprob)%/%3;
    
    /* Weighted cumulative probabilities
    Here we need to watch out for p=0 and p=1 problems, where the weighting
    function is undefined, but is 0 and 1 in the limit respectively. Here
    I avoid getting NaNs by adding a little bit when p=0, and subtracting 
    a little bit when p=1. I then substitute in the limit exactly just below
    this
    */
    
    matrix[n,3] wcprob = exp(
      -eta * pow(-log(cprob+0.01*(cprob0-cprob1)),psi)
    );
    wcprob = wcprob.*(1.0-cprob0-cprob1)+cprob1;
    
    // convert to decision weights
    
    matrix[n,3] wprob = wcprob;
    
    for (kk in 2:3) {
      wprob[,kk] = wcprob[,kk]-wcprob[,kk-1];
    }
    
    return wprob;
  }
  
  /* Calculating the certainty equivalent is a little more tricky for RDU, so
  I am writing a function to do it so as not to clutter up the generated quantities
  block
  */
  
  real calcCE(vector probs, vector prizes,real r, real psi,real eta,real tol) {
    
    vector[3] cprobs = probs;
    
    for (pp in 2:3) {
      
      cprobs[pp] = cprobs[pp-1]+probs[pp];
    }
    
    vector[3] wcprobs = exp(
      -eta * pow(-log(cprobs),psi)
    );
    
    wcprobs[3] = 1.0; // avoids getting a NaN. This mucst be 1
    for (pp in 1:2) {
      if (wcprobs[pp]<tol) {
        wcprobs[pp] = 0.0;
      }
    }
    
    vector[3] wprobs = wcprobs;
    for (pp in 2:3) {
      wprobs[pp] = wcprobs[pp]-wcprobs[pp-1];
    }
    
    
    return pow(pow(prizes,1.0-r)'*wprobs,1.0/(1.0-r));
    
    
  }
  
}


data {
  int<lower=0> N; // total number of decisions
  
  int<lower=0> nparticipants;
  int id[N];
  int idstartend[nparticipants,2];
  
  int Left[N]; // indicator for chose the Left lottery
  
  matrix[N,3] pLeft; 
  matrix[N,3] pRight;
  matrix[N,3] prizes;
  matrix[N,2] prizerange;
  
  vector[2] prior_MU[4];
  vector[4] prior_TAU;
  real prior_OMEGA;
  
  vector[2] prior_nu;
  
  
  real<lower=0> tol;
  
  // information about the certainty equivalents
  int nCE; // number of certainty equivalents to evaluate
  vector[3] CEprizes[nCE]; // prizes for the lottery for certainty equivalents
  vector[3] CEprobs[nCE]; // probabilities for the lottery for certainty equivalents
}

transformed data {
  
  matrix[N,3] cprobLeft = pLeft;
  matrix[N,3] cprobRight = pRight;
  
  matrix[N,3] cprobLeft0 = rep_matrix(0.0,N,3);
  matrix[N,3] cprobLeft1 = rep_matrix(0.0,N,3);
  matrix[N,3] cprobRight0 = rep_matrix(0.0,N,3);
  matrix[N,3] cprobRight1 = rep_matrix(0.0,N,3);
  
  for (kk in 2:3) {
    cprobLeft[,kk] = cprobLeft[,kk-1]+pLeft[,kk];
    cprobRight[,kk] = cprobRight[,kk-1]+pRight[,kk];
  }
  
  for (ii in 1:N) {
    for (kk in 1:3) {
      
      if (cprobLeft[ii,kk]<tol) {
        cprobLeft0[ii,kk] = 1.0;
      }
      if (cprobLeft[ii,kk]>(1.0-tol)) {
        cprobLeft1[ii,kk] = 1.0;
      }
      
      if (cprobRight[ii,kk]<tol) {
        cprobRight0[ii,kk] = 1.0;
      }
      if (cprobRight[ii,kk]>(1.0-tol)) {
        cprobRight1[ii,kk] = 1.0;
      }
      
    }
  }
  
  
}

parameters {
  
  vector[4] MU;
  vector<lower=0>[4] TAU;
  cholesky_factor_corr[4] L_OMEGA;
  real<lower=0> nu;
  
  vector[4] theta[nparticipants];
 
}

transformed parameters {
  
  vector[nparticipants] r;
  vector[nparticipants] lambda;
  vector[nparticipants] eta;
  vector[nparticipants] psi;
  
  
    
   for (ii in 1:nparticipants) { 
    
    r[ii] = (theta[ii][1]);
    lambda[ii] = (exp(theta[ii][2]));
    eta[ii] = (exp(theta[ii][3]));
    psi[ii] = (exp(theta[ii][4]));
     
   }
  
}


model {
  
  theta ~ multi_student_t(nu,MU,quad_form_diag(L_OMEGA*L_OMEGA',TAU));
  
  // priors
  for (pp in 1:4) {
    MU[pp] ~ normal(prior_MU[pp][1],prior_MU[pp][2]);
    TAU[pp] ~ cauchy(0.0,prior_TAU[pp]);
  }
  L_OMEGA ~ lkj_corr_cholesky(prior_OMEGA);
  nu ~ normal(prior_nu[1],prior_nu[2]);
  
  
  
  for (ii in 1:nparticipants) {
    
    int start = idstartend[ii,1];
    int end = idstartend[ii,2];
    
    real ri = r[ii];
    real lambdai = lambda[ii];
    real etai = eta[ii];
    real psii = psi[ii];
    
    matrix[end-start+1,3] dprob = 
    decisionWeights(psii, etai, cprobLeft[start:end,], cprobLeft0[start:end,], cprobLeft1[start:end,])
     - 
    decisionWeights(psii, etai, cprobRight[start:end,], cprobRight0[start:end,], cprobRight1[start:end,])
    ; 
    
    target +=  bernoulli_logit_lpmf( Left[start:end] | 
    lambdai * ((
      dprob.*pow(prizes[start:end,],1.0-ri)
    )*rep_vector(1.0,3)
    ) 
    ./ // contextual utility normalization
    (
      pow(prizerange[start:end,2],1.0-ri)-pow(prizerange[start:end,1],1.0-ri)
    )
  );
    
  }
  
  
}

generated quantities {
  
  matrix[4,4] OMEGA = L_OMEGA*L_OMEGA';
  
  // calculate certainty equivalents
  
  vector[nCE] CE[nparticipants];
  for (ii in 1:nparticipants) {
    for (cc in 1:nCE) {
    
      CE[ii][cc] = calcCE(CEprobs[cc], CEprizes[cc],r[ii],psi[ii],eta[ii],tol);
    
    }
  }
}
```

-->
</div>
</div>
<div id="r-code-used-to-estimate-these-models-1" class="section level2 hasAnchor" number="19.5">
<h2><span class="header-section-number">19.5</span> <em>R</em> code used to estimate these models<a href="application-estimating-risk-preferences.html#r-code-used-to-estimate-these-models-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Script to do the participant-specific estimation:</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb246-1"><a href="application-estimating-risk-preferences.html#cb246-1" tabindex="-1"></a>library<span class="op">(</span>tidyverse<span class="op">)</span></span>
<span id="cb246-2"><a href="application-estimating-risk-preferences.html#cb246-2" tabindex="-1"></a>library<span class="op">(</span>rstan<span class="op">)</span></span>
<span id="cb246-3"><a href="application-estimating-risk-preferences.html#cb246-3" tabindex="-1"></a>  rstan_options<span class="op">(</span>auto_write <span class="op">=</span> TRUE<span class="op">)</span></span>
<span id="cb246-4"><a href="application-estimating-risk-preferences.html#cb246-4" tabindex="-1"></a>  options<span class="op">(</span>mc<span class="op">.</span>cores <span class="op">=</span> parallel<span class="op">::</span>detectCores<span class="op">())</span></span>
<span id="cb246-5"><a href="application-estimating-risk-preferences.html#cb246-5" tabindex="-1"></a>  rstan_options<span class="op">(</span>threads_per_chain <span class="op">=</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb246-6"><a href="application-estimating-risk-preferences.html#cb246-6" tabindex="-1"></a>  </span>
<span id="cb246-7"><a href="application-estimating-risk-preferences.html#cb246-7" tabindex="-1"></a>D<span class="op">&lt;-</span><span class="st">&quot;Code/RiskPreferences/HS2023Cleaned.rds&quot;</span> <span class="op">|&gt;</span></span>
<span id="cb246-8"><a href="application-estimating-risk-preferences.html#cb246-8" tabindex="-1"></a>  readRDS<span class="op">()</span></span>
<span id="cb246-9"><a href="application-estimating-risk-preferences.html#cb246-9" tabindex="-1"></a></span>
<span id="cb246-10"><a href="application-estimating-risk-preferences.html#cb246-10" tabindex="-1"></a></span>
<span id="cb246-11"><a href="application-estimating-risk-preferences.html#cb246-11" tabindex="-1"></a>models<span class="op">&lt;-</span>list<span class="op">(</span></span>
<span id="cb246-12"><a href="application-estimating-risk-preferences.html#cb246-12" tabindex="-1"></a>  </span>
<span id="cb246-13"><a href="application-estimating-risk-preferences.html#cb246-13" tabindex="-1"></a>  EUT <span class="op">=</span> <span class="st">&quot;Code/RiskPreferences/EUT_individual.stan&quot;</span> <span class="op">|&gt;</span> stan_model<span class="op">(),</span></span>
<span id="cb246-14"><a href="application-estimating-risk-preferences.html#cb246-14" tabindex="-1"></a>  RDU <span class="op">=</span> <span class="st">&quot;Code/RiskPreferences/RDU_individual.stan&quot;</span> <span class="op">|&gt;</span> stan_model<span class="op">()</span></span>
<span id="cb246-15"><a href="application-estimating-risk-preferences.html#cb246-15" tabindex="-1"></a>  </span>
<span id="cb246-16"><a href="application-estimating-risk-preferences.html#cb246-16" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb246-17"><a href="application-estimating-risk-preferences.html#cb246-17" tabindex="-1"></a></span>
<span id="cb246-18"><a href="application-estimating-risk-preferences.html#cb246-18" tabindex="-1"></a>EstimatesSummary<span class="op">&lt;-</span>tibble<span class="op">()</span></span>
<span id="cb246-19"><a href="application-estimating-risk-preferences.html#cb246-19" tabindex="-1"></a></span>
<span id="cb246-20"><a href="application-estimating-risk-preferences.html#cb246-20" tabindex="-1"></a></span>
<span id="cb246-21"><a href="application-estimating-risk-preferences.html#cb246-21" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span>ii  in <span class="op">(</span>D$id <span class="op">|&gt;</span> unique<span class="op">()))</span> <span class="op">{</span></span>
<span id="cb246-22"><a href="application-estimating-risk-preferences.html#cb246-22" tabindex="-1"></a>  </span>
<span id="cb246-23"><a href="application-estimating-risk-preferences.html#cb246-23" tabindex="-1"></a>  d<span class="op">&lt;-</span>D <span class="op">|&gt;</span></span>
<span id="cb246-24"><a href="application-estimating-risk-preferences.html#cb246-24" tabindex="-1"></a>    filter<span class="op">(</span>id<span class="op">==</span>ii<span class="op">)</span></span>
<span id="cb246-25"><a href="application-estimating-risk-preferences.html#cb246-25" tabindex="-1"></a>  </span>
<span id="cb246-26"><a href="application-estimating-risk-preferences.html#cb246-26" tabindex="-1"></a>  dStan<span class="op">&lt;-</span>list<span class="op">(</span></span>
<span id="cb246-27"><a href="application-estimating-risk-preferences.html#cb246-27" tabindex="-1"></a>    </span>
<span id="cb246-28"><a href="application-estimating-risk-preferences.html#cb246-28" tabindex="-1"></a>    N <span class="op">=</span> dim<span class="op">(</span>d<span class="op">)[</span><span class="dv">1</span><span class="op">],</span></span>
<span id="cb246-29"><a href="application-estimating-risk-preferences.html#cb246-29" tabindex="-1"></a>    Left <span class="op">=</span> d$Left<span class="op">,</span></span>
<span id="cb246-30"><a href="application-estimating-risk-preferences.html#cb246-30" tabindex="-1"></a>    </span>
<span id="cb246-31"><a href="application-estimating-risk-preferences.html#cb246-31" tabindex="-1"></a>    pLeft <span class="op">=</span> cbind<span class="op">(</span>d$qL1<span class="op">,</span>d$qL2<span class="op">,</span>d$qL3<span class="op">),</span></span>
<span id="cb246-32"><a href="application-estimating-risk-preferences.html#cb246-32" tabindex="-1"></a>    pRight <span class="op">=</span> cbind<span class="op">(</span>d$qR1<span class="op">,</span>d$qR2<span class="op">,</span>d$qR3<span class="op">),</span></span>
<span id="cb246-33"><a href="application-estimating-risk-preferences.html#cb246-33" tabindex="-1"></a>    prizes <span class="op">=</span> cbind<span class="op">(</span>d$prize1<span class="op">,</span>d$prize2<span class="op">,</span>d$prize3<span class="op">),</span></span>
<span id="cb246-34"><a href="application-estimating-risk-preferences.html#cb246-34" tabindex="-1"></a>    prizerange <span class="op">=</span> cbind<span class="op">(</span>d$prize1<span class="op">,</span>d$prize3<span class="op">),</span></span>
<span id="cb246-35"><a href="application-estimating-risk-preferences.html#cb246-35" tabindex="-1"></a>    </span>
<span id="cb246-36"><a href="application-estimating-risk-preferences.html#cb246-36" tabindex="-1"></a>    prior_r <span class="op">=</span> c<span class="op">(</span><span class="fl">0.27</span><span class="op">,</span><span class="fl">0.36</span><span class="op">),</span></span>
<span id="cb246-37"><a href="application-estimating-risk-preferences.html#cb246-37" tabindex="-1"></a>    prior_lambda <span class="op">=</span> c<span class="op">(</span>log<span class="op">(</span><span class="dv">30</span><span class="op">),</span><span class="fl">0.5</span><span class="op">),</span></span>
<span id="cb246-38"><a href="application-estimating-risk-preferences.html#cb246-38" tabindex="-1"></a>    prior_psi <span class="op">=</span> c<span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb246-39"><a href="application-estimating-risk-preferences.html#cb246-39" tabindex="-1"></a>    prior_eta <span class="op">=</span> c<span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb246-40"><a href="application-estimating-risk-preferences.html#cb246-40" tabindex="-1"></a>    </span>
<span id="cb246-41"><a href="application-estimating-risk-preferences.html#cb246-41" tabindex="-1"></a>    tol <span class="op">=</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb246-42"><a href="application-estimating-risk-preferences.html#cb246-42" tabindex="-1"></a>    </span>
<span id="cb246-43"><a href="application-estimating-risk-preferences.html#cb246-43" tabindex="-1"></a>    nCE <span class="op">=</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb246-44"><a href="application-estimating-risk-preferences.html#cb246-44" tabindex="-1"></a>    CEprizes <span class="op">=</span> list<span class="op">(</span>c<span class="op">(</span><span class="dv">10</span><span class="op">,</span><span class="dv">45</span><span class="op">,</span><span class="dv">80</span><span class="op">),</span>c<span class="op">(</span><span class="dv">10</span><span class="op">,</span><span class="dv">45</span><span class="op">,</span><span class="dv">80</span><span class="op">)),</span></span>
<span id="cb246-45"><a href="application-estimating-risk-preferences.html#cb246-45" tabindex="-1"></a>    CEprobs <span class="op">=</span> list<span class="op">(</span>c<span class="op">(</span><span class="fl">0.95</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="fl">0.05</span><span class="op">),</span>c<span class="op">(</span><span class="fl">0.05</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="fl">0.95</span><span class="op">))</span></span>
<span id="cb246-46"><a href="application-estimating-risk-preferences.html#cb246-46" tabindex="-1"></a>    </span>
<span id="cb246-47"><a href="application-estimating-risk-preferences.html#cb246-47" tabindex="-1"></a>  <span class="op">)</span></span>
<span id="cb246-48"><a href="application-estimating-risk-preferences.html#cb246-48" tabindex="-1"></a>  </span>
<span id="cb246-49"><a href="application-estimating-risk-preferences.html#cb246-49" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>mm in names<span class="op">(</span>models<span class="op">))</span> <span class="op">{</span></span>
<span id="cb246-50"><a href="application-estimating-risk-preferences.html#cb246-50" tabindex="-1"></a>    </span>
<span id="cb246-51"><a href="application-estimating-risk-preferences.html#cb246-51" tabindex="-1"></a>    Fit<span class="op">&lt;-</span>models<span class="op">[[</span><span class="at">mm</span><span class="op">]]</span> <span class="op">|&gt;</span></span>
<span id="cb246-52"><a href="application-estimating-risk-preferences.html#cb246-52" tabindex="-1"></a>      sampling<span class="op">(</span>data<span class="op">=</span>dStan<span class="op">,</span>seed<span class="op">=</span><span class="dv">42</span><span class="op">,</span></span>
<span id="cb246-53"><a href="application-estimating-risk-preferences.html#cb246-53" tabindex="-1"></a>               iter<span class="op">=</span><span class="dv">4000</span><span class="op">,</span></span>
<span id="cb246-54"><a href="application-estimating-risk-preferences.html#cb246-54" tabindex="-1"></a>               control<span class="op">=</span>list<span class="op">(</span>adapt_delta<span class="op">=</span><span class="fl">0.999</span><span class="op">))</span></span>
<span id="cb246-55"><a href="application-estimating-risk-preferences.html#cb246-55" tabindex="-1"></a>    </span>
<span id="cb246-56"><a href="application-estimating-risk-preferences.html#cb246-56" tabindex="-1"></a>    addThis<span class="op">&lt;-</span>summary<span class="op">(</span>Fit<span class="op">)</span>$summary <span class="op">|&gt;</span></span>
<span id="cb246-57"><a href="application-estimating-risk-preferences.html#cb246-57" tabindex="-1"></a>      data<span class="op">.</span>frame<span class="op">()</span></span>
<span id="cb246-58"><a href="application-estimating-risk-preferences.html#cb246-58" tabindex="-1"></a>    </span>
<span id="cb246-59"><a href="application-estimating-risk-preferences.html#cb246-59" tabindex="-1"></a>    addThis$parameter<span class="op">&lt;-</span>rownames<span class="op">(</span>addThis<span class="op">)</span></span>
<span id="cb246-60"><a href="application-estimating-risk-preferences.html#cb246-60" tabindex="-1"></a>    </span>
<span id="cb246-61"><a href="application-estimating-risk-preferences.html#cb246-61" tabindex="-1"></a>    EstimatesSummary<span class="op">&lt;-</span>EstimatesSummary <span class="op">|&gt;</span></span>
<span id="cb246-62"><a href="application-estimating-risk-preferences.html#cb246-62" tabindex="-1"></a>      rbind<span class="op">(</span></span>
<span id="cb246-63"><a href="application-estimating-risk-preferences.html#cb246-63" tabindex="-1"></a>        addThis <span class="op">|&gt;</span> </span>
<span id="cb246-64"><a href="application-estimating-risk-preferences.html#cb246-64" tabindex="-1"></a>          mutate<span class="op">(</span></span>
<span id="cb246-65"><a href="application-estimating-risk-preferences.html#cb246-65" tabindex="-1"></a>            id <span class="op">=</span> ii<span class="op">,</span></span>
<span id="cb246-66"><a href="application-estimating-risk-preferences.html#cb246-66" tabindex="-1"></a>            model <span class="op">=</span> mm</span>
<span id="cb246-67"><a href="application-estimating-risk-preferences.html#cb246-67" tabindex="-1"></a>          <span class="op">)</span></span>
<span id="cb246-68"><a href="application-estimating-risk-preferences.html#cb246-68" tabindex="-1"></a>      <span class="op">)</span></span>
<span id="cb246-69"><a href="application-estimating-risk-preferences.html#cb246-69" tabindex="-1"></a>    </span>
<span id="cb246-70"><a href="application-estimating-risk-preferences.html#cb246-70" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb246-71"><a href="application-estimating-risk-preferences.html#cb246-71" tabindex="-1"></a>  </span>
<span id="cb246-72"><a href="application-estimating-risk-preferences.html#cb246-72" tabindex="-1"></a>  </span>
<span id="cb246-73"><a href="application-estimating-risk-preferences.html#cb246-73" tabindex="-1"></a>  EstimatesSummary <span class="op">|&gt;</span></span>
<span id="cb246-74"><a href="application-estimating-risk-preferences.html#cb246-74" tabindex="-1"></a>    saveRDS<span class="op">(</span><span class="st">&quot;Code/RiskPreferences/Estimates_Individual.rds&quot;</span><span class="op">)</span></span>
<span id="cb246-75"><a href="application-estimating-risk-preferences.html#cb246-75" tabindex="-1"></a>  </span>
<span id="cb246-76"><a href="application-estimating-risk-preferences.html#cb246-76" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Script to estimate the hierarchical models</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb247-1"><a href="application-estimating-risk-preferences.html#cb247-1" tabindex="-1"></a>library<span class="op">(</span>tidyverse<span class="op">)</span></span>
<span id="cb247-2"><a href="application-estimating-risk-preferences.html#cb247-2" tabindex="-1"></a>library<span class="op">(</span>rstan<span class="op">)</span></span>
<span id="cb247-3"><a href="application-estimating-risk-preferences.html#cb247-3" tabindex="-1"></a>  rstan_options<span class="op">(</span>auto_write <span class="op">=</span> TRUE<span class="op">)</span></span>
<span id="cb247-4"><a href="application-estimating-risk-preferences.html#cb247-4" tabindex="-1"></a>  options<span class="op">(</span>mc<span class="op">.</span>cores <span class="op">=</span> parallel<span class="op">::</span>detectCores<span class="op">())</span></span>
<span id="cb247-5"><a href="application-estimating-risk-preferences.html#cb247-5" tabindex="-1"></a>  rstan_options<span class="op">(</span>threads_per_chain <span class="op">=</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb247-6"><a href="application-estimating-risk-preferences.html#cb247-6" tabindex="-1"></a>  </span>
<span id="cb247-7"><a href="application-estimating-risk-preferences.html#cb247-7" tabindex="-1"></a>D<span class="op">&lt;-</span><span class="st">&quot;Code/RiskPreferences/HS2023Cleaned.rds&quot;</span> <span class="op">|&gt;</span></span>
<span id="cb247-8"><a href="application-estimating-risk-preferences.html#cb247-8" tabindex="-1"></a>  readRDS<span class="op">()</span> <span class="op">|&gt;</span></span>
<span id="cb247-9"><a href="application-estimating-risk-preferences.html#cb247-9" tabindex="-1"></a>   mutate<span class="op">(</span>id <span class="op">=</span> paste<span class="op">(</span><span class="st">&quot;-&quot;</span><span class="op">,</span>id<span class="op">,</span><span class="st">&quot;-&quot;</span><span class="op">)</span> <span class="op">|&gt;</span> as<span class="op">.</span>factor<span class="op">()</span> <span class="op">|&gt;</span> as<span class="op">.</span>numeric<span class="op">())</span> <span class="op">|&gt;</span></span>
<span id="cb247-10"><a href="application-estimating-risk-preferences.html#cb247-10" tabindex="-1"></a>  arrange<span class="op">(</span>id<span class="op">)</span></span>
<span id="cb247-11"><a href="application-estimating-risk-preferences.html#cb247-11" tabindex="-1"></a></span>
<span id="cb247-12"><a href="application-estimating-risk-preferences.html#cb247-12" tabindex="-1"></a>idstartend<span class="op">&lt;-</span> D<span class="op">|&gt;</span></span>
<span id="cb247-13"><a href="application-estimating-risk-preferences.html#cb247-13" tabindex="-1"></a>  ungroup<span class="op">()</span> <span class="op">|&gt;</span></span>
<span id="cb247-14"><a href="application-estimating-risk-preferences.html#cb247-14" tabindex="-1"></a>  mutate<span class="op">(</span>rownum <span class="op">=</span> <span class="dv">1</span><span class="op">:</span>n<span class="op">())</span> <span class="op">|&gt;</span></span>
<span id="cb247-15"><a href="application-estimating-risk-preferences.html#cb247-15" tabindex="-1"></a>  group_by<span class="op">(</span>id<span class="op">)</span> <span class="op">|&gt;</span></span>
<span id="cb247-16"><a href="application-estimating-risk-preferences.html#cb247-16" tabindex="-1"></a>  summarize<span class="op">(</span></span>
<span id="cb247-17"><a href="application-estimating-risk-preferences.html#cb247-17" tabindex="-1"></a>    start <span class="op">=</span> min<span class="op">(</span>rownum<span class="op">),</span></span>
<span id="cb247-18"><a href="application-estimating-risk-preferences.html#cb247-18" tabindex="-1"></a>    end <span class="op">=</span> max<span class="op">(</span>rownum<span class="op">)</span></span>
<span id="cb247-19"><a href="application-estimating-risk-preferences.html#cb247-19" tabindex="-1"></a>  <span class="op">)</span></span>
<span id="cb247-20"><a href="application-estimating-risk-preferences.html#cb247-20" tabindex="-1"></a></span>
<span id="cb247-21"><a href="application-estimating-risk-preferences.html#cb247-21" tabindex="-1"></a>ReRunRDU<span class="op">&lt;-</span>FALSE</span>
<span id="cb247-22"><a href="application-estimating-risk-preferences.html#cb247-22" tabindex="-1"></a>ReRunEUT<span class="op">&lt;-</span>FALSE</span>
<span id="cb247-23"><a href="application-estimating-risk-preferences.html#cb247-23" tabindex="-1"></a>ReRunRDU_t<span class="op">&lt;-</span>TRUE</span>
<span id="cb247-24"><a href="application-estimating-risk-preferences.html#cb247-24" tabindex="-1"></a></span>
<span id="cb247-25"><a href="application-estimating-risk-preferences.html#cb247-25" tabindex="-1"></a><span class="pp"># </span><span class="er">Hierarchical RDU model with student t distribution</span></span>
<span id="cb247-26"><a href="application-estimating-risk-preferences.html#cb247-26" tabindex="-1"></a></span>
<span id="cb247-27"><a href="application-estimating-risk-preferences.html#cb247-27" tabindex="-1"></a>file <span class="op">&lt;-</span><span class="st">&quot;Code/RiskPreferences/FitRDU_t.rds&quot;</span></span>
<span id="cb247-28"><a href="application-estimating-risk-preferences.html#cb247-28" tabindex="-1"></a></span>
<span id="cb247-29"><a href="application-estimating-risk-preferences.html#cb247-29" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>file<span class="op">.</span>exists<span class="op">(</span>file<span class="op">)</span> <span class="op">|</span> ReRunRDU_t<span class="op">)</span> <span class="op">{</span></span>
<span id="cb247-30"><a href="application-estimating-risk-preferences.html#cb247-30" tabindex="-1"></a>  </span>
<span id="cb247-31"><a href="application-estimating-risk-preferences.html#cb247-31" tabindex="-1"></a>  print<span class="op">(</span>paste<span class="op">(</span><span class="st">&quot;Estimating RDU hierarchical model with Student t distribution. Output will go into: &quot;</span><span class="op">,</span>file<span class="op">))</span></span>
<span id="cb247-32"><a href="application-estimating-risk-preferences.html#cb247-32" tabindex="-1"></a>  </span>
<span id="cb247-33"><a href="application-estimating-risk-preferences.html#cb247-33" tabindex="-1"></a>  </span>
<span id="cb247-34"><a href="application-estimating-risk-preferences.html#cb247-34" tabindex="-1"></a>  RDU_t <span class="op">&lt;-</span> <span class="st">&quot;Code/RiskPreferences/RDU_hierarchical_student_t.stan&quot;</span> <span class="op">|&gt;</span> stan_model<span class="op">()</span></span>
<span id="cb247-35"><a href="application-estimating-risk-preferences.html#cb247-35" tabindex="-1"></a>  </span>
<span id="cb247-36"><a href="application-estimating-risk-preferences.html#cb247-36" tabindex="-1"></a>  </span>
<span id="cb247-37"><a href="application-estimating-risk-preferences.html#cb247-37" tabindex="-1"></a>  dStan<span class="op">&lt;-</span>list<span class="op">(</span></span>
<span id="cb247-38"><a href="application-estimating-risk-preferences.html#cb247-38" tabindex="-1"></a>    </span>
<span id="cb247-39"><a href="application-estimating-risk-preferences.html#cb247-39" tabindex="-1"></a>    N <span class="op">=</span> dim<span class="op">(</span>D<span class="op">)[</span><span class="dv">1</span><span class="op">],</span></span>
<span id="cb247-40"><a href="application-estimating-risk-preferences.html#cb247-40" tabindex="-1"></a>    Left <span class="op">=</span> D$Left<span class="op">,</span></span>
<span id="cb247-41"><a href="application-estimating-risk-preferences.html#cb247-41" tabindex="-1"></a>    </span>
<span id="cb247-42"><a href="application-estimating-risk-preferences.html#cb247-42" tabindex="-1"></a>    id <span class="op">=</span> D$id<span class="op">,</span></span>
<span id="cb247-43"><a href="application-estimating-risk-preferences.html#cb247-43" tabindex="-1"></a>    </span>
<span id="cb247-44"><a href="application-estimating-risk-preferences.html#cb247-44" tabindex="-1"></a>    nparticipants <span class="op">=</span> dim<span class="op">(</span>idstartend<span class="op">)[</span><span class="dv">1</span><span class="op">],</span></span>
<span id="cb247-45"><a href="application-estimating-risk-preferences.html#cb247-45" tabindex="-1"></a>    </span>
<span id="cb247-46"><a href="application-estimating-risk-preferences.html#cb247-46" tabindex="-1"></a>    idstartend <span class="op">=</span> idstartend <span class="op">|&gt;</span> select<span class="op">(</span>start<span class="op">,</span>end<span class="op">),</span></span>
<span id="cb247-47"><a href="application-estimating-risk-preferences.html#cb247-47" tabindex="-1"></a>    </span>
<span id="cb247-48"><a href="application-estimating-risk-preferences.html#cb247-48" tabindex="-1"></a>    pLeft <span class="op">=</span> cbind<span class="op">(</span>D$qL1<span class="op">,</span>D$qL2<span class="op">,</span>D$qL3<span class="op">),</span></span>
<span id="cb247-49"><a href="application-estimating-risk-preferences.html#cb247-49" tabindex="-1"></a>    pRight <span class="op">=</span> cbind<span class="op">(</span>D$qR1<span class="op">,</span>D$qR2<span class="op">,</span>D$qR3<span class="op">),</span></span>
<span id="cb247-50"><a href="application-estimating-risk-preferences.html#cb247-50" tabindex="-1"></a>    prizes <span class="op">=</span> cbind<span class="op">(</span>D$prize1<span class="op">,</span>D$prize2<span class="op">,</span>D$prize3<span class="op">),</span></span>
<span id="cb247-51"><a href="application-estimating-risk-preferences.html#cb247-51" tabindex="-1"></a>    prizerange <span class="op">=</span> cbind<span class="op">(</span>D$prize1<span class="op">,</span>D$prize3<span class="op">),</span></span>
<span id="cb247-52"><a href="application-estimating-risk-preferences.html#cb247-52" tabindex="-1"></a>    </span>
<span id="cb247-53"><a href="application-estimating-risk-preferences.html#cb247-53" tabindex="-1"></a>    prior_MU<span class="op">&lt;-</span>list<span class="op">(</span></span>
<span id="cb247-54"><a href="application-estimating-risk-preferences.html#cb247-54" tabindex="-1"></a>      c<span class="op">(</span><span class="fl">0.27</span><span class="op">,</span><span class="fl">0.36</span><span class="op">),</span></span>
<span id="cb247-55"><a href="application-estimating-risk-preferences.html#cb247-55" tabindex="-1"></a>      c<span class="op">(</span><span class="fl">3.45</span><span class="op">,</span><span class="fl">0.59</span><span class="op">),</span></span>
<span id="cb247-56"><a href="application-estimating-risk-preferences.html#cb247-56" tabindex="-1"></a>      c<span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb247-57"><a href="application-estimating-risk-preferences.html#cb247-57" tabindex="-1"></a>      c<span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb247-58"><a href="application-estimating-risk-preferences.html#cb247-58" tabindex="-1"></a>      </span>
<span id="cb247-59"><a href="application-estimating-risk-preferences.html#cb247-59" tabindex="-1"></a>    <span class="op">),</span></span>
<span id="cb247-60"><a href="application-estimating-risk-preferences.html#cb247-60" tabindex="-1"></a>    </span>
<span id="cb247-61"><a href="application-estimating-risk-preferences.html#cb247-61" tabindex="-1"></a>    prior_TAU <span class="op">=</span> c<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb247-62"><a href="application-estimating-risk-preferences.html#cb247-62" tabindex="-1"></a>    prior_OMEGA <span class="op">=</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb247-63"><a href="application-estimating-risk-preferences.html#cb247-63" tabindex="-1"></a>    prior_nu <span class="op">=</span> c<span class="op">(</span><span class="dv">15</span><span class="op">,</span><span class="fl">7.5</span><span class="op">),</span></span>
<span id="cb247-64"><a href="application-estimating-risk-preferences.html#cb247-64" tabindex="-1"></a>    </span>
<span id="cb247-65"><a href="application-estimating-risk-preferences.html#cb247-65" tabindex="-1"></a>    tol <span class="op">=</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb247-66"><a href="application-estimating-risk-preferences.html#cb247-66" tabindex="-1"></a>    </span>
<span id="cb247-67"><a href="application-estimating-risk-preferences.html#cb247-67" tabindex="-1"></a>    nCE <span class="op">=</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb247-68"><a href="application-estimating-risk-preferences.html#cb247-68" tabindex="-1"></a>    CEprizes <span class="op">=</span> list<span class="op">(</span>c<span class="op">(</span><span class="dv">10</span><span class="op">,</span><span class="dv">45</span><span class="op">,</span><span class="dv">80</span><span class="op">),</span>c<span class="op">(</span><span class="dv">10</span><span class="op">,</span><span class="dv">45</span><span class="op">,</span><span class="dv">80</span><span class="op">)),</span></span>
<span id="cb247-69"><a href="application-estimating-risk-preferences.html#cb247-69" tabindex="-1"></a>    CEprobs <span class="op">=</span> list<span class="op">(</span>c<span class="op">(</span><span class="fl">0.95</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="fl">0.05</span><span class="op">),</span>c<span class="op">(</span><span class="fl">0.05</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="fl">0.95</span><span class="op">))</span></span>
<span id="cb247-70"><a href="application-estimating-risk-preferences.html#cb247-70" tabindex="-1"></a>    </span>
<span id="cb247-71"><a href="application-estimating-risk-preferences.html#cb247-71" tabindex="-1"></a>  <span class="op">)</span></span>
<span id="cb247-72"><a href="application-estimating-risk-preferences.html#cb247-72" tabindex="-1"></a>  </span>
<span id="cb247-73"><a href="application-estimating-risk-preferences.html#cb247-73" tabindex="-1"></a>  FitRDU_t<span class="op">&lt;-</span>RDU_t <span class="op">|&gt;</span></span>
<span id="cb247-74"><a href="application-estimating-risk-preferences.html#cb247-74" tabindex="-1"></a>    sampling<span class="op">(</span></span>
<span id="cb247-75"><a href="application-estimating-risk-preferences.html#cb247-75" tabindex="-1"></a>      data <span class="op">=</span> dStan<span class="op">,</span>seed<span class="op">=</span><span class="dv">43</span><span class="op">,</span></span>
<span id="cb247-76"><a href="application-estimating-risk-preferences.html#cb247-76" tabindex="-1"></a>      pars<span class="op">=</span><span class="st">&quot;theta&quot;</span><span class="op">,</span>include<span class="op">=</span>FALSE<span class="op">,</span></span>
<span id="cb247-77"><a href="application-estimating-risk-preferences.html#cb247-77" tabindex="-1"></a>      iter<span class="op">=</span><span class="dv">20000</span><span class="op">,</span></span>
<span id="cb247-78"><a href="application-estimating-risk-preferences.html#cb247-78" tabindex="-1"></a>      control <span class="op">=</span> list<span class="op">(</span>adapt_delta<span class="op">=</span><span class="fl">0.99999</span><span class="op">)</span></span>
<span id="cb247-79"><a href="application-estimating-risk-preferences.html#cb247-79" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb247-80"><a href="application-estimating-risk-preferences.html#cb247-80" tabindex="-1"></a>  </span>
<span id="cb247-81"><a href="application-estimating-risk-preferences.html#cb247-81" tabindex="-1"></a>  FitRDU_t <span class="op">|&gt;</span></span>
<span id="cb247-82"><a href="application-estimating-risk-preferences.html#cb247-82" tabindex="-1"></a>    saveRDS<span class="op">(</span>file<span class="op">)</span></span>
<span id="cb247-83"><a href="application-estimating-risk-preferences.html#cb247-83" tabindex="-1"></a>  </span>
<span id="cb247-84"><a href="application-estimating-risk-preferences.html#cb247-84" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb247-85"><a href="application-estimating-risk-preferences.html#cb247-85" tabindex="-1"></a>  print<span class="op">(</span>paste<span class="op">(</span><span class="st">&quot;skipping RDU_t,&quot;</span><span class="op">,</span>file<span class="op">,</span><span class="st">&quot;already exists&quot;</span><span class="op">))</span></span>
<span id="cb247-86"><a href="application-estimating-risk-preferences.html#cb247-86" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb247-87"><a href="application-estimating-risk-preferences.html#cb247-87" tabindex="-1"></a></span>
<span id="cb247-88"><a href="application-estimating-risk-preferences.html#cb247-88" tabindex="-1"></a></span>
<span id="cb247-89"><a href="application-estimating-risk-preferences.html#cb247-89" tabindex="-1"></a><span class="pp">#</span><span class="er"># RDU hierarchical model with multivariate normal distribution</span></span>
<span id="cb247-90"><a href="application-estimating-risk-preferences.html#cb247-90" tabindex="-1"></a></span>
<span id="cb247-91"><a href="application-estimating-risk-preferences.html#cb247-91" tabindex="-1"></a>file <span class="op">&lt;-</span><span class="st">&quot;Code/RiskPreferences/FitRDU.rds&quot;</span></span>
<span id="cb247-92"><a href="application-estimating-risk-preferences.html#cb247-92" tabindex="-1"></a></span>
<span id="cb247-93"><a href="application-estimating-risk-preferences.html#cb247-93" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>file<span class="op">.</span>exists<span class="op">(</span>file<span class="op">)</span> <span class="op">|</span> ReRunRDU<span class="op">)</span> <span class="op">{</span></span>
<span id="cb247-94"><a href="application-estimating-risk-preferences.html#cb247-94" tabindex="-1"></a>  </span>
<span id="cb247-95"><a href="application-estimating-risk-preferences.html#cb247-95" tabindex="-1"></a>  print<span class="op">(</span>paste<span class="op">(</span><span class="st">&quot;Estimating RDU hierarchical model. Output will go into: &quot;</span><span class="op">,</span>file<span class="op">))</span></span>
<span id="cb247-96"><a href="application-estimating-risk-preferences.html#cb247-96" tabindex="-1"></a></span>
<span id="cb247-97"><a href="application-estimating-risk-preferences.html#cb247-97" tabindex="-1"></a></span>
<span id="cb247-98"><a href="application-estimating-risk-preferences.html#cb247-98" tabindex="-1"></a>  RDU <span class="op">&lt;-</span> <span class="st">&quot;Code/RiskPreferences/RDU_hierarchical.stan&quot;</span> <span class="op">|&gt;</span> stan_model<span class="op">()</span></span>
<span id="cb247-99"><a href="application-estimating-risk-preferences.html#cb247-99" tabindex="-1"></a>  </span>
<span id="cb247-100"><a href="application-estimating-risk-preferences.html#cb247-100" tabindex="-1"></a>  </span>
<span id="cb247-101"><a href="application-estimating-risk-preferences.html#cb247-101" tabindex="-1"></a>  dStan<span class="op">&lt;-</span>list<span class="op">(</span></span>
<span id="cb247-102"><a href="application-estimating-risk-preferences.html#cb247-102" tabindex="-1"></a>      </span>
<span id="cb247-103"><a href="application-estimating-risk-preferences.html#cb247-103" tabindex="-1"></a>      N <span class="op">=</span> dim<span class="op">(</span>D<span class="op">)[</span><span class="dv">1</span><span class="op">],</span></span>
<span id="cb247-104"><a href="application-estimating-risk-preferences.html#cb247-104" tabindex="-1"></a>      Left <span class="op">=</span> D$Left<span class="op">,</span></span>
<span id="cb247-105"><a href="application-estimating-risk-preferences.html#cb247-105" tabindex="-1"></a>      </span>
<span id="cb247-106"><a href="application-estimating-risk-preferences.html#cb247-106" tabindex="-1"></a>      id <span class="op">=</span> D$id<span class="op">,</span></span>
<span id="cb247-107"><a href="application-estimating-risk-preferences.html#cb247-107" tabindex="-1"></a>      </span>
<span id="cb247-108"><a href="application-estimating-risk-preferences.html#cb247-108" tabindex="-1"></a>      nparticipants <span class="op">=</span> dim<span class="op">(</span>idstartend<span class="op">)[</span><span class="dv">1</span><span class="op">],</span></span>
<span id="cb247-109"><a href="application-estimating-risk-preferences.html#cb247-109" tabindex="-1"></a>      </span>
<span id="cb247-110"><a href="application-estimating-risk-preferences.html#cb247-110" tabindex="-1"></a>      idstartend <span class="op">=</span> idstartend <span class="op">|&gt;</span> select<span class="op">(</span>start<span class="op">,</span>end<span class="op">),</span></span>
<span id="cb247-111"><a href="application-estimating-risk-preferences.html#cb247-111" tabindex="-1"></a>      </span>
<span id="cb247-112"><a href="application-estimating-risk-preferences.html#cb247-112" tabindex="-1"></a>      pLeft <span class="op">=</span> cbind<span class="op">(</span>D$qL1<span class="op">,</span>D$qL2<span class="op">,</span>D$qL3<span class="op">),</span></span>
<span id="cb247-113"><a href="application-estimating-risk-preferences.html#cb247-113" tabindex="-1"></a>      pRight <span class="op">=</span> cbind<span class="op">(</span>D$qR1<span class="op">,</span>D$qR2<span class="op">,</span>D$qR3<span class="op">),</span></span>
<span id="cb247-114"><a href="application-estimating-risk-preferences.html#cb247-114" tabindex="-1"></a>      prizes <span class="op">=</span> cbind<span class="op">(</span>D$prize1<span class="op">,</span>D$prize2<span class="op">,</span>D$prize3<span class="op">),</span></span>
<span id="cb247-115"><a href="application-estimating-risk-preferences.html#cb247-115" tabindex="-1"></a>      prizerange <span class="op">=</span> cbind<span class="op">(</span>D$prize1<span class="op">,</span>D$prize3<span class="op">),</span></span>
<span id="cb247-116"><a href="application-estimating-risk-preferences.html#cb247-116" tabindex="-1"></a>      </span>
<span id="cb247-117"><a href="application-estimating-risk-preferences.html#cb247-117" tabindex="-1"></a>      prior_MU<span class="op">&lt;-</span>list<span class="op">(</span></span>
<span id="cb247-118"><a href="application-estimating-risk-preferences.html#cb247-118" tabindex="-1"></a>        c<span class="op">(</span><span class="fl">0.27</span><span class="op">,</span><span class="fl">0.36</span><span class="op">),</span></span>
<span id="cb247-119"><a href="application-estimating-risk-preferences.html#cb247-119" tabindex="-1"></a>        c<span class="op">(</span><span class="fl">3.45</span><span class="op">,</span><span class="fl">0.59</span><span class="op">),</span></span>
<span id="cb247-120"><a href="application-estimating-risk-preferences.html#cb247-120" tabindex="-1"></a>        c<span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb247-121"><a href="application-estimating-risk-preferences.html#cb247-121" tabindex="-1"></a>        c<span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb247-122"><a href="application-estimating-risk-preferences.html#cb247-122" tabindex="-1"></a>        </span>
<span id="cb247-123"><a href="application-estimating-risk-preferences.html#cb247-123" tabindex="-1"></a>      <span class="op">),</span></span>
<span id="cb247-124"><a href="application-estimating-risk-preferences.html#cb247-124" tabindex="-1"></a>      </span>
<span id="cb247-125"><a href="application-estimating-risk-preferences.html#cb247-125" tabindex="-1"></a>      prior_TAU <span class="op">=</span> c<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb247-126"><a href="application-estimating-risk-preferences.html#cb247-126" tabindex="-1"></a>      prior_OMEGA <span class="op">=</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb247-127"><a href="application-estimating-risk-preferences.html#cb247-127" tabindex="-1"></a>      </span>
<span id="cb247-128"><a href="application-estimating-risk-preferences.html#cb247-128" tabindex="-1"></a>      tol <span class="op">=</span> <span class="fl">1e-6</span><span class="op">,</span></span>
<span id="cb247-129"><a href="application-estimating-risk-preferences.html#cb247-129" tabindex="-1"></a>      </span>
<span id="cb247-130"><a href="application-estimating-risk-preferences.html#cb247-130" tabindex="-1"></a>      nCE <span class="op">=</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb247-131"><a href="application-estimating-risk-preferences.html#cb247-131" tabindex="-1"></a>      CEprizes <span class="op">=</span> list<span class="op">(</span>c<span class="op">(</span><span class="dv">10</span><span class="op">,</span><span class="dv">45</span><span class="op">,</span><span class="dv">80</span><span class="op">),</span>c<span class="op">(</span><span class="dv">10</span><span class="op">,</span><span class="dv">45</span><span class="op">,</span><span class="dv">80</span><span class="op">)),</span></span>
<span id="cb247-132"><a href="application-estimating-risk-preferences.html#cb247-132" tabindex="-1"></a>      CEprobs <span class="op">=</span> list<span class="op">(</span>c<span class="op">(</span><span class="fl">0.95</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="fl">0.05</span><span class="op">),</span>c<span class="op">(</span><span class="fl">0.05</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="fl">0.95</span><span class="op">))</span></span>
<span id="cb247-133"><a href="application-estimating-risk-preferences.html#cb247-133" tabindex="-1"></a>      </span>
<span id="cb247-134"><a href="application-estimating-risk-preferences.html#cb247-134" tabindex="-1"></a>  <span class="op">)</span></span>
<span id="cb247-135"><a href="application-estimating-risk-preferences.html#cb247-135" tabindex="-1"></a>  </span>
<span id="cb247-136"><a href="application-estimating-risk-preferences.html#cb247-136" tabindex="-1"></a>  FitRDU<span class="op">&lt;-</span>RDU <span class="op">|&gt;</span></span>
<span id="cb247-137"><a href="application-estimating-risk-preferences.html#cb247-137" tabindex="-1"></a>    sampling<span class="op">(</span></span>
<span id="cb247-138"><a href="application-estimating-risk-preferences.html#cb247-138" tabindex="-1"></a>      data <span class="op">=</span> dStan<span class="op">,</span>seed<span class="op">=</span><span class="dv">43</span><span class="op">,</span></span>
<span id="cb247-139"><a href="application-estimating-risk-preferences.html#cb247-139" tabindex="-1"></a>      pars<span class="op">=</span><span class="st">&quot;z&quot;</span><span class="op">,</span>include<span class="op">=</span>FALSE</span>
<span id="cb247-140"><a href="application-estimating-risk-preferences.html#cb247-140" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb247-141"><a href="application-estimating-risk-preferences.html#cb247-141" tabindex="-1"></a>  </span>
<span id="cb247-142"><a href="application-estimating-risk-preferences.html#cb247-142" tabindex="-1"></a>  FitRDU <span class="op">|&gt;</span></span>
<span id="cb247-143"><a href="application-estimating-risk-preferences.html#cb247-143" tabindex="-1"></a>    saveRDS<span class="op">(</span>file<span class="op">)</span></span>
<span id="cb247-144"><a href="application-estimating-risk-preferences.html#cb247-144" tabindex="-1"></a>    </span>
<span id="cb247-145"><a href="application-estimating-risk-preferences.html#cb247-145" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb247-146"><a href="application-estimating-risk-preferences.html#cb247-146" tabindex="-1"></a>  print<span class="op">(</span>paste<span class="op">(</span><span class="st">&quot;skipping RDU,&quot;</span><span class="op">,</span>file<span class="op">,</span><span class="st">&quot;already exists&quot;</span><span class="op">))</span></span>
<span id="cb247-147"><a href="application-estimating-risk-preferences.html#cb247-147" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb247-148"><a href="application-estimating-risk-preferences.html#cb247-148" tabindex="-1"></a></span>
<span id="cb247-149"><a href="application-estimating-risk-preferences.html#cb247-149" tabindex="-1"></a>file <span class="op">&lt;-</span><span class="st">&quot;Code/RiskPreferences/FitEUT.rds&quot;</span></span>
<span id="cb247-150"><a href="application-estimating-risk-preferences.html#cb247-150" tabindex="-1"></a></span>
<span id="cb247-151"><a href="application-estimating-risk-preferences.html#cb247-151" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>file<span class="op">.</span>exists<span class="op">(</span>file<span class="op">)</span> <span class="op">|</span> ReRunEUT<span class="op">)</span> <span class="op">{</span></span>
<span id="cb247-152"><a href="application-estimating-risk-preferences.html#cb247-152" tabindex="-1"></a>  </span>
<span id="cb247-153"><a href="application-estimating-risk-preferences.html#cb247-153" tabindex="-1"></a>  print<span class="op">(</span>paste<span class="op">(</span><span class="st">&quot;Estimating EUT hierarchical model. Output will go into: &quot;</span><span class="op">,</span>file<span class="op">))</span></span>
<span id="cb247-154"><a href="application-estimating-risk-preferences.html#cb247-154" tabindex="-1"></a>  </span>
<span id="cb247-155"><a href="application-estimating-risk-preferences.html#cb247-155" tabindex="-1"></a>  </span>
<span id="cb247-156"><a href="application-estimating-risk-preferences.html#cb247-156" tabindex="-1"></a>  EUT <span class="op">&lt;-</span> <span class="st">&quot;Code/RiskPreferences/EUT_hierarchical.stan&quot;</span> <span class="op">|&gt;</span> stan_model<span class="op">()</span></span>
<span id="cb247-157"><a href="application-estimating-risk-preferences.html#cb247-157" tabindex="-1"></a>  </span>
<span id="cb247-158"><a href="application-estimating-risk-preferences.html#cb247-158" tabindex="-1"></a>  </span>
<span id="cb247-159"><a href="application-estimating-risk-preferences.html#cb247-159" tabindex="-1"></a>  dStan<span class="op">&lt;-</span>list<span class="op">(</span></span>
<span id="cb247-160"><a href="application-estimating-risk-preferences.html#cb247-160" tabindex="-1"></a>    </span>
<span id="cb247-161"><a href="application-estimating-risk-preferences.html#cb247-161" tabindex="-1"></a>    N <span class="op">=</span> dim<span class="op">(</span>D<span class="op">)[</span><span class="dv">1</span><span class="op">],</span></span>
<span id="cb247-162"><a href="application-estimating-risk-preferences.html#cb247-162" tabindex="-1"></a>    Left <span class="op">=</span> D$Left<span class="op">,</span></span>
<span id="cb247-163"><a href="application-estimating-risk-preferences.html#cb247-163" tabindex="-1"></a>    </span>
<span id="cb247-164"><a href="application-estimating-risk-preferences.html#cb247-164" tabindex="-1"></a>    id <span class="op">=</span> D$id<span class="op">,</span></span>
<span id="cb247-165"><a href="application-estimating-risk-preferences.html#cb247-165" tabindex="-1"></a>    </span>
<span id="cb247-166"><a href="application-estimating-risk-preferences.html#cb247-166" tabindex="-1"></a>    nparticipants <span class="op">=</span> dim<span class="op">(</span>idstartend<span class="op">)[</span><span class="dv">1</span><span class="op">],</span></span>
<span id="cb247-167"><a href="application-estimating-risk-preferences.html#cb247-167" tabindex="-1"></a>    </span>
<span id="cb247-168"><a href="application-estimating-risk-preferences.html#cb247-168" tabindex="-1"></a>    idstartend <span class="op">=</span> idstartend <span class="op">|&gt;</span> select<span class="op">(</span>start<span class="op">,</span>end<span class="op">),</span></span>
<span id="cb247-169"><a href="application-estimating-risk-preferences.html#cb247-169" tabindex="-1"></a>    </span>
<span id="cb247-170"><a href="application-estimating-risk-preferences.html#cb247-170" tabindex="-1"></a>    pLeft <span class="op">=</span> cbind<span class="op">(</span>D$qL1<span class="op">,</span>D$qL2<span class="op">,</span>D$qL3<span class="op">),</span></span>
<span id="cb247-171"><a href="application-estimating-risk-preferences.html#cb247-171" tabindex="-1"></a>    pRight <span class="op">=</span> cbind<span class="op">(</span>D$qR1<span class="op">,</span>D$qR2<span class="op">,</span>D$qR3<span class="op">),</span></span>
<span id="cb247-172"><a href="application-estimating-risk-preferences.html#cb247-172" tabindex="-1"></a>    prizes <span class="op">=</span> cbind<span class="op">(</span>D$prize1<span class="op">,</span>D$prize2<span class="op">,</span>D$prize3<span class="op">),</span></span>
<span id="cb247-173"><a href="application-estimating-risk-preferences.html#cb247-173" tabindex="-1"></a>    prizerange <span class="op">=</span> cbind<span class="op">(</span>D$prize1<span class="op">,</span>D$prize3<span class="op">),</span></span>
<span id="cb247-174"><a href="application-estimating-risk-preferences.html#cb247-174" tabindex="-1"></a>    </span>
<span id="cb247-175"><a href="application-estimating-risk-preferences.html#cb247-175" tabindex="-1"></a>    prior_MU<span class="op">&lt;-</span>list<span class="op">(</span></span>
<span id="cb247-176"><a href="application-estimating-risk-preferences.html#cb247-176" tabindex="-1"></a>      c<span class="op">(</span><span class="fl">0.27</span><span class="op">,</span><span class="fl">0.36</span><span class="op">),</span></span>
<span id="cb247-177"><a href="application-estimating-risk-preferences.html#cb247-177" tabindex="-1"></a>      c<span class="op">(</span><span class="fl">3.45</span><span class="op">,</span><span class="fl">0.59</span><span class="op">)</span></span>
<span id="cb247-178"><a href="application-estimating-risk-preferences.html#cb247-178" tabindex="-1"></a>      </span>
<span id="cb247-179"><a href="application-estimating-risk-preferences.html#cb247-179" tabindex="-1"></a>    <span class="op">),</span></span>
<span id="cb247-180"><a href="application-estimating-risk-preferences.html#cb247-180" tabindex="-1"></a>    </span>
<span id="cb247-181"><a href="application-estimating-risk-preferences.html#cb247-181" tabindex="-1"></a>    prior_TAU <span class="op">=</span> c<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">),</span></span>
<span id="cb247-182"><a href="application-estimating-risk-preferences.html#cb247-182" tabindex="-1"></a>    prior_OMEGA <span class="op">=</span> <span class="dv">4</span><span class="op">,</span></span>
<span id="cb247-183"><a href="application-estimating-risk-preferences.html#cb247-183" tabindex="-1"></a>    </span>
<span id="cb247-184"><a href="application-estimating-risk-preferences.html#cb247-184" tabindex="-1"></a>    tol <span class="op">=</span> <span class="fl">1e-6</span></span>
<span id="cb247-185"><a href="application-estimating-risk-preferences.html#cb247-185" tabindex="-1"></a>    </span>
<span id="cb247-186"><a href="application-estimating-risk-preferences.html#cb247-186" tabindex="-1"></a>  <span class="op">)</span></span>
<span id="cb247-187"><a href="application-estimating-risk-preferences.html#cb247-187" tabindex="-1"></a>  </span>
<span id="cb247-188"><a href="application-estimating-risk-preferences.html#cb247-188" tabindex="-1"></a>  FitEUT<span class="op">&lt;-</span>EUT <span class="op">|&gt;</span></span>
<span id="cb247-189"><a href="application-estimating-risk-preferences.html#cb247-189" tabindex="-1"></a>    sampling<span class="op">(</span></span>
<span id="cb247-190"><a href="application-estimating-risk-preferences.html#cb247-190" tabindex="-1"></a>      data <span class="op">=</span> dStan<span class="op">,</span>seed<span class="op">=</span><span class="dv">43</span><span class="op">,</span></span>
<span id="cb247-191"><a href="application-estimating-risk-preferences.html#cb247-191" tabindex="-1"></a>      pars <span class="op">=</span> <span class="st">&quot;z&quot;</span><span class="op">,</span>include<span class="op">=</span>FALSE</span>
<span id="cb247-192"><a href="application-estimating-risk-preferences.html#cb247-192" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb247-193"><a href="application-estimating-risk-preferences.html#cb247-193" tabindex="-1"></a>  </span>
<span id="cb247-194"><a href="application-estimating-risk-preferences.html#cb247-194" tabindex="-1"></a>  FitEUT <span class="op">|&gt;</span></span>
<span id="cb247-195"><a href="application-estimating-risk-preferences.html#cb247-195" tabindex="-1"></a>    saveRDS<span class="op">(</span>file<span class="op">)</span></span>
<span id="cb247-196"><a href="application-estimating-risk-preferences.html#cb247-196" tabindex="-1"></a>  </span>
<span id="cb247-197"><a href="application-estimating-risk-preferences.html#cb247-197" tabindex="-1"></a><span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb247-198"><a href="application-estimating-risk-preferences.html#cb247-198" tabindex="-1"></a>  print<span class="op">(</span>paste<span class="op">(</span><span class="st">&quot;skipping EUT,&quot;</span><span class="op">,</span>file<span class="op">,</span><span class="st">&quot;already exists&quot;</span><span class="op">))</span></span>
<span id="cb247-199"><a href="application-estimating-risk-preferences.html#cb247-199" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Bland2023" class="csl-entry">
———. 2023b. <span>“Bayesian Model Selection and Prior Calibration for Models of Behavior in Economic Experiments.”</span> <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4334267">https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4334267</a>.
</div>
<div id="ref-Blavatskyy2023" class="csl-entry">
Blavatskyy, Pavlo, Valentyn Panchenko, and Andreas Ortmann. 2023. <span>“How Common Is the Common-Ratio Effect?”</span> <em>Experimental Economics</em> 26 (2): 253–72.
</div>
<div id="ref-Conte2011" class="csl-entry">
Conte, Anna, John D Hey, and Peter G Moffatt. 2011. <span>“Mixture Models of Choice Under Risk.”</span> <em>Journal of Econometrics</em> 162 (1): 79–88.
</div>
<div id="ref-Harrison2016" class="csl-entry">
Harrison, Glenn W, and Jia Min Ng. 2016. <span>“Evaluating the Expected Welfare Gain from Insurance.”</span> <em>Journal of Risk and Insurance</em> 83 (1): 91–120. <a href="https://doi.org/10.1111/jori.12142">https://doi.org/10.1111/jori.12142</a>.
</div>
<div id="ref-Harrison2009" class="csl-entry">
Harrison, Glenn W, and E Elisabet Rutström. 2009. <span>“Expected Utility Theory and Prospect Theory: One Wedding and a Decent Funeral.”</span> <em>Experimental Economics</em> 12 (2): 133–58.
</div>
<div id="ref-Harrison2016cumulative" class="csl-entry">
Harrison, Glenn W, and Todd Swarthout. 2023. <span>“Cumulative Prospect Theory in the Laboratory: A Reconsideration.”</span> In <em>Research in Experimental Economics: Models of Risk Preferences: Descriptive and Normative Challenges</em>, edited by G. W. Harrison and D. Ross. Bingley, UK: Emerald.
</div>
<div id="ref-Hey2001" class="csl-entry">
Hey, John D. 2001. <span>“Does Repetition Improve Consistency?”</span> <em>Experimental Economics</em> 4 (1): 5–54.
</div>
<div id="ref-HeyCagno1990" class="csl-entry">
Hey, John D, and Daniela Di Cagno. 1990. <span>“Circles and Triangles an Experimental Estimation of Indifference Lines in the Marschak-Machina Triangle.”</span> <em>Journal of Behavioral Decision Making</em> 3 (4): 279–305.
</div>
<div id="ref-Hey1994" class="csl-entry">
Hey, John D, and Chris Orme. 1994. <span>“Investigating Generalizations of Expected Utility Theory Using Experimental Data.”</span> <em>Econometrica: Journal of the Econometric Society</em>, 1291–1326.
</div>
<div id="ref-Holt2002" class="csl-entry">
Holt, Charles A, and Susan K Laury. 2002. <span>“Risk Aversion and Incentive Effects.”</span> <em>American Economic Review</em> 92 (5): 1644–55.
</div>
<div id="ref-Monroe2020" class="csl-entry">
Monroe, Brian Albert. 2020. <span>“The Statistical Power of Individual-Level Risk Preference Estimation.”</span> <em>Journal of the Economic Science Association</em> 6 (2): 168–88.
</div>
<div id="ref-Prelec1998" class="csl-entry">
Prelec, Drazen. 1998. <span>“The Probability Weighting Function.”</span> <em>Econometrica</em>, 497–527.
</div>
<div id="ref-Quiggin1982" class="csl-entry">
Quiggin, John. 1982. <span>“A Theory of Anticipated Utility.”</span> <em>Journal of Economic Behavior &amp; Organization</em> 3 (4): 323–43.
</div>
<div id="ref-Wilcox2011" class="csl-entry">
———. 2011. <span>“‘Stochastically More Risk Averse:’a Contextual Theory of Stochastic Discrete Choice Under Risk.”</span> <em>Journal of Econometrics</em> 162 (1): 89–104.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="83">
<li id="fn83"><p> Glenn Harrison’s <a href="https://cear.gsu.edu/gwh/">replication archive</a> is an amazing resource if you are looking for datasets using this design. I am indebted to the data sharing norms in Experimental Economics that mean I am able to have easy access to resources like this to do my work.<a href="application-estimating-risk-preferences.html#fnref83" class="footnote-back">↩︎</a></p></li>
<li id="fn84"><p>Not doing so is called a “common ratio” choice pattern. See <span class="citation">Blavatskyy, Panchenko, and Ortmann (<a href="#ref-Blavatskyy2023">2023</a>)</span> for a literature review on this choice pattern. <a href="application-estimating-risk-preferences.html#fnref84" class="footnote-back">↩︎</a></p></li>
<li id="fn85"><p>For example <span class="citation">Harrison and Ng (<a href="#ref-Harrison2016">2016</a>)</span> keeps their three prizes constant for the 80 decisions made in their battery. <a href="application-estimating-risk-preferences.html#fnref85" class="footnote-back">↩︎</a></p></li>
<li id="fn86"><p>These are lotteries where I suspect that the RDU model (discussed below) will produce very different estimates than the EUT model. <a href="application-estimating-risk-preferences.html#fnref86" class="footnote-back">↩︎</a></p></li>
<li id="fn87"><p>This is not the case for all experiments. In our case it works because all lottery prizes (after adding in the show-up fee and endowment) are strictly positive. In other experiments, however, we need to be more careful. For example after adding in the show-up fee to the <span class="citation">Hey (<a href="#ref-Hey2001">2001</a>)</span> dataset, the smallest prize is zero. In this case we would need to restrict <span class="math inline">\(r\)</span> to the interval <span class="math inline">\((-\infty,1)\)</span>. Alternatively, we could use a different functional form for the utility function. In other instances, we may be specifically interested in participants’ treatment of gains and losses, and so in that case our utility function would need to permit negative and positive prizes. <a href="application-estimating-risk-preferences.html#fnref87" class="footnote-back">↩︎</a></p></li>
<li id="fn88"><p>I calibrated these priors with the <span class="citation">Harrison and Ng (<a href="#ref-Harrison2016">2016</a>)</span> experiment in mind, but they are similar enough designs with similar enough payoff scales that I think it is still appropriate to use these priors here.<a href="application-estimating-risk-preferences.html#fnref88" class="footnote-back">↩︎</a></p></li>
<li id="fn89"><p>Please have a look at <span class="citation">Bland (<a href="#ref-Bland2023">2023b</a>)</span> for a detailed scrutiny of these priors.<a href="application-estimating-risk-preferences.html#fnref89" class="footnote-back">↩︎</a></p></li>
<li id="fn90"><p>In an early version of <span class="citation">Bland (<a href="#ref-Bland2023">2023b</a>)</span>, I used the following re-parameterization of the Prelec weighting function:
<span class="math display">\[
\omega_i(p)=\exp(-(-\log\rho_i)^{1-\psi_i}(-\log p)^{\psi_i}),\quad \rho_i\in(0,1),\ \psi_i&gt;0
\]</span>
That is, <span class="math inline">\(\eta_i=(-\log\rho_i)^{1-\psi_i}\)</span>. This re-parameterization has a useful interpretation in that the weighting function crosses the <span class="math inline">\(45^\circ\)</span> line at <span class="math inline">\(p=\rho_i\)</span>, and the function at this point has a slope of <span class="math inline">\(\psi_i\)</span>. That is: <span class="math inline">\(\omega_i(\rho_i)=\rho_i\)</span>, and <span class="math inline">\(\omega&#39;_i(\rho_i)=\psi_i\)</span>. EUT is then nested within RDU if and only if <span class="math inline">\(\psi_i=1\)</span>. While I still like this re-parameterization for its <em>interpretation</em>, it is a mess for estimation. This is because there the estimation does badly when <span class="math inline">\(\rho_i\)</span> is close to zero or one. That is, the estimation has trouble when the probability weighting function is close to either entirely above the <span class="math inline">\(45^\circ\)</span> line, or entirely below the <span class="math inline">\(45^\circ\)</span> line. Therefor3e <em>estimating</em> <span class="math inline">\(\rho_i\)</span> as a fundamental parameter is not a good idea, but you still may want to calculate it in the <code>generated quantities</code> block so you can use this nice interpretation. <a href="application-estimating-risk-preferences.html#fnref90" class="footnote-back">↩︎</a></p></li>
<li id="fn91"><p>We should be careful here in concluding from this plot that there is no correlation between the parameters. It would be better to re-estimate the model setting the correlation matrix to the identity matrix (i.e. no correlation), and then interpret the Bayes factor of these two models.<a href="application-estimating-risk-preferences.html#fnref91" class="footnote-back">↩︎</a></p></li>
<li id="fn92"><p>This, of course, depends on the inferential goal. If we are interested in making statements about the population as a whole, then we are primarily interested in <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\tau\)</span>, and <span class="math inline">\(\Omega\)</span>. On the other hand, if we want to learn things about specific participants, then we will be more interested in the augmented data and the quantities derived from it. <a href="application-estimating-risk-preferences.html#fnref92" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="application-level-k-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="application-meta-analysis-using-some-of-the-metaret-data.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": false,
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

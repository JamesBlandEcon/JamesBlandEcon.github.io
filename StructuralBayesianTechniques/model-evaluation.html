<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Model evaluation | Structural Bayesian Techniques for Experimental and Behavioral Economics</title>
  <meta name="description" content="8 Model evaluation | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  <meta name="generator" content="bookdown 0.38 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Model evaluation | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Model evaluation | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  
  
  

<meta name="author" content="James R. Bland" />


<meta name="date" content="2025-03-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="mixture-models.html"/>
<link rel="next" href="speeding-up-your-stan-code.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="section.html#section" id="toc-section"></a></li>
<li class="chapter" data-level="" data-path="setting-the-stage.html"><a href="setting-the-stage.html"><i class="fa fa-check"></i>Setting the stage</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-does-your-theory-say-about-your-data"><i class="fa fa-check"></i><b>1.1</b> What does your theory say about your data?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-do-your-data-say-about-your-theory"><i class="fa fa-check"></i><b>1.2</b> What do your data say about your theory?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-do-your-parameters-say-about-other-things"><i class="fa fa-check"></i><b>1.3</b> What do your parameters say about other things?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-does-your-expertise-say-about-your-parameters"><i class="fa fa-check"></i><b>1.4</b> What does your expertise say about your parameters?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html"><i class="fa fa-check"></i><b>2</b> Getting started in <em>Stan</em></a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#installation-in-r"><i class="fa fa-check"></i><b>2.1</b> Installation in <em>R</em></a></li>
<li class="chapter" data-level="2.2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#the-anatomy-of-a-stan-program"><i class="fa fa-check"></i><b>2.2</b> The anatomy of a <em>Stan</em> program</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#data-block"><i class="fa fa-check"></i><b>2.2.1</b> Data block</a></li>
<li class="chapter" data-level="2.2.2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#transformed-data-block"><i class="fa fa-check"></i><b>2.2.2</b> Transformed data block</a></li>
<li class="chapter" data-level="2.2.3" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#parameters-block"><i class="fa fa-check"></i><b>2.2.3</b> Parameters block</a></li>
<li class="chapter" data-level="2.2.4" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#model-block"><i class="fa fa-check"></i><b>2.2.4</b> Model block</a></li>
<li class="chapter" data-level="2.2.5" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#generated-quantities-block"><i class="fa fa-check"></i><b>2.2.5</b> Generated quantities block</a></li>
<li class="chapter" data-level="2.2.6" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#the-final-product"><i class="fa fa-check"></i><b>2.2.6</b> The final product</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#estimating-a-model"><i class="fa fa-check"></i><b>2.3</b> Estimating a model</a></li>
<li class="chapter" data-level="2.4" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#looking-at-the-results"><i class="fa fa-check"></i><b>2.4</b> Looking at the results</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html"><i class="fa fa-check"></i><b>3</b> Probabilistic models of behavior</a>
<ul>
<li class="chapter" data-level="3.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#the-problem-with-deterministic-models"><i class="fa fa-check"></i><b>3.1</b> The problem with deterministic models</a></li>
<li class="chapter" data-level="3.2" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#what-is-a-probabilistic-model"><i class="fa fa-check"></i><b>3.2</b> What <em>is</em> a probabilistic model?</a></li>
<li class="chapter" data-level="3.3" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#example-dataset-and-model"><i class="fa fa-check"></i><b>3.3</b> Example dataset and model</a></li>
<li class="chapter" data-level="3.4" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#optimal-choice-plus-an-error"><i class="fa fa-check"></i><b>3.4</b> Optimal choice plus an error</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#estimating-a-model-1"><i class="fa fa-check"></i><b>3.4.1</b> Estimating a model</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#utility-based-models"><i class="fa fa-check"></i><b>3.5</b> Utility-based models</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#estimating-a-model-2"><i class="fa fa-check"></i><b>3.5.1</b> Estimating a model</a></li>
<li class="chapter" data-level="3.5.2" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#doing-something-with-the-estimates"><i class="fa fa-check"></i><b>3.5.2</b> Doing something with the estimates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html"><i class="fa fa-check"></i><b>4</b> Considerations for choosing a prior</a>
<ul>
<li class="chapter" data-level="4.1" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#example-model-and-experiment"><i class="fa fa-check"></i><b>4.1</b> Example model and experiment</a></li>
<li class="chapter" data-level="4.2" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#getting-the-support-right"><i class="fa fa-check"></i><b>4.2</b> Getting the support right</a></li>
<li class="chapter" data-level="4.3" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#eliciting-reasonable-priors"><i class="fa fa-check"></i><b>4.3</b> Eliciting reasonable priors</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#parameter-values-and-the-prior-pushforward-check"><i class="fa fa-check"></i><b>4.3.1</b> Parameter values and the prior pushforward check</a></li>
<li class="chapter" data-level="4.3.2" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#predictions-and-other-derived-quantities-the-prior-predictive-check"><i class="fa fa-check"></i><b>4.3.2</b> Predictions and other derived quantities: The prior predictive check</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#assessing-the-sampling-performance-of-a-prior"><i class="fa fa-check"></i><b>4.4</b> Assessing the sampling performance of a prior</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#does-our-model-recover-its-parameters-well"><i class="fa fa-check"></i><b>4.4.1</b> Does our model recover its parameters well?</a></li>
<li class="chapter" data-level="4.4.2" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#do-we-see-any-pathologies-in-the-estimation-process"><i class="fa fa-check"></i><b>4.4.2</b> Do we see any pathologies in the estimation process?</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#r-code-used-for-this-chapter"><i class="fa fa-check"></i><b>4.5</b> <em>R</em> code used for this chapter</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="building-blocks.html"><a href="building-blocks.html"><i class="fa fa-check"></i>Building blocks</a></li>
<li class="chapter" data-level="5" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html"><i class="fa fa-check"></i><b>5</b> Representative agent and participant-specific models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#participant-specific-models"><i class="fa fa-check"></i><b>5.1</b> Participant-specific models</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#example-data-and-economic-model"><i class="fa fa-check"></i><b>5.1.1</b> Example data and economic model</a></li>
<li class="chapter" data-level="5.1.2" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#going-to-the-probabilistic-model"><i class="fa fa-check"></i><b>5.1.2</b> Going to the probabilistic model</a></li>
<li class="chapter" data-level="5.1.3" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#a-short-side-quest-into-canned-estimation-techniques"><i class="fa fa-check"></i><b>5.1.3</b> A short side quest into canned estimation techniques</a></li>
<li class="chapter" data-level="5.1.4" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#assigning-priors"><i class="fa fa-check"></i><b>5.1.4</b> Assigning priors</a></li>
<li class="chapter" data-level="5.1.5" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#estimating-the-model-for-one-participant"><i class="fa fa-check"></i><b>5.1.5</b> Estimating the model for one participant</a></li>
<li class="chapter" data-level="5.1.6" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#estimating-the-model-for-all-participants"><i class="fa fa-check"></i><b>5.1.6</b> Estimating the model for all participants</a></li>
<li class="chapter" data-level="5.1.7" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#but-we-could-be-learning-more"><i class="fa fa-check"></i><b>5.1.7</b> But we could be learning more!</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#actual-representative-agent-models-pooled-models"><i class="fa fa-check"></i><b>5.2</b> Actual representative agent models (pooled models)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="hierarchical-models.html"><a href="hierarchical-models.html"><i class="fa fa-check"></i><b>6</b> Hierarchical models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-random-sample-of-participants-walks-into-your-lab"><i class="fa fa-check"></i><b>6.1</b> A random sample of participants walks into your lab</a></li>
<li class="chapter" data-level="6.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#the-anatomy-of-a-basic-hierarchical-model"><i class="fa fa-check"></i><b>6.2</b> The anatomy of a basic hierarchical model</a></li>
<li class="chapter" data-level="6.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#accounting-for-unobserved-heterogeneity"><i class="fa fa-check"></i><b>6.3</b> Accounting for unobserved heterogeneity</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#the-last-time-you-will-integrate-the-likelihood-probably"><i class="fa fa-check"></i><b>6.3.1</b> The last time you will integrate the likelihood, probably</a></li>
<li class="chapter" data-level="6.3.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#data-augmentation"><i class="fa fa-check"></i><b>6.3.2</b> Data augmentation</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-multivariate-normal-hierarchical-model"><i class="fa fa-check"></i><b>6.4</b> A multivariate normal hierarchical model</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#decomposing-the-variance-covariance-matrix"><i class="fa fa-check"></i><b>6.4.1</b> Decomposing the variance-covariance matrix</a></li>
<li class="chapter" data-level="6.4.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#transformed-parameters-and-normal-distributions"><i class="fa fa-check"></i><b>6.4.2</b> Transformed parameters and normal distributions</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-again-with-bfs2019"><i class="fa fa-check"></i><b>6.5</b> Example: again with <span class="citation">Bruhin, Fehr, and Schunk (2019)</span></a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#no-correlation-between-individual-level-parameters"><i class="fa fa-check"></i><b>6.5.1</b> No correlation between individual-level parameters</a></li>
<li class="chapter" data-level="6.5.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#correlation-between-individual-level-parameters"><i class="fa fa-check"></i><b>6.5.2</b> Correlation between individual-level parameters</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="mixture-models.html"><a href="mixture-models.html"><i class="fa fa-check"></i><b>7</b> Mixture models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="mixture-models.html"><a href="mixture-models.html#a-menu-of-models"><i class="fa fa-check"></i><b>7.1</b> A menu of models</a></li>
<li class="chapter" data-level="7.2" data-path="mixture-models.html"><a href="mixture-models.html#dichotomous-and-toolbox-mixture-models"><i class="fa fa-check"></i><b>7.2</b> Dichotomous and toolbox mixture models</a></li>
<li class="chapter" data-level="7.3" data-path="mixture-models.html"><a href="mixture-models.html#coding-peculearities"><i class="fa fa-check"></i><b>7.3</b> Coding peculearities</a></li>
<li class="chapter" data-level="7.4" data-path="mixture-models.html"><a href="mixture-models.html#example-experiment-av2001"><i class="fa fa-check"></i><b>7.4</b> Example experiment: <span class="citation">Andreoni and Vesterlund (2001)</span></a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="mixture-models.html"><a href="mixture-models.html#as-basic-as-it-gets"><i class="fa fa-check"></i><b>7.4.1</b> As basic as it gets</a></li>
<li class="chapter" data-level="7.4.2" data-path="mixture-models.html"><a href="mixture-models.html#adding-some-heterogeneity"><i class="fa fa-check"></i><b>7.4.2</b> Adding some heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="mixture-models.html"><a href="mixture-models.html#some-code-used-to-estimate-the-models"><i class="fa fa-check"></i><b>7.5</b> Some code used to estimate the models</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="model-evaluation.html"><a href="model-evaluation.html"><i class="fa fa-check"></i><b>8</b> Model evaluation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="model-evaluation.html"><a href="model-evaluation.html#example-dataset-and-models"><i class="fa fa-check"></i><b>8.1</b> Example dataset and models</a></li>
<li class="chapter" data-level="8.2" data-path="model-evaluation.html"><a href="model-evaluation.html#model-posterior-probabilities"><i class="fa fa-check"></i><b>8.2</b> Model posterior probabilities</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="model-evaluation.html"><a href="model-evaluation.html#implementation-using-bridge-sampling-and-the-bridgesampling-library"><i class="fa fa-check"></i><b>8.2.1</b> Implementation using bridge sampling and the <code>bridgesampling</code> library</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="model-evaluation.html"><a href="model-evaluation.html#cross-validation"><i class="fa fa-check"></i><b>8.3</b> Cross-validation</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="model-evaluation.html"><a href="model-evaluation.html#expected-log-predicted-density-elpd-and-other-measures-of-goodness-of-fit"><i class="fa fa-check"></i><b>8.3.1</b> Expected Log Predicted Density (ELPD) and other measures of goodness of fit</a></li>
<li class="chapter" data-level="8.3.2" data-path="model-evaluation.html"><a href="model-evaluation.html#round-cross-validation"><i class="fa fa-check"></i><b>8.3.2</b> 1-round cross-validation</a></li>
<li class="chapter" data-level="8.3.3" data-path="model-evaluation.html"><a href="model-evaluation.html#leave-one-out-cross-validation-loo"><i class="fa fa-check"></i><b>8.3.3</b> Leave-one-out cross-validation (LOO)</a></li>
<li class="chapter" data-level="8.3.4" data-path="model-evaluation.html"><a href="model-evaluation.html#approximate-loo"><i class="fa fa-check"></i><b>8.3.4</b> Approximate LOO</a></li>
<li class="chapter" data-level="8.3.5" data-path="model-evaluation.html"><a href="model-evaluation.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>8.3.5</b> <span class="math inline">\(k\)</span>-fold cross-validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html"><i class="fa fa-check"></i><b>9</b> Speeding up your <em>Stan</em> code</a>
<ul>
<li class="chapter" data-level="9.1" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#example-dataset-and-model-1"><i class="fa fa-check"></i><b>9.1</b> Example dataset and model</a></li>
<li class="chapter" data-level="9.2" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#a-really-slow-way-to-estimate-the-model"><i class="fa fa-check"></i><b>9.2</b> A really slow way to estimate the model</a></li>
<li class="chapter" data-level="9.3" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#pre-computing-things"><i class="fa fa-check"></i><b>9.3</b> Pre-computing things</a></li>
<li class="chapter" data-level="9.4" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#vectorization"><i class="fa fa-check"></i><b>9.4</b> Vectorization</a></li>
<li class="chapter" data-level="9.5" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#within-chain-parallelization-with-reduce_sum"><i class="fa fa-check"></i><b>9.5</b> Within-chain parallelization with <code>reduce_sum()</code></a></li>
<li class="chapter" data-level="9.6" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#evaluating-the-implementations"><i class="fa fa-check"></i><b>9.6</b> Evaluating the implementations</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#pre-computing-and-vectorization"><i class="fa fa-check"></i><b>9.6.1</b> Pre-computing and vectorization</a></li>
<li class="chapter" data-level="9.6.2" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#within-chain-parallelization"><i class="fa fa-check"></i><b>9.6.2</b> Within-chain parallelization</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#r-code-to-estimate-models"><i class="fa fa-check"></i><b>9.7</b> <em>R</em> code to estimate models</a>
<ul>
<li class="chapter" data-level="9.7.1" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#slow-pre-computed-and-vectorized-models"><i class="fa fa-check"></i><b>9.7.1</b> Slow, pre-computed, and vectorized models</a></li>
<li class="chapter" data-level="9.7.2" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#parallelized-model"><i class="fa fa-check"></i><b>9.7.2</b> Parallelized model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i>Applications</a></li>
<li class="chapter" data-level="10" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html"><i class="fa fa-check"></i><b>10</b> Application: Experience-Weighted Attraction</a>
<ul>
<li class="chapter" data-level="10.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-model-at-the-individual-level"><i class="fa fa-check"></i><b>10.1</b> The model at the individual level</a></li>
<li class="chapter" data-level="10.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#some-computational-and-coding-issues"><i class="fa fa-check"></i><b>10.2</b> Some computational and coding issues</a></li>
<li class="chapter" data-level="10.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#representative-agent-models"><i class="fa fa-check"></i><b>10.3</b> Representative agent models</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#prior-calibration"><i class="fa fa-check"></i><b>10.3.1</b> Prior calibration</a></li>
<li class="chapter" data-level="10.3.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-stan-model"><i class="fa fa-check"></i><b>10.3.2</b> The <em>Stan</em> model</a></li>
<li class="chapter" data-level="10.3.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#results"><i class="fa fa-check"></i><b>10.3.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#hierarchical-model"><i class="fa fa-check"></i><b>10.4</b> Hierarchical model</a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#prior-calibration-1"><i class="fa fa-check"></i><b>10.4.1</b> Prior calibration</a></li>
<li class="chapter" data-level="10.4.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-stan-model-1"><i class="fa fa-check"></i><b>10.4.2</b> The <em>Stan</em> model</a></li>
<li class="chapter" data-level="10.4.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#results-1"><i class="fa fa-check"></i><b>10.4.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#some-code-used-to-estimate-the-models-1"><i class="fa fa-check"></i><b>10.5</b> Some code used to estimate the models</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#loading-the-data"><i class="fa fa-check"></i><b>10.5.1</b> Loading the data</a></li>
<li class="chapter" data-level="10.5.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#estimating-the-representative-agent-models"><i class="fa fa-check"></i><b>10.5.2</b> Estimating the representative agent models</a></li>
<li class="chapter" data-level="10.5.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#estimating-the-hierarchical-model"><i class="fa fa-check"></i><b>10.5.3</b> Estimating the hierarchical model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html"><i class="fa fa-check"></i><b>11</b> Application: Strategy Frequency Estimation</a>
<ul>
<li class="chapter" data-level="11.1" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#simplifying-the-individual-likelihood-functions"><i class="fa fa-check"></i><b>11.1</b> Simplifying the individual likelihood functions</a></li>
<li class="chapter" data-level="11.2" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#example-experiment-dbf2011"><i class="fa fa-check"></i><b>11.2</b> Example experiment: <span class="citation">Dal Bó and Fréchette (2011)</span></a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#the-sfem-with-homogeneous-trembles"><i class="fa fa-check"></i><b>11.2.1</b> The SFEM with homogeneous trembles</a></li>
<li class="chapter" data-level="11.2.2" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#adding-heterogeneous-trembles-and-integrating-the-likelihood"><i class="fa fa-check"></i><b>11.2.2</b> Adding heterogeneous trembles and integrating the likelihood</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#r-code-to-do-these-estimations"><i class="fa fa-check"></i><b>11.3</b> <em>R</em> code to do these estimations</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><i class="fa fa-check"></i><b>12</b> Application: Strategy frequency estimation with a mixed strategy</a>
<ul>
<li class="chapter" data-level="12.1" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#example-dataset-and-strategies"><i class="fa fa-check"></i><b>12.1</b> Example dataset and strategies</a></li>
<li class="chapter" data-level="12.2" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#the-likelihood-function"><i class="fa fa-check"></i><b>12.2</b> The likelihood function</a></li>
<li class="chapter" data-level="12.3" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#implementation-in-stan"><i class="fa fa-check"></i><b>12.3</b> Implementation in <em>Stan</em></a></li>
<li class="chapter" data-level="12.4" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#results-2"><i class="fa fa-check"></i><b>12.4</b> Results</a></li>
<li class="chapter" data-level="12.5" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#r-code-used-to-estimate-the-models"><i class="fa fa-check"></i><b>12.5</b> <em>R</em> code used to estimate the models</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html"><i class="fa fa-check"></i><b>13</b> Computing Quantal Response Equilibrium</a>
<ul>
<li class="chapter" data-level="13.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#overview-of-quantal-response-equilibrium"><i class="fa fa-check"></i><b>13.1</b> Overview of quantal response equilibrium</a></li>
<li class="chapter" data-level="13.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#computing-quantal-response-equilibrium-1"><i class="fa fa-check"></i><b>13.2</b> Computing Quantal Response Equilibrium</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#setting-up-the-problem"><i class="fa fa-check"></i><b>13.2.1</b> Setting up the problem</a></li>
<li class="chapter" data-level="13.2.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#a-predictor-corrector-algorithm"><i class="fa fa-check"></i><b>13.2.2</b> A predictor-corrector algorithm</a></li>
<li class="chapter" data-level="13.2.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#initial-conditions"><i class="fa fa-check"></i><b>13.2.3</b> Initial conditions</a></li>
<li class="chapter" data-level="13.2.4" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#algorithm-tuning"><i class="fa fa-check"></i><b>13.2.4</b> Algorithm tuning</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#the-predictor-corrector-algorithm-in-r"><i class="fa fa-check"></i><b>13.3</b> The predictor-corrector algorithm in <em>R</em></a></li>
<li class="chapter" data-level="13.4" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#some-example-games"><i class="fa fa-check"></i><b>13.4</b> Some example games</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#generalized-matching-pennies-ochs1995"><i class="fa fa-check"></i><b>13.4.1</b> Generalized matching pennies <span class="citation">(Ochs 1995)</span></a></li>
<li class="chapter" data-level="13.4.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#stag-hunt"><i class="fa fa-check"></i><b>13.4.2</b> Stag hunt</a></li>
<li class="chapter" data-level="13.4.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#n-player-volunteers-dilemma-imposing-symmetric-strategies"><i class="fa fa-check"></i><b>13.4.3</b> <span class="math inline">\(n\)</span>-player Volunteer’s Dilemma imposing symmetric strategies</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><i class="fa fa-check"></i><b>14</b> Application: Quantal Response Equilibrium and the Volunteer’s Dilemma <span class="citation">(Goeree, Holt, and Smith 2017)</span></a>
<ul>
<li class="chapter" data-level="14.1" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#solving-logit-qre-and-estimating-the-model"><i class="fa fa-check"></i><b>14.1</b> Solving logit QRE and estimating the model</a></li>
<li class="chapter" data-level="14.2" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#adding-some-heterogeneity-1"><i class="fa fa-check"></i><b>14.2</b> Adding some heterogeneity</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#computing-quantal-response-equilibrium-with-heterogeneous-parameters"><i class="fa fa-check"></i><b>14.2.1</b> Computing quantal response equilibrium with heterogeneous parameters</a></li>
<li class="chapter" data-level="14.2.2" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#warm-glow-volunteering"><i class="fa fa-check"></i><b>14.2.2</b> Warm glow volunteering</a></li>
<li class="chapter" data-level="14.2.3" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#duplicate-aversion"><i class="fa fa-check"></i><b>14.2.3</b> Duplicate aversion</a></li>
<li class="chapter" data-level="14.2.4" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#results-3"><i class="fa fa-check"></i><b>14.2.4</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#r-code-to-run-estimations"><i class="fa fa-check"></i><b>14.3</b> <em>R</em> code to run estimations</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html"><i class="fa fa-check"></i><b>15</b> Application: A Quantal Response Equilibrium with discrete types</a>
<ul>
<li class="chapter" data-level="15.1" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#example-dataset-and-models-1"><i class="fa fa-check"></i><b>15.1</b> Example dataset and models</a></li>
<li class="chapter" data-level="15.2" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#a-note-on-replication"><i class="fa fa-check"></i><b>15.2</b> A note on replication</a></li>
<li class="chapter" data-level="15.3" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#three-models-that-make-different-assumptions-about-bracketing"><i class="fa fa-check"></i><b>15.3</b> Three models that make different assumptions about bracketing</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#broad-bracketing-only"><i class="fa fa-check"></i><b>15.3.1</b> Broad bracketing only</a></li>
<li class="chapter" data-level="15.3.2" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#narrow-bracketing-only"><i class="fa fa-check"></i><b>15.3.2</b> Narrow bracketing only</a></li>
<li class="chapter" data-level="15.3.3" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#a-mixture-of-broad-and-narrow-bracketing"><i class="fa fa-check"></i><b>15.3.3</b> A mixture of broad and narrow bracketing</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#results-4"><i class="fa fa-check"></i><b>15.4</b> Results</a></li>
<li class="chapter" data-level="15.5" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#r-code-used-to-estimate-these-models"><i class="fa fa-check"></i><b>15.5</b> <em>R</em> code used to estimate these models</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="application-level-k-models.html"><a href="application-level-k-models.html"><i class="fa fa-check"></i><b>16</b> Application: Level-<span class="math inline">\(k\)</span> models</a>
<ul>
<li class="chapter" data-level="16.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#data-and-game"><i class="fa fa-check"></i><b>16.1</b> Data and game</a></li>
<li class="chapter" data-level="16.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-level-k-model"><i class="fa fa-check"></i><b>16.2</b> The level-<span class="math inline">\(k\)</span> model</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-deterministic-component-of-the-model"><i class="fa fa-check"></i><b>16.2.1</b> The deterministic component of the model</a></li>
<li class="chapter" data-level="16.2.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#exact-and-probabilistic-play"><i class="fa fa-check"></i><b>16.2.2</b> Exact and probabilistic play</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#assigning-probabilities-to-types-for-each-participant-separately"><i class="fa fa-check"></i><b>16.3</b> Assigning probabilities to types for each participant separately</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-stan-program"><i class="fa fa-check"></i><b>16.3.1</b> The <em>Stan</em> program</a></li>
<li class="chapter" data-level="16.3.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#prior-calibration-2"><i class="fa fa-check"></i><b>16.3.2</b> Prior calibration</a></li>
<li class="chapter" data-level="16.3.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-5"><i class="fa fa-check"></i><b>16.3.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="application-level-k-models.html"><a href="application-level-k-models.html#doing-the-averaging-within-one-program"><i class="fa fa-check"></i><b>16.4</b> Doing the averaging within one program</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-stan-program-1"><i class="fa fa-check"></i><b>16.4.1</b> The <em>Stan</em> program</a></li>
<li class="chapter" data-level="16.4.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-6"><i class="fa fa-check"></i><b>16.4.2</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-mixture-model"><i class="fa fa-check"></i><b>16.5</b> A mixture model</a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#stan-program"><i class="fa fa-check"></i><b>16.5.1</b> <em>Stan</em> program</a></li>
<li class="chapter" data-level="16.5.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-prior-for-psi"><i class="fa fa-check"></i><b>16.5.2</b> A prior for <span class="math inline">\(\psi\)</span></a></li>
<li class="chapter" data-level="16.5.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-7"><i class="fa fa-check"></i><b>16.5.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-mixture-over-levels-and-hierarchical-nuisance-parameters"><i class="fa fa-check"></i><b>16.6</b> A mixture over levels and hierarchical nuisance parameters</a>
<ul>
<li class="chapter" data-level="16.6.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#prior-calibration-3"><i class="fa fa-check"></i><b>16.6.1</b> Prior calibration</a></li>
<li class="chapter" data-level="16.6.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#stan-program-1"><i class="fa fa-check"></i><b>16.6.2</b> <em>Stan</em> program</a></li>
<li class="chapter" data-level="16.6.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-8"><i class="fa fa-check"></i><b>16.6.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="16.7" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-different-assumption-about-mixing"><i class="fa fa-check"></i><b>16.7</b> A different assumption about mixing</a>
<ul>
<li class="chapter" data-level="16.7.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#stan-program-2"><i class="fa fa-check"></i><b>16.7.1</b> <em>Stan</em> program</a></li>
<li class="chapter" data-level="16.7.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-9"><i class="fa fa-check"></i><b>16.7.2</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="16.8" data-path="application-level-k-models.html"><a href="application-level-k-models.html#r-code-to-estimate-the-models"><i class="fa fa-check"></i><b>16.8</b> <em>R</em> code to estimate the models</a>
<ul>
<li class="chapter" data-level="16.8.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#participant-specific-estimation-conditional-on-k-with-bayesian-model-averaging"><i class="fa fa-check"></i><b>16.8.1</b> Participant-specific estimation conditional on <span class="math inline">\(k\)</span> with Bayesian model averaging</a></li>
<li class="chapter" data-level="16.8.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#participant-specific-estimation-with-a-prior-over-k"><i class="fa fa-check"></i><b>16.8.2</b> Participant-specific estimation with a prior over <span class="math inline">\(k\)</span></a></li>
<li class="chapter" data-level="16.8.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#mixture-model"><i class="fa fa-check"></i><b>16.8.3</b> Mixture model</a></li>
<li class="chapter" data-level="16.8.4" data-path="application-level-k-models.html"><a href="application-level-k-models.html#hierarchical-model-1"><i class="fa fa-check"></i><b>16.8.4</b> Hierarchical model</a></li>
<li class="chapter" data-level="16.8.5" data-path="application-level-k-models.html"><a href="application-level-k-models.html#mixture-model-with-beliefs-consistent-with-truncated-type-distribution"><i class="fa fa-check"></i><b>16.8.5</b> Mixture model with beliefs consistent with truncated type distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html"><i class="fa fa-check"></i><b>17</b> Application: Estimating risk preferences</a>
<ul>
<li class="chapter" data-level="17.1" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#example-dataset"><i class="fa fa-check"></i><b>17.1</b> Example dataset</a></li>
<li class="chapter" data-level="17.2" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#we-might-not-just-be-interested-in-the-parameters"><i class="fa fa-check"></i><b>17.2</b> We might not just be interested in the parameters</a></li>
<li class="chapter" data-level="17.3" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#introducing-some-important-models"><i class="fa fa-check"></i><b>17.3</b> Introducing some important models</a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#expected-utility-theory"><i class="fa fa-check"></i><b>17.3.1</b> Expected utility theory</a></li>
<li class="chapter" data-level="17.3.2" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#rank-dependent-utility-quiggin1982"><i class="fa fa-check"></i><b>17.3.2</b> Rank-dependent utility <span class="citation">(Quiggin 1982)</span></a></li>
<li class="chapter" data-level="17.3.3" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#comparing-the-certainty-equivalents-estimated-using-eut-and-rdu"><i class="fa fa-check"></i><b>17.3.3</b> Comparing the certainty equivalents estimated using EUT and RDU</a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#a-hierarchical-specification"><i class="fa fa-check"></i><b>17.4</b> A hierarchical specification</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#population-level-estimates"><i class="fa fa-check"></i><b>17.4.1</b> Population-level estimates</a></li>
<li class="chapter" data-level="17.4.2" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#participant-level-estimates"><i class="fa fa-check"></i><b>17.4.2</b> Participant-level estimates</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#r-code-used-to-estimate-these-models-1"><i class="fa fa-check"></i><b>17.5</b> <em>R</em> code used to estimate these models</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html"><i class="fa fa-check"></i><b>18</b> Application: Meta-analysis using (some of) the METARET data</a>
<ul>
<li class="chapter" data-level="18.1" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#data"><i class="fa fa-check"></i><b>18.1</b> Data</a></li>
<li class="chapter" data-level="18.2" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#a-basic-model"><i class="fa fa-check"></i><b>18.2</b> A basic model</a></li>
<li class="chapter" data-level="18.3" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#but-the-data-are-really-interval-valued"><i class="fa fa-check"></i><b>18.3</b> But the data are really interval-valued!</a></li>
<li class="chapter" data-level="18.4" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#heterogeneous-standard-deviations"><i class="fa fa-check"></i><b>18.4</b> Heterogeneous standard deviations</a></li>
<li class="chapter" data-level="18.5" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#student-t-distributions-because-why-not"><i class="fa fa-check"></i><b>18.5</b> Student-<span class="math inline">\(t\)</span> distributions, because why not?</a></li>
<li class="chapter" data-level="18.6" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#r-code-to-estimate-the-models-1"><i class="fa fa-check"></i><b>18.6</b> <em>R</em> code to estimate the models</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html"><i class="fa fa-check"></i><b>19</b> Application: Ranked choices and the Thurstonian model</a>
<ul>
<li class="chapter" data-level="19.1" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#the-thurstonian-model"><i class="fa fa-check"></i><b>19.1</b> The Thurstonian model</a></li>
<li class="chapter" data-level="19.2" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#computational-issues"><i class="fa fa-check"></i><b>19.2</b> Computational issues</a></li>
<li class="chapter" data-level="19.3" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#example-dataset-and-model-2"><i class="fa fa-check"></i><b>19.3</b> Example dataset and model</a></li>
<li class="chapter" data-level="19.4" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#a-representative-agent-model"><i class="fa fa-check"></i><b>19.4</b> A representative agent model</a></li>
<li class="chapter" data-level="19.5" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#a-hierarchical-model"><i class="fa fa-check"></i><b>19.5</b> A hierarchical model</a></li>
<li class="chapter" data-level="19.6" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#r-code-used-to-run-this"><i class="fa fa-check"></i><b>19.6</b> <em>R</em> code used to run this</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="links-to-data.html"><a href="links-to-data.html"><i class="fa fa-check"></i>Links to data</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Structural Bayesian Techniques for Experimental and Behavioral Economics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="model-evaluation" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">8</span> Model evaluation<a href="model-evaluation.html#model-evaluation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>It is often the case that we want to take more than one model to the data. While it is sometimes feasible to include all of your models in one big estimation (e.g. in a mixture model, or a model that nests all models under consideration), sometimes it is not computationally feasible to do this. In these cases, one approach is to compare your models in some way, and assign them some kind of measure of goodness-of-fit. These could include, but are certainly not limited to, assigning posterior probabilities to each model, and cross-validation, which I will tell you about in this chapter.</p>
<p>An important questions you will need to answer for yourself when deciding between the tools described below (or some secret other thing) is which technique best speaks to your research question? While it might seem that, philosophically, you might want to <em>always</em> use model posterior probabilities, because this is how Bayes’ rule says we should do things, if we are trying to make out-of-sample predictions, then cross-validation might be more appropriate. It really depends on what you want to get out of your analysis.</p>
<div id="example-dataset-and-models" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Example dataset and models<a href="model-evaluation.html#example-dataset-and-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here I will take three models of other-regarding preferences to just the first participant to appear in the <span class="citation">Bruhin, Fehr, and Schunk (<a href="#ref-BFS2019">2019</a>)</span> dataset. As a reminder from previous chapters, this experiment consists of 78 pair-wise choices of allocations between a decision-maker (the “self”) and an inactive participant (the “other”). I will consider three models that could be generating the data.</p>
<p>The first, and most general of the three, is the <span class="citation">Fehr and Schmidt (<a href="#ref-FS1999">1999</a>)</span> model of inequality-aversion. This is the same model as I use in the “representative agent” chapter. For this, I took the <em>Stan</em> file from the representative agent models chapter, and made a few modifications that would allow me to do the model evaluations shown in this chapter.
First, I added a data element in called <code>UseData</code>, which is a vector of ones and zeros the same length as the data (in this case 78 choices). If (say) the 36th element of this vector is equal to one, then the 36th decision in the data is counted toward the likelihood. On the other hand if this element is zero, then the model is estimated ignoring this observation. We will need this functionality to perform cross-validation. Hence, setting <code>UseData</code> to a vector of ones will exactly replicate the estimations in the representative agent models chapter, and setting <code>UseData</code> to a vector of zero will give you draws from the prior (because it will ignore all the data).
Second, I explicitly computed the log-likelihood associated with each decision in a vector called <code>log_lik</code> in the <code>transformed parameters</code> block. Again, this is needed for cross-validation.
Finally, I replaced sampling statements with a tilde (<code>~</code>) with an explicit <code>target += ...</code> statement. That is, whereas in the representative agent models chapter I would have had:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb102-1"><a href="model-evaluation.html#cb102-1" tabindex="-1"></a>lambda <span class="op">~</span> lognormal<span class="op">(</span>prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span></code></pre></div>
<p>I now have:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb103-1"><a href="model-evaluation.html#cb103-1" tabindex="-1"></a>target <span class="op">+=</span> lognormal_lpdf<span class="op">(</span>lambda <span class="op">|</span> prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span></code></pre></div>
<p>The difference between these sampling statements is that the former drops the log-normal density’s constant of proportionality, while the latter does not. We will need this when we use <code>bridgesampling</code> to evaluate model posterior probabilities.</p>
<p>Here is the <em>Stan</em> program that estimates the <span class="citation">Fehr and Schmidt (<a href="#ref-FS1999">1999</a>)</span> model:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb104-1"><a href="model-evaluation.html#cb104-1" tabindex="-1"></a><span class="co">// FS.stan</span></span>
<span id="cb104-2"><a href="model-evaluation.html#cb104-2" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb104-3"><a href="model-evaluation.html#cb104-3" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> n<span class="op">;</span> <span class="co">// number of observations</span></span>
<span id="cb104-4"><a href="model-evaluation.html#cb104-4" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> self_x<span class="op">;</span> <span class="co">// payoff to self with allocation x</span></span>
<span id="cb104-5"><a href="model-evaluation.html#cb104-5" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> other_x<span class="op">;</span> <span class="co">// payoff to other with allocation x</span></span>
<span id="cb104-6"><a href="model-evaluation.html#cb104-6" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> self_y<span class="op">;</span> <span class="co">// payoff to self with allocation y</span></span>
<span id="cb104-7"><a href="model-evaluation.html#cb104-7" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> other_y<span class="op">;</span> <span class="co">// payoff to other with allocation y</span></span>
<span id="cb104-8"><a href="model-evaluation.html#cb104-8" tabindex="-1"></a>  <span class="dt">int</span> choice_x<span class="op">[</span>n<span class="op">];</span> <span class="co">// =1 iff allocation x is chosen</span></span>
<span id="cb104-9"><a href="model-evaluation.html#cb104-9" tabindex="-1"></a>  </span>
<span id="cb104-10"><a href="model-evaluation.html#cb104-10" tabindex="-1"></a>  real prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb104-11"><a href="model-evaluation.html#cb104-11" tabindex="-1"></a>  real prior_alpha<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb104-12"><a href="model-evaluation.html#cb104-12" tabindex="-1"></a>  real prior_beta<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb104-13"><a href="model-evaluation.html#cb104-13" tabindex="-1"></a>  </span>
<span id="cb104-14"><a href="model-evaluation.html#cb104-14" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> UseData<span class="op">;</span></span>
<span id="cb104-15"><a href="model-evaluation.html#cb104-15" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb104-16"><a href="model-evaluation.html#cb104-16" tabindex="-1"></a></span>
<span id="cb104-17"><a href="model-evaluation.html#cb104-17" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb104-18"><a href="model-evaluation.html#cb104-18" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> dX<span class="op">;</span> <span class="co">// disadvantageous inequality at allocation x</span></span>
<span id="cb104-19"><a href="model-evaluation.html#cb104-19" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> dY<span class="op">;</span> <span class="co">// disadvantageous inequality at allocation y</span></span>
<span id="cb104-20"><a href="model-evaluation.html#cb104-20" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> aX<span class="op">;</span> <span class="co">// advantageous inequality at allocation X</span></span>
<span id="cb104-21"><a href="model-evaluation.html#cb104-21" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> aY<span class="op">;</span> <span class="co">// advantageous inequality at allocation X</span></span>
<span id="cb104-22"><a href="model-evaluation.html#cb104-22" tabindex="-1"></a>  </span>
<span id="cb104-23"><a href="model-evaluation.html#cb104-23" tabindex="-1"></a>  dX <span class="op">=</span> fmax<span class="op">(</span><span class="dv">0</span><span class="op">,</span>other_x<span class="op">-</span>self_x<span class="op">);</span></span>
<span id="cb104-24"><a href="model-evaluation.html#cb104-24" tabindex="-1"></a>  dY <span class="op">=</span> fmax<span class="op">(</span><span class="dv">0</span><span class="op">,</span>other_y<span class="op">-</span>self_y<span class="op">);</span></span>
<span id="cb104-25"><a href="model-evaluation.html#cb104-25" tabindex="-1"></a>  aX <span class="op">=</span> fmax<span class="op">(</span><span class="dv">0</span><span class="op">,</span>self_x<span class="op">-</span>other_x<span class="op">);</span></span>
<span id="cb104-26"><a href="model-evaluation.html#cb104-26" tabindex="-1"></a>  aY <span class="op">=</span> fmax<span class="op">(</span><span class="dv">0</span><span class="op">,</span>self_y<span class="op">-</span>other_y<span class="op">);</span></span>
<span id="cb104-27"><a href="model-evaluation.html#cb104-27" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb104-28"><a href="model-evaluation.html#cb104-28" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb104-29"><a href="model-evaluation.html#cb104-29" tabindex="-1"></a>  real alpha<span class="op">;</span></span>
<span id="cb104-30"><a href="model-evaluation.html#cb104-30" tabindex="-1"></a>  real beta<span class="op">;</span></span>
<span id="cb104-31"><a href="model-evaluation.html#cb104-31" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> lambda<span class="op">;</span></span>
<span id="cb104-32"><a href="model-evaluation.html#cb104-32" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb104-33"><a href="model-evaluation.html#cb104-33" tabindex="-1"></a>transformed parameters <span class="op">{</span></span>
<span id="cb104-34"><a href="model-evaluation.html#cb104-34" tabindex="-1"></a>  </span>
<span id="cb104-35"><a href="model-evaluation.html#cb104-35" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> log_lik<span class="op">;</span></span>
<span id="cb104-36"><a href="model-evaluation.html#cb104-36" tabindex="-1"></a>  </span>
<span id="cb104-37"><a href="model-evaluation.html#cb104-37" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb104-38"><a href="model-evaluation.html#cb104-38" tabindex="-1"></a>    real Ux <span class="op">=</span> self_x<span class="op">[</span>ii<span class="op">]-</span>alpha<span class="op">*</span>dX<span class="op">[</span>ii<span class="op">]-</span>beta<span class="op">*</span>aX<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb104-39"><a href="model-evaluation.html#cb104-39" tabindex="-1"></a>    real Uy <span class="op">=</span> self_y<span class="op">[</span>ii<span class="op">]-</span>alpha<span class="op">*</span>dY<span class="op">[</span>ii<span class="op">]-</span>beta<span class="op">*</span>aY<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb104-40"><a href="model-evaluation.html#cb104-40" tabindex="-1"></a>    log_lik<span class="op">[</span>ii<span class="op">]</span> <span class="op">=</span> bernoulli_logit_lpmf<span class="op">(</span>choice_x<span class="op">[</span>ii<span class="op">]</span> <span class="op">|</span> lambda<span class="op">*(</span>Ux<span class="op">-</span>Uy<span class="op">));</span></span>
<span id="cb104-41"><a href="model-evaluation.html#cb104-41" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb104-42"><a href="model-evaluation.html#cb104-42" tabindex="-1"></a>  </span>
<span id="cb104-43"><a href="model-evaluation.html#cb104-43" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb104-44"><a href="model-evaluation.html#cb104-44" tabindex="-1"></a></span>
<span id="cb104-45"><a href="model-evaluation.html#cb104-45" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb104-46"><a href="model-evaluation.html#cb104-46" tabindex="-1"></a>  </span>
<span id="cb104-47"><a href="model-evaluation.html#cb104-47" tabindex="-1"></a></span>
<span id="cb104-48"><a href="model-evaluation.html#cb104-48" tabindex="-1"></a>  <span class="co">// likelihood</span></span>
<span id="cb104-49"><a href="model-evaluation.html#cb104-49" tabindex="-1"></a>  target <span class="op">+=</span> log_lik<span class="op">.*</span>UseData<span class="op">;</span></span>
<span id="cb104-50"><a href="model-evaluation.html#cb104-50" tabindex="-1"></a>  </span>
<span id="cb104-51"><a href="model-evaluation.html#cb104-51" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb104-52"><a href="model-evaluation.html#cb104-52" tabindex="-1"></a>  target <span class="op">+=</span> normal_lpdf<span class="op">(</span>alpha <span class="op">|</span> prior_alpha<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_alpha<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb104-53"><a href="model-evaluation.html#cb104-53" tabindex="-1"></a>  target <span class="op">+=</span> normal_lpdf<span class="op">(</span>beta <span class="op">|</span> prior_beta<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_beta<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb104-54"><a href="model-evaluation.html#cb104-54" tabindex="-1"></a>  target <span class="op">+=</span> lognormal_lpdf<span class="op">(</span>lambda <span class="op">|</span> prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb104-55"><a href="model-evaluation.html#cb104-55" tabindex="-1"></a>  </span>
<span id="cb104-56"><a href="model-evaluation.html#cb104-56" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>For this chapter, I consider two simplifications of the <span class="citation">Fehr and Schmidt (<a href="#ref-FS1999">1999</a>)</span> model. First, a model of pure selfishness that sets the aversion to inequality parameters equal to zero:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb105-1"><a href="model-evaluation.html#cb105-1" tabindex="-1"></a><span class="co">// Selfish.stan</span></span>
<span id="cb105-2"><a href="model-evaluation.html#cb105-2" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb105-3"><a href="model-evaluation.html#cb105-3" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> n<span class="op">;</span> <span class="co">// number of observations</span></span>
<span id="cb105-4"><a href="model-evaluation.html#cb105-4" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> self_x<span class="op">;</span> <span class="co">// payoff to self with allocation x</span></span>
<span id="cb105-5"><a href="model-evaluation.html#cb105-5" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> self_y<span class="op">;</span> <span class="co">// payoff to self with allocation y</span></span>
<span id="cb105-6"><a href="model-evaluation.html#cb105-6" tabindex="-1"></a>  <span class="dt">int</span> choice_x<span class="op">[</span>n<span class="op">];</span> <span class="co">// =1 iff allocation x is chosen</span></span>
<span id="cb105-7"><a href="model-evaluation.html#cb105-7" tabindex="-1"></a>  </span>
<span id="cb105-8"><a href="model-evaluation.html#cb105-8" tabindex="-1"></a>  real prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb105-9"><a href="model-evaluation.html#cb105-9" tabindex="-1"></a>  </span>
<span id="cb105-10"><a href="model-evaluation.html#cb105-10" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> UseData<span class="op">;</span></span>
<span id="cb105-11"><a href="model-evaluation.html#cb105-11" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb105-12"><a href="model-evaluation.html#cb105-12" tabindex="-1"></a></span>
<span id="cb105-13"><a href="model-evaluation.html#cb105-13" tabindex="-1"></a></span>
<span id="cb105-14"><a href="model-evaluation.html#cb105-14" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb105-15"><a href="model-evaluation.html#cb105-15" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> lambda<span class="op">;</span></span>
<span id="cb105-16"><a href="model-evaluation.html#cb105-16" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb105-17"><a href="model-evaluation.html#cb105-17" tabindex="-1"></a>transformed parameters <span class="op">{</span></span>
<span id="cb105-18"><a href="model-evaluation.html#cb105-18" tabindex="-1"></a>  </span>
<span id="cb105-19"><a href="model-evaluation.html#cb105-19" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> log_lik<span class="op">;</span></span>
<span id="cb105-20"><a href="model-evaluation.html#cb105-20" tabindex="-1"></a>  </span>
<span id="cb105-21"><a href="model-evaluation.html#cb105-21" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb105-22"><a href="model-evaluation.html#cb105-22" tabindex="-1"></a>    real Ux <span class="op">=</span> self_x<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb105-23"><a href="model-evaluation.html#cb105-23" tabindex="-1"></a>    real Uy <span class="op">=</span> self_y<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb105-24"><a href="model-evaluation.html#cb105-24" tabindex="-1"></a>    log_lik<span class="op">[</span>ii<span class="op">]</span> <span class="op">=</span> bernoulli_logit_lpmf<span class="op">(</span>choice_x<span class="op">[</span>ii<span class="op">]</span> <span class="op">|</span> lambda<span class="op">*(</span>Ux<span class="op">-</span>Uy<span class="op">));</span></span>
<span id="cb105-25"><a href="model-evaluation.html#cb105-25" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb105-26"><a href="model-evaluation.html#cb105-26" tabindex="-1"></a>  </span>
<span id="cb105-27"><a href="model-evaluation.html#cb105-27" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb105-28"><a href="model-evaluation.html#cb105-28" tabindex="-1"></a></span>
<span id="cb105-29"><a href="model-evaluation.html#cb105-29" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb105-30"><a href="model-evaluation.html#cb105-30" tabindex="-1"></a>  </span>
<span id="cb105-31"><a href="model-evaluation.html#cb105-31" tabindex="-1"></a></span>
<span id="cb105-32"><a href="model-evaluation.html#cb105-32" tabindex="-1"></a>  <span class="co">// likelihood</span></span>
<span id="cb105-33"><a href="model-evaluation.html#cb105-33" tabindex="-1"></a>  target <span class="op">+=</span> log_lik<span class="op">.*</span>UseData<span class="op">;</span></span>
<span id="cb105-34"><a href="model-evaluation.html#cb105-34" tabindex="-1"></a>  </span>
<span id="cb105-35"><a href="model-evaluation.html#cb105-35" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb105-36"><a href="model-evaluation.html#cb105-36" tabindex="-1"></a>  target <span class="op">+=</span> lognormal_lpdf<span class="op">(</span>lambda <span class="op">|</span> prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb105-37"><a href="model-evaluation.html#cb105-37" tabindex="-1"></a>  </span>
<span id="cb105-38"><a href="model-evaluation.html#cb105-38" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And second, as an in-between model, I estimated a one-parameter ustility model that essentially imposes a restriction of <span class="math inline">\(\alpha=-\beta\)</span>. This can capture efficiency-loving or efficiency-averse preferences, but not inequality-averse preferences:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb106-1"><a href="model-evaluation.html#cb106-1" tabindex="-1"></a><span class="co">// Linear.stan</span></span>
<span id="cb106-2"><a href="model-evaluation.html#cb106-2" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb106-3"><a href="model-evaluation.html#cb106-3" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> n<span class="op">;</span> <span class="co">// number of observations</span></span>
<span id="cb106-4"><a href="model-evaluation.html#cb106-4" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> self_x<span class="op">;</span> <span class="co">// payoff to self with allocation x</span></span>
<span id="cb106-5"><a href="model-evaluation.html#cb106-5" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> other_x<span class="op">;</span> <span class="co">// payoff to other with allocation x</span></span>
<span id="cb106-6"><a href="model-evaluation.html#cb106-6" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> self_y<span class="op">;</span> <span class="co">// payoff to self with allocation y</span></span>
<span id="cb106-7"><a href="model-evaluation.html#cb106-7" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> other_y<span class="op">;</span> <span class="co">// payoff to other with allocation y</span></span>
<span id="cb106-8"><a href="model-evaluation.html#cb106-8" tabindex="-1"></a>  <span class="dt">int</span> choice_x<span class="op">[</span>n<span class="op">];</span> <span class="co">// =1 iff allocation x is chosen</span></span>
<span id="cb106-9"><a href="model-evaluation.html#cb106-9" tabindex="-1"></a>  </span>
<span id="cb106-10"><a href="model-evaluation.html#cb106-10" tabindex="-1"></a>  real prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb106-11"><a href="model-evaluation.html#cb106-11" tabindex="-1"></a>  real prior_gamma<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb106-12"><a href="model-evaluation.html#cb106-12" tabindex="-1"></a>  </span>
<span id="cb106-13"><a href="model-evaluation.html#cb106-13" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> UseData<span class="op">;</span></span>
<span id="cb106-14"><a href="model-evaluation.html#cb106-14" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb106-15"><a href="model-evaluation.html#cb106-15" tabindex="-1"></a></span>
<span id="cb106-16"><a href="model-evaluation.html#cb106-16" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb106-17"><a href="model-evaluation.html#cb106-17" tabindex="-1"></a>  real gamma<span class="op">;</span></span>
<span id="cb106-18"><a href="model-evaluation.html#cb106-18" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> lambda<span class="op">;</span></span>
<span id="cb106-19"><a href="model-evaluation.html#cb106-19" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb106-20"><a href="model-evaluation.html#cb106-20" tabindex="-1"></a>transformed parameters <span class="op">{</span></span>
<span id="cb106-21"><a href="model-evaluation.html#cb106-21" tabindex="-1"></a>  </span>
<span id="cb106-22"><a href="model-evaluation.html#cb106-22" tabindex="-1"></a>  vector<span class="op">[</span>n<span class="op">]</span> log_lik<span class="op">;</span></span>
<span id="cb106-23"><a href="model-evaluation.html#cb106-23" tabindex="-1"></a>  </span>
<span id="cb106-24"><a href="model-evaluation.html#cb106-24" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb106-25"><a href="model-evaluation.html#cb106-25" tabindex="-1"></a>    real Ux <span class="op">=</span> self_x<span class="op">[</span>ii<span class="op">]+</span>gamma<span class="op">*</span>other_x<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb106-26"><a href="model-evaluation.html#cb106-26" tabindex="-1"></a>    real Uy <span class="op">=</span> self_y<span class="op">[</span>ii<span class="op">]+</span>gamma<span class="op">*</span>other_y<span class="op">[</span>ii<span class="op">];</span></span>
<span id="cb106-27"><a href="model-evaluation.html#cb106-27" tabindex="-1"></a>    log_lik<span class="op">[</span>ii<span class="op">]</span> <span class="op">=</span> bernoulli_logit_lpmf<span class="op">(</span>choice_x<span class="op">[</span>ii<span class="op">]</span> <span class="op">|</span> lambda<span class="op">*(</span>Ux<span class="op">-</span>Uy<span class="op">));</span></span>
<span id="cb106-28"><a href="model-evaluation.html#cb106-28" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb106-29"><a href="model-evaluation.html#cb106-29" tabindex="-1"></a>  </span>
<span id="cb106-30"><a href="model-evaluation.html#cb106-30" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb106-31"><a href="model-evaluation.html#cb106-31" tabindex="-1"></a></span>
<span id="cb106-32"><a href="model-evaluation.html#cb106-32" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb106-33"><a href="model-evaluation.html#cb106-33" tabindex="-1"></a>  </span>
<span id="cb106-34"><a href="model-evaluation.html#cb106-34" tabindex="-1"></a></span>
<span id="cb106-35"><a href="model-evaluation.html#cb106-35" tabindex="-1"></a>  <span class="co">// likelihood</span></span>
<span id="cb106-36"><a href="model-evaluation.html#cb106-36" tabindex="-1"></a>  target <span class="op">+=</span> log_lik<span class="op">.*</span>UseData<span class="op">;</span></span>
<span id="cb106-37"><a href="model-evaluation.html#cb106-37" tabindex="-1"></a>  </span>
<span id="cb106-38"><a href="model-evaluation.html#cb106-38" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb106-39"><a href="model-evaluation.html#cb106-39" tabindex="-1"></a>  target <span class="op">+=</span> normal_lpdf<span class="op">(</span>gamma <span class="op">|</span> prior_gamma<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_gamma<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb106-40"><a href="model-evaluation.html#cb106-40" tabindex="-1"></a>  target <span class="op">+=</span> lognormal_lpdf<span class="op">(</span>lambda <span class="op">|</span> prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb106-41"><a href="model-evaluation.html#cb106-41" tabindex="-1"></a>  </span>
<span id="cb106-42"><a href="model-evaluation.html#cb106-42" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>For all of these models, I use the priors calibrated in the representative agent models chapter, which are:</p>
<p><span class="math display">\[
\begin{aligned}
\alpha,\beta,\gamma &amp; \sim N(0,0.67^2)\\
\log \lambda &amp;\sim N(-5.76,2.11^2)
\end{aligned}
\]</span></p>
</div>
<div id="model-posterior-probabilities" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Model posterior probabilities<a href="model-evaluation.html#model-posterior-probabilities" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Bayes’ rule actually provides us with a clear way of assigning posterior probabilities to models. To see this, take Bayes’ rule in its general form for any two events <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>:</p>
<p><span class="math display">\[
p(A\mid B)=\frac{p(B\mid A)p(A)}{p(B)}
\]</span></p>
<p>and then substitute <span class="math inline">\(A=M\)</span> (i.e. the model) and <span class="math inline">\(B=y\)</span> (the data):</p>
<p><span class="math display">\[
p(M\mid y)=\frac{p(y\mid M)p(M)}{p(y)}
\]</span></p>
<p>That is, if we have a prior for each model, <span class="math inline">\(p(M)\)</span>, and a likelihood of observing the data conditional on each model, <span class="math inline">\(p(y\mid M)\)</span>, we can calculate the posterior probability of a model. The denominator can be integrated out by noting that:</p>
<p><span class="math display">\[
\begin{aligned}
p(M\mid y)&amp;\propto p(y\mid M)p(M)\\
\implies p(M\mid Y)&amp;=\frac{p(y\mid M)p(M)}{\sum_{m\in\mathcal M}p(y\mid m)p(m)}
\end{aligned}
\]</span></p>
<p>So we can assign a posterior probability to a model <span class="math inline">\(M\)</span> in the set of models under consideration <span class="math inline">\(\mathcal M\)</span> if we can compute <span class="math inline">\(p(y\mid M)\)</span> and have formed a prior <span class="math inline">\(p(M)\)</span> for each model.</p>
<p>While a prior for a model is something that you need to come up with on your own, the likelihood component <span class="math inline">\(p(y\mid M)\)</span> comes straight from the marginal likelihood of each individual model. In principle, if you can estimate each model, then computing the marginal likelihood is feasible. To see this, note that we can notate Bayes’ rule for a specific model as follows:</p>
<p><span class="math display">\[
p(\theta\mid y,M)=\frac{p(y\mid \theta,M)p(\theta\mid M)}{p(y\mid M)}
\]</span></p>
<p>So there is the marginal likelihood we are after right there in the denominator. A bit of re-arranging yields:</p>
<p><span class="math display">\[
p(y\mid M)=\frac{p(y\mid \theta,M)p(\theta\mid M)}{p(\theta\mid y,M)}
\]</span></p>
<p>Therefore in principle at least, if we can draw from the posterior <span class="math inline">\(\theta\mid y,M\)</span>, we can compute the marginal likelihood <span class="math inline">\(p(y\mid M)\)</span>.</p>
<p>Unfortunately, in practice doing this is somewhat difficult. To see this, the most intuitive (for me at least) way of evaluating <span class="math inline">\(p(y\mid M)\)</span> is to integrate out <span class="math inline">\(\theta\)</span> from <span class="math inline">\(p(y\mid \theta,M)\)</span>, that is:</p>
<p><span class="math display">\[
\begin{aligned}
p(y\mid M)&amp;=\int_{\Theta}p(y,\theta\mid ,M)\mathrm d\theta\\
&amp;=\int_\Theta p(y\mid \theta,M)p(\theta)\mathrm d\theta\\
&amp;=E_\theta\left[p(y\mid \theta,M)\right]
\end{aligned}
\]</span></p>
<p>where the last line takes the expectation over prior <span class="math inline">\(\theta\)</span>. Therefore, we could approximate this marginal likelihood through simulation as:</p>
<p><span class="math display">\[
\begin{aligned}
p(y\mid M)&amp;\approx \frac1S\sum_{s=1}^S p(y\mid \theta_s,M)\\
\{\theta_s\}_{s=1}^S&amp;\sim p(\theta)
\end{aligned}
\]</span></p>
<p>where the <span class="math inline">\(\theta_S\)</span>s are draws from the prior. However if the posterior is very different to the prior (and we hope that it would be because we hope to learn from our data), then this simulation will be very inefficient. This is because there will be many draws of <span class="math inline">\(\theta_s\)</span> that return very small likelihoods.</p>
<div id="implementation-using-bridge-sampling-and-the-bridgesampling-library" class="section level3 hasAnchor" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Implementation using bridge sampling and the <code>bridgesampling</code> library<a href="model-evaluation.html#implementation-using-bridge-sampling-and-the-bridgesampling-library" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A more efficient way to evaluate <span class="math inline">\(p(y\mid M)\)</span> is to use <em>bridge sampling</em> <span class="citation">(<a href="#ref-Meng1996">Meng and Wong 1996</a>)</span>. While we fortunately have a package in <em>R</em> that will just do this for us, it may be useful to see how it works. For my own understanding, I found <span class="citation">Gronau et al. (<a href="#ref-Gronau2017">2017</a>)</span> immensely useful in learning how this worked, and what follows closely mimics their explaination.</p>
<p>We start, as is the case with many algebraic problems, by constructing fancy but trivial identity:</p>
<p><span class="math display">\[
\begin{aligned}
1&amp;=\frac{\int_\Theta p(y\mid \theta,M)p(\theta\mid M)g(\theta)h(\theta)\mathrm d\theta}{\int_\Theta p(y\mid \theta,M)p(\theta,M)g(\theta)h(\theta)\mathrm d\theta}
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(g(\theta)\)</span> is a user-specified proposal distribution, and <span class="math inline">\(h(\theta)\)</span> is a user-specified “bridge function”.</p>
<p>Next, we multiply both sides by <span class="math inline">\(p(y\mid M)\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
p(y\mid M)&amp;=p(y\mid M)\frac{\int_\Theta p(y\mid \theta,M)p(\theta\mid M)g(\theta)h(\theta)\mathrm d\theta}{\int_\Theta p(y\mid \theta,M)p(\theta,M)g(\theta)h(\theta)\mathrm d\theta}\\
&amp;=\frac{\int_\Theta p(y\mid \theta,M)p(\theta\mid M)g(\theta)h(\theta)\mathrm d\theta}{\frac{1}{p(y\mid M)}\int_\Theta p(y\mid \theta,M)p(\theta,M)g(\theta)h(\theta)\mathrm d\theta}\\
&amp;=\frac{\int_\Theta p(y\mid \theta,M)p(\theta\mid M)g(\theta)h(\theta)\mathrm d\theta}{\int_\Theta \frac{p(y\mid \theta,M)p(\theta\mid M)}{p(y\mid M)}g(\theta)h(\theta)\mathrm d\theta}\\
&amp;=\frac{\int_\Theta p(y\mid \theta,M)p(\theta\mid M)g(\theta)h(\theta)\mathrm d\theta}{\int_\Theta \frac{p(y,\theta\mid M)}{p(y\mid M)} g(\theta)h(\theta)\mathrm d\theta}\\
&amp;=\frac{\int_\Theta p(y\mid \theta,M)p(\theta\mid M)g(\theta)h(\theta)\mathrm d\theta}{\int_\Theta p(\theta\mid y,M) g(\theta)h(\theta)\mathrm d\theta}
\end{aligned}
\]</span></p>
<p>Note now that both the numerator and denominator can be written as expectations. For the numerator we will view this as an expectation relative to the proposal density <span class="math inline">\(g(\theta)\)</span>, and for the denominator we will view this as an expectation relative to the posterior <span class="math inline">\(p(\theta\mid y,M)\)</span>, so we can write:</p>
<p><span class="math display">\[
\begin{aligned}
p(y\mid M)&amp;=\frac{E_{\theta \sim g(\theta)}\left[p(y\mid \theta,M)p(\theta\mid M)h(\theta)\right]}{E_{\theta\sim p(\theta\mid y,M)}\left[g(\theta)h(\theta)\right]}
\end{aligned}
\]</span></p>
<p>Therefore we can approximate <span class="math inline">\(p(y\mid M)\)</span> as follows:</p>
<p><span class="math display">\[
\begin{aligned}
p(y\mid M)&amp;\approx\frac{\frac{1}{S}\sum_{s=1}^Sp(y\mid \hat\theta_s,M)p(\hat\theta_s\mid M)h(\hat\theta_s)}{\frac1T\sum_{t=1}^Tg(\tilde\theta_t)h(\tilde\theta_t)}\\
\hat\theta_s&amp;\sim g(\theta)\\
\tilde\theta_t&amp;\sim p(\theta\mid y,M)
\end{aligned}
\]</span></p>
<p>That is, the <span class="math inline">\(\hat\theta\)</span>s are draws from the proposal distribution, and the <span class="math inline">\(\tilde\theta\)</span>s are draws from the posterior.</p>
<p>Fortunately for us, the <code>bridgesampling</code> library <span class="citation">(<a href="#ref-Bridgesampling">Gronau, Singmann, and Wagenmakers 2020</a>)</span> does all of this for us. The only thing we need to be careful of in writing our <em>Stan</em> files is that we do not drop constants of proportionality, which I do in the <em>Stan</em> programs shown above.<a href="#fn34" class="footnote-ref" id="fnref34"><sup>34</sup></a> Here is how we can assign posterior probabilities to our three models using the <code>bridgesampling</code> library:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="model-evaluation.html#cb107-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb107-2"><a href="model-evaluation.html#cb107-2" tabindex="-1"></a><span class="fu">library</span>(bridgesampling)</span>
<span id="cb107-3"><a href="model-evaluation.html#cb107-3" tabindex="-1"></a></span>
<span id="cb107-4"><a href="model-evaluation.html#cb107-4" tabindex="-1"></a>d1<span class="ot">&lt;-</span>(<span class="fu">read.csv</span>(<span class="st">&quot;Data/BFS2019_choices_exp1.csv&quot;</span>)</span>
<span id="cb107-5"><a href="model-evaluation.html#cb107-5" tabindex="-1"></a>     <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">experiment=</span><span class="dv">1</span>)</span>
<span id="cb107-6"><a href="model-evaluation.html#cb107-6" tabindex="-1"></a>)</span>
<span id="cb107-7"><a href="model-evaluation.html#cb107-7" tabindex="-1"></a>d2<span class="ot">&lt;-</span>(<span class="fu">read.csv</span>(<span class="st">&quot;Data/BFS2019_choices_exp2.csv&quot;</span>)</span>
<span id="cb107-8"><a href="model-evaluation.html#cb107-8" tabindex="-1"></a>     <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">experiment=</span><span class="dv">2</span>)    </span>
<span id="cb107-9"><a href="model-evaluation.html#cb107-9" tabindex="-1"></a>)</span>
<span id="cb107-10"><a href="model-evaluation.html#cb107-10" tabindex="-1"></a>D<span class="ot">&lt;-</span>(<span class="fu">rbind</span>(d1,d2)</span>
<span id="cb107-11"><a href="model-evaluation.html#cb107-11" tabindex="-1"></a>    <span class="co"># Just use the dictator game data</span></span>
<span id="cb107-12"><a href="model-evaluation.html#cb107-12" tabindex="-1"></a>    <span class="sc">|&gt;</span> <span class="fu">filter</span>(dg<span class="sc">==</span><span class="dv">1</span>)  </span>
<span id="cb107-13"><a href="model-evaluation.html#cb107-13" tabindex="-1"></a>    <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb107-14"><a href="model-evaluation.html#cb107-14" tabindex="-1"></a>      <span class="at">self_alloc =</span> <span class="fu">ifelse</span>(choice_x<span class="sc">==</span><span class="dv">1</span>,self_x,self_y),</span>
<span id="cb107-15"><a href="model-evaluation.html#cb107-15" tabindex="-1"></a>      <span class="at">other_alloc =</span> <span class="fu">ifelse</span>(choice_x<span class="sc">==</span><span class="dv">1</span>,other_x,other_y)</span>
<span id="cb107-16"><a href="model-evaluation.html#cb107-16" tabindex="-1"></a>    )</span>
<span id="cb107-17"><a href="model-evaluation.html#cb107-17" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb107-18"><a href="model-evaluation.html#cb107-18" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb107-19"><a href="model-evaluation.html#cb107-19" tabindex="-1"></a>    sid<span class="sc">==</span><span class="dv">102010050706</span></span>
<span id="cb107-20"><a href="model-evaluation.html#cb107-20" tabindex="-1"></a>  )</span>
<span id="cb107-21"><a href="model-evaluation.html#cb107-21" tabindex="-1"></a></span>
<span id="cb107-22"><a href="model-evaluation.html#cb107-22" tabindex="-1"></a></span>
<span id="cb107-23"><a href="model-evaluation.html#cb107-23" tabindex="-1"></a></span>
<span id="cb107-24"><a href="model-evaluation.html#cb107-24" tabindex="-1"></a>model_FS<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/FS.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb107-25"><a href="model-evaluation.html#cb107-25" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb107-26"><a href="model-evaluation.html#cb107-26" tabindex="-1"></a>model_Linear<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/Linear.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb107-27"><a href="model-evaluation.html#cb107-27" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb107-28"><a href="model-evaluation.html#cb107-28" tabindex="-1"></a>model_Selfish<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/Selfish.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb107-29"><a href="model-evaluation.html#cb107-29" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb107-30"><a href="model-evaluation.html#cb107-30" tabindex="-1"></a></span>
<span id="cb107-31"><a href="model-evaluation.html#cb107-31" tabindex="-1"></a>dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb107-32"><a href="model-evaluation.html#cb107-32" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">dim</span>(D)[<span class="dv">1</span>],</span>
<span id="cb107-33"><a href="model-evaluation.html#cb107-33" tabindex="-1"></a>  <span class="at">self_x =</span> D<span class="sc">$</span>self_x,</span>
<span id="cb107-34"><a href="model-evaluation.html#cb107-34" tabindex="-1"></a>  <span class="at">other_x =</span> D<span class="sc">$</span>other_x,</span>
<span id="cb107-35"><a href="model-evaluation.html#cb107-35" tabindex="-1"></a>  <span class="at">self_y =</span> D<span class="sc">$</span>self_y,</span>
<span id="cb107-36"><a href="model-evaluation.html#cb107-36" tabindex="-1"></a>  <span class="at">other_y =</span> D<span class="sc">$</span>other_y,</span>
<span id="cb107-37"><a href="model-evaluation.html#cb107-37" tabindex="-1"></a>  </span>
<span id="cb107-38"><a href="model-evaluation.html#cb107-38" tabindex="-1"></a>  <span class="at">choice_x =</span> D<span class="sc">$</span>choice_x,</span>
<span id="cb107-39"><a href="model-evaluation.html#cb107-39" tabindex="-1"></a>  </span>
<span id="cb107-40"><a href="model-evaluation.html#cb107-40" tabindex="-1"></a>  <span class="at">prior_alpha =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb107-41"><a href="model-evaluation.html#cb107-41" tabindex="-1"></a>  <span class="at">prior_beta =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb107-42"><a href="model-evaluation.html#cb107-42" tabindex="-1"></a>  <span class="at">prior_gamma =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb107-43"><a href="model-evaluation.html#cb107-43" tabindex="-1"></a>  <span class="at">prior_lambda =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">5.76</span>,<span class="fl">2.11</span>),</span>
<span id="cb107-44"><a href="model-evaluation.html#cb107-44" tabindex="-1"></a>  </span>
<span id="cb107-45"><a href="model-evaluation.html#cb107-45" tabindex="-1"></a>  <span class="at">UseData =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">dim</span>(D)[<span class="dv">1</span>])</span>
<span id="cb107-46"><a href="model-evaluation.html#cb107-46" tabindex="-1"></a>)</span>
<span id="cb107-47"><a href="model-evaluation.html#cb107-47" tabindex="-1"></a></span>
<span id="cb107-48"><a href="model-evaluation.html#cb107-48" tabindex="-1"></a><span class="co"># Estimate the models</span></span>
<span id="cb107-49"><a href="model-evaluation.html#cb107-49" tabindex="-1"></a></span>
<span id="cb107-50"><a href="model-evaluation.html#cb107-50" tabindex="-1"></a>Fit_FS<span class="ot">&lt;-</span>model_FS <span class="sc">|&gt;</span></span>
<span id="cb107-51"><a href="model-evaluation.html#cb107-51" tabindex="-1"></a>  <span class="fu">sampling</span>(<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb107-52"><a href="model-evaluation.html#cb107-52" tabindex="-1"></a></span>
<span id="cb107-53"><a href="model-evaluation.html#cb107-53" tabindex="-1"></a>Fit_Selfish<span class="ot">&lt;-</span>model_Selfish <span class="sc">|&gt;</span></span>
<span id="cb107-54"><a href="model-evaluation.html#cb107-54" tabindex="-1"></a>  <span class="fu">sampling</span>(<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb107-55"><a href="model-evaluation.html#cb107-55" tabindex="-1"></a></span>
<span id="cb107-56"><a href="model-evaluation.html#cb107-56" tabindex="-1"></a>Fit_Linear<span class="ot">&lt;-</span>model_Linear <span class="sc">|&gt;</span></span>
<span id="cb107-57"><a href="model-evaluation.html#cb107-57" tabindex="-1"></a>  <span class="fu">sampling</span>(<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb107-58"><a href="model-evaluation.html#cb107-58" tabindex="-1"></a></span>
<span id="cb107-59"><a href="model-evaluation.html#cb107-59" tabindex="-1"></a><span class="co"># Apply the bridge sampler to the estimated models</span></span>
<span id="cb107-60"><a href="model-evaluation.html#cb107-60" tabindex="-1"></a></span>
<span id="cb107-61"><a href="model-evaluation.html#cb107-61" tabindex="-1"></a>FS<span class="ot">&lt;-</span>Fit_FS <span class="sc">|&gt;</span> </span>
<span id="cb107-62"><a href="model-evaluation.html#cb107-62" tabindex="-1"></a>  <span class="fu">bridge_sampler</span>()</span>
<span id="cb107-63"><a href="model-evaluation.html#cb107-63" tabindex="-1"></a></span>
<span id="cb107-64"><a href="model-evaluation.html#cb107-64" tabindex="-1"></a>Selfish<span class="ot">&lt;-</span>Fit_Selfish <span class="sc">|&gt;</span> </span>
<span id="cb107-65"><a href="model-evaluation.html#cb107-65" tabindex="-1"></a>  <span class="fu">bridge_sampler</span>()</span>
<span id="cb107-66"><a href="model-evaluation.html#cb107-66" tabindex="-1"></a></span>
<span id="cb107-67"><a href="model-evaluation.html#cb107-67" tabindex="-1"></a>Linear<span class="ot">&lt;-</span>Fit_Linear <span class="sc">|&gt;</span> </span>
<span id="cb107-68"><a href="model-evaluation.html#cb107-68" tabindex="-1"></a>  <span class="fu">bridge_sampler</span>()</span>
<span id="cb107-69"><a href="model-evaluation.html#cb107-69" tabindex="-1"></a></span>
<span id="cb107-70"><a href="model-evaluation.html#cb107-70" tabindex="-1"></a><span class="co"># Calculate a posterior probability for each model assuming an equal prior</span></span>
<span id="cb107-71"><a href="model-evaluation.html#cb107-71" tabindex="-1"></a></span>
<span id="cb107-72"><a href="model-evaluation.html#cb107-72" tabindex="-1"></a><span class="fu">post_prob</span>(FS,Selfish,Linear) <span class="sc">|&gt;</span></span>
<span id="cb107-73"><a href="model-evaluation.html#cb107-73" tabindex="-1"></a>  <span class="fu">saveRDS</span>(<span class="st">&quot;Code/Validation/PostProbs.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="model-evaluation.html#cb108-1" tabindex="-1"></a><span class="st">&quot;Code/Validation/PostProbs.rds&quot;</span> <span class="sc">|&gt;</span> </span>
<span id="cb108-2"><a href="model-evaluation.html#cb108-2" tabindex="-1"></a>  <span class="fu">readRDS</span>() <span class="sc">|&gt;</span></span>
<span id="cb108-3"><a href="model-evaluation.html#cb108-3" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">4</span>,<span class="at">caption =</span> <span class="st">&quot;Posterior probabilities of the three models assuming equal prior probabilities.&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb108-4"><a href="model-evaluation.html#cb108-4" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<table class=" lightable-classic" style="color: black; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:ValidationPostProbsTable">Table 8.1: </span>Posterior probabilities of the three models assuming equal prior probabilities.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
x
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
FS
</td>
<td style="text-align:right;">
0.0742
</td>
</tr>
<tr>
<td style="text-align:left;">
Selfish
</td>
<td style="text-align:right;">
0.7706
</td>
</tr>
<tr>
<td style="text-align:left;">
Linear
</td>
<td style="text-align:right;">
0.1552
</td>
</tr>
</tbody>
</table>
<p>Table <a href="model-evaluation.html#tab:ValidationPostProbsTable">8.1</a> shows the three models’ posterior probabilities assuming equal prior probabilities. Here we can see that most of the probability mass is assigned to the selfish model. That is, if we wanted to pick one model out of these three, we would choose the selfish model. Another, more Bayesian interpretation of the results in this Table is as follows: suppose that these three models are the only three models that could be generating the data, then after observing the data our belief that the selfish model is the true model is 77% (assuming equal prior probabilities).</p>
<!--
### Critiques and problems of this approach

* @Morey2016

-->
</div>
</div>
<div id="cross-validation" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Cross-validation<a href="model-evaluation.html#cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Cross-validation techniques, while not strictly Bayesian,<a href="#fn35" class="footnote-ref" id="fnref35"><sup>35</sup></a> are useful when you are interested in making out-of-sample predictions. Cross-validation mimics an out-of-sample prediction by splitting the dataset into a “training” dataset and a “testing” dataset. The training dataset is used to estimate the model, and then the testing dataset is used to evaluate the model. That is, we estimate the model ignoring the testing data, and then see how well the estimated model performs in predicting it.</p>
<div id="expected-log-predicted-density-elpd-and-other-measures-of-goodness-of-fit" class="section level3 hasAnchor" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Expected Log Predicted Density (ELPD) and other measures of goodness of fit<a href="model-evaluation.html#expected-log-predicted-density-elpd-and-other-measures-of-goodness-of-fit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An important component to cross-validation is the choice of goodness-of-fit: we need to have a measure of how well, or how badly, our models fit the data. If we were in the realm of linear regression, a good starting point could be out-of-sample residual sum of squares:</p>
<p><span class="math display">\[
RSS_M=\sum_{i,t\in\mathrm{testing}}(y_{i,t}-X_{i,t}\hat\beta_M)^2
\]</span></p>
<p>That is, we would aim to select the model <span class="math inline">\(M\in\mathcal M\)</span> that minimized <span class="math inline">\(RSS_M\)</span>.</p>
<p>Things become a little more complicated when we are dealing with choice data <span class="math inline">\(y_{i,t}\)</span> that are not real numbers. For instance, many of the examples I use in this book, and many experiments in general, have <em>binary</em> choices. It is not clear whether minimizing the sum of squared residuals for binary data is what we want to be doing. Furthermore, even if we had continuous data, <span class="math inline">\(RSS_M\)</span> only evaluates the model’s <em>point predictions</em> (i.e. <span class="math inline">\(\hat y_{i,t,M}=X_{i,t}\hat\beta_M\)</span>), and completely ignores that our model makes <em>probabilistic</em> predictions. From the linear regression model’s perspective we are ignoring that, when coupled with (say) a distributional assumption of normal errors, the model also says something about the spread of data.</p>
<p>In the absence of a specific predictive goal,<a href="#fn36" class="footnote-ref" id="fnref36"><sup>36</sup></a> a good all-encompassing measure of goodness-of-fit is Expected Log Predicted Density (ELPD), which is defined as:</p>
<p><span class="math display">\[
\mathrm{ELPD}_M=E_{\theta\mid y,M}\left[\log p(y^*\mid \theta,M)\right]
\]</span></p>
<p>where <span class="math inline">\(\theta\mid y,M\)</span> is the posterior distribution of parameters <span class="math inline">\(\theta\)</span> from model <span class="math inline">\(M\)</span>, and <span class="math inline">\(p(y^*\mid \theta,M)\)</span> is the probability (mass or density) of observing (out-of-sample) observation <span class="math inline">\(y^*\)</span> given model <span class="math inline">\(M\)</span> and parameters <span class="math inline">\(\theta\)</span>. My (somewhat) lay-person’s translation of <span class="math inline">\(\mathrm{ELPD}_M\)</span> is: “If we estimate and use model <span class="math inline">\(M\)</span>, how un-surprised will we be by new data?” That is, if <span class="math inline">\(\mathrm{ELPD}_M\)</span> is large, then our model on average assigns a lot of probability (mass or density) to the new data that we will get, and so we are often not surprised by our new data.</p>
<p>Since <span class="math inline">\(y^*\)</span> is unknown at the time of estimation, in practice we approximate it using cross-validation. We use the testing dataset to compute it:</p>
<p><span class="math display">\[
\begin{aligned}
\mathrm{ELPD}_M&amp;\approx \frac{1}{n_\mathrm{testing}}\sum_{i,t\in\mathrm{testing}}E_{\theta\mid M}\left[\log p(y_{i,t}\mid \theta,M)\right]\\
&amp;\approx \frac{1}{n_\mathrm{testing}}\sum_{i,t\in\mathrm{testing}}\left[\frac{1}{S}\sum_{s=1}^S\log p(y_{i,t}\mid \theta_s,M)\right]\\
\theta_s&amp;\sim p(\theta\mid y_\mathrm{training},M)
\end{aligned}
\]</span></p>
<p>That is, we are evaluating the out-of-sample (i.e. testing) log-likelihood of our model with respect to the posterior (conditional on the training data only). Hence you will see in the in the <em>Stan</em> programs above, that I have explicitly created a <code>log_lik</code> vector in the <code>transformed parameters</code> block. This will make it easy to extract the relevent elements of this when we do cross-validation.</p>
<p>I will proceed with the remainder of this chapter using ELPD as the measure of goodness-of-fit, but realize that what follows applies equally to any other valid measure.</p>
</div>
<div id="round-cross-validation" class="section level3 hasAnchor" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> 1-round cross-validation<a href="model-evaluation.html#round-cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The simplest and fastest form of cross-validation in 1-round cross-validation. Here, we do the cross-validation process exactly once. We partition the sample into a “training” dataset, where we estimate the model, and a “testing” dataset, which we use to evaluate the model. We do this exactly once. The other cross-validation techniques mentioned later on in this chapter will involve repeating this many times.</p>
<p>Here is my code to evaluate ELPD for the three models using 1-round cross-validation. Note that I achieve this by setting ten random elements of the <code>UseData</code> vector to zero. This means that these observations are not used in incrementing the target (see the <code>target += log_like .* UseData;</code> line in the <em>Stan</em> programs), and so don’t contribute to the estimation process. I then extract the log-likelihoods corresponding to these testing data to compute ELPD.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="model-evaluation.html#cb109-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb109-2"><a href="model-evaluation.html#cb109-2" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb109-3"><a href="model-evaluation.html#cb109-3" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb109-4"><a href="model-evaluation.html#cb109-4" tabindex="-1"></a><span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb109-5"><a href="model-evaluation.html#cb109-5" tabindex="-1"></a></span>
<span id="cb109-6"><a href="model-evaluation.html#cb109-6" tabindex="-1"></a></span>
<span id="cb109-7"><a href="model-evaluation.html#cb109-7" tabindex="-1"></a>d1<span class="ot">&lt;-</span>(<span class="fu">read.csv</span>(<span class="st">&quot;Data/BFS2019_choices_exp1.csv&quot;</span>)</span>
<span id="cb109-8"><a href="model-evaluation.html#cb109-8" tabindex="-1"></a>     <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">experiment=</span><span class="dv">1</span>)</span>
<span id="cb109-9"><a href="model-evaluation.html#cb109-9" tabindex="-1"></a>)</span>
<span id="cb109-10"><a href="model-evaluation.html#cb109-10" tabindex="-1"></a>d2<span class="ot">&lt;-</span>(<span class="fu">read.csv</span>(<span class="st">&quot;Data/BFS2019_choices_exp2.csv&quot;</span>)</span>
<span id="cb109-11"><a href="model-evaluation.html#cb109-11" tabindex="-1"></a>     <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">experiment=</span><span class="dv">2</span>)    </span>
<span id="cb109-12"><a href="model-evaluation.html#cb109-12" tabindex="-1"></a>)</span>
<span id="cb109-13"><a href="model-evaluation.html#cb109-13" tabindex="-1"></a>D<span class="ot">&lt;-</span>(<span class="fu">rbind</span>(d1,d2)</span>
<span id="cb109-14"><a href="model-evaluation.html#cb109-14" tabindex="-1"></a>    <span class="co"># Just use the dictator game data</span></span>
<span id="cb109-15"><a href="model-evaluation.html#cb109-15" tabindex="-1"></a>    <span class="sc">|&gt;</span> <span class="fu">filter</span>(dg<span class="sc">==</span><span class="dv">1</span>)  </span>
<span id="cb109-16"><a href="model-evaluation.html#cb109-16" tabindex="-1"></a>    <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb109-17"><a href="model-evaluation.html#cb109-17" tabindex="-1"></a>      <span class="at">self_alloc =</span> <span class="fu">ifelse</span>(choice_x<span class="sc">==</span><span class="dv">1</span>,self_x,self_y),</span>
<span id="cb109-18"><a href="model-evaluation.html#cb109-18" tabindex="-1"></a>      <span class="at">other_alloc =</span> <span class="fu">ifelse</span>(choice_x<span class="sc">==</span><span class="dv">1</span>,other_x,other_y)</span>
<span id="cb109-19"><a href="model-evaluation.html#cb109-19" tabindex="-1"></a>    )</span>
<span id="cb109-20"><a href="model-evaluation.html#cb109-20" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb109-21"><a href="model-evaluation.html#cb109-21" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb109-22"><a href="model-evaluation.html#cb109-22" tabindex="-1"></a>    sid<span class="sc">==</span><span class="dv">102010050706</span></span>
<span id="cb109-23"><a href="model-evaluation.html#cb109-23" tabindex="-1"></a>  )</span>
<span id="cb109-24"><a href="model-evaluation.html#cb109-24" tabindex="-1"></a></span>
<span id="cb109-25"><a href="model-evaluation.html#cb109-25" tabindex="-1"></a>model_FS<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/FS.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb109-26"><a href="model-evaluation.html#cb109-26" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb109-27"><a href="model-evaluation.html#cb109-27" tabindex="-1"></a>model_Linear<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/Linear.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb109-28"><a href="model-evaluation.html#cb109-28" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb109-29"><a href="model-evaluation.html#cb109-29" tabindex="-1"></a>model_Selfish<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/Selfish.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb109-30"><a href="model-evaluation.html#cb109-30" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb109-31"><a href="model-evaluation.html#cb109-31" tabindex="-1"></a></span>
<span id="cb109-32"><a href="model-evaluation.html#cb109-32" tabindex="-1"></a>dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb109-33"><a href="model-evaluation.html#cb109-33" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">dim</span>(D)[<span class="dv">1</span>],</span>
<span id="cb109-34"><a href="model-evaluation.html#cb109-34" tabindex="-1"></a>  <span class="at">self_x =</span> D<span class="sc">$</span>self_x,</span>
<span id="cb109-35"><a href="model-evaluation.html#cb109-35" tabindex="-1"></a>  <span class="at">other_x =</span> D<span class="sc">$</span>other_x,</span>
<span id="cb109-36"><a href="model-evaluation.html#cb109-36" tabindex="-1"></a>  <span class="at">self_y =</span> D<span class="sc">$</span>self_y,</span>
<span id="cb109-37"><a href="model-evaluation.html#cb109-37" tabindex="-1"></a>  <span class="at">other_y =</span> D<span class="sc">$</span>other_y,</span>
<span id="cb109-38"><a href="model-evaluation.html#cb109-38" tabindex="-1"></a>  </span>
<span id="cb109-39"><a href="model-evaluation.html#cb109-39" tabindex="-1"></a>  <span class="at">choice_x =</span> D<span class="sc">$</span>choice_x,</span>
<span id="cb109-40"><a href="model-evaluation.html#cb109-40" tabindex="-1"></a>  </span>
<span id="cb109-41"><a href="model-evaluation.html#cb109-41" tabindex="-1"></a>  <span class="at">prior_alpha =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb109-42"><a href="model-evaluation.html#cb109-42" tabindex="-1"></a>  <span class="at">prior_beta =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb109-43"><a href="model-evaluation.html#cb109-43" tabindex="-1"></a>  <span class="at">prior_gamma =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb109-44"><a href="model-evaluation.html#cb109-44" tabindex="-1"></a>  <span class="at">prior_lambda =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">5.76</span>,<span class="fl">2.11</span>),</span>
<span id="cb109-45"><a href="model-evaluation.html#cb109-45" tabindex="-1"></a>  </span>
<span id="cb109-46"><a href="model-evaluation.html#cb109-46" tabindex="-1"></a>  <span class="at">UseData =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">dim</span>(D)[<span class="dv">1</span>])</span>
<span id="cb109-47"><a href="model-evaluation.html#cb109-47" tabindex="-1"></a>)</span>
<span id="cb109-48"><a href="model-evaluation.html#cb109-48" tabindex="-1"></a></span>
<span id="cb109-49"><a href="model-evaluation.html#cb109-49" tabindex="-1"></a><span class="co"># split the data into training and testing subsamples</span></span>
<span id="cb109-50"><a href="model-evaluation.html#cb109-50" tabindex="-1"></a><span class="co"># Here we will randomly select 10 observations to hold out for the testing data</span></span>
<span id="cb109-51"><a href="model-evaluation.html#cb109-51" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb109-52"><a href="model-evaluation.html#cb109-52" tabindex="-1"></a>training<span class="ot">&lt;-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">78</span>)[<span class="fu">order</span>(<span class="fu">runif</span>(<span class="dv">78</span>))][<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb109-53"><a href="model-evaluation.html#cb109-53" tabindex="-1"></a>dStan<span class="sc">$</span>UseData[training]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb109-54"><a href="model-evaluation.html#cb109-54" tabindex="-1"></a></span>
<span id="cb109-55"><a href="model-evaluation.html#cb109-55" tabindex="-1"></a></span>
<span id="cb109-56"><a href="model-evaluation.html#cb109-56" tabindex="-1"></a><span class="co"># Estimate the models</span></span>
<span id="cb109-57"><a href="model-evaluation.html#cb109-57" tabindex="-1"></a></span>
<span id="cb109-58"><a href="model-evaluation.html#cb109-58" tabindex="-1"></a>Fit_FS<span class="ot">&lt;-</span>model_FS <span class="sc">|&gt;</span></span>
<span id="cb109-59"><a href="model-evaluation.html#cb109-59" tabindex="-1"></a>  <span class="fu">sampling</span>(<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb109-60"><a href="model-evaluation.html#cb109-60" tabindex="-1"></a></span>
<span id="cb109-61"><a href="model-evaluation.html#cb109-61" tabindex="-1"></a>Fit_Selfish<span class="ot">&lt;-</span>model_Selfish <span class="sc">|&gt;</span></span>
<span id="cb109-62"><a href="model-evaluation.html#cb109-62" tabindex="-1"></a>  <span class="fu">sampling</span>(<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb109-63"><a href="model-evaluation.html#cb109-63" tabindex="-1"></a></span>
<span id="cb109-64"><a href="model-evaluation.html#cb109-64" tabindex="-1"></a>Fit_Linear<span class="ot">&lt;-</span>model_Linear <span class="sc">|&gt;</span></span>
<span id="cb109-65"><a href="model-evaluation.html#cb109-65" tabindex="-1"></a>  <span class="fu">sampling</span>(<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb109-66"><a href="model-evaluation.html#cb109-66" tabindex="-1"></a></span>
<span id="cb109-67"><a href="model-evaluation.html#cb109-67" tabindex="-1"></a><span class="co"># extract the relevant parts of the log-likelihood matrix for the training data</span></span>
<span id="cb109-68"><a href="model-evaluation.html#cb109-68" tabindex="-1"></a></span>
<span id="cb109-69"><a href="model-evaluation.html#cb109-69" tabindex="-1"></a>ELPD_FS<span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">extract</span>(Fit_FS)<span class="sc">$</span>log_lik[,training]<span class="sc">%*%</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">10</span>))</span>
<span id="cb109-70"><a href="model-evaluation.html#cb109-70" tabindex="-1"></a>ELPD_Selfish<span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">extract</span>(Fit_Selfish)<span class="sc">$</span>log_lik[,training]<span class="sc">%*%</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">10</span>))</span>
<span id="cb109-71"><a href="model-evaluation.html#cb109-71" tabindex="-1"></a>ELPD_Linear<span class="ot">&lt;-</span><span class="fu">mean</span>(<span class="fu">extract</span>(Fit_Linear)<span class="sc">$</span>log_lik[,training]<span class="sc">%*%</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">10</span>))</span>
<span id="cb109-72"><a href="model-evaluation.html#cb109-72" tabindex="-1"></a></span>
<span id="cb109-73"><a href="model-evaluation.html#cb109-73" tabindex="-1"></a>d<span class="ot">&lt;-</span><span class="fu">tibble</span>(</span>
<span id="cb109-74"><a href="model-evaluation.html#cb109-74" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">c</span>(<span class="st">&quot;FS&quot;</span>,<span class="st">&quot;Selfish&quot;</span>,<span class="st">&quot;Linear&quot;</span>),</span>
<span id="cb109-75"><a href="model-evaluation.html#cb109-75" tabindex="-1"></a>  <span class="at">ELPD  =</span> <span class="fu">c</span>(ELPD_FS,ELPD_Selfish,ELPD_Linear)</span>
<span id="cb109-76"><a href="model-evaluation.html#cb109-76" tabindex="-1"></a>)</span>
<span id="cb109-77"><a href="model-evaluation.html#cb109-77" tabindex="-1"></a></span>
<span id="cb109-78"><a href="model-evaluation.html#cb109-78" tabindex="-1"></a>d <span class="sc">|&gt;</span></span>
<span id="cb109-79"><a href="model-evaluation.html#cb109-79" tabindex="-1"></a>  <span class="fu">write.csv</span>(<span class="st">&quot;Code/Validation/OneRound.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="model-evaluation.html#cb110-1" tabindex="-1"></a><span class="st">&quot;Code/Validation/OneRound.csv&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb110-2"><a href="model-evaluation.html#cb110-2" tabindex="-1"></a>  <span class="fu">read.csv</span>() <span class="sc">|&gt;</span></span>
<span id="cb110-3"><a href="model-evaluation.html#cb110-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">|&gt;</span></span>
<span id="cb110-4"><a href="model-evaluation.html#cb110-4" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">digits=</span><span class="dv">2</span>,<span class="at">caption =</span> <span class="st">&quot;ELPD evaluated using 1-round cross validation.&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb110-5"><a href="model-evaluation.html#cb110-5" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<table class=" lightable-classic" style="color: black; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:ValidationOneRoundTable">Table 8.2: </span>ELPD evaluated using 1-round cross validation.
</caption>
<thead>
<tr>
<th style="text-align:left;">
model
</th>
<th style="text-align:right;">
ELPD
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
FS
</td>
<td style="text-align:right;">
-6.30
</td>
</tr>
<tr>
<td style="text-align:left;">
Selfish
</td>
<td style="text-align:right;">
-6.32
</td>
</tr>
<tr>
<td style="text-align:left;">
Linear
</td>
<td style="text-align:right;">
-6.25
</td>
</tr>
</tbody>
</table>
<p>Table <a href="model-evaluation.html#tab:ValidationOneRoundTable">8.2</a> shows the ELPD evaluated using 1-round cross-validation. More positive numbers indicate better out-of-sample predictions. Here we can see that we (marginally) select the FS model over the others.</p>
</div>
<div id="leave-one-out-cross-validation-loo" class="section level3 hasAnchor" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Leave-one-out cross-validation (LOO)<a href="model-evaluation.html#leave-one-out-cross-validation-loo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Leave-one-out (LOO) cross-validation is <em>much</em> more computationally intensive than 1-round, but is preferable because it better mimics the estimation process and does not depend on the definition of the testing and training datasets. Here, we estimate the model <span class="math inline">\(n\)</span> times, once for each observation in the dataset. Each time, we put just one observation into the testing dataset and evaluate its goodness-of-fit. We then take the average goodness-of-fit over these <span class="math inline">\(n\)</span> estimation runs. In the code below, you can see I loop over the observations in the data (<code>for (ii in 1:dim(D)[1]) { ...</code>). Each time through the loop, element <code>ii</code> of <code>UseData</code> is set to zero. We then extract the log-likelihood for this left-out observation and store it in a matrix (e.g. <code>extract(Fit_FS)$log_lik[,ii]</code>) I then use the <code>loo</code> library to summarize the results.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="model-evaluation.html#cb111-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb111-2"><a href="model-evaluation.html#cb111-2" tabindex="-1"></a><span class="fu">library</span>(loo)</span>
<span id="cb111-3"><a href="model-evaluation.html#cb111-3" tabindex="-1"></a></span>
<span id="cb111-4"><a href="model-evaluation.html#cb111-4" tabindex="-1"></a>d1<span class="ot">&lt;-</span>(<span class="fu">read.csv</span>(<span class="st">&quot;Data/BFS2019_choices_exp1.csv&quot;</span>)</span>
<span id="cb111-5"><a href="model-evaluation.html#cb111-5" tabindex="-1"></a>     <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">experiment=</span><span class="dv">1</span>)</span>
<span id="cb111-6"><a href="model-evaluation.html#cb111-6" tabindex="-1"></a>)</span>
<span id="cb111-7"><a href="model-evaluation.html#cb111-7" tabindex="-1"></a>d2<span class="ot">&lt;-</span>(<span class="fu">read.csv</span>(<span class="st">&quot;Data/BFS2019_choices_exp2.csv&quot;</span>)</span>
<span id="cb111-8"><a href="model-evaluation.html#cb111-8" tabindex="-1"></a>     <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">experiment=</span><span class="dv">2</span>)    </span>
<span id="cb111-9"><a href="model-evaluation.html#cb111-9" tabindex="-1"></a>)</span>
<span id="cb111-10"><a href="model-evaluation.html#cb111-10" tabindex="-1"></a>D<span class="ot">&lt;-</span>(<span class="fu">rbind</span>(d1,d2)</span>
<span id="cb111-11"><a href="model-evaluation.html#cb111-11" tabindex="-1"></a>    <span class="co"># Just use the dictator game data</span></span>
<span id="cb111-12"><a href="model-evaluation.html#cb111-12" tabindex="-1"></a>    <span class="sc">|&gt;</span> <span class="fu">filter</span>(dg<span class="sc">==</span><span class="dv">1</span>)  </span>
<span id="cb111-13"><a href="model-evaluation.html#cb111-13" tabindex="-1"></a>    <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb111-14"><a href="model-evaluation.html#cb111-14" tabindex="-1"></a>      <span class="at">self_alloc =</span> <span class="fu">ifelse</span>(choice_x<span class="sc">==</span><span class="dv">1</span>,self_x,self_y),</span>
<span id="cb111-15"><a href="model-evaluation.html#cb111-15" tabindex="-1"></a>      <span class="at">other_alloc =</span> <span class="fu">ifelse</span>(choice_x<span class="sc">==</span><span class="dv">1</span>,other_x,other_y)</span>
<span id="cb111-16"><a href="model-evaluation.html#cb111-16" tabindex="-1"></a>    )</span>
<span id="cb111-17"><a href="model-evaluation.html#cb111-17" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb111-18"><a href="model-evaluation.html#cb111-18" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb111-19"><a href="model-evaluation.html#cb111-19" tabindex="-1"></a>    sid<span class="sc">==</span><span class="dv">102010050706</span></span>
<span id="cb111-20"><a href="model-evaluation.html#cb111-20" tabindex="-1"></a>  )</span>
<span id="cb111-21"><a href="model-evaluation.html#cb111-21" tabindex="-1"></a></span>
<span id="cb111-22"><a href="model-evaluation.html#cb111-22" tabindex="-1"></a></span>
<span id="cb111-23"><a href="model-evaluation.html#cb111-23" tabindex="-1"></a></span>
<span id="cb111-24"><a href="model-evaluation.html#cb111-24" tabindex="-1"></a>model_FS<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/FS.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb111-25"><a href="model-evaluation.html#cb111-25" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb111-26"><a href="model-evaluation.html#cb111-26" tabindex="-1"></a>model_Linear<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/Linear.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb111-27"><a href="model-evaluation.html#cb111-27" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb111-28"><a href="model-evaluation.html#cb111-28" tabindex="-1"></a>model_Selfish<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/Selfish.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb111-29"><a href="model-evaluation.html#cb111-29" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb111-30"><a href="model-evaluation.html#cb111-30" tabindex="-1"></a></span>
<span id="cb111-31"><a href="model-evaluation.html#cb111-31" tabindex="-1"></a>dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb111-32"><a href="model-evaluation.html#cb111-32" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">dim</span>(D)[<span class="dv">1</span>],</span>
<span id="cb111-33"><a href="model-evaluation.html#cb111-33" tabindex="-1"></a>  <span class="at">self_x =</span> D<span class="sc">$</span>self_x,</span>
<span id="cb111-34"><a href="model-evaluation.html#cb111-34" tabindex="-1"></a>  <span class="at">other_x =</span> D<span class="sc">$</span>other_x,</span>
<span id="cb111-35"><a href="model-evaluation.html#cb111-35" tabindex="-1"></a>  <span class="at">self_y =</span> D<span class="sc">$</span>self_y,</span>
<span id="cb111-36"><a href="model-evaluation.html#cb111-36" tabindex="-1"></a>  <span class="at">other_y =</span> D<span class="sc">$</span>other_y,</span>
<span id="cb111-37"><a href="model-evaluation.html#cb111-37" tabindex="-1"></a>  </span>
<span id="cb111-38"><a href="model-evaluation.html#cb111-38" tabindex="-1"></a>  <span class="at">choice_x =</span> D<span class="sc">$</span>choice_x,</span>
<span id="cb111-39"><a href="model-evaluation.html#cb111-39" tabindex="-1"></a>  </span>
<span id="cb111-40"><a href="model-evaluation.html#cb111-40" tabindex="-1"></a>  <span class="at">prior_alpha =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb111-41"><a href="model-evaluation.html#cb111-41" tabindex="-1"></a>  <span class="at">prior_beta =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb111-42"><a href="model-evaluation.html#cb111-42" tabindex="-1"></a>  <span class="at">prior_gamma =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb111-43"><a href="model-evaluation.html#cb111-43" tabindex="-1"></a>  <span class="at">prior_lambda =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">5.76</span>,<span class="fl">2.11</span>),</span>
<span id="cb111-44"><a href="model-evaluation.html#cb111-44" tabindex="-1"></a>  </span>
<span id="cb111-45"><a href="model-evaluation.html#cb111-45" tabindex="-1"></a>  <span class="at">UseData =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">dim</span>(D)[<span class="dv">1</span>])</span>
<span id="cb111-46"><a href="model-evaluation.html#cb111-46" tabindex="-1"></a>)</span>
<span id="cb111-47"><a href="model-evaluation.html#cb111-47" tabindex="-1"></a></span>
<span id="cb111-48"><a href="model-evaluation.html#cb111-48" tabindex="-1"></a>ll_FS<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb111-49"><a href="model-evaluation.html#cb111-49" tabindex="-1"></a>ll_Selfish<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb111-50"><a href="model-evaluation.html#cb111-50" tabindex="-1"></a>ll_Linear<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb111-51"><a href="model-evaluation.html#cb111-51" tabindex="-1"></a></span>
<span id="cb111-52"><a href="model-evaluation.html#cb111-52" tabindex="-1"></a><span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(D)[<span class="dv">1</span>]) {</span>
<span id="cb111-53"><a href="model-evaluation.html#cb111-53" tabindex="-1"></a>  </span>
<span id="cb111-54"><a href="model-evaluation.html#cb111-54" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(ii,<span class="st">&quot;of&quot;</span>,<span class="fu">dim</span>(D)[<span class="dv">1</span>]))</span>
<span id="cb111-55"><a href="model-evaluation.html#cb111-55" tabindex="-1"></a>  </span>
<span id="cb111-56"><a href="model-evaluation.html#cb111-56" tabindex="-1"></a>  dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb111-57"><a href="model-evaluation.html#cb111-57" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">dim</span>(D)[<span class="dv">1</span>],</span>
<span id="cb111-58"><a href="model-evaluation.html#cb111-58" tabindex="-1"></a>    <span class="at">self_x =</span> D<span class="sc">$</span>self_x,</span>
<span id="cb111-59"><a href="model-evaluation.html#cb111-59" tabindex="-1"></a>    <span class="at">other_x =</span> D<span class="sc">$</span>other_x,</span>
<span id="cb111-60"><a href="model-evaluation.html#cb111-60" tabindex="-1"></a>    <span class="at">self_y =</span> D<span class="sc">$</span>self_y,</span>
<span id="cb111-61"><a href="model-evaluation.html#cb111-61" tabindex="-1"></a>    <span class="at">other_y =</span> D<span class="sc">$</span>other_y,</span>
<span id="cb111-62"><a href="model-evaluation.html#cb111-62" tabindex="-1"></a>    </span>
<span id="cb111-63"><a href="model-evaluation.html#cb111-63" tabindex="-1"></a>    <span class="at">choice_x =</span> D<span class="sc">$</span>choice_x,</span>
<span id="cb111-64"><a href="model-evaluation.html#cb111-64" tabindex="-1"></a>    </span>
<span id="cb111-65"><a href="model-evaluation.html#cb111-65" tabindex="-1"></a>    <span class="at">prior_alpha =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb111-66"><a href="model-evaluation.html#cb111-66" tabindex="-1"></a>    <span class="at">prior_beta =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb111-67"><a href="model-evaluation.html#cb111-67" tabindex="-1"></a>    <span class="at">prior_gamma =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb111-68"><a href="model-evaluation.html#cb111-68" tabindex="-1"></a>    <span class="at">prior_lambda =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">5.76</span>,<span class="fl">2.11</span>),</span>
<span id="cb111-69"><a href="model-evaluation.html#cb111-69" tabindex="-1"></a>    </span>
<span id="cb111-70"><a href="model-evaluation.html#cb111-70" tabindex="-1"></a>    <span class="at">UseData =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">dim</span>(D)[<span class="dv">1</span>])</span>
<span id="cb111-71"><a href="model-evaluation.html#cb111-71" tabindex="-1"></a>  )</span>
<span id="cb111-72"><a href="model-evaluation.html#cb111-72" tabindex="-1"></a>  </span>
<span id="cb111-73"><a href="model-evaluation.html#cb111-73" tabindex="-1"></a>  dStan<span class="sc">$</span>UseData[ii]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb111-74"><a href="model-evaluation.html#cb111-74" tabindex="-1"></a>  </span>
<span id="cb111-75"><a href="model-evaluation.html#cb111-75" tabindex="-1"></a>  Fit_FS<span class="ot">&lt;-</span>model_FS <span class="sc">|&gt;</span></span>
<span id="cb111-76"><a href="model-evaluation.html#cb111-76" tabindex="-1"></a>    <span class="fu">sampling</span>(<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb111-77"><a href="model-evaluation.html#cb111-77" tabindex="-1"></a>  ll_FS<span class="ot">&lt;-</span><span class="fu">cbind</span>(ll_FS,<span class="fu">extract</span>(Fit_FS)<span class="sc">$</span>log_lik[,ii])</span>
<span id="cb111-78"><a href="model-evaluation.html#cb111-78" tabindex="-1"></a>  </span>
<span id="cb111-79"><a href="model-evaluation.html#cb111-79" tabindex="-1"></a>  Fit_Linear<span class="ot">&lt;-</span>model_Linear <span class="sc">|&gt;</span></span>
<span id="cb111-80"><a href="model-evaluation.html#cb111-80" tabindex="-1"></a>    <span class="fu">sampling</span>(<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb111-81"><a href="model-evaluation.html#cb111-81" tabindex="-1"></a>  ll_Linear<span class="ot">&lt;-</span><span class="fu">cbind</span>(ll_Linear,<span class="fu">extract</span>(Fit_Linear)<span class="sc">$</span>log_lik[,ii])</span>
<span id="cb111-82"><a href="model-evaluation.html#cb111-82" tabindex="-1"></a>  </span>
<span id="cb111-83"><a href="model-evaluation.html#cb111-83" tabindex="-1"></a>  Fit_Selfish<span class="ot">&lt;-</span>model_Selfish <span class="sc">|&gt;</span></span>
<span id="cb111-84"><a href="model-evaluation.html#cb111-84" tabindex="-1"></a>    <span class="fu">sampling</span>(<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb111-85"><a href="model-evaluation.html#cb111-85" tabindex="-1"></a>  ll_Selfish<span class="ot">&lt;-</span><span class="fu">cbind</span>(ll_Selfish,<span class="fu">extract</span>(Fit_Selfish)<span class="sc">$</span>log_lik[,ii])</span>
<span id="cb111-86"><a href="model-evaluation.html#cb111-86" tabindex="-1"></a></span>
<span id="cb111-87"><a href="model-evaluation.html#cb111-87" tabindex="-1"></a>}</span>
<span id="cb111-88"><a href="model-evaluation.html#cb111-88" tabindex="-1"></a></span>
<span id="cb111-89"><a href="model-evaluation.html#cb111-89" tabindex="-1"></a>ll_FS <span class="sc">|&gt;</span></span>
<span id="cb111-90"><a href="model-evaluation.html#cb111-90" tabindex="-1"></a>  <span class="fu">write.csv</span>(<span class="st">&quot;Code/Validation/LOO_ll_FS.csv&quot;</span>)</span>
<span id="cb111-91"><a href="model-evaluation.html#cb111-91" tabindex="-1"></a>ll_Linear <span class="sc">|&gt;</span></span>
<span id="cb111-92"><a href="model-evaluation.html#cb111-92" tabindex="-1"></a>  <span class="fu">write.csv</span>(<span class="st">&quot;Code/Validation/LOO_ll_Linear.csv&quot;</span>)</span>
<span id="cb111-93"><a href="model-evaluation.html#cb111-93" tabindex="-1"></a>ll_Selfish <span class="sc">|&gt;</span></span>
<span id="cb111-94"><a href="model-evaluation.html#cb111-94" tabindex="-1"></a>  <span class="fu">write.csv</span>(<span class="st">&quot;Code/Validation/LOO_ll_Selfish.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="model-evaluation.html#cb112-1" tabindex="-1"></a>models<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="at">model1=</span><span class="st">&quot;FS&quot;</span>,<span class="at">model2=</span><span class="st">&quot;Selfish&quot;</span>,<span class="at">model3=</span><span class="st">&quot;Linear&quot;</span>)</span>
<span id="cb112-2"><a href="model-evaluation.html#cb112-2" tabindex="-1"></a></span>
<span id="cb112-3"><a href="model-evaluation.html#cb112-3" tabindex="-1"></a>LOO_ll_FS<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/LOO_ll_FS.csv&quot;</span> <span class="sc">|&gt;</span> <span class="fu">read.csv</span>() <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>()</span>
<span id="cb112-4"><a href="model-evaluation.html#cb112-4" tabindex="-1"></a>LOO_ll_Linear<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/LOO_ll_Linear.csv&quot;</span> <span class="sc">|&gt;</span> <span class="fu">read.csv</span>() <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>()</span>
<span id="cb112-5"><a href="model-evaluation.html#cb112-5" tabindex="-1"></a>LOO_ll_Selfish<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/LOO_ll_Selfish.csv&quot;</span> <span class="sc">|&gt;</span> <span class="fu">read.csv</span>() <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>()</span>
<span id="cb112-6"><a href="model-evaluation.html#cb112-6" tabindex="-1"></a></span>
<span id="cb112-7"><a href="model-evaluation.html#cb112-7" tabindex="-1"></a><span class="fu">loo_compare</span>(<span class="fu">loo</span>(LOO_ll_FS,<span class="at">cores=</span><span class="dv">8</span>),<span class="fu">loo</span>(LOO_ll_Selfish,<span class="at">cores=</span><span class="dv">8</span>),<span class="fu">loo</span>(LOO_ll_Linear,<span class="at">cores=</span><span class="dv">8</span>)) <span class="sc">|&gt;</span></span>
<span id="cb112-8"><a href="model-evaluation.html#cb112-8" tabindex="-1"></a>  <span class="fu">data.frame</span>()<span class="sc">|&gt;</span></span>
<span id="cb112-9"><a href="model-evaluation.html#cb112-9" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;model&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb112-10"><a href="model-evaluation.html#cb112-10" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb112-11"><a href="model-evaluation.html#cb112-11" tabindex="-1"></a>    <span class="at">model =</span> models[model]</span>
<span id="cb112-12"><a href="model-evaluation.html#cb112-12" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb112-13"><a href="model-evaluation.html#cb112-13" tabindex="-1"></a>  <span class="fu">kbl</span>( <span class="at">caption =</span> <span class="st">&quot;Model comparison using exact LOO&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb112-14"><a href="model-evaluation.html#cb112-14" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<table class=" lightable-classic" style="color: black; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:ValidationExactLOOtable">Table 8.3: </span>Model comparison using exact LOO
</caption>
<thead>
<tr>
<th style="text-align:left;">
model
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_loo
</th>
<th style="text-align:right;">
se_elpd_loo
</th>
<th style="text-align:right;">
p_loo
</th>
<th style="text-align:right;">
se_p_loo
</th>
<th style="text-align:right;">
looic
</th>
<th style="text-align:right;">
se_looic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Selfish
</td>
<td style="text-align:right;">
0.00000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
-41.71713
</td>
<td style="text-align:right;">
6.029357
</td>
<td style="text-align:right;">
1.794600
</td>
<td style="text-align:right;">
0.8102173
</td>
<td style="text-align:right;">
83.43425
</td>
<td style="text-align:right;">
12.05871
</td>
</tr>
<tr>
<td style="text-align:left;">
Linear
</td>
<td style="text-align:right;">
-2.14477
</td>
<td style="text-align:right;">
0.7093951
</td>
<td style="text-align:right;">
-43.86190
</td>
<td style="text-align:right;">
5.823461
</td>
<td style="text-align:right;">
2.979981
</td>
<td style="text-align:right;">
0.9124914
</td>
<td style="text-align:right;">
87.72379
</td>
<td style="text-align:right;">
11.64692
</td>
</tr>
<tr>
<td style="text-align:left;">
FS
</td>
<td style="text-align:right;">
-4.65318
</td>
<td style="text-align:right;">
1.4090278
</td>
<td style="text-align:right;">
-46.37031
</td>
<td style="text-align:right;">
6.316032
</td>
<td style="text-align:right;">
4.604015
</td>
<td style="text-align:right;">
1.3196564
</td>
<td style="text-align:right;">
92.74061
</td>
<td style="text-align:right;">
12.63206
</td>
</tr>
</tbody>
</table>
<p>Table <a href="model-evaluation.html#tab:ValidationExactLOOtable">8.3</a> shows a summary of the <code>loo</code> output. Recall that larger (i.e. more positive) values of ELPD indicate a better fit. Here we select the selfish model.</p>
</div>
<div id="approximate-loo" class="section level3 hasAnchor" number="8.3.4">
<h3><span class="header-section-number">8.3.4</span> Approximate LOO<a href="model-evaluation.html#approximate-loo" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="citation">Vehtari, Gelman, and Gabry (<a href="#ref-Vehtari2017">2017</a>)</span> describes methods for approximating LOO using Pareto-smoothed importance sampling. The advantage of this process is that you only need to estimate each model once, rather than <span class="math inline">\(n\)</span> times. This can be done in <em>R</em> using the <code>loo</code> library.</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="model-evaluation.html#cb113-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb113-2"><a href="model-evaluation.html#cb113-2" tabindex="-1"></a><span class="fu">library</span>(loo)</span>
<span id="cb113-3"><a href="model-evaluation.html#cb113-3" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb113-4"><a href="model-evaluation.html#cb113-4" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb113-5"><a href="model-evaluation.html#cb113-5" tabindex="-1"></a><span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb113-6"><a href="model-evaluation.html#cb113-6" tabindex="-1"></a></span>
<span id="cb113-7"><a href="model-evaluation.html#cb113-7" tabindex="-1"></a>d1<span class="ot">&lt;-</span>(<span class="fu">read.csv</span>(<span class="st">&quot;Data/BFS2019_choices_exp1.csv&quot;</span>)</span>
<span id="cb113-8"><a href="model-evaluation.html#cb113-8" tabindex="-1"></a>     <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">experiment=</span><span class="dv">1</span>)</span>
<span id="cb113-9"><a href="model-evaluation.html#cb113-9" tabindex="-1"></a>)</span>
<span id="cb113-10"><a href="model-evaluation.html#cb113-10" tabindex="-1"></a>d2<span class="ot">&lt;-</span>(<span class="fu">read.csv</span>(<span class="st">&quot;Data/BFS2019_choices_exp2.csv&quot;</span>)</span>
<span id="cb113-11"><a href="model-evaluation.html#cb113-11" tabindex="-1"></a>     <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">experiment=</span><span class="dv">2</span>)    </span>
<span id="cb113-12"><a href="model-evaluation.html#cb113-12" tabindex="-1"></a>)</span>
<span id="cb113-13"><a href="model-evaluation.html#cb113-13" tabindex="-1"></a>D<span class="ot">&lt;-</span>(<span class="fu">rbind</span>(d1,d2)</span>
<span id="cb113-14"><a href="model-evaluation.html#cb113-14" tabindex="-1"></a>    <span class="co"># Just use the dictator game data</span></span>
<span id="cb113-15"><a href="model-evaluation.html#cb113-15" tabindex="-1"></a>    <span class="sc">|&gt;</span> <span class="fu">filter</span>(dg<span class="sc">==</span><span class="dv">1</span>)  </span>
<span id="cb113-16"><a href="model-evaluation.html#cb113-16" tabindex="-1"></a>    <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb113-17"><a href="model-evaluation.html#cb113-17" tabindex="-1"></a>      <span class="at">self_alloc =</span> <span class="fu">ifelse</span>(choice_x<span class="sc">==</span><span class="dv">1</span>,self_x,self_y),</span>
<span id="cb113-18"><a href="model-evaluation.html#cb113-18" tabindex="-1"></a>      <span class="at">other_alloc =</span> <span class="fu">ifelse</span>(choice_x<span class="sc">==</span><span class="dv">1</span>,other_x,other_y)</span>
<span id="cb113-19"><a href="model-evaluation.html#cb113-19" tabindex="-1"></a>    )</span>
<span id="cb113-20"><a href="model-evaluation.html#cb113-20" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb113-21"><a href="model-evaluation.html#cb113-21" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb113-22"><a href="model-evaluation.html#cb113-22" tabindex="-1"></a>    sid<span class="sc">==</span><span class="dv">102010050706</span></span>
<span id="cb113-23"><a href="model-evaluation.html#cb113-23" tabindex="-1"></a>  )</span>
<span id="cb113-24"><a href="model-evaluation.html#cb113-24" tabindex="-1"></a></span>
<span id="cb113-25"><a href="model-evaluation.html#cb113-25" tabindex="-1"></a></span>
<span id="cb113-26"><a href="model-evaluation.html#cb113-26" tabindex="-1"></a></span>
<span id="cb113-27"><a href="model-evaluation.html#cb113-27" tabindex="-1"></a>model_FS<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/FS.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb113-28"><a href="model-evaluation.html#cb113-28" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb113-29"><a href="model-evaluation.html#cb113-29" tabindex="-1"></a>model_Linear<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/Linear.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb113-30"><a href="model-evaluation.html#cb113-30" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb113-31"><a href="model-evaluation.html#cb113-31" tabindex="-1"></a>model_Selfish<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/Selfish.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb113-32"><a href="model-evaluation.html#cb113-32" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb113-33"><a href="model-evaluation.html#cb113-33" tabindex="-1"></a></span>
<span id="cb113-34"><a href="model-evaluation.html#cb113-34" tabindex="-1"></a>dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb113-35"><a href="model-evaluation.html#cb113-35" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">dim</span>(D)[<span class="dv">1</span>],</span>
<span id="cb113-36"><a href="model-evaluation.html#cb113-36" tabindex="-1"></a>  <span class="at">self_x =</span> D<span class="sc">$</span>self_x,</span>
<span id="cb113-37"><a href="model-evaluation.html#cb113-37" tabindex="-1"></a>  <span class="at">other_x =</span> D<span class="sc">$</span>other_x,</span>
<span id="cb113-38"><a href="model-evaluation.html#cb113-38" tabindex="-1"></a>  <span class="at">self_y =</span> D<span class="sc">$</span>self_y,</span>
<span id="cb113-39"><a href="model-evaluation.html#cb113-39" tabindex="-1"></a>  <span class="at">other_y =</span> D<span class="sc">$</span>other_y,</span>
<span id="cb113-40"><a href="model-evaluation.html#cb113-40" tabindex="-1"></a>  </span>
<span id="cb113-41"><a href="model-evaluation.html#cb113-41" tabindex="-1"></a>  <span class="at">choice_x =</span> D<span class="sc">$</span>choice_x,</span>
<span id="cb113-42"><a href="model-evaluation.html#cb113-42" tabindex="-1"></a>  </span>
<span id="cb113-43"><a href="model-evaluation.html#cb113-43" tabindex="-1"></a>  <span class="at">prior_alpha =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb113-44"><a href="model-evaluation.html#cb113-44" tabindex="-1"></a>  <span class="at">prior_beta =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb113-45"><a href="model-evaluation.html#cb113-45" tabindex="-1"></a>  <span class="at">prior_gamma =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb113-46"><a href="model-evaluation.html#cb113-46" tabindex="-1"></a>  <span class="at">prior_lambda =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">5.76</span>,<span class="fl">2.11</span>),</span>
<span id="cb113-47"><a href="model-evaluation.html#cb113-47" tabindex="-1"></a>  </span>
<span id="cb113-48"><a href="model-evaluation.html#cb113-48" tabindex="-1"></a>  <span class="at">UseData =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">dim</span>(D)[<span class="dv">1</span>])</span>
<span id="cb113-49"><a href="model-evaluation.html#cb113-49" tabindex="-1"></a>)</span>
<span id="cb113-50"><a href="model-evaluation.html#cb113-50" tabindex="-1"></a></span>
<span id="cb113-51"><a href="model-evaluation.html#cb113-51" tabindex="-1"></a><span class="co"># Estimate the models</span></span>
<span id="cb113-52"><a href="model-evaluation.html#cb113-52" tabindex="-1"></a></span>
<span id="cb113-53"><a href="model-evaluation.html#cb113-53" tabindex="-1"></a>Fit_FS<span class="ot">&lt;-</span>model_FS <span class="sc">|&gt;</span></span>
<span id="cb113-54"><a href="model-evaluation.html#cb113-54" tabindex="-1"></a>  <span class="fu">sampling</span>(<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb113-55"><a href="model-evaluation.html#cb113-55" tabindex="-1"></a></span>
<span id="cb113-56"><a href="model-evaluation.html#cb113-56" tabindex="-1"></a>Fit_Selfish<span class="ot">&lt;-</span>model_Selfish <span class="sc">|&gt;</span></span>
<span id="cb113-57"><a href="model-evaluation.html#cb113-57" tabindex="-1"></a>  <span class="fu">sampling</span>(<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb113-58"><a href="model-evaluation.html#cb113-58" tabindex="-1"></a></span>
<span id="cb113-59"><a href="model-evaluation.html#cb113-59" tabindex="-1"></a>Fit_Linear<span class="ot">&lt;-</span>model_Linear <span class="sc">|&gt;</span></span>
<span id="cb113-60"><a href="model-evaluation.html#cb113-60" tabindex="-1"></a>  <span class="fu">sampling</span>(<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb113-61"><a href="model-evaluation.html#cb113-61" tabindex="-1"></a></span>
<span id="cb113-62"><a href="model-evaluation.html#cb113-62" tabindex="-1"></a><span class="co"># apply approximate LOO cross-validation</span></span>
<span id="cb113-63"><a href="model-evaluation.html#cb113-63" tabindex="-1"></a></span>
<span id="cb113-64"><a href="model-evaluation.html#cb113-64" tabindex="-1"></a>FS<span class="ot">&lt;-</span><span class="fu">extract</span>(Fit_FS)<span class="sc">$</span>log_lik <span class="sc">|&gt;</span> </span>
<span id="cb113-65"><a href="model-evaluation.html#cb113-65" tabindex="-1"></a>  <span class="fu">loo</span>(<span class="at">cores=</span><span class="dv">8</span>)</span>
<span id="cb113-66"><a href="model-evaluation.html#cb113-66" tabindex="-1"></a>  </span>
<span id="cb113-67"><a href="model-evaluation.html#cb113-67" tabindex="-1"></a></span>
<span id="cb113-68"><a href="model-evaluation.html#cb113-68" tabindex="-1"></a>Selfish<span class="ot">&lt;-</span><span class="fu">extract</span>(Fit_Selfish)<span class="sc">$</span>log_lik <span class="sc">|&gt;</span> </span>
<span id="cb113-69"><a href="model-evaluation.html#cb113-69" tabindex="-1"></a>  <span class="fu">loo</span>(<span class="at">cores=</span><span class="dv">8</span>)</span>
<span id="cb113-70"><a href="model-evaluation.html#cb113-70" tabindex="-1"></a></span>
<span id="cb113-71"><a href="model-evaluation.html#cb113-71" tabindex="-1"></a>Linear<span class="ot">&lt;-</span><span class="fu">extract</span>(Fit_Linear)<span class="sc">$</span>log_lik <span class="sc">|&gt;</span> </span>
<span id="cb113-72"><a href="model-evaluation.html#cb113-72" tabindex="-1"></a>  <span class="fu">loo</span>(<span class="at">cores=</span><span class="dv">8</span>)</span>
<span id="cb113-73"><a href="model-evaluation.html#cb113-73" tabindex="-1"></a></span>
<span id="cb113-74"><a href="model-evaluation.html#cb113-74" tabindex="-1"></a><span class="co"># Compare the models</span></span>
<span id="cb113-75"><a href="model-evaluation.html#cb113-75" tabindex="-1"></a></span>
<span id="cb113-76"><a href="model-evaluation.html#cb113-76" tabindex="-1"></a><span class="fu">loo_compare</span>(FS,Selfish,Linear) <span class="sc">|&gt;</span></span>
<span id="cb113-77"><a href="model-evaluation.html#cb113-77" tabindex="-1"></a>  <span class="fu">saveRDS</span>(<span class="st">&quot;Code/Validation/ApproxLOO.rds&quot;</span>)</span></code></pre></div>
<p>The downside of this process is that it is not guaranteed that the sampling is reliable. Fortunately there is a diagnostic of this, which `loo’ checks for us. For example, for the “Selfish” model, I got the following warning:</p>
<pre><code>Pareto k diagnostic values:
                         Count Pct.    Min. ESS
(-Inf, 0.7]   (good)     72    92.3%   2270    
   (0.7, 1]   (bad)       0     0.0%   &lt;NA&gt;    
   (1, Inf)   (very bad)  6     7.7%   &lt;NA&gt;    
See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<p>So there are six observations for which this process did not work well. In these cases one can instead do LOO as described in the previous section.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="model-evaluation.html#cb115-1" tabindex="-1"></a><span class="st">&quot;Code/Validation/ApproxLOO.rds&quot;</span> <span class="sc">|&gt;</span> </span>
<span id="cb115-2"><a href="model-evaluation.html#cb115-2" tabindex="-1"></a>  <span class="fu">readRDS</span>() <span class="sc">|&gt;</span></span>
<span id="cb115-3"><a href="model-evaluation.html#cb115-3" tabindex="-1"></a>  <span class="fu">data.frame</span>()<span class="sc">|&gt;</span></span>
<span id="cb115-4"><a href="model-evaluation.html#cb115-4" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;model&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb115-5"><a href="model-evaluation.html#cb115-5" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb115-6"><a href="model-evaluation.html#cb115-6" tabindex="-1"></a>    <span class="at">model =</span> models[model]</span>
<span id="cb115-7"><a href="model-evaluation.html#cb115-7" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb115-8"><a href="model-evaluation.html#cb115-8" tabindex="-1"></a>  <span class="fu">kbl</span>( <span class="at">caption =</span> <span class="st">&quot;Model validation using approximate LOO&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb115-9"><a href="model-evaluation.html#cb115-9" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<table class=" lightable-classic" style="color: black; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:ValidationApproxLOOtable">Table 8.4: </span>Model validation using approximate LOO
</caption>
<thead>
<tr>
<th style="text-align:left;">
model
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_loo
</th>
<th style="text-align:right;">
se_elpd_loo
</th>
<th style="text-align:right;">
p_loo
</th>
<th style="text-align:right;">
se_p_loo
</th>
<th style="text-align:right;">
looic
</th>
<th style="text-align:right;">
se_looic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Selfish
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
-39.93907
</td>
<td style="text-align:right;">
5.310491
</td>
<td style="text-align:right;">
1.467190
</td>
<td style="text-align:right;">
0.6213825
</td>
<td style="text-align:right;">
79.87814
</td>
<td style="text-align:right;">
10.62098
</td>
</tr>
<tr>
<td style="text-align:left;">
Linear
</td>
<td style="text-align:right;">
-0.9970267
</td>
<td style="text-align:right;">
0.7318856
</td>
<td style="text-align:right;">
-40.93610
</td>
<td style="text-align:right;">
5.009543
</td>
<td style="text-align:right;">
2.454233
</td>
<td style="text-align:right;">
0.6737671
</td>
<td style="text-align:right;">
81.87220
</td>
<td style="text-align:right;">
10.01909
</td>
</tr>
<tr>
<td style="text-align:left;">
FS
</td>
<td style="text-align:right;">
-1.7310278
</td>
<td style="text-align:right;">
1.0247346
</td>
<td style="text-align:right;">
-41.67010
</td>
<td style="text-align:right;">
5.095779
</td>
<td style="text-align:right;">
3.476072
</td>
<td style="text-align:right;">
0.8952323
</td>
<td style="text-align:right;">
83.34020
</td>
<td style="text-align:right;">
10.19156
</td>
</tr>
</tbody>
</table>
<p>Table <a href="model-evaluation.html#tab:ValidationApproxLOOtable">8.4</a> shows the <code>loo</code> library’s summary of the model evaluation. Here we select the “Selfish” model.</p>
</div>
<div id="k-fold-cross-validation" class="section level3 hasAnchor" number="8.3.5">
<h3><span class="header-section-number">8.3.5</span> <span class="math inline">\(k\)</span>-fold cross-validation<a href="model-evaluation.html#k-fold-cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Perhaps a happy medium between LOO and approximate LOO is <span class="math inline">\(k\)</span>-fold cross-validation. Here, we partition the data into <span class="math inline">\(k\)</span> “folds”. For each fold, we estimate the model using data not in that fold, then evaluate how well the estimated model predicts data in that fold. That is, when <span class="math inline">\(k=n\)</span> we are back to LOO.</p>
<p>Here is my <em>R</em> code for implementing <span class="math inline">\(k\)</span>-fold cross-validation. In this script, I partition the data into <span class="math inline">\(k=10\)</span> folds.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="model-evaluation.html#cb116-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb116-2"><a href="model-evaluation.html#cb116-2" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb116-3"><a href="model-evaluation.html#cb116-3" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb116-4"><a href="model-evaluation.html#cb116-4" tabindex="-1"></a><span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb116-5"><a href="model-evaluation.html#cb116-5" tabindex="-1"></a></span>
<span id="cb116-6"><a href="model-evaluation.html#cb116-6" tabindex="-1"></a>d1<span class="ot">&lt;-</span>(<span class="fu">read.csv</span>(<span class="st">&quot;Data/BFS2019_choices_exp1.csv&quot;</span>)</span>
<span id="cb116-7"><a href="model-evaluation.html#cb116-7" tabindex="-1"></a>     <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">experiment=</span><span class="dv">1</span>)</span>
<span id="cb116-8"><a href="model-evaluation.html#cb116-8" tabindex="-1"></a>)</span>
<span id="cb116-9"><a href="model-evaluation.html#cb116-9" tabindex="-1"></a>d2<span class="ot">&lt;-</span>(<span class="fu">read.csv</span>(<span class="st">&quot;Data/BFS2019_choices_exp2.csv&quot;</span>)</span>
<span id="cb116-10"><a href="model-evaluation.html#cb116-10" tabindex="-1"></a>     <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">experiment=</span><span class="dv">2</span>)    </span>
<span id="cb116-11"><a href="model-evaluation.html#cb116-11" tabindex="-1"></a>)</span>
<span id="cb116-12"><a href="model-evaluation.html#cb116-12" tabindex="-1"></a>D<span class="ot">&lt;-</span>(<span class="fu">rbind</span>(d1,d2)</span>
<span id="cb116-13"><a href="model-evaluation.html#cb116-13" tabindex="-1"></a>    <span class="co"># Just use the dictator game data</span></span>
<span id="cb116-14"><a href="model-evaluation.html#cb116-14" tabindex="-1"></a>    <span class="sc">|&gt;</span> <span class="fu">filter</span>(dg<span class="sc">==</span><span class="dv">1</span>)  </span>
<span id="cb116-15"><a href="model-evaluation.html#cb116-15" tabindex="-1"></a>    <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb116-16"><a href="model-evaluation.html#cb116-16" tabindex="-1"></a>      <span class="at">self_alloc =</span> <span class="fu">ifelse</span>(choice_x<span class="sc">==</span><span class="dv">1</span>,self_x,self_y),</span>
<span id="cb116-17"><a href="model-evaluation.html#cb116-17" tabindex="-1"></a>      <span class="at">other_alloc =</span> <span class="fu">ifelse</span>(choice_x<span class="sc">==</span><span class="dv">1</span>,other_x,other_y)</span>
<span id="cb116-18"><a href="model-evaluation.html#cb116-18" tabindex="-1"></a>    )</span>
<span id="cb116-19"><a href="model-evaluation.html#cb116-19" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb116-20"><a href="model-evaluation.html#cb116-20" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb116-21"><a href="model-evaluation.html#cb116-21" tabindex="-1"></a>    sid<span class="sc">==</span><span class="dv">102010050706</span></span>
<span id="cb116-22"><a href="model-evaluation.html#cb116-22" tabindex="-1"></a>  )</span>
<span id="cb116-23"><a href="model-evaluation.html#cb116-23" tabindex="-1"></a></span>
<span id="cb116-24"><a href="model-evaluation.html#cb116-24" tabindex="-1"></a></span>
<span id="cb116-25"><a href="model-evaluation.html#cb116-25" tabindex="-1"></a></span>
<span id="cb116-26"><a href="model-evaluation.html#cb116-26" tabindex="-1"></a>model_FS<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/FS.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb116-27"><a href="model-evaluation.html#cb116-27" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb116-28"><a href="model-evaluation.html#cb116-28" tabindex="-1"></a>model_Linear<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/Linear.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb116-29"><a href="model-evaluation.html#cb116-29" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb116-30"><a href="model-evaluation.html#cb116-30" tabindex="-1"></a>model_Selfish<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/Selfish.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb116-31"><a href="model-evaluation.html#cb116-31" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb116-32"><a href="model-evaluation.html#cb116-32" tabindex="-1"></a></span>
<span id="cb116-33"><a href="model-evaluation.html#cb116-33" tabindex="-1"></a>dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb116-34"><a href="model-evaluation.html#cb116-34" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">dim</span>(D)[<span class="dv">1</span>],</span>
<span id="cb116-35"><a href="model-evaluation.html#cb116-35" tabindex="-1"></a>  <span class="at">self_x =</span> D<span class="sc">$</span>self_x,</span>
<span id="cb116-36"><a href="model-evaluation.html#cb116-36" tabindex="-1"></a>  <span class="at">other_x =</span> D<span class="sc">$</span>other_x,</span>
<span id="cb116-37"><a href="model-evaluation.html#cb116-37" tabindex="-1"></a>  <span class="at">self_y =</span> D<span class="sc">$</span>self_y,</span>
<span id="cb116-38"><a href="model-evaluation.html#cb116-38" tabindex="-1"></a>  <span class="at">other_y =</span> D<span class="sc">$</span>other_y,</span>
<span id="cb116-39"><a href="model-evaluation.html#cb116-39" tabindex="-1"></a>  </span>
<span id="cb116-40"><a href="model-evaluation.html#cb116-40" tabindex="-1"></a>  <span class="at">choice_x =</span> D<span class="sc">$</span>choice_x,</span>
<span id="cb116-41"><a href="model-evaluation.html#cb116-41" tabindex="-1"></a>  </span>
<span id="cb116-42"><a href="model-evaluation.html#cb116-42" tabindex="-1"></a>  <span class="at">prior_alpha =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb116-43"><a href="model-evaluation.html#cb116-43" tabindex="-1"></a>  <span class="at">prior_beta =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb116-44"><a href="model-evaluation.html#cb116-44" tabindex="-1"></a>  <span class="at">prior_gamma =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb116-45"><a href="model-evaluation.html#cb116-45" tabindex="-1"></a>  <span class="at">prior_lambda =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">5.76</span>,<span class="fl">2.11</span>),</span>
<span id="cb116-46"><a href="model-evaluation.html#cb116-46" tabindex="-1"></a>  </span>
<span id="cb116-47"><a href="model-evaluation.html#cb116-47" tabindex="-1"></a>  <span class="at">UseData =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">dim</span>(D)[<span class="dv">1</span>])</span>
<span id="cb116-48"><a href="model-evaluation.html#cb116-48" tabindex="-1"></a>)</span>
<span id="cb116-49"><a href="model-evaluation.html#cb116-49" tabindex="-1"></a></span>
<span id="cb116-50"><a href="model-evaluation.html#cb116-50" tabindex="-1"></a>ll_FS<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="dv">4000</span>,<span class="dv">78</span>)</span>
<span id="cb116-51"><a href="model-evaluation.html#cb116-51" tabindex="-1"></a>ll_Selfish<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="dv">4000</span>,<span class="dv">78</span>)</span>
<span id="cb116-52"><a href="model-evaluation.html#cb116-52" tabindex="-1"></a>ll_Linear<span class="ot">&lt;-</span><span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="dv">4000</span>,<span class="dv">78</span>)</span>
<span id="cb116-53"><a href="model-evaluation.html#cb116-53" tabindex="-1"></a></span>
<span id="cb116-54"><a href="model-evaluation.html#cb116-54" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb116-55"><a href="model-evaluation.html#cb116-55" tabindex="-1"></a></span>
<span id="cb116-56"><a href="model-evaluation.html#cb116-56" tabindex="-1"></a></span>
<span id="cb116-57"><a href="model-evaluation.html#cb116-57" tabindex="-1"></a><span class="co"># set up an index for the folds. </span></span>
<span id="cb116-58"><a href="model-evaluation.html#cb116-58" tabindex="-1"></a>folds<span class="ot">&lt;-</span><span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">8</span>)</span>
<span id="cb116-59"><a href="model-evaluation.html#cb116-59" tabindex="-1"></a>folds<span class="ot">&lt;-</span>folds[<span class="fu">order</span>(<span class="fu">runif</span>(<span class="dv">80</span>))][<span class="dv">1</span><span class="sc">:</span><span class="dv">78</span>]</span>
<span id="cb116-60"><a href="model-evaluation.html#cb116-60" tabindex="-1"></a></span>
<span id="cb116-61"><a href="model-evaluation.html#cb116-61" tabindex="-1"></a></span>
<span id="cb116-62"><a href="model-evaluation.html#cb116-62" tabindex="-1"></a></span>
<span id="cb116-63"><a href="model-evaluation.html#cb116-63" tabindex="-1"></a><span class="cf">for</span> (ff <span class="cf">in</span> <span class="fu">unique</span>(folds)) {</span>
<span id="cb116-64"><a href="model-evaluation.html#cb116-64" tabindex="-1"></a>  </span>
<span id="cb116-65"><a href="model-evaluation.html#cb116-65" tabindex="-1"></a>  <span class="fu">print</span>(ff)</span>
<span id="cb116-66"><a href="model-evaluation.html#cb116-66" tabindex="-1"></a>  </span>
<span id="cb116-67"><a href="model-evaluation.html#cb116-67" tabindex="-1"></a>  dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb116-68"><a href="model-evaluation.html#cb116-68" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">dim</span>(D)[<span class="dv">1</span>],</span>
<span id="cb116-69"><a href="model-evaluation.html#cb116-69" tabindex="-1"></a>    <span class="at">self_x =</span> D<span class="sc">$</span>self_x,</span>
<span id="cb116-70"><a href="model-evaluation.html#cb116-70" tabindex="-1"></a>    <span class="at">other_x =</span> D<span class="sc">$</span>other_x,</span>
<span id="cb116-71"><a href="model-evaluation.html#cb116-71" tabindex="-1"></a>    <span class="at">self_y =</span> D<span class="sc">$</span>self_y,</span>
<span id="cb116-72"><a href="model-evaluation.html#cb116-72" tabindex="-1"></a>    <span class="at">other_y =</span> D<span class="sc">$</span>other_y,</span>
<span id="cb116-73"><a href="model-evaluation.html#cb116-73" tabindex="-1"></a>    </span>
<span id="cb116-74"><a href="model-evaluation.html#cb116-74" tabindex="-1"></a>    <span class="at">choice_x =</span> D<span class="sc">$</span>choice_x,</span>
<span id="cb116-75"><a href="model-evaluation.html#cb116-75" tabindex="-1"></a>    </span>
<span id="cb116-76"><a href="model-evaluation.html#cb116-76" tabindex="-1"></a>    <span class="at">prior_alpha =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb116-77"><a href="model-evaluation.html#cb116-77" tabindex="-1"></a>    <span class="at">prior_beta =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb116-78"><a href="model-evaluation.html#cb116-78" tabindex="-1"></a>    <span class="at">prior_gamma =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.67</span>),</span>
<span id="cb116-79"><a href="model-evaluation.html#cb116-79" tabindex="-1"></a>    <span class="at">prior_lambda =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">5.76</span>,<span class="fl">2.11</span>),</span>
<span id="cb116-80"><a href="model-evaluation.html#cb116-80" tabindex="-1"></a>    </span>
<span id="cb116-81"><a href="model-evaluation.html#cb116-81" tabindex="-1"></a>    <span class="at">UseData =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">dim</span>(D)[<span class="dv">1</span>])</span>
<span id="cb116-82"><a href="model-evaluation.html#cb116-82" tabindex="-1"></a>  )</span>
<span id="cb116-83"><a href="model-evaluation.html#cb116-83" tabindex="-1"></a>  </span>
<span id="cb116-84"><a href="model-evaluation.html#cb116-84" tabindex="-1"></a>  dStan<span class="sc">$</span>UseData[folds<span class="sc">==</span>ff]<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb116-85"><a href="model-evaluation.html#cb116-85" tabindex="-1"></a>  </span>
<span id="cb116-86"><a href="model-evaluation.html#cb116-86" tabindex="-1"></a>  Fit_FS<span class="ot">&lt;-</span>model_FS <span class="sc">|&gt;</span></span>
<span id="cb116-87"><a href="model-evaluation.html#cb116-87" tabindex="-1"></a>    <span class="fu">sampling</span>(<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb116-88"><a href="model-evaluation.html#cb116-88" tabindex="-1"></a>  ll_FS[,ff<span class="sc">==</span>folds]<span class="ot">&lt;-</span><span class="fu">extract</span>(Fit_FS)<span class="sc">$</span>log_lik[,ff<span class="sc">==</span>folds]</span>
<span id="cb116-89"><a href="model-evaluation.html#cb116-89" tabindex="-1"></a>  </span>
<span id="cb116-90"><a href="model-evaluation.html#cb116-90" tabindex="-1"></a>  Fit_Linear<span class="ot">&lt;-</span>model_Linear <span class="sc">|&gt;</span></span>
<span id="cb116-91"><a href="model-evaluation.html#cb116-91" tabindex="-1"></a>    <span class="fu">sampling</span>(<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb116-92"><a href="model-evaluation.html#cb116-92" tabindex="-1"></a>  ll_Linear[,ff<span class="sc">==</span>folds]<span class="ot">&lt;-</span><span class="fu">extract</span>(Fit_Linear)<span class="sc">$</span>log_lik[,ff<span class="sc">==</span>folds]</span>
<span id="cb116-93"><a href="model-evaluation.html#cb116-93" tabindex="-1"></a>  </span>
<span id="cb116-94"><a href="model-evaluation.html#cb116-94" tabindex="-1"></a>  Fit_Selfish<span class="ot">&lt;-</span>model_Selfish <span class="sc">|&gt;</span></span>
<span id="cb116-95"><a href="model-evaluation.html#cb116-95" tabindex="-1"></a>    <span class="fu">sampling</span>(<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb116-96"><a href="model-evaluation.html#cb116-96" tabindex="-1"></a>  ll_Selfish[,ff<span class="sc">==</span>folds]<span class="ot">&lt;-</span><span class="fu">extract</span>(Fit_Selfish)<span class="sc">$</span>log_lik[,ff<span class="sc">==</span>folds]</span>
<span id="cb116-97"><a href="model-evaluation.html#cb116-97" tabindex="-1"></a></span>
<span id="cb116-98"><a href="model-evaluation.html#cb116-98" tabindex="-1"></a>}</span>
<span id="cb116-99"><a href="model-evaluation.html#cb116-99" tabindex="-1"></a></span>
<span id="cb116-100"><a href="model-evaluation.html#cb116-100" tabindex="-1"></a>ll_FS <span class="sc">|&gt;</span></span>
<span id="cb116-101"><a href="model-evaluation.html#cb116-101" tabindex="-1"></a>  <span class="fu">write.csv</span>(<span class="st">&quot;Code/Validation/kfold_ll_FS.csv&quot;</span>)</span>
<span id="cb116-102"><a href="model-evaluation.html#cb116-102" tabindex="-1"></a>ll_Linear <span class="sc">|&gt;</span></span>
<span id="cb116-103"><a href="model-evaluation.html#cb116-103" tabindex="-1"></a>  <span class="fu">write.csv</span>(<span class="st">&quot;Code/Validation/kfold_ll_Linear.csv&quot;</span>)</span>
<span id="cb116-104"><a href="model-evaluation.html#cb116-104" tabindex="-1"></a>ll_Selfish <span class="sc">|&gt;</span></span>
<span id="cb116-105"><a href="model-evaluation.html#cb116-105" tabindex="-1"></a>  <span class="fu">write.csv</span>(<span class="st">&quot;Code/Validation/kfold_ll_Selfish.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="model-evaluation.html#cb117-1" tabindex="-1"></a>kfold_ll_FS<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/kfold_ll_FS.csv&quot;</span> <span class="sc">|&gt;</span> <span class="fu">read.csv</span>() <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>()</span>
<span id="cb117-2"><a href="model-evaluation.html#cb117-2" tabindex="-1"></a>kfold_ll_Linear<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/kfold_ll_Linear.csv&quot;</span> <span class="sc">|&gt;</span> <span class="fu">read.csv</span>() <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>()</span>
<span id="cb117-3"><a href="model-evaluation.html#cb117-3" tabindex="-1"></a>kfold_ll_Selfish<span class="ot">&lt;-</span><span class="st">&quot;Code/Validation/kfold_ll_Selfish.csv&quot;</span> <span class="sc">|&gt;</span> <span class="fu">read.csv</span>() <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>X) <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>()</span>
<span id="cb117-4"><a href="model-evaluation.html#cb117-4" tabindex="-1"></a></span>
<span id="cb117-5"><a href="model-evaluation.html#cb117-5" tabindex="-1"></a></span>
<span id="cb117-6"><a href="model-evaluation.html#cb117-6" tabindex="-1"></a><span class="fu">loo_compare</span>(<span class="fu">loo</span>(kfold_ll_FS,<span class="at">cores=</span><span class="dv">8</span>),<span class="fu">loo</span>(kfold_ll_Selfish,<span class="at">cores=</span><span class="dv">8</span>),<span class="fu">loo</span>(kfold_ll_Linear,<span class="at">cores=</span><span class="dv">8</span>)) <span class="sc">|&gt;</span></span>
<span id="cb117-7"><a href="model-evaluation.html#cb117-7" tabindex="-1"></a>  <span class="fu">data.frame</span>()<span class="sc">|&gt;</span></span>
<span id="cb117-8"><a href="model-evaluation.html#cb117-8" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;model&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb117-9"><a href="model-evaluation.html#cb117-9" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb117-10"><a href="model-evaluation.html#cb117-10" tabindex="-1"></a>    <span class="at">model =</span> models[model]</span>
<span id="cb117-11"><a href="model-evaluation.html#cb117-11" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb117-12"><a href="model-evaluation.html#cb117-12" tabindex="-1"></a>  <span class="fu">kbl</span>( <span class="at">caption =</span> <span class="st">&quot;Model comparison using $k$-fold cross-validation&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb117-13"><a href="model-evaluation.html#cb117-13" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<table class=" lightable-classic" style="color: black; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:Validationkfoldtable">Table 8.5: </span>Model comparison using <span class="math inline">\(k\)</span>-fold cross-validation
</caption>
<thead>
<tr>
<th style="text-align:left;">
model
</th>
<th style="text-align:right;">
elpd_diff
</th>
<th style="text-align:right;">
se_diff
</th>
<th style="text-align:right;">
elpd_loo
</th>
<th style="text-align:right;">
se_elpd_loo
</th>
<th style="text-align:right;">
p_loo
</th>
<th style="text-align:right;">
se_p_loo
</th>
<th style="text-align:right;">
looic
</th>
<th style="text-align:right;">
se_looic
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Selfish
</td>
<td style="text-align:right;">
0.000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
-42.31369
</td>
<td style="text-align:right;">
6.220406
</td>
<td style="text-align:right;">
2.098414
</td>
<td style="text-align:right;">
0.9582934
</td>
<td style="text-align:right;">
84.62739
</td>
<td style="text-align:right;">
12.44081
</td>
</tr>
<tr>
<td style="text-align:left;">
Linear
</td>
<td style="text-align:right;">
-1.810640
</td>
<td style="text-align:right;">
0.8332116
</td>
<td style="text-align:right;">
-44.12433
</td>
<td style="text-align:right;">
5.871708
</td>
<td style="text-align:right;">
3.168026
</td>
<td style="text-align:right;">
0.9462041
</td>
<td style="text-align:right;">
88.24867
</td>
<td style="text-align:right;">
11.74342
</td>
</tr>
<tr>
<td style="text-align:left;">
FS
</td>
<td style="text-align:right;">
-4.303829
</td>
<td style="text-align:right;">
1.6452414
</td>
<td style="text-align:right;">
-46.61752
</td>
<td style="text-align:right;">
6.330098
</td>
<td style="text-align:right;">
4.929662
</td>
<td style="text-align:right;">
1.3753267
</td>
<td style="text-align:right;">
93.23504
</td>
<td style="text-align:right;">
12.66020
</td>
</tr>
</tbody>
</table>
<p>Table <a href="model-evaluation.html#tab:Validationkfoldtable">8.5</a> shows the <code>loo</code> library’s summary of the model evaluation using <span class="math inline">\(k\)</span>-fold cross-validation. Again, we select the Selfish model.</p>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-BFS2019" class="csl-entry">
Bruhin, Adrian, Ernst Fehr, and Daniel Schunk. 2019. <span>“The Many Faces of Human Sociality: Uncovering the Distribution and Stability of Social Preferences.”</span> <em>Journal of the European Economic Association</em> 17 (4): 1025–69.
</div>
<div id="ref-FS1999" class="csl-entry">
Fehr, Ernst, and Klaus M Schmidt. 1999. <span>“A Theory of Fairness, Competition, and Cooperation.”</span> <em>The Quarterly Journal of Economics</em> 114 (3): 817–68.
</div>
<div id="ref-Gronau2017" class="csl-entry">
Gronau, Quentin F., Alexandra Sarafoglou, Dora Matzke, Alexander Ly, Udo Boehm, Maarten Marsman, David S. Leslie, Jonathan J. Forster, Eric-Jan Wagenmakers, and Helen Steingroever. 2017. <span>“A Tutorial on Bridge Sampling.”</span> <em>Journal of Mathematical Psychology</em> 81: 80–97. https://doi.org/<a href="https://doi.org/10.1016/j.jmp.2017.09.005">https://doi.org/10.1016/j.jmp.2017.09.005</a>.
</div>
<div id="ref-Bridgesampling" class="csl-entry">
Gronau, Quentin F., Henrik Singmann, and Eric-Jan Wagenmakers. 2020. <span>“Bridgesampling: An r Package for Estimating Normalizing Constants.”</span> <em>Journal of Statistical Software</em> 92: 1–29.
</div>
<div id="ref-Meng1996" class="csl-entry">
Meng, Xiao-Li, and Wing Hung Wong. 1996. <span>“Simulating Ratios of Normalizing Constants via a Simple Identity: A Theoretical Exploration.”</span> <em>Statistica Sinica</em>, 831–60.
</div>
<div id="ref-Vehtari2017" class="csl-entry">
Vehtari, Aki, Andrew Gelman, and Jonah Gabry. 2017. <span>“Practical Bayesian Model Evaluation Using Leave-One-Out Cross-Validation and WAIC.”</span> <em>Statistics and Computing</em> 27 (5): 1413–32.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="34">
<li id="fn34"><p>When using a sampling statement with a tilde (<code>~</code>), <em>Stan</em> drops constants of proportionality because they are not needed to simulate the posterior. However they <em>are</em> needed for computing the marginal likelihood of a model. <a href="model-evaluation.html#fnref34" class="footnote-back">↩︎</a></p></li>
<li id="fn35"><p>I mean two things here. Firstly, unlike posterior probabilities, we are not using Bayes’ rule to quantify uncertainty in our models. Secondly, cross-validation can equally be applied using Frequentist techniques. <a href="model-evaluation.html#fnref35" class="footnote-back">↩︎</a></p></li>
<li id="fn36"><p>For example, if you want to make predictions that minimize the expected squared error, then <span class="math inline">\(RSS_M\)</span> may be a great choice for you.<a href="model-evaluation.html#fnref36" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mixture-models.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="speeding-up-your-stan-code.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

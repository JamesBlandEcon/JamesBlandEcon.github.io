<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Probabilistic models of behavior | Structural Bayesian Techniques for Experimental and Behavioral Economics</title>
  <meta name="description" content="3 Probabilistic models of behavior | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Probabilistic models of behavior | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Probabilistic models of behavior | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  
  
  

<meta name="author" content="James R. Bland" />


<meta name="date" content="2023-06-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="getting-started-in-stan.html"/>
<link rel="next" href="building-blocks.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="section.html#section" id="toc-section"></a></li>
<li class="chapter" data-level="" data-path="setting-the-stage.html"><a href="setting-the-stage.html"><i class="fa fa-check"></i>Setting the stage</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-does-your-theory-say-about-your-data"><i class="fa fa-check"></i><b>1.1</b> What does your theory say about your data?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-do-your-data-say-about-your-theory"><i class="fa fa-check"></i><b>1.2</b> What do your data say about your theory?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-do-your-parameters-say-about-other-things"><i class="fa fa-check"></i><b>1.3</b> What do your parameters say about other things?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-does-your-expertise-say-about-your-parameters"><i class="fa fa-check"></i><b>1.4</b> What does your expertise say about your parameters?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html"><i class="fa fa-check"></i><b>2</b> Getting started in <em>Stan</em></a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#installation-in-r"><i class="fa fa-check"></i><b>2.1</b> Installation in <em>R</em></a></li>
<li class="chapter" data-level="2.2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#the-anatomy-of-a-stan-program"><i class="fa fa-check"></i><b>2.2</b> The anatomy of a <em>Stan</em> program</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#data-block"><i class="fa fa-check"></i><b>2.2.1</b> Data block</a></li>
<li class="chapter" data-level="2.2.2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#transformed-data-block"><i class="fa fa-check"></i><b>2.2.2</b> Transformed data block</a></li>
<li class="chapter" data-level="2.2.3" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#parameters-block"><i class="fa fa-check"></i><b>2.2.3</b> Parameters block</a></li>
<li class="chapter" data-level="2.2.4" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#model-block"><i class="fa fa-check"></i><b>2.2.4</b> Model block</a></li>
<li class="chapter" data-level="2.2.5" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#generated-quantities-block"><i class="fa fa-check"></i><b>2.2.5</b> Generated quantities block</a></li>
<li class="chapter" data-level="2.2.6" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#the-final-product"><i class="fa fa-check"></i><b>2.2.6</b> The final product</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#estimating-a-model"><i class="fa fa-check"></i><b>2.3</b> Estimating a model</a></li>
<li class="chapter" data-level="2.4" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#looking-at-the-results"><i class="fa fa-check"></i><b>2.4</b> Looking at the results</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html"><i class="fa fa-check"></i><b>3</b> Probabilistic models of behavior</a>
<ul>
<li class="chapter" data-level="3.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#the-problem-with-deterministic-models"><i class="fa fa-check"></i><b>3.1</b> The problem with deterministic models</a></li>
<li class="chapter" data-level="3.2" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#what-is-a-probabilistic-model"><i class="fa fa-check"></i><b>3.2</b> What <em>is</em> a probabilistic model?</a></li>
<li class="chapter" data-level="3.3" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#example-dataset-and-model"><i class="fa fa-check"></i><b>3.3</b> Example dataset and model</a></li>
<li class="chapter" data-level="3.4" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#optimal-choice-plus-an-error"><i class="fa fa-check"></i><b>3.4</b> Optimal choice plus an error</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#estimating-a-model-1"><i class="fa fa-check"></i><b>3.4.1</b> Estimating a model</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#utility-based-models"><i class="fa fa-check"></i><b>3.5</b> Utility-based models</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#estimating-a-model-2"><i class="fa fa-check"></i><b>3.5.1</b> Estimating a model</a></li>
<li class="chapter" data-level="3.5.2" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#doing-something-with-the-estimates"><i class="fa fa-check"></i><b>3.5.2</b> Doing something with the estimates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="building-blocks.html"><a href="building-blocks.html"><i class="fa fa-check"></i>Building blocks</a></li>
<li class="chapter" data-level="4" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html"><i class="fa fa-check"></i><b>4</b> Representative agent and participant-specific models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#participant-specific-models"><i class="fa fa-check"></i><b>4.1</b> Participant-specific models</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#example-data-and-economic-model"><i class="fa fa-check"></i><b>4.1.1</b> Example data and economic model</a></li>
<li class="chapter" data-level="4.1.2" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#going-to-the-probabilistic-model"><i class="fa fa-check"></i><b>4.1.2</b> Going to the probabilistic model</a></li>
<li class="chapter" data-level="4.1.3" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#a-short-side-quest-into-canned-estimation-techniques"><i class="fa fa-check"></i><b>4.1.3</b> A short side quest into canned estimation techniques</a></li>
<li class="chapter" data-level="4.1.4" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#assigning-priors"><i class="fa fa-check"></i><b>4.1.4</b> Assigning priors</a></li>
<li class="chapter" data-level="4.1.5" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#estimating-the-model-for-one-participant"><i class="fa fa-check"></i><b>4.1.5</b> Estimating the model for one participant</a></li>
<li class="chapter" data-level="4.1.6" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#estimating-the-model-for-all-participants"><i class="fa fa-check"></i><b>4.1.6</b> Estimating the model for all participants</a></li>
<li class="chapter" data-level="4.1.7" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#but-we-could-be-learning-more"><i class="fa fa-check"></i><b>4.1.7</b> But we could be learning more!</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#actual-representative-agent-models-pooled-models"><i class="fa fa-check"></i><b>4.2</b> Actual representative agent models (pooled models)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="hierarchical-models.html"><a href="hierarchical-models.html"><i class="fa fa-check"></i><b>5</b> Hierarchical models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-random-sample-of-participants-walks-into-your-lab"><i class="fa fa-check"></i><b>5.1</b> A random sample of participants walks into your lab</a></li>
<li class="chapter" data-level="5.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#the-anatomy-of-a-basic-hierarchical-model"><i class="fa fa-check"></i><b>5.2</b> The anatomy of a basic hierarchical model</a></li>
<li class="chapter" data-level="5.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#accounting-for-unobserved-heterogeneity"><i class="fa fa-check"></i><b>5.3</b> Accounting for unobserved heterogeneity</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#the-last-time-you-will-integrate-the-likelihood-probably"><i class="fa fa-check"></i><b>5.3.1</b> The last time you will integrate the likelihood, probably</a></li>
<li class="chapter" data-level="5.3.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#data-augmentation"><i class="fa fa-check"></i><b>5.3.2</b> Data augmentation</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-multivariate-normal-hierarchical-model"><i class="fa fa-check"></i><b>5.4</b> A multivariate normal hierarchical model</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#decomposing-the-variance-covariance-matrix"><i class="fa fa-check"></i><b>5.4.1</b> Decomposing the variance-covariance matrix</a></li>
<li class="chapter" data-level="5.4.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#transformed-parameters-and-normal-distributions"><i class="fa fa-check"></i><b>5.4.2</b> Transformed parameters and normal distributions</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-again-with-bfs2019"><i class="fa fa-check"></i><b>5.5</b> Example: again with <span class="citation">Bruhin, Fehr, and Schunk (<span>2019</span>)</span></a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#no-correlation-between-individual-level-parameters"><i class="fa fa-check"></i><b>5.5.1</b> No correlation between individual-level parameters</a></li>
<li class="chapter" data-level="5.5.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#correlation-between-individual-level-parameters"><i class="fa fa-check"></i><b>5.5.2</b> Correlation between individual-level parameters</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mixture-models.html"><a href="mixture-models.html"><i class="fa fa-check"></i><b>6</b> Mixture models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="mixture-models.html"><a href="mixture-models.html#a-menu-of-models"><i class="fa fa-check"></i><b>6.1</b> A menu of models</a></li>
<li class="chapter" data-level="6.2" data-path="mixture-models.html"><a href="mixture-models.html#dichotomous-and-toolbox-mixture-models"><i class="fa fa-check"></i><b>6.2</b> Dichotomous and toolbox mixture models</a></li>
<li class="chapter" data-level="6.3" data-path="mixture-models.html"><a href="mixture-models.html#coding-peculearities"><i class="fa fa-check"></i><b>6.3</b> Coding peculearities</a></li>
<li class="chapter" data-level="6.4" data-path="mixture-models.html"><a href="mixture-models.html#example-experiment-av2001"><i class="fa fa-check"></i><b>6.4</b> Example experiment: <span class="citation">Andreoni and Vesterlund (<span>2001</span>)</span></a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="mixture-models.html"><a href="mixture-models.html#as-basic-as-it-gets"><i class="fa fa-check"></i><b>6.4.1</b> As basic as it gets</a></li>
<li class="chapter" data-level="6.4.2" data-path="mixture-models.html"><a href="mixture-models.html#adding-some-heterogeneity"><i class="fa fa-check"></i><b>6.4.2</b> Adding some heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="mixture-models.html"><a href="mixture-models.html#some-code-used-to-estimate-the-models"><i class="fa fa-check"></i><b>6.5</b> Some code used to estimate the models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i>Applications</a></li>
<li class="chapter" data-level="7" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html"><i class="fa fa-check"></i><b>7</b> Application: Experience-Weighted Attraction</a>
<ul>
<li class="chapter" data-level="7.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-model-at-the-individual-level"><i class="fa fa-check"></i><b>7.1</b> The model at the individual level</a></li>
<li class="chapter" data-level="7.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#some-computational-and-coding-issues"><i class="fa fa-check"></i><b>7.2</b> Some computational and coding issues</a></li>
<li class="chapter" data-level="7.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#representative-agent-models"><i class="fa fa-check"></i><b>7.3</b> Representative agent models</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#prior-calibration"><i class="fa fa-check"></i><b>7.3.1</b> Prior calibration</a></li>
<li class="chapter" data-level="7.3.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-stan-model"><i class="fa fa-check"></i><b>7.3.2</b> The <em>Stan</em> model</a></li>
<li class="chapter" data-level="7.3.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#results"><i class="fa fa-check"></i><b>7.3.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#hierarchical-model"><i class="fa fa-check"></i><b>7.4</b> Hierarchical model</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#prior-calibration-1"><i class="fa fa-check"></i><b>7.4.1</b> Prior calibration</a></li>
<li class="chapter" data-level="7.4.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-stan-model-1"><i class="fa fa-check"></i><b>7.4.2</b> The <em>Stan</em> model</a></li>
<li class="chapter" data-level="7.4.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#results-1"><i class="fa fa-check"></i><b>7.4.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#some-code-used-to-estimate-the-models-1"><i class="fa fa-check"></i><b>7.5</b> Some code used to estimate the models</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#loading-the-data"><i class="fa fa-check"></i><b>7.5.1</b> Loading the data</a></li>
<li class="chapter" data-level="7.5.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#estimating-the-representative-agent-models"><i class="fa fa-check"></i><b>7.5.2</b> Estimating the representative agent models</a></li>
<li class="chapter" data-level="7.5.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#estimating-the-hierarchical-model"><i class="fa fa-check"></i><b>7.5.3</b> Estimating the hierarchical model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html"><i class="fa fa-check"></i><b>8</b> Application: Strategy Frequency Estimation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#simplifying-the-individual-likelihood-functions"><i class="fa fa-check"></i><b>8.1</b> Simplifying the individual likelihood functions</a></li>
<li class="chapter" data-level="8.2" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#example-experiment-dbf2011"><i class="fa fa-check"></i><b>8.2</b> Example experiment: <span class="citation">Dal Bó and Fréchette (<span>2011</span>)</span></a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#the-sfem-with-homogeneous-trembles"><i class="fa fa-check"></i><b>8.2.1</b> The SFEM with homogeneous trembles</a></li>
<li class="chapter" data-level="8.2.2" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#adding-heterogeneous-trembles-and-integrating-the-likelihood"><i class="fa fa-check"></i><b>8.2.2</b> Adding heterogeneous trembles and integrating the likelihood</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#r-code-to-do-these-estimations"><i class="fa fa-check"></i><b>8.3</b> <em>R</em> code to do these estimations</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html"><i class="fa fa-check"></i><b>9</b> Computing Quantal Response Equilibrium</a>
<ul>
<li class="chapter" data-level="9.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#overview-of-quantal-response-equilibrium"><i class="fa fa-check"></i><b>9.1</b> Overview of quantal response equilibrium</a></li>
<li class="chapter" data-level="9.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#computing-quantal-response-equilibrium-1"><i class="fa fa-check"></i><b>9.2</b> Computing Quantal Response Equilibrium</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#setting-up-the-problem"><i class="fa fa-check"></i><b>9.2.1</b> Setting up the problem</a></li>
<li class="chapter" data-level="9.2.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#a-predictor-corrector-algorithm"><i class="fa fa-check"></i><b>9.2.2</b> A predictor-corrector algorithm</a></li>
<li class="chapter" data-level="9.2.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#initial-conditions"><i class="fa fa-check"></i><b>9.2.3</b> Initial conditions</a></li>
<li class="chapter" data-level="9.2.4" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#algorithm-tuning"><i class="fa fa-check"></i><b>9.2.4</b> Algorithm tuning</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#the-predictor-corrector-algorithm-in-r"><i class="fa fa-check"></i><b>9.3</b> The predictor-corrector algorithm in <em>R</em></a></li>
<li class="chapter" data-level="9.4" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#some-example-games"><i class="fa fa-check"></i><b>9.4</b> Some example games</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#generalized-matching-pennies-ochs1995"><i class="fa fa-check"></i><b>9.4.1</b> Generalized matching pennies <span class="citation">(<span>Ochs 1995</span>)</span></a></li>
<li class="chapter" data-level="9.4.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#stag-hunt"><i class="fa fa-check"></i><b>9.4.2</b> Stag hunt</a></li>
<li class="chapter" data-level="9.4.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#n-player-volunteers-dilemma-imposing-symmetric-strategies"><i class="fa fa-check"></i><b>9.4.3</b> <span class="math inline">\(n\)</span>-player Volunteer’s Dilemma imposing symmetric strategies</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><i class="fa fa-check"></i><b>10</b> Application: Quantal Response Equilibrium and the Volunteer’s Dilemma <span class="citation">(<span>Goeree, Holt, and Smith 2017</span>)</span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#solving-logit-qre-and-estimating-the-model"><i class="fa fa-check"></i><b>10.1</b> Solving logit QRE and estimating the model</a></li>
<li class="chapter" data-level="10.2" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#adding-some-heterogeneity-1"><i class="fa fa-check"></i><b>10.2</b> Adding some heterogeneity</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#computing-quantal-response-equilibrium-with-heterogeneous-parameters"><i class="fa fa-check"></i><b>10.2.1</b> Computing quantal response equilibrium with heterogeneous parameters</a></li>
<li class="chapter" data-level="10.2.2" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#warm-glow-volunteering"><i class="fa fa-check"></i><b>10.2.2</b> Warm glow volunteering</a></li>
<li class="chapter" data-level="10.2.3" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#duplicate-aversion"><i class="fa fa-check"></i><b>10.2.3</b> Duplicate aversion</a></li>
<li class="chapter" data-level="10.2.4" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#results-2"><i class="fa fa-check"></i><b>10.2.4</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#r-code-to-run-estimations"><i class="fa fa-check"></i><b>10.3</b> <em>R</em> code to run estimations</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Structural Bayesian Techniques for Experimental and Behavioral Economics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="probabilistic-models-of-behavior" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Probabilistic models of behavior<a href="probabilistic-models-of-behavior.html#probabilistic-models-of-behavior" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="the-problem-with-deterministic-models" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> The problem with deterministic models<a href="probabilistic-models-of-behavior.html#the-problem-with-deterministic-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Our economic models typically assume some kind of optimal choice. This is a great place to start, as knowing what someone <em>should</em> do in your experiment if they (say) have a particular utility function is going to make some useful predictions and hopefully provide some testable implications. That is, if our model assumes a utility function <span class="math inline">\(U(y,x;\theta)\)</span> over choices <span class="math inline">\(y\)</span>, experimental conditions <span class="math inline">\(x\)</span>, given parameters <span class="math inline">\(\theta\)</span>, then our model makes predictions like this:</p>
<p><span class="math display" id="eq:DeterministicChoice">\[
y=\arg\max_{\tilde y \in \mathbb Y}U(\tilde y ,x;\theta)
\tag{3.1}
\]</span></p>
<p>The trouble we run into with modeling behavior, though, is (at least) twofold. Firstly, it is not <em>behaviorally plausible</em> that our participants will actually do this. Our participants are usually humans, not robots, and so even if we have correctly specified <span class="math inline">\(U(y,x;\theta)\)</span>, they will make decisions with some noise. Additionally, it is somewhat heroic to assume that we have correctly specified <span class="math inline">\(U(y,x;\theta)\)</span>, and so there is likely a component of utility that is known to the participant, but not by the econometrician. That is, it is likely that participants are actually maximizing some other function <span class="math inline">\(V(y,x;\theta)\)</span>, and <span class="math inline">\(U\)</span> is just our approximation of this.</p>
<p>Secondly, as we are using a likelihood-based technique,<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> any departures in the data from what can be rationalized by the deterministic model are going to set our likelihood to zero, meaning that we cannot simulate the posterior: a model of probabilistic choice is a necessity for Bayesian estimation.</p>
</div>
<div id="what-is-a-probabilistic-model" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> What <em>is</em> a probabilistic model?<a href="probabilistic-models-of-behavior.html#what-is-a-probabilistic-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Unlike a deterministic model, which prescribes an <em>action</em> in each choice set, a probabilistic model specifies a <em>probability distribution</em> over each choice set. This means that, given an action in the choice set <span class="math inline">\(y\in\mathbb Y\)</span> taken by a participant, and parameters <span class="math inline">\(\theta\)</span> of the model, we can assign a probability (mass or density) to that action. This means we can compute a likelihood function of our data, and it also means that given parameters <span class="math inline">\(\theta\)</span>, we can <em>simulate</em> data. Being able to compute a likelihood is a necessary condition for both Bayesian and maxiumum likelihood estimation. Being able to simulate data is also crucial for evaluating our experiment designs and the estimators we apply to our data.</p>
<p>Unlike Equation <a href="probabilistic-models-of-behavior.html#eq:DeterministicChoice">(3.1)</a>, where our model’s predictions are nonrandom, instead we will specify the distribution of actions over the choice set. For example if the choice set <span class="math inline">\(\mathbb Y\)</span> is the real number line, a probabilistic model could look something like this:</p>
<p><span class="math display">\[
y\mid x,\theta\sim N(x-\theta_1,\theta^2_2)
\]</span></p>
<p>In words: “given treatment conditions <span class="math inline">\(x\)</span> and parameters <span class="math inline">\(\theta\)</span>, <span class="math inline">\(y\)</span> is normally distributed with mean <span class="math inline">\(x-\theta_1\)</span> and standard deviation <span class="math inline">\(\theta_2\)</span>.”</p>
<p>An alternative way of writing this down would be to use a probability density function:</p>
<p><span class="math display">\[
p(y\mid x,\theta)=\frac{1}{\sqrt{2\pi\theta_2^2}}\exp\left(-\frac{1}{2\theta_2^2}(y-x+\theta_1)^2\right)
\]</span></p>
<p>For another example if the choice set is binary <span class="math inline">\(\mathbb Y=\{0,1\}\)</span>, instead of our model specifying either action <span class="math inline">\(y=0\)</span> or <span class="math inline">\(y=0\)</span>, we specify the probability that each of these actions are taken. A probabilistic model in this case could look something like this:</p>
<p><span class="math display">\[
y\mid x,\theta \sim \mathrm{Bernoulli}\left(\Phi(x-\theta)\right)
\]</span></p>
<p>where <span class="math inline">\(\Phi(\cdot)\)</span> is the standard normal cumulative density function. An alternative way of writing the same thing is to use the probability mass function:</p>
<p><span class="math display">\[
p(y\mid x,\theta)=
\begin{cases}
\Phi(x-\theta)&amp;\text{if }y=1\\
1-\Phi(x-\theta)&amp;\text{if }y=0\\
0&amp;\text{otherwise}
\end{cases}
\]</span></p>
<p>Fortunately for us, <em>Stan</em> is geared towards coding up models exactly like this. Once we have our probabilistic model written down, it is fairly straightforward to translate this into <em>Stan</em> code. That is, for this binary choice example, we could tell <em>Stan</em> that <span class="math inline">\(y\)</span> is distributed according to the Bernoulli distribution as follows:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb27-1"><a href="probabilistic-models-of-behavior.html#cb27-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">~</span> bernoulli<span class="op">(</span>Phi<span class="op">(</span>x<span class="op">-</span>theta<span class="op">));</span></span></code></pre></div>
<p>Alternatively, we can provide the same information to <em>Stan</em> by incrementing the likelihood. Here <em>Stan</em> actually deals with <em>log</em> densities, so we tell it to add the log-probability to its <code>target</code> variable:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb28-1"><a href="probabilistic-models-of-behavior.html#cb28-1" aria-hidden="true" tabindex="-1"></a>target <span class="op">+=</span> y <span class="op">.*</span> log<span class="op">(</span>Phi<span class="op">(</span>x<span class="op">-</span>theta<span class="op">))</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1.0</span><span class="op">-</span>y<span class="op">)</span> <span class="op">.*</span> log<span class="op">(</span><span class="fl">1.0</span><span class="op">-</span>Phi<span class="op">(</span>x<span class="op">-</span>theta<span class="op">));</span></span></code></pre></div>
</div>
<div id="example-dataset-and-model" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Example dataset and model<a href="probabilistic-models-of-behavior.html#example-dataset-and-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For this chapter, I will use data from Part 1 of <span class="citation">Halevy, Persitz, and Zrill (<a href="#ref-Halevy2018" role="doc-biblioref">2018</a>)</span>. In this task, participants were given a budget of tokens to allocate between two assets. Each asset paid out in mutually exclusive states, which were equally likely to occur. We can see the budget sets presented to each participant in Figure <a href="probabilistic-models-of-behavior.html#fig:HPZ2018">3.1</a>. The dots in this Figure show the choices made by the first participant in the dataset, which is coded as <code>Subject=202</code>. I will use just the data from this participant for examples in this chapter.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="probabilistic-models-of-behavior.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb29-2"><a href="probabilistic-models-of-behavior.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb29-3"><a href="probabilistic-models-of-behavior.html#cb29-3" aria-hidden="true" tabindex="-1"></a>D<span class="ot">&lt;-</span><span class="fu">read_excel</span>(<span class="st">&quot;Data/Halevy et al (2016) - Data.xlsx&quot;</span>,<span class="at">sheet=</span><span class="st">&quot;Budgetline Choices&quot;</span>)</span>
<span id="cb29-4"><a href="probabilistic-models-of-behavior.html#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="probabilistic-models-of-behavior.html#cb29-5" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span>D <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Subject<span class="sc">==</span><span class="dv">201</span>)</span>
<span id="cb29-6"><a href="probabilistic-models-of-behavior.html#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="probabilistic-models-of-behavior.html#cb29-7" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb29-8"><a href="probabilistic-models-of-behavior.html#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d)</span>
<span id="cb29-9"><a href="probabilistic-models-of-behavior.html#cb29-9" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">slope=</span><span class="sc">-</span><span class="st">`</span><span class="at">Y-intercept</span><span class="st">`</span><span class="sc">/</span><span class="st">`</span><span class="at">X-intercept</span><span class="st">`</span>,<span class="at">intercept =</span> <span class="st">`</span><span class="at">Y-intercept</span><span class="st">`</span>))</span>
<span id="cb29-10"><a href="probabilistic-models-of-behavior.html#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>X,<span class="at">y=</span>Y))</span>
<span id="cb29-11"><a href="probabilistic-models-of-behavior.html#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()<span class="sc">+</span><span class="fu">coord_fixed</span>()</span>
<span id="cb29-12"><a href="probabilistic-models-of-behavior.html#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(d<span class="sc">$</span><span class="st">`</span><span class="at">X-intercept</span><span class="st">`</span>)))<span class="sc">+</span><span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="fu">max</span>(d<span class="sc">$</span><span class="st">`</span><span class="at">Y-intercept</span><span class="st">`</span>)))</span>
<span id="cb29-13"><a href="probabilistic-models-of-behavior.html#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;Prize if state 1 occurs (x)&quot;</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Prize if state 2 occurs (y)&quot;</span>)</span>
<span id="cb29-14"><a href="probabilistic-models-of-behavior.html#cb29-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:HPZ2018"></span>
<img src="index_files/figure-html/HPZ2018-1.png" alt="Budget sets and choices of one participant in @Halevy2018" width="672" />
<p class="caption">
Figure 3.1: Budget sets and choices of one participant in <span class="citation">Halevy, Persitz, and Zrill (<a href="#ref-Halevy2018" role="doc-biblioref">2018</a>)</span>
</p>
</div>
<p>Each budget set is characterized in th data by the <span class="math inline">\(y\)</span>- and <span class="math inline">\(x\)</span>-intercepts of the budget line, so if we denote these as <span class="math inline">\(\bar y_t\)</span> and <span class="math inline">\(\bar x_t\)</span> respectively for budget set <span class="math inline">\(t\)</span>, then we can write the budget as:</p>
<p><span class="math display">\[
\begin{aligned}
y&amp;=\bar y_t-x\frac{\bar y_t}{\bar x_t}
\end{aligned}
\]</span></p>
<p>Let’s suppose each participant is an expected utility maximizer with a constant relative risk aversion utility function over certain amounts of money:</p>
<p><span class="math display">\[
u_i(x)=\frac{x^{1-r}}{1-r}
\]</span></p>
<p>Then the participant’s utility maximization problem is:</p>
<p><span class="math display">\[
\begin{aligned}
\max_{x,y\geq 0}\left\{0.5\frac{x^{1-r}}{1-r}+0.5\frac{y^{1-r}}{1-r}\right\}\quad \text{s.t.: } y=\bar y_t-x\frac{\bar y_t}{\bar x_t}
\end{aligned}
\]</span></p>
<p>We can set up a Lagrangian to solve for the optimal portfolio choice (again, forgive me, I like to show my working):</p>
<p><span class="math display">\[
\begin{aligned}
\mathcal L&amp;=0.5\frac{x^{1-r}}{1-r}+0.5\frac{y^{1-r}}{1-r} - \gamma\left(y_t-x\frac{\bar y_t}{\bar x_t}-y\right)\\
~\\
0&amp;=0.5x^{-r}+\gamma\frac{\bar y_t}{\bar x_t}\\
0&amp;=0.5 y^{-r}+\gamma\\
~\\
-2\gamma&amp;=x^{-r}\frac{\bar x_t}{\bar y_t}=y^{-r}\\
\left(\frac yx\right)^{-r}&amp;=\frac{\bar x_t}{\bar y_t}\\
\frac{y}{x}&amp;=\left(\frac{\bar y_t}{\bar x_t}\right)^{\frac{1}{r}}
\end{aligned}
\]</span></p>
<p>Substituting this into the budget constraint yields:</p>
<p><span class="math display">\[
\begin{aligned}
x\left(\frac{\bar y_t}{\bar x_t}\right)^{\frac{1}{r}}&amp;=\bar y_t-x\frac{\bar y_t}{\bar x_t}\\
x\left(\left(\frac{\bar y_t}{\bar x_t}\right)^{\frac{1}{r}}+\frac{\bar y_t}{\bar x_t}\right)&amp;=\bar y_t\\
x&amp;=\frac{\bar y_t}{\left(\frac{\bar y_t}{\bar x_t}\right)^{\frac{1}{r}}+\frac{\bar y_t}{\bar x_t}}\\
y&amp;=\frac{\bar y_t\left(\frac{\bar y_t}{\bar x_t}\right)^{\frac{1}{r}}}{\left(\frac{\bar y_t}{\bar x_t}\right)^{\frac{1}{r}}+\frac{\bar y_t}{\bar x_t}}
\end{aligned}
\]</span></p>
<p>So our deterministic model of behavior is:</p>
<p><span class="math display">\[
\begin{aligned}
x^*(\bar x_t,\bar y_t)&amp;=\frac{\bar y_t}{\left(\frac{\bar y_t}{\bar x_t}\right)^{\frac{1}{r}}+\frac{\bar y_t}{\bar x_t}}\\
y^*(\bar x_t,\bar y_t)&amp;=\frac{\bar y_t\left(\frac{\bar y_t}{\bar x_t}\right)^{\frac{1}{r}}}{\left(\frac{\bar y_t}{\bar x_t}\right)^{\frac{1}{r}}+\frac{\bar y_t}{\bar x_t}}
\end{aligned}
\]</span></p>
</div>
<div id="optimal-choice-plus-an-error" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Optimal choice plus an error<a href="probabilistic-models-of-behavior.html#optimal-choice-plus-an-error" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One common approach to turning a deterministic model into a probabilistic model, especially in these convex budget set experiments, is to add a mean-zero error term to these deterministic predictions. That is, <em>on average</em> the participant chooses <span class="math inline">\((x^*,y^*)\)</span>, but then each decision is implemented with an error. A simple specification for this is to assume that the error term is normally distributed:</p>
<p><span class="math display">\[
x\mid x^*\sim N(x^*,\sigma^2)
\]</span></p>
<p>If we were using Frequentist techniques, this is where we might go ahead and estimate the model using nonlinear least squares, as is done in <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span>, <span class="citation">Andreoni and Miller (<a href="#ref-Andreoni2002" role="doc-biblioref">2002</a>)</span>, and for one of the estimators under consideration in <span class="citation">Halevy, Persitz, and Zrill (<a href="#ref-Halevy2018" role="doc-biblioref">2018</a>)</span>. For the Bayesian application, and for the maximum likelihood application for that matter, we need to be careful about a few things here.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<p>Firstly, the choice of whether to use <span class="math inline">\(x\)</span> or <span class="math inline">\(y\)</span> as our dependent variable is not inconsequential. To see this, note that since most of the lines in Figure <a href="probabilistic-models-of-behavior.html#fig:HPZ2018">3.1</a> do not have a slope of negative one, the probabilistic predictions will be different between these two specifications. That is, if we choose <span class="math inline">\(x\)</span> as our explanatory variable, then it must be that:</p>
<p><span class="math display">\[
y\mid y^*\sim N\left(y^*,\left(\frac{\bar y_t}{\bar x_t}\right)^2\sigma^2\right)
\]</span></p>
<p>So the variance of <span class="math inline">\(y\)</span> is not the same as the variance of <span class="math inline">\(x\)</span>. Perhaps more alarmingly, the variance of <span class="math inline">\(y\)</span> is a function of the slope of the budget set, but the variance of <span class="math inline">\(x\)</span> is constant, so choices of <span class="math inline">\(y\)</span> will be more or less precise as these budget lines shift. Thus, homoskedasticity in <em>x</em> implies heteroskedastcity in <em>y</em>. This specification therefore suffers from a <em>labeling problem</em>, and we will likely end up with different estimates depending on whether we choose <span class="math inline">\(x\)</span> or <span class="math inline">\(y\)</span> as our explanatory variable.</p>
<p>Another modeling issue to consider is whether the distribution <span class="math inline">\(x\mid x^*\)</span> is <em>truncated</em> or <em>censored</em> at the endpoints of the choice set. For example, what happens to our prediction if <span class="math inline">\(x^*=3\)</span> but our error term implies that <span class="math inline">\(x=-5\)</span>? Such a realization is possible with a normal distribution, but it is a choice that the experiment would have prevented the participant from choosing. For example, let’s simulate some draws assuming <span class="math inline">\(x\sim N(1,2)\)</span>, and consider the implications of getting some draws with <span class="math inline">\(x&lt;0\)</span>, which the experiment would not allow a participant to choose:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="probabilistic-models-of-behavior.html#cb30-1" aria-hidden="true" tabindex="-1"></a>dx <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x=</span><span class="fu">rnorm</span>(<span class="dv">10000</span>,<span class="at">mean=</span><span class="dv">1</span>,<span class="at">sd=</span><span class="fu">sqrt</span>(<span class="dv">2</span>)))</span>
<span id="cb30-2"><a href="probabilistic-models-of-behavior.html#cb30-2" aria-hidden="true" tabindex="-1"></a>dsim<span class="ot">&lt;-</span><span class="fu">rbind</span>(</span>
<span id="cb30-3"><a href="probabilistic-models-of-behavior.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  dx <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;Normal&quot;</span>),</span>
<span id="cb30-4"><a href="probabilistic-models-of-behavior.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  dx <span class="sc">%&gt;%</span> <span class="fu">filter</span>(x<span class="sc">&gt;=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type=</span><span class="st">&quot;truncated&quot;</span>),</span>
<span id="cb30-5"><a href="probabilistic-models-of-behavior.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  dx <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">x=</span><span class="fu">ifelse</span>(x<span class="sc">&lt;</span><span class="dv">0</span>,<span class="dv">0</span>,x)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type=</span><span class="st">&quot;censored&quot;</span>)</span>
<span id="cb30-6"><a href="probabilistic-models-of-behavior.html#cb30-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-7"><a href="probabilistic-models-of-behavior.html#cb30-7" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb30-8"><a href="probabilistic-models-of-behavior.html#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(dsim,<span class="fu">aes</span>(<span class="at">x=</span>x))</span>
<span id="cb30-9"><a href="probabilistic-models-of-behavior.html#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_histogram</span>()</span>
<span id="cb30-10"><a href="probabilistic-models-of-behavior.html#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>type)</span>
<span id="cb30-11"><a href="probabilistic-models-of-behavior.html#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb30-12"><a href="probabilistic-models-of-behavior.html#cb30-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:censorTruncated"></span>
<img src="index_files/figure-html/censorTruncated-1.png" alt="Examples of censored and truncated data." width="672" />
<p class="caption">
Figure 3.2: Examples of censored and truncated data.
</p>
</div>
<p>Figure <a href="probabilistic-models-of-behavior.html#fig:censorTruncated">3.2</a> illustrates the difference between censoring and truncation. Firstly, the un-censored, un-truncated simulated data is shown in the middle panel. Clearly these could not be choices from a convex budget set problem, because the participant would sometimes choose a negative amount of <span class="math inline">\(x\)</span>. The left panel shows what happens when the data are censored at zero. All observations with <span class="math inline">\(x&lt;0\)</span> are coded as <span class="math inline">\(x=0\)</span>, and we can see that this is happening because there is a spike in the distribution at <span class="math inline">\(x=0\)</span>. Truncation, on the other hand, is shown in the rightmost panel. Here we see no spike because instead of coding all negative numbers as zeros, they are simply thrown out. The choice of which specification to go with here should be specific to the application. For example, in experiments investigating other-regarding preferences such as <span class="citation">Andreoni and Vesterlund (<a href="#ref-AV2001" role="doc-biblioref">2001</a>)</span> and <span class="citation">Andreoni and Miller (<a href="#ref-Andreoni2002" role="doc-biblioref">2002</a>)</span>, it is likely that there will be a substantial fraction of selfish participants who pass no money to their partner. In this case a spike of data at zero makes a lot of sense. For the <span class="citation">Halevy, Persitz, and Zrill (<a href="#ref-Halevy2018" role="doc-biblioref">2018</a>)</span> experiment, on this other hand, choosing <span class="math inline">\(x=0\)</span> means that the participant wants to earn nothing in one of the two, equally likely, states of the world. This seemed unlikely to me, but we can look at the data to see how uncommon this is:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="probabilistic-models-of-behavior.html#cb31-1" aria-hidden="true" tabindex="-1"></a>tab<span class="ot">&lt;-</span>(D</span>
<span id="cb31-2"><a href="probabilistic-models-of-behavior.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|&gt;</span> <span class="fu">group_by</span>(<span class="st">`</span><span class="at">X-intercept</span><span class="st">`</span>,<span class="st">`</span><span class="at">Y-intercept</span><span class="st">`</span>)</span>
<span id="cb31-3"><a href="probabilistic-models-of-behavior.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="st">`</span><span class="at">fraction choosing zero</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(X<span class="sc">==</span><span class="dv">0</span> <span class="sc">|</span> Y<span class="sc">==</span><span class="dv">0</span>))</span>
<span id="cb31-4"><a href="probabilistic-models-of-behavior.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-5"><a href="probabilistic-models-of-behavior.html#cb31-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-6"><a href="probabilistic-models-of-behavior.html#cb31-6" aria-hidden="true" tabindex="-1"></a>tab<span class="sc">|&gt;</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">caption=</span><span class="st">&quot;Fraction of participants choosing either $x=0$ or $y=0$ in each of the 22 budget sets in @Halevy2018.&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:probModFrac0">Table 3.1: </span>Fraction of participants choosing either <span class="math inline">\(x=0\)</span> or <span class="math inline">\(y=0\)</span> in each of the 22 budget sets in <span class="citation">Halevy, Persitz, and Zrill (<a href="#ref-Halevy2018" role="doc-biblioref">2018</a>)</span>.</caption>
<thead>
<tr class="header">
<th align="right">X-intercept</th>
<th align="right">Y-intercept</th>
<th align="right">fraction choosing zero</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">20.00</td>
<td align="right">80.00</td>
<td align="right">0.2898551</td>
</tr>
<tr class="even">
<td align="right">25.00</td>
<td align="right">100.00</td>
<td align="right">0.3285024</td>
</tr>
<tr class="odd">
<td align="right">27.94</td>
<td align="right">80.00</td>
<td align="right">0.2463768</td>
</tr>
<tr class="even">
<td align="right">34.92</td>
<td align="right">100.00</td>
<td align="right">0.3043478</td>
</tr>
<tr class="odd">
<td align="right">39.03</td>
<td align="right">80.00</td>
<td align="right">0.1739130</td>
</tr>
<tr class="even">
<td align="right">48.79</td>
<td align="right">100.00</td>
<td align="right">0.2222222</td>
</tr>
<tr class="odd">
<td align="right">50.45</td>
<td align="right">74.00</td>
<td align="right">0.0821256</td>
</tr>
<tr class="even">
<td align="right">58.50</td>
<td align="right">61.57</td>
<td align="right">0.0144928</td>
</tr>
<tr class="odd">
<td align="right">60.00</td>
<td align="right">60.00</td>
<td align="right">0.0193237</td>
</tr>
<tr class="even">
<td align="right">61.57</td>
<td align="right">58.50</td>
<td align="right">0.0193237</td>
</tr>
<tr class="odd">
<td align="right">67.26</td>
<td align="right">98.67</td>
<td align="right">0.1159420</td>
</tr>
<tr class="even">
<td align="right">74.00</td>
<td align="right">50.45</td>
<td align="right">0.0869565</td>
</tr>
<tr class="odd">
<td align="right">78.00</td>
<td align="right">82.10</td>
<td align="right">0.0193237</td>
</tr>
<tr class="even">
<td align="right">80.00</td>
<td align="right">20.00</td>
<td align="right">0.2995169</td>
</tr>
<tr class="odd">
<td align="right">80.00</td>
<td align="right">27.94</td>
<td align="right">0.2318841</td>
</tr>
<tr class="even">
<td align="right">80.00</td>
<td align="right">39.03</td>
<td align="right">0.1739130</td>
</tr>
<tr class="odd">
<td align="right">80.00</td>
<td align="right">80.00</td>
<td align="right">0.0144928</td>
</tr>
<tr class="even">
<td align="right">82.10</td>
<td align="right">78.00</td>
<td align="right">0.0241546</td>
</tr>
<tr class="odd">
<td align="right">98.67</td>
<td align="right">67.26</td>
<td align="right">0.1062802</td>
</tr>
<tr class="even">
<td align="right">100.00</td>
<td align="right">25.00</td>
<td align="right">0.2946860</td>
</tr>
<tr class="odd">
<td align="right">100.00</td>
<td align="right">34.92</td>
<td align="right">0.2415459</td>
</tr>
<tr class="even">
<td align="right">100.00</td>
<td align="right">48.79</td>
<td align="right">0.1932367</td>
</tr>
</tbody>
</table>
<p>Table <a href="probabilistic-models-of-behavior.html#tab:probModFrac0">3.1</a> proves me wrong! There are in fact a substantial minority of participants in some budgets sets who choose zero. I will take this onboard with the modeling presented below.<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a> In particular, I will implement the censoring specification, rather than the truncation specification.</p>
<div id="estimating-a-model-1" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Estimating a model<a href="probabilistic-models-of-behavior.html#estimating-a-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For the purposes of this example, I will make some simplifying assumptions. These are mainly to speed up computation. <span class="citation">Halevy, Persitz, and Zrill (<a href="#ref-Halevy2018" role="doc-biblioref">2018</a>)</span> allow their participants to choose in increments of 0.2 tokens, so if I was being truly faithful to the data-generating process, I would be modeling the choice set as a grid with resolution 0.2. In the interest of making the task less strenuous for my laptop, I normalize the budget sets by dividing by the <span class="math inline">\(x\)</span> intercept, so the choice of <span class="math inline">\(x\)</span> must be on the unit interval. I then round the normalized <span class="math inline">\(x\)</span> choices to the nearest 0.05 units.<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a> The information I will pass to <em>Stan</em> will be the normalized <span class="math inline">\(y\)</span>-intercept, and the range that the normalized choice fell into:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="probabilistic-models-of-behavior.html#cb32-1" aria-hidden="true" tabindex="-1"></a>gridsize<span class="ot">&lt;-</span><span class="fl">0.05</span></span>
<span id="cb32-2"><a href="probabilistic-models-of-behavior.html#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="probabilistic-models-of-behavior.html#cb32-3" aria-hidden="true" tabindex="-1"></a>d<span class="ot">&lt;-</span>(</span>
<span id="cb32-4"><a href="probabilistic-models-of-behavior.html#cb32-4" aria-hidden="true" tabindex="-1"></a>  d</span>
<span id="cb32-5"><a href="probabilistic-models-of-behavior.html#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">x=</span> X<span class="sc">/</span><span class="st">`</span><span class="at">X-intercept</span><span class="st">`</span>,</span>
<span id="cb32-6"><a href="probabilistic-models-of-behavior.html#cb32-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">yint =</span> <span class="st">`</span><span class="at">Y-intercept</span><span class="st">`</span><span class="sc">/</span><span class="st">`</span><span class="at">X-intercept</span><span class="st">`</span>,</span>
<span id="cb32-7"><a href="probabilistic-models-of-behavior.html#cb32-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">xgrid =</span> <span class="fu">floor</span>(x<span class="sc">/</span>gridsize),</span>
<span id="cb32-8"><a href="probabilistic-models-of-behavior.html#cb32-8" aria-hidden="true" tabindex="-1"></a>            <span class="co"># lower and upper bounds for the censored data</span></span>
<span id="cb32-9"><a href="probabilistic-models-of-behavior.html#cb32-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">xlb =</span> xgrid<span class="sc">*</span>gridsize,</span>
<span id="cb32-10"><a href="probabilistic-models-of-behavior.html#cb32-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">xub =</span> (xgrid<span class="sc">+</span><span class="dv">1</span>)<span class="sc">*</span>gridsize,</span>
<span id="cb32-11"><a href="probabilistic-models-of-behavior.html#cb32-11" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb32-12"><a href="probabilistic-models-of-behavior.html#cb32-12" aria-hidden="true" tabindex="-1"></a>            <span class="co"># This ensures that the lower and upper bounds at the endpoints of</span></span>
<span id="cb32-13"><a href="probabilistic-models-of-behavior.html#cb32-13" aria-hidden="true" tabindex="-1"></a>            <span class="co"># the grid are (-999,0.05) and (0.95,999)</span></span>
<span id="cb32-14"><a href="probabilistic-models-of-behavior.html#cb32-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">xlb =</span> <span class="fu">ifelse</span>(x<span class="sc">==</span><span class="dv">0</span>,<span class="sc">-</span><span class="dv">999</span>,xlb),</span>
<span id="cb32-15"><a href="probabilistic-models-of-behavior.html#cb32-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">xlb =</span> <span class="fu">ifelse</span>(x<span class="sc">==</span><span class="dv">1</span>,<span class="dv">1</span><span class="sc">-</span>gridsize,xlb),</span>
<span id="cb32-16"><a href="probabilistic-models-of-behavior.html#cb32-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">xub =</span> <span class="fu">ifelse</span>(x<span class="sc">==</span><span class="dv">1</span>,<span class="dv">999</span>,xub)</span>
<span id="cb32-17"><a href="probabilistic-models-of-behavior.html#cb32-17" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb32-18"><a href="probabilistic-models-of-behavior.html#cb32-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb32-19"><a href="probabilistic-models-of-behavior.html#cb32-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>That is, if a participant chose, say, a (normalized) <span class="math inline">\(x=0.23\)</span>, I will use the information that <span class="math inline">\(0.20&lt;x&lt;0.25\)</span>. That is, <code>xlb=0.20</code> and <code>xub=0.25</code> The probability of a choice <span class="math inline">\(x\)</span> being in this region <span class="math inline">\((x_{lb},x_{ub})\)</span> is then:</p>
<p><span class="math display">\[
\Pr\left(x_{lb}&lt;x&lt;x_{ub}\right)=\Phi\left(\frac{x_{ub}-x^*}{\sigma}\right)-\Phi\left(\frac{x_{lb}-x^*}{\sigma}\right)
\]</span></p>
<p>where <span class="math inline">\(\Phi(\cdot)\)</span> is the standard normal cumulative density function. For decisions that were at the endpoints of the choice set, I set <span class="math inline">\(x_{lb}=-999\)</span> if <span class="math inline">\(x=0\)</span>, and <span class="math inline">\(x_{ub}=999\)</span> if <span class="math inline">\(x=1\)</span>.</p>
<p>Here is the <em>Stan</em> file I use:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb33-1"><a href="probabilistic-models-of-behavior.html#cb33-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-2"><a href="probabilistic-models-of-behavior.html#cb33-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb33-3"><a href="probabilistic-models-of-behavior.html#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> n<span class="op">;</span> <span class="co">// number of observations</span></span>
<span id="cb33-4"><a href="probabilistic-models-of-behavior.html#cb33-4" aria-hidden="true" tabindex="-1"></a>  real xlb<span class="op">[</span>n<span class="op">];</span> <span class="co">// lower bound for x choice</span></span>
<span id="cb33-5"><a href="probabilistic-models-of-behavior.html#cb33-5" aria-hidden="true" tabindex="-1"></a>  real xub<span class="op">[</span>n<span class="op">];</span> <span class="co">// upper bound for x choice</span></span>
<span id="cb33-6"><a href="probabilistic-models-of-behavior.html#cb33-6" aria-hidden="true" tabindex="-1"></a>  real yint<span class="op">[</span>n<span class="op">];</span> <span class="co">// y intercept</span></span>
<span id="cb33-7"><a href="probabilistic-models-of-behavior.html#cb33-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-8"><a href="probabilistic-models-of-behavior.html#cb33-8" aria-hidden="true" tabindex="-1"></a>  real prior_r<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb33-9"><a href="probabilistic-models-of-behavior.html#cb33-9" aria-hidden="true" tabindex="-1"></a>  real prior_sigma<span class="op">;</span></span>
<span id="cb33-10"><a href="probabilistic-models-of-behavior.html#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb33-11"><a href="probabilistic-models-of-behavior.html#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="probabilistic-models-of-behavior.html#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="probabilistic-models-of-behavior.html#cb33-13" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb33-14"><a href="probabilistic-models-of-behavior.html#cb33-14" aria-hidden="true" tabindex="-1"></a>  real r<span class="op">;</span></span>
<span id="cb33-15"><a href="probabilistic-models-of-behavior.html#cb33-15" aria-hidden="true" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> sigma<span class="op">;</span></span>
<span id="cb33-16"><a href="probabilistic-models-of-behavior.html#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb33-17"><a href="probabilistic-models-of-behavior.html#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="probabilistic-models-of-behavior.html#cb33-18" aria-hidden="true" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb33-19"><a href="probabilistic-models-of-behavior.html#cb33-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-20"><a href="probabilistic-models-of-behavior.html#cb33-20" aria-hidden="true" tabindex="-1"></a>  real xstar<span class="op">[</span>n<span class="op">];</span></span>
<span id="cb33-21"><a href="probabilistic-models-of-behavior.html#cb33-21" aria-hidden="true" tabindex="-1"></a>  real px<span class="op">[</span>n<span class="op">];</span></span>
<span id="cb33-22"><a href="probabilistic-models-of-behavior.html#cb33-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-23"><a href="probabilistic-models-of-behavior.html#cb33-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-24"><a href="probabilistic-models-of-behavior.html#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">// optimal choice given r</span></span>
<span id="cb33-25"><a href="probabilistic-models-of-behavior.html#cb33-25" aria-hidden="true" tabindex="-1"></a>    xstar<span class="op">[</span>ii<span class="op">]</span> <span class="op">=</span> yint<span class="op">[</span>ii<span class="op">]/</span> <span class="op">(</span>pow<span class="op">(</span>yint<span class="op">[</span>ii<span class="op">],</span><span class="fl">1.0</span><span class="op">/</span>r<span class="op">)+</span>yint<span class="op">[</span>ii<span class="op">]);</span></span>
<span id="cb33-26"><a href="probabilistic-models-of-behavior.html#cb33-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">// probability of the optimal choice + error landing where it did</span></span>
<span id="cb33-27"><a href="probabilistic-models-of-behavior.html#cb33-27" aria-hidden="true" tabindex="-1"></a>    px<span class="op">[</span>ii<span class="op">]</span> <span class="op">=</span> normal_cdf<span class="op">(</span>xub<span class="op">[</span>ii<span class="op">],</span>xstar<span class="op">[</span>ii<span class="op">],</span>sigma<span class="op">)-</span>normal_cdf<span class="op">(</span>xlb<span class="op">[</span>ii<span class="op">],</span>xstar<span class="op">[</span>ii<span class="op">],</span>sigma<span class="op">);</span></span>
<span id="cb33-28"><a href="probabilistic-models-of-behavior.html#cb33-28" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb33-29"><a href="probabilistic-models-of-behavior.html#cb33-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-30"><a href="probabilistic-models-of-behavior.html#cb33-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-31"><a href="probabilistic-models-of-behavior.html#cb33-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">// increment the likelihood</span></span>
<span id="cb33-32"><a href="probabilistic-models-of-behavior.html#cb33-32" aria-hidden="true" tabindex="-1"></a>  target <span class="op">+=</span>log<span class="op">(</span>px<span class="op">);</span></span>
<span id="cb33-33"><a href="probabilistic-models-of-behavior.html#cb33-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-34"><a href="probabilistic-models-of-behavior.html#cb33-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb33-35"><a href="probabilistic-models-of-behavior.html#cb33-35" aria-hidden="true" tabindex="-1"></a>  r <span class="op">~</span> normal<span class="op">(</span>prior_r<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_r<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb33-36"><a href="probabilistic-models-of-behavior.html#cb33-36" aria-hidden="true" tabindex="-1"></a>  sigma <span class="op">~</span> cauchy<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>prior_sigma<span class="op">);</span></span>
<span id="cb33-37"><a href="probabilistic-models-of-behavior.html#cb33-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-38"><a href="probabilistic-models-of-behavior.html#cb33-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-39"><a href="probabilistic-models-of-behavior.html#cb33-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Here’s how we estimate it for the one participant:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="probabilistic-models-of-behavior.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb34-2"><a href="probabilistic-models-of-behavior.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-3"><a href="probabilistic-models-of-behavior.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb34-4"><a href="probabilistic-models-of-behavior.html#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="probabilistic-models-of-behavior.html#cb34-5" aria-hidden="true" tabindex="-1"></a>dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb34-6"><a href="probabilistic-models-of-behavior.html#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">dim</span>(d)[<span class="dv">1</span>],</span>
<span id="cb34-7"><a href="probabilistic-models-of-behavior.html#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlb =</span> d<span class="sc">$</span>xlb,</span>
<span id="cb34-8"><a href="probabilistic-models-of-behavior.html#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">xub =</span> d<span class="sc">$</span>xub,</span>
<span id="cb34-9"><a href="probabilistic-models-of-behavior.html#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">yint =</span> d<span class="sc">$</span>yint,</span>
<span id="cb34-10"><a href="probabilistic-models-of-behavior.html#cb34-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-11"><a href="probabilistic-models-of-behavior.html#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_r =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.25</span>),</span>
<span id="cb34-12"><a href="probabilistic-models-of-behavior.html#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_sigma =</span> <span class="fl">0.008</span></span>
<span id="cb34-13"><a href="probabilistic-models-of-behavior.html#cb34-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-14"><a href="probabilistic-models-of-behavior.html#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="probabilistic-models-of-behavior.html#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">&quot;Outputs/ProbabilisticModels/ProbMods_HPZ2018_normal.rds&quot;</span>)) {</span>
<span id="cb34-16"><a href="probabilistic-models-of-behavior.html#cb34-16" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">stan</span>(<span class="st">&quot;Code/ProbabilisticModels/ProbMods_HPZ2018_normal.stan&quot;</span>,</span>
<span id="cb34-17"><a href="probabilistic-models-of-behavior.html#cb34-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb34-18"><a href="probabilistic-models-of-behavior.html#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save the fitted model results</span></span>
<span id="cb34-19"><a href="probabilistic-models-of-behavior.html#cb34-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(Fit,<span class="at">file =</span> <span class="st">&quot;Outputs/ProbabilisticModels/ProbMods_HPZ2018_normal.rds&quot;</span>)</span>
<span id="cb34-20"><a href="probabilistic-models-of-behavior.html#cb34-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-21"><a href="probabilistic-models-of-behavior.html#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co"># load the fitted model results</span></span>
<span id="cb34-22"><a href="probabilistic-models-of-behavior.html#cb34-22" aria-hidden="true" tabindex="-1"></a>FitNormal<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">&quot;Outputs/ProbabilisticModels/ProbMods_HPZ2018_normal.rds&quot;</span>)</span>
<span id="cb34-23"><a href="probabilistic-models-of-behavior.html#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="probabilistic-models-of-behavior.html#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="probabilistic-models-of-behavior.html#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(FitNormal)<span class="sc">$</span>summary <span class="sc">|&gt;</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">caption=</span><span class="st">&quot;Posterior estimates  of the &#39;optimal choice plus error&#39; model.&quot;</span>)</span></code></pre></div>
<table style="width:100%;">
<caption><span id="tab:ProbModNormal">Table 3.2: </span>Posterior estimates of the ‘optimal choice plus error’ model.</caption>
<colgroup>
<col width="5%" />
<col width="10%" />
<col width="8%" />
<col width="8%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="7%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">se_mean</th>
<th align="right">sd</th>
<th align="right">2.5%</th>
<th align="right">25%</th>
<th align="right">50%</th>
<th align="right">75%</th>
<th align="right">97.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">r</td>
<td align="right">0.6356843</td>
<td align="right">0.0016724</td>
<td align="right">0.0740045</td>
<td align="right">0.5014449</td>
<td align="right">0.5854661</td>
<td align="right">0.6313009</td>
<td align="right">0.6819358</td>
<td align="right">0.7911945</td>
<td align="right">1958.047</td>
<td align="right">1.001512</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">0.1429142</td>
<td align="right">0.0004520</td>
<td align="right">0.0226142</td>
<td align="right">0.1066118</td>
<td align="right">0.1265328</td>
<td align="right">0.1403869</td>
<td align="right">0.1564103</td>
<td align="right">0.1948155</td>
<td align="right">2503.575</td>
<td align="right">0.999256</td>
</tr>
<tr class="odd">
<td align="left">lp__</td>
<td align="right">-62.5379703</td>
<td align="right">0.0278744</td>
<td align="right">1.0820914</td>
<td align="right">-65.2606211</td>
<td align="right">-62.9812424</td>
<td align="right">-62.2161067</td>
<td align="right">-61.7512873</td>
<td align="right">-61.4540023</td>
<td align="right">1507.011</td>
<td align="right">1.001079</td>
</tr>
</tbody>
</table>
<p>The estimates in Table <a href="probabilistic-models-of-behavior.html#tab:ProbModNormal">3.2</a> seem plausible based on what we know about participants in economic experiments. <span class="math inline">\(r\approx 0.63\)</span> is right in the meaty part of the distribution of typical levels of risk aversion for experiment participants, and <span class="math inline">\(\sigma\approx 0.14\)</span> means that choices are not so noisy that they always get censored at zero or one.</p>
</div>
</div>
<div id="utility-based-models" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Utility-based models<a href="probabilistic-models-of-behavior.html#utility-based-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Another approach for going from a deterministic to a probabilistic model is to have the utility function determine the entire probability distribution of our data. Note that for the “optimal choice plus error” model, the only place that the utility function came into the equation was in determining where the distribution of choices was centered. To show you why this might be a problem, let’s look a bit deeper into what the participant’s utility maximization problem looks like for one decision in <span class="citation">Halevy, Persitz, and Zrill (<a href="#ref-Halevy2018" role="doc-biblioref">2018</a>)</span>. In particular, here is what their utility of choosing an allocation <span class="math inline">\(\left(x,(1-x)\bar y/\bar x\right)\)</span> looks like for the normalized budget set when <span class="math inline">\(\bar y/\bar x = 4\)</span>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="probabilistic-models-of-behavior.html#cb35-1" aria-hidden="true" tabindex="-1"></a>ybar<span class="ot">&lt;-</span><span class="dv">4</span></span>
<span id="cb35-2"><a href="probabilistic-models-of-behavior.html#cb35-2" aria-hidden="true" tabindex="-1"></a>r<span class="ot">&lt;-</span><span class="fl">0.5</span></span>
<span id="cb35-3"><a href="probabilistic-models-of-behavior.html#cb35-3" aria-hidden="true" tabindex="-1"></a>d<span class="ot">&lt;-</span>(</span>
<span id="cb35-4"><a href="probabilistic-models-of-behavior.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x=</span><span class="fu">seq</span>(<span class="fl">0.001</span>,<span class="fl">0.999</span>,<span class="at">length=</span><span class="dv">101</span>))</span>
<span id="cb35-5"><a href="probabilistic-models-of-behavior.html#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">utility =</span> <span class="fl">0.5</span><span class="sc">*</span>x<span class="sc">^</span>(<span class="dv">1</span><span class="sc">-</span>r)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>r)<span class="sc">+</span><span class="fl">0.5</span><span class="sc">*</span>((<span class="dv">1</span><span class="sc">-</span>x)<span class="sc">*</span>ybar)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">-</span>r)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>r)</span>
<span id="cb35-6"><a href="probabilistic-models-of-behavior.html#cb35-6" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb35-7"><a href="probabilistic-models-of-behavior.html#cb35-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-8"><a href="probabilistic-models-of-behavior.html#cb35-8" aria-hidden="true" tabindex="-1"></a>optimal<span class="ot">&lt;-</span>d<span class="sc">$</span>x[<span class="fu">which.max</span>(d<span class="sc">$</span>utility)]</span>
<span id="cb35-9"><a href="probabilistic-models-of-behavior.html#cb35-9" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb35-10"><a href="probabilistic-models-of-behavior.html#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(d)</span>
<span id="cb35-11"><a href="probabilistic-models-of-behavior.html#cb35-11" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>utility))</span>
<span id="cb35-12"><a href="probabilistic-models-of-behavior.html#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span>optimal,<span class="at">color=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb35-13"><a href="probabilistic-models-of-behavior.html#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb35-14"><a href="probabilistic-models-of-behavior.html#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Expected utility&quot;</span>)</span>
<span id="cb35-15"><a href="probabilistic-models-of-behavior.html#cb35-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:ProbModExpectedUtility"></span>
<img src="index_files/figure-html/ProbModExpectedUtility-1.png" alt="The expected utility function in @Halevy2018 for a participant with $r=0.5$ when $\bar y/\bar x=4$. The vertical red line denotes the optimal choice" width="672" />
<p class="caption">
Figure 3.3: The expected utility function in <span class="citation">Halevy, Persitz, and Zrill (<a href="#ref-Halevy2018" role="doc-biblioref">2018</a>)</span> for a participant with <span class="math inline">\(r=0.5\)</span> when <span class="math inline">\(\bar y/\bar x=4\)</span>. The vertical red line denotes the optimal choice
</p>
</div>
<p>One important feature of Figure <a href="probabilistic-models-of-behavior.html#fig:ProbModExpectedUtility">3.3</a> is that the expected utility function is not symmetric: there is a much sharper drop-off in utility moving to the left of the optimal choice (red line) than to the right. Yet the “optimal choice plus error” model will assume a symmetric distribution centered on the red line (outside of any censoring or truncation). This is because that model does not take into account the <em>shape</em> of this plot, only the maximum.</p>
<p>This goes against a lot of our understanding of how actual humans make decisions. In particular, they are more likely to take actions that yield higher utility than those that yield lower utility. In order for our model to reflect this, then loosely speaking, what we want for our probabilistic model to look something like this:</p>
<p><span class="math display">\[
p\left(y\mid x, \theta\right)=g\left(U(y,x;\theta)\right)
\]</span></p>
<p>with <span class="math inline">\(g&#39;(u)&gt;0\)</span>. That is, the probability of choosing an action is increasing in the utility associated with taking that action.</p>
<p>By far the most common implementation of this is the logistic choice rule, which mathematically looks like this:</p>
<p><span class="math display">\[
p(y\mid x,\theta)=\frac{\exp\left(\lambda U(y,x;\theta)\right)}{\sum_{z\in\mathbb Y}\exp\left(\lambda U(z,x;\theta)\right)}
\]</span>
where <span class="math inline">\(\lambda&gt;0\)</span> measures a participant’s <em>choice precision</em>: as <span class="math inline">\(\lambda\)</span> increases, the participant is more sensitive to payoffs. For this decision in <span class="citation">Halevy, Persitz, and Zrill (<a href="#ref-Halevy2018" role="doc-biblioref">2018</a>)</span>, the probabilistic predictions from logit choice look like this:<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="probabilistic-models-of-behavior.html#cb36-1" aria-hidden="true" tabindex="-1"></a>LAMBDA<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">30</span>,<span class="dv">40</span>)</span>
<span id="cb36-2"><a href="probabilistic-models-of-behavior.html#cb36-2" aria-hidden="true" tabindex="-1"></a>dlogit<span class="ot">&lt;-</span><span class="fu">tibble</span>()</span>
<span id="cb36-3"><a href="probabilistic-models-of-behavior.html#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="probabilistic-models-of-behavior.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ll <span class="cf">in</span> LAMBDA) {</span>
<span id="cb36-5"><a href="probabilistic-models-of-behavior.html#cb36-5" aria-hidden="true" tabindex="-1"></a>  tmp<span class="ot">&lt;-</span>(d</span>
<span id="cb36-6"><a href="probabilistic-models-of-behavior.html#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb36-7"><a href="probabilistic-models-of-behavior.html#cb36-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">lu =</span> ll<span class="sc">*</span>utility,</span>
<span id="cb36-8"><a href="probabilistic-models-of-behavior.html#cb36-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">px =</span> <span class="fu">exp</span>(lu<span class="sc">-</span><span class="fu">max</span>(lu))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(lu<span class="sc">-</span><span class="fu">max</span>(lu))),</span>
<span id="cb36-9"><a href="probabilistic-models-of-behavior.html#cb36-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">lambda =</span> <span class="fu">paste</span>(<span class="st">&quot;\u03bb =&quot;</span>,ll)</span>
<span id="cb36-10"><a href="probabilistic-models-of-behavior.html#cb36-10" aria-hidden="true" tabindex="-1"></a>              )  </span>
<span id="cb36-11"><a href="probabilistic-models-of-behavior.html#cb36-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-12"><a href="probabilistic-models-of-behavior.html#cb36-12" aria-hidden="true" tabindex="-1"></a>  dlogit<span class="ot">&lt;-</span><span class="fu">rbind</span>(dlogit,tmp)</span>
<span id="cb36-13"><a href="probabilistic-models-of-behavior.html#cb36-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-14"><a href="probabilistic-models-of-behavior.html#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="probabilistic-models-of-behavior.html#cb36-15" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb36-16"><a href="probabilistic-models-of-behavior.html#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(dlogit,<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>px,<span class="at">linetype=</span>lambda))</span>
<span id="cb36-17"><a href="probabilistic-models-of-behavior.html#cb36-17" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_path</span>()</span>
<span id="cb36-18"><a href="probabilistic-models-of-behavior.html#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span>optimal,<span class="at">color=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb36-19"><a href="probabilistic-models-of-behavior.html#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;probability&quot;</span>)</span>
<span id="cb36-20"><a href="probabilistic-models-of-behavior.html#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb36-21"><a href="probabilistic-models-of-behavior.html#cb36-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:ProbModLogitChoice"></span>
<img src="index_files/figure-html/ProbModLogitChoice-1.png" alt="Logistic choice in @Halevy2018 for a participant with $r=0.5$ when $\bar y/\bar x=4$. The vertical red line denotes the optimal choice" width="672" />
<p class="caption">
Figure 3.4: Logistic choice in <span class="citation">Halevy, Persitz, and Zrill (<a href="#ref-Halevy2018" role="doc-biblioref">2018</a>)</span> for a participant with <span class="math inline">\(r=0.5\)</span> when <span class="math inline">\(\bar y/\bar x=4\)</span>. The vertical red line denotes the optimal choice
</p>
</div>
<p>In particular, the distributions in Figure <a href="probabilistic-models-of-behavior.html#fig:ProbModLogitChoice">3.4</a> are <em>not</em> symmetric: they have a longer right tail than left tail. This is because making “mistakes” by choosing slightly to the right of the optimal choice (red line) are less costly than choosing slightly to the left.</p>
<div id="estimating-a-model-2" class="section level3 hasAnchor" number="3.5.1">
<h3><span class="header-section-number">3.5.1</span> Estimating a model<a href="probabilistic-models-of-behavior.html#estimating-a-model-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here is the <em>Stan</em> file for estimating this logistic choice model. As with the previous model, I need to discretize the choice set. For this implementation, instead of just computing a point prediction and adding an error, I need to compute utility for every possible choice that could be made. This is done over the grid veriable <code>xgrid</code>, and the element of this grid that most closely matches the participant’s choice is <code>xi</code>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb37-1"><a href="probabilistic-models-of-behavior.html#cb37-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-2"><a href="probabilistic-models-of-behavior.html#cb37-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb37-3"><a href="probabilistic-models-of-behavior.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span><span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> n<span class="op">;</span> <span class="co">// number of observations</span></span>
<span id="cb37-4"><a href="probabilistic-models-of-behavior.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> gridsize<span class="op">;</span></span>
<span id="cb37-5"><a href="probabilistic-models-of-behavior.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>gridsize<span class="op">]</span> xgrid<span class="op">;</span> <span class="co">// grid to discretize choice of x over</span></span>
<span id="cb37-6"><a href="probabilistic-models-of-behavior.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> xi<span class="op">[</span>n<span class="op">];</span> <span class="co">// index for the grid for choice of x</span></span>
<span id="cb37-7"><a href="probabilistic-models-of-behavior.html#cb37-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-8"><a href="probabilistic-models-of-behavior.html#cb37-8" aria-hidden="true" tabindex="-1"></a>  real yint<span class="op">[</span>n<span class="op">];</span> <span class="co">// y intercept</span></span>
<span id="cb37-9"><a href="probabilistic-models-of-behavior.html#cb37-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-10"><a href="probabilistic-models-of-behavior.html#cb37-10" aria-hidden="true" tabindex="-1"></a>  real prior_r<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb37-11"><a href="probabilistic-models-of-behavior.html#cb37-11" aria-hidden="true" tabindex="-1"></a>  real prior_lambda<span class="op">;</span></span>
<span id="cb37-12"><a href="probabilistic-models-of-behavior.html#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb37-13"><a href="probabilistic-models-of-behavior.html#cb37-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-14"><a href="probabilistic-models-of-behavior.html#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="probabilistic-models-of-behavior.html#cb37-15" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb37-16"><a href="probabilistic-models-of-behavior.html#cb37-16" aria-hidden="true" tabindex="-1"></a>  real r<span class="op">;</span></span>
<span id="cb37-17"><a href="probabilistic-models-of-behavior.html#cb37-17" aria-hidden="true" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> lambda<span class="op">;</span></span>
<span id="cb37-18"><a href="probabilistic-models-of-behavior.html#cb37-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb37-19"><a href="probabilistic-models-of-behavior.html#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="probabilistic-models-of-behavior.html#cb37-20" aria-hidden="true" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb37-21"><a href="probabilistic-models-of-behavior.html#cb37-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-22"><a href="probabilistic-models-of-behavior.html#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="probabilistic-models-of-behavior.html#cb37-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-24"><a href="probabilistic-models-of-behavior.html#cb37-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb37-25"><a href="probabilistic-models-of-behavior.html#cb37-25" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">[</span>gridsize<span class="op">]</span> EU<span class="op">;</span></span>
<span id="cb37-26"><a href="probabilistic-models-of-behavior.html#cb37-26" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">[</span>gridsize<span class="op">]</span> probX<span class="op">;</span></span>
<span id="cb37-27"><a href="probabilistic-models-of-behavior.html#cb37-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-28"><a href="probabilistic-models-of-behavior.html#cb37-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">// expected utility of choosing each x in the grid</span></span>
<span id="cb37-29"><a href="probabilistic-models-of-behavior.html#cb37-29" aria-hidden="true" tabindex="-1"></a>    EU <span class="op">=</span> <span class="fl">0.5</span><span class="op">*</span>pow<span class="op">(</span>xgrid<span class="op">,</span><span class="fl">1.0</span><span class="op">-</span>r<span class="op">)/(</span><span class="fl">1.0</span><span class="op">-</span>r<span class="op">)+</span><span class="fl">0.5</span><span class="op">*</span>pow<span class="op">((</span><span class="fl">1.0</span><span class="op">-</span>xgrid<span class="op">)*</span>yint<span class="op">[</span>ii<span class="op">],</span><span class="fl">1.0</span><span class="op">-</span>r<span class="op">)/(</span><span class="fl">1.0</span><span class="op">-</span>r<span class="op">);</span></span>
<span id="cb37-30"><a href="probabilistic-models-of-behavior.html#cb37-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-31"><a href="probabilistic-models-of-behavior.html#cb37-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// logit choice probabilities</span></span>
<span id="cb37-32"><a href="probabilistic-models-of-behavior.html#cb37-32" aria-hidden="true" tabindex="-1"></a>    probX <span class="op">=</span> log_softmax<span class="op">(</span>lambda<span class="op">*</span>EU<span class="op">);</span></span>
<span id="cb37-33"><a href="probabilistic-models-of-behavior.html#cb37-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-34"><a href="probabilistic-models-of-behavior.html#cb37-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">// increment the likelihood by the log probability chosen</span></span>
<span id="cb37-35"><a href="probabilistic-models-of-behavior.html#cb37-35" aria-hidden="true" tabindex="-1"></a>    target <span class="op">+=</span> probX<span class="op">[</span>xi<span class="op">[</span>ii<span class="op">]];</span></span>
<span id="cb37-36"><a href="probabilistic-models-of-behavior.html#cb37-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-37"><a href="probabilistic-models-of-behavior.html#cb37-37" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb37-38"><a href="probabilistic-models-of-behavior.html#cb37-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-39"><a href="probabilistic-models-of-behavior.html#cb37-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb37-40"><a href="probabilistic-models-of-behavior.html#cb37-40" aria-hidden="true" tabindex="-1"></a>  r <span class="op">~</span> normal<span class="op">(</span>prior_r<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_r<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb37-41"><a href="probabilistic-models-of-behavior.html#cb37-41" aria-hidden="true" tabindex="-1"></a>  lambda <span class="op">~</span> cauchy<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>prior_lambda<span class="op">);</span></span>
<span id="cb37-42"><a href="probabilistic-models-of-behavior.html#cb37-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-43"><a href="probabilistic-models-of-behavior.html#cb37-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-44"><a href="probabilistic-models-of-behavior.html#cb37-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And here is how I pass the data to <em>Stan</em> to estimate the model in <em>R</em>:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="probabilistic-models-of-behavior.html#cb38-1" aria-hidden="true" tabindex="-1"></a>gridsize<span class="ot">&lt;-</span><span class="dv">20</span></span>
<span id="cb38-2"><a href="probabilistic-models-of-behavior.html#cb38-2" aria-hidden="true" tabindex="-1"></a>Xgrid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>gridsize),<span class="dv">1-1</span><span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span>gridsize),<span class="at">by=</span><span class="dv">1</span><span class="sc">/</span>gridsize)</span>
<span id="cb38-3"><a href="probabilistic-models-of-behavior.html#cb38-3" aria-hidden="true" tabindex="-1"></a>d<span class="ot">&lt;-</span>(</span>
<span id="cb38-4"><a href="probabilistic-models-of-behavior.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  d</span>
<span id="cb38-5"><a href="probabilistic-models-of-behavior.html#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">%&gt;%</span> <span class="fu">rowwise</span>()</span>
<span id="cb38-6"><a href="probabilistic-models-of-behavior.html#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">xi =</span> <span class="fu">which.min</span>(<span class="fu">abs</span>(x<span class="sc">-</span>Xgrid)))</span>
<span id="cb38-7"><a href="probabilistic-models-of-behavior.html#cb38-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-8"><a href="probabilistic-models-of-behavior.html#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="probabilistic-models-of-behavior.html#cb38-9" aria-hidden="true" tabindex="-1"></a>dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb38-10"><a href="probabilistic-models-of-behavior.html#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">dim</span>(d)[<span class="dv">1</span>],</span>
<span id="cb38-11"><a href="probabilistic-models-of-behavior.html#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">xgrid =</span> Xgrid,</span>
<span id="cb38-12"><a href="probabilistic-models-of-behavior.html#cb38-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">gridsize=</span>gridsize,</span>
<span id="cb38-13"><a href="probabilistic-models-of-behavior.html#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">xi=</span>d<span class="sc">$</span>xi,</span>
<span id="cb38-14"><a href="probabilistic-models-of-behavior.html#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">yint =</span> d<span class="sc">$</span>yint,</span>
<span id="cb38-15"><a href="probabilistic-models-of-behavior.html#cb38-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-16"><a href="probabilistic-models-of-behavior.html#cb38-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_r =</span> <span class="fu">c</span>(<span class="fl">0.5</span>,<span class="fl">0.25</span>),</span>
<span id="cb38-17"><a href="probabilistic-models-of-behavior.html#cb38-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_lambda =</span> <span class="fl">0.08</span></span>
<span id="cb38-18"><a href="probabilistic-models-of-behavior.html#cb38-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Warning: Unknown or uninitialised column: `yint`.</code></pre>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="probabilistic-models-of-behavior.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">&quot;Outputs/ProbabilisticModels/ProbMods_HPZ2018_logit.rds&quot;</span>)) {</span>
<span id="cb40-2"><a href="probabilistic-models-of-behavior.html#cb40-2" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">stan</span>(<span class="st">&quot;Code/ProbabilisticModels/ProbMods_HPZ2018_logit.stan&quot;</span>,</span>
<span id="cb40-3"><a href="probabilistic-models-of-behavior.html#cb40-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb40-4"><a href="probabilistic-models-of-behavior.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save the fitted model results</span></span>
<span id="cb40-5"><a href="probabilistic-models-of-behavior.html#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(Fit,<span class="at">file =</span> <span class="st">&quot;Outputs/ProbabilisticModels/ProbMods_HPZ2018_logit.rds&quot;</span>)</span>
<span id="cb40-6"><a href="probabilistic-models-of-behavior.html#cb40-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-7"><a href="probabilistic-models-of-behavior.html#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># load the fitted model results</span></span>
<span id="cb40-8"><a href="probabilistic-models-of-behavior.html#cb40-8" aria-hidden="true" tabindex="-1"></a>FitLogit<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">&quot;Outputs/ProbabilisticModels/ProbMods_HPZ2018_logit.rds&quot;</span>)</span>
<span id="cb40-9"><a href="probabilistic-models-of-behavior.html#cb40-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-10"><a href="probabilistic-models-of-behavior.html#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="probabilistic-models-of-behavior.html#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(FitLogit)<span class="sc">$</span>summary <span class="sc">|&gt;</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">caption=</span><span class="st">&quot;Posterior estimates of the logit choice model.&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:ProbModLogit">Table 3.3: </span>Posterior estimates of the logit choice model.</caption>
<colgroup>
<col width="5%" />
<col width="10%" />
<col width="8%" />
<col width="8%" />
<col width="9%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="10%" />
<col width="8%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">se_mean</th>
<th align="right">sd</th>
<th align="right">2.5%</th>
<th align="right">25%</th>
<th align="right">50%</th>
<th align="right">75%</th>
<th align="right">97.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">r</td>
<td align="right">0.6180463</td>
<td align="right">0.0022409</td>
<td align="right">0.0823109</td>
<td align="right">0.479191</td>
<td align="right">0.5672429</td>
<td align="right">0.6121625</td>
<td align="right">0.6612087</td>
<td align="right">0.7932096</td>
<td align="right">1349.1623</td>
<td align="right">1.003993</td>
</tr>
<tr class="even">
<td align="left">lambda</td>
<td align="right">19.4787417</td>
<td align="right">0.2092722</td>
<td align="right">8.1674884</td>
<td align="right">5.569901</td>
<td align="right">13.7510580</td>
<td align="right">18.7127683</td>
<td align="right">24.4728880</td>
<td align="right">37.7761375</td>
<td align="right">1523.1894</td>
<td align="right">1.001866</td>
</tr>
<tr class="odd">
<td align="left">lp__</td>
<td align="right">-61.6231103</td>
<td align="right">0.0584521</td>
<td align="right">1.3736571</td>
<td align="right">-65.357691</td>
<td align="right">-62.0096403</td>
<td align="right">-61.1958480</td>
<td align="right">-60.7450303</td>
<td align="right">-60.4548983</td>
<td align="right">552.2771</td>
<td align="right">1.006458</td>
</tr>
</tbody>
</table>
<p>The posterior estimates are summarized in Table <a href="probabilistic-models-of-behavior.html#tab:ProbModLogit">3.3</a>. While we cannot directly compare the parameters <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\sigma\)</span>, we can compare the estimates of the risk-aversion parameter <span class="math inline">\(r\)</span>. These are both similar in terms of the posterior mean and the posterior standard deviation.</p>
</div>
<div id="doing-something-with-the-estimates" class="section level3 hasAnchor" number="3.5.2">
<h3><span class="header-section-number">3.5.2</span> Doing something with the estimates<a href="probabilistic-models-of-behavior.html#doing-something-with-the-estimates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>While having and estimate of <span class="math inline">\(r\)</span> and <span class="math inline">\(\lambda\)</span> might be useful to your research question on their own, note that because they are parameters of a probabilistic choice model, they can be used to make predictions and derive implications. To fix ideas, let’s just focus on the first decision that this participant made. For this decision, the normalized <span class="math inline">\(y\)</span> intercept of the budget line was <code>yint=0.3492</code>, and they chose to invest a normalized amount of <code>x=0.702</code> in the asset that pays out in State 1. Let’s begin by extracting our estimated model’s posterior draws, and then we will use them to derive some predictions.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="probabilistic-models-of-behavior.html#cb41-1" aria-hidden="true" tabindex="-1"></a>postdraws<span class="ot">&lt;-</span><span class="fu">tibble</span>(<span class="at">r=</span><span class="fu">extract</span>(FitLogit)<span class="sc">$</span>r,<span class="at">lambda=</span><span class="fu">extract</span>(FitLogit)<span class="sc">$</span>lambda)</span>
<span id="cb41-2"><a href="probabilistic-models-of-behavior.html#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="probabilistic-models-of-behavior.html#cb41-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb41-4"><a href="probabilistic-models-of-behavior.html#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(postdraws,<span class="fu">aes</span>(<span class="at">x=</span>r,<span class="at">y=</span>lambda))</span>
<span id="cb41-5"><a href="probabilistic-models-of-behavior.html#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_point</span>(<span class="at">size=</span><span class="fl">0.3</span>)</span>
<span id="cb41-6"><a href="probabilistic-models-of-behavior.html#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb41-7"><a href="probabilistic-models-of-behavior.html#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;\u03bb&quot;</span>)</span>
<span id="cb41-8"><a href="probabilistic-models-of-behavior.html#cb41-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-36"></span>
<img src="index_files/figure-html/unnamed-chunk-36-1.png" alt="Posterior draws from the estimated logit choice model" width="672" />
<p class="caption">
Figure 3.5: Posterior draws from the estimated logit choice model
</p>
</div>
<p>Firstly, let’s look at our model’s prediction for this decision. Recall that since we estimated a probabilistic model, our models prediction will be a probability distribution. Furthermore, since we have 4,000 draws from the posterior distribution, we will have 4,000 posterior draws of this probability distribution. Here is what I came up with the visualize the model’s prediction for this choice</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="probabilistic-models-of-behavior.html#cb42-1" aria-hidden="true" tabindex="-1"></a>yint<span class="ot">&lt;-</span><span class="fl">0.3492</span></span>
<span id="cb42-2"><a href="probabilistic-models-of-behavior.html#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="probabilistic-models-of-behavior.html#cb42-3" aria-hidden="true" tabindex="-1"></a>ProbPrediction<span class="ot">&lt;-</span><span class="fu">tibble</span>()</span>
<span id="cb42-4"><a href="probabilistic-models-of-behavior.html#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="probabilistic-models-of-behavior.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ss <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(postdraws)[<span class="dv">1</span>]) {</span>
<span id="cb42-6"><a href="probabilistic-models-of-behavior.html#cb42-6" aria-hidden="true" tabindex="-1"></a>  r<span class="ot">&lt;-</span>postdraws[ss,]<span class="sc">$</span>r</span>
<span id="cb42-7"><a href="probabilistic-models-of-behavior.html#cb42-7" aria-hidden="true" tabindex="-1"></a>  lambda<span class="ot">&lt;-</span>postdraws[ss,]<span class="sc">$</span>lambda</span>
<span id="cb42-8"><a href="probabilistic-models-of-behavior.html#cb42-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-9"><a href="probabilistic-models-of-behavior.html#cb42-9" aria-hidden="true" tabindex="-1"></a>  EU<span class="ot">&lt;-</span><span class="fl">0.5</span><span class="sc">*</span>Xgrid<span class="sc">^</span>(<span class="dv">1</span><span class="sc">-</span>r)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>r)<span class="sc">+</span><span class="fl">0.5</span><span class="sc">*</span>((<span class="dv">1</span><span class="sc">-</span>Xgrid)<span class="sc">*</span>yint)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">-</span>r)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>r)</span>
<span id="cb42-10"><a href="probabilistic-models-of-behavior.html#cb42-10" aria-hidden="true" tabindex="-1"></a>  Pr<span class="ot">&lt;-</span><span class="fu">exp</span>(lambda<span class="sc">*</span>EU<span class="sc">-</span><span class="fu">max</span>(lambda<span class="sc">*</span>EU))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(lambda<span class="sc">*</span>EU<span class="sc">-</span><span class="fu">max</span>(lambda<span class="sc">*</span>EU)))</span>
<span id="cb42-11"><a href="probabilistic-models-of-behavior.html#cb42-11" aria-hidden="true" tabindex="-1"></a>  ProbPrediction<span class="ot">&lt;-</span><span class="fu">rbind</span>(ProbPrediction,<span class="fu">tibble</span>(<span class="at">x=</span>Xgrid,<span class="at">Pr=</span>Pr))</span>
<span id="cb42-12"><a href="probabilistic-models-of-behavior.html#cb42-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb42-13"><a href="probabilistic-models-of-behavior.html#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="probabilistic-models-of-behavior.html#cb42-14" aria-hidden="true" tabindex="-1"></a>means<span class="ot">&lt;-</span>ProbPrediction <span class="sc">|&gt;</span> <span class="fu">group_by</span>(x) <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="at">meanPr =</span> <span class="fu">mean</span>(Pr))</span>
<span id="cb42-15"><a href="probabilistic-models-of-behavior.html#cb42-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-16"><a href="probabilistic-models-of-behavior.html#cb42-16" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb42-17"><a href="probabilistic-models-of-behavior.html#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()</span>
<span id="cb42-18"><a href="probabilistic-models-of-behavior.html#cb42-18" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_jitter</span>(<span class="at">data=</span>ProbPrediction,<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>Pr),<span class="at">size=</span><span class="fl">0.2</span>,<span class="at">alpha=</span><span class="fl">0.1</span>)</span>
<span id="cb42-19"><a href="probabilistic-models-of-behavior.html#cb42-19" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_line</span>(<span class="at">data=</span>means,<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>meanPr),<span class="at">color=</span><span class="st">&quot;red&quot;</span>,<span class="at">linewidth=</span><span class="dv">2</span>)</span>
<span id="cb42-20"><a href="probabilistic-models-of-behavior.html#cb42-20" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb42-21"><a href="probabilistic-models-of-behavior.html#cb42-21" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fl">0.702</span>,<span class="at">color=</span><span class="st">&quot;blue&quot;</span>,<span class="at">linewidth=</span><span class="dv">2</span>,<span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)</span>
<span id="cb42-22"><a href="probabilistic-models-of-behavior.html#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;Investment in the state 1 asset&quot;</span>)</span>
<span id="cb42-23"><a href="probabilistic-models-of-behavior.html#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Probability&quot;</span>)</span>
<span id="cb42-24"><a href="probabilistic-models-of-behavior.html#cb42-24" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:ProbModPrediction"></span>
<img src="index_files/figure-html/ProbModPrediction-1.png" alt="Posterior predictive distribution for the participant. Dots show draws from the individual posterior distribution. The red curve shows the mean of this predictive distribution. The dashed blue line shows the choice that was made by the participant." width="672" />
<p class="caption">
Figure 3.6: Posterior predictive distribution for the participant. Dots show draws from the individual posterior distribution. The red curve shows the mean of this predictive distribution. The dashed blue line shows the choice that was made by the participant.
</p>
</div>
<p>So it looks like the participant chose fairly closely (blue line) to what our model estimated was their optimal choice.<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a></p>
<p>Finally, whenever I see a plot like Figure <a href="probabilistic-models-of-behavior.html#fig:HPZ2018">3.1</a>, I always wonder what the indifference curves look like. So in the interest of satisfying my curiosity, let’s work out what their indifference curve looks like for the choice that they made. To begin with, the equation of the indifference curve is:</p>
<p><span class="math display">\[
\begin{aligned}
\bar u&amp;=0.5\frac{x^{1-r}}{1-r}+0.5\frac{y^{1-r}}{1-r}\\
y^{1-r}&amp;=2(1-r)\bar u-x^{1-r}\\
y&amp;=\left(2(1-r)\bar u-x^{1-r}\right)^{\frac{1}{1-r}}
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(\bar u\)</span> is the utility of the indifference curve. Let’s work out what the indifference curves look like using our 4,000 posterior draws:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="probabilistic-models-of-behavior.html#cb43-1" aria-hidden="true" tabindex="-1"></a>indiff<span class="ot">&lt;-</span>(</span>
<span id="cb43-2"><a href="probabilistic-models-of-behavior.html#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand.grid</span>(<span class="at">r =</span> postdraws<span class="sc">$</span>r,<span class="at">x=</span><span class="fu">seq</span>(<span class="fl">0.1</span>,<span class="fl">0.9</span>,<span class="at">length=</span><span class="dv">20</span>))</span>
<span id="cb43-3"><a href="probabilistic-models-of-behavior.html#cb43-3" aria-hidden="true" tabindex="-1"></a>    <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb43-4"><a href="probabilistic-models-of-behavior.html#cb43-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">ubar =</span> <span class="fl">0.5</span><span class="sc">*</span><span class="fl">0.702</span><span class="sc">^</span>(<span class="dv">1</span><span class="sc">-</span>r)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>r)<span class="sc">+</span><span class="fl">0.5</span><span class="sc">*</span>((<span class="dv">1</span><span class="fl">-0.702</span>)<span class="sc">*</span><span class="fl">0.3492</span>)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">-</span>r)<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>r),</span>
<span id="cb43-5"><a href="probabilistic-models-of-behavior.html#cb43-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> (<span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>r)<span class="sc">*</span>ubar<span class="sc">-</span>x<span class="sc">^</span>(<span class="dv">1</span><span class="sc">-</span>r))<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>r))</span>
<span id="cb43-6"><a href="probabilistic-models-of-behavior.html#cb43-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-7"><a href="probabilistic-models-of-behavior.html#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|&gt;</span> <span class="fu">group_by</span>(x)</span>
<span id="cb43-8"><a href="probabilistic-models-of-behavior.html#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="at">mean=</span><span class="fu">mean</span>(y),</span>
<span id="cb43-9"><a href="probabilistic-models-of-behavior.html#cb43-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">p05=</span><span class="fu">quantile</span>(y,<span class="at">probs=</span><span class="fl">0.05</span>,<span class="at">na.rm=</span>T),</span>
<span id="cb43-10"><a href="probabilistic-models-of-behavior.html#cb43-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">p95=</span><span class="fu">quantile</span>(y,<span class="at">probs=</span><span class="fl">0.95</span>,<span class="at">na.rm=</span>T),</span>
<span id="cb43-11"><a href="probabilistic-models-of-behavior.html#cb43-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">p25=</span><span class="fu">quantile</span>(y,<span class="at">probs=</span><span class="fl">0.25</span>,<span class="at">na.rm=</span>T),</span>
<span id="cb43-12"><a href="probabilistic-models-of-behavior.html#cb43-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">p75=</span><span class="fu">quantile</span>(y,<span class="at">probs=</span><span class="fl">0.75</span>,<span class="at">na.rm=</span>T)</span>
<span id="cb43-13"><a href="probabilistic-models-of-behavior.html#cb43-13" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb43-14"><a href="probabilistic-models-of-behavior.html#cb43-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-15"><a href="probabilistic-models-of-behavior.html#cb43-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-16"><a href="probabilistic-models-of-behavior.html#cb43-16" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb43-17"><a href="probabilistic-models-of-behavior.html#cb43-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(indiff,<span class="fu">aes</span>(<span class="at">x=</span>x))</span>
<span id="cb43-18"><a href="probabilistic-models-of-behavior.html#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="sc">-</span><span class="fl">0.3492</span>,<span class="at">intercept =</span> <span class="fl">0.3492</span>,<span class="at">linewidth=</span><span class="dv">1</span>)</span>
<span id="cb43-19"><a href="probabilistic-models-of-behavior.html#cb43-19" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymax=</span>p95,<span class="at">ymin=</span>p05),<span class="at">alpha=</span><span class="fl">0.2</span>)</span>
<span id="cb43-20"><a href="probabilistic-models-of-behavior.html#cb43-20" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymax=</span>p75,<span class="at">ymin=</span>p25),<span class="at">alpha=</span><span class="fl">0.4</span>)</span>
<span id="cb43-21"><a href="probabilistic-models-of-behavior.html#cb43-21" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>mean))</span>
<span id="cb43-22"><a href="probabilistic-models-of-behavior.html#cb43-22" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb43-23"><a href="probabilistic-models-of-behavior.html#cb43-23" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;Prize if state 1 occurs (x)&quot;</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Prize if state 2 occurs (y)&quot;</span>)</span>
<span id="cb43-24"><a href="probabilistic-models-of-behavior.html#cb43-24" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_text</span>(<span class="at">x=</span><span class="fl">0.702</span>,<span class="at">y=</span><span class="fl">0.349</span><span class="sc">*</span>(<span class="dv">1</span><span class="fl">-0.702</span>),<span class="at">label=</span><span class="st">&quot;X&quot;</span>)</span>
<span id="cb43-25"><a href="probabilistic-models-of-behavior.html#cb43-25" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:ProbModIndiff"></span>
<img src="index_files/figure-html/ProbModIndiff-1.png" alt="Estimated indifference curve of the first choice made by the participant. Shaded areas show 50% and 95% Bayesian credible regions. X denotes the choice made by the participant." width="672" />
<p class="caption">
Figure 3.7: Estimated indifference curve of the first choice made by the participant. Shaded areas show 50% and 95% Bayesian credible regions. X denotes the choice made by the participant.
</p>
</div>
<p>Figure <a href="probabilistic-models-of-behavior.html#fig:ProbModIndiff">3.7</a> shows the estimated indifference curve for this first decision, Including 95% and 50% Bayesian credible regions around its point prediction. Note that in this process, once we have draws from the posterior, it is very easy not just to get point predictions that are transforms of our parameters (like this indifference curve), but also the <em>entire posterior distribution</em> of these transforms. This will be extremely useful to us, as our structural models’ predictions are often nonlinear transformations of the parameters. Other quantities as well, such as utility, indifference curves, reservation values, and so on, are just as easily computed.</p>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Andreoni2002" class="csl-entry">
Andreoni, James, and John Miller. 2002. <span>“Giving According to GARP: An Experimental Test of the Consistency of Preferences for Altruism.”</span> <em>Econometrica</em> 70 (2): 737–53. <a href="https://www.jstor.org/stable/2692289">https://www.jstor.org/stable/2692289</a>.
</div>
<div id="ref-AV2001" class="csl-entry">
Andreoni, James, and Lise Vesterlund. 2001. <span>“Which Is the Fair Sex? Gender Differences in Altruism.”</span> <em>The Quarterly Journal of Economics</em> 116 (1): 293–312. <a href="https://doi.org/10.1162/003355301556419">https://doi.org/10.1162/003355301556419</a>.
</div>
<div id="ref-Halevy2018" class="csl-entry">
Halevy, Yoram, Dotan Persitz, and Lanny Zrill. 2018. <span>“Parametric Recoverability of Preferences.”</span> <em>Journal of Political Economy</em> 126 (4): 1558–93. <a href="https://doi.org/10.1086/697741">https://doi.org/10.1086/697741</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>Here I say “likelihood-based”, because the argument applies to any technique that uses a likelihood. Bayesian estimation and Maximum likelihood estimation both use a likelihood.<a href="probabilistic-models-of-behavior.html#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>There are a few reasons for this. For one thing, for pedagogical reasons I want to keep the examples in this chapter as simple as possible. Going to more than one participant will complicate matters both computationally and conceptually. We will cover these issues later. Also, <em>Stan</em> returns some errors when I estimate these models for many of the other participants, and instead of giving attention to how to understand and address these errors here, I prefer to show you what you can do with a probabilistic model. We will get to understanding and fixing <em>Stan</em>’s error warnings later.<a href="probabilistic-models-of-behavior.html#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>I am <em>not</em> saying that nonlinear least squares avoids these problems, just that the problems become more apparent when one is dealing directly with a likelihood.<a href="probabilistic-models-of-behavior.html#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>I acknowledge that I am being a bad Bayesian in that I have looked at the data before estimating my model here. It probably would have been better to estimate both models (truncation and censoring), and then assess which one is matching the data better.<a href="probabilistic-models-of-behavior.html#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>This is another kind of censoring: I know that the actual choice falls within a range, but I do not know where in the range the actual choice was.<a href="probabilistic-models-of-behavior.html#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>Note that when I computed the logit choice probabilities in Figure <a href="probabilistic-models-of-behavior.html#fig:ProbModLogitChoice">3.4</a>, I first subtracted the maximum utility. This does not mathematically change the answer, but computationally is much more stable because we avoid exponentiating large positive numbers.<a href="probabilistic-models-of-behavior.html#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>We should be wary of using this as evidence that we have a good fit for our model, because this participant’s choice was used in estimating the model. In a later chapter I will discuss some cross-validation techniques that can be used to assess goodness of fit.<a href="probabilistic-models-of-behavior.html#fnref9" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="getting-started-in-stan.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="building-blocks.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

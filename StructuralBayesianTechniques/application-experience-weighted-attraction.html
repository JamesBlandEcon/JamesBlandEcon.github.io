<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 Application: Experience-Weighted Attraction | Structural Bayesian Techniques for Experimental and Behavioral Economics</title>
  <meta name="description" content="7 Application: Experience-Weighted Attraction | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  <meta name="generator" content="bookdown 0.31 and GitBook 2.6.7" />

  <meta property="og:title" content="7 Application: Experience-Weighted Attraction | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 Application: Experience-Weighted Attraction | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  
  
  

<meta name="author" content="James R. Bland" />


<meta name="date" content="2023-06-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="applications.html"/>
<link rel="next" href="strategy-frequency-estimation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="section.html#section" id="toc-section"></a></li>
<li class="chapter" data-level="" data-path="setting-the-stage.html"><a href="setting-the-stage.html"><i class="fa fa-check"></i>Setting the stage</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-does-your-theory-say-about-your-data"><i class="fa fa-check"></i><b>1.1</b> What does your theory say about your data?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-do-your-data-say-about-your-theory"><i class="fa fa-check"></i><b>1.2</b> What do your data say about your theory?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-do-your-parameters-say-about-other-things"><i class="fa fa-check"></i><b>1.3</b> What do your parameters say about other things?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-does-your-expertise-say-about-your-parameters"><i class="fa fa-check"></i><b>1.4</b> What does your expertise say about your parameters?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html"><i class="fa fa-check"></i><b>2</b> Getting started in <em>Stan</em></a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#installation-in-r"><i class="fa fa-check"></i><b>2.1</b> Installation in <em>R</em></a></li>
<li class="chapter" data-level="2.2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#the-anatomy-of-a-stan-program"><i class="fa fa-check"></i><b>2.2</b> The anatomy of a <em>Stan</em> program</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#data-block"><i class="fa fa-check"></i><b>2.2.1</b> Data block</a></li>
<li class="chapter" data-level="2.2.2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#transformed-data-block"><i class="fa fa-check"></i><b>2.2.2</b> Transformed data block</a></li>
<li class="chapter" data-level="2.2.3" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#parameters-block"><i class="fa fa-check"></i><b>2.2.3</b> Parameters block</a></li>
<li class="chapter" data-level="2.2.4" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#model-block"><i class="fa fa-check"></i><b>2.2.4</b> Model block</a></li>
<li class="chapter" data-level="2.2.5" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#generated-quantities-block"><i class="fa fa-check"></i><b>2.2.5</b> Generated quantities block</a></li>
<li class="chapter" data-level="2.2.6" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#the-final-product"><i class="fa fa-check"></i><b>2.2.6</b> The final product</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#estimating-a-model"><i class="fa fa-check"></i><b>2.3</b> Estimating a model</a></li>
<li class="chapter" data-level="2.4" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#looking-at-the-results"><i class="fa fa-check"></i><b>2.4</b> Looking at the results</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html"><i class="fa fa-check"></i><b>3</b> Probabilistic models of behavior</a>
<ul>
<li class="chapter" data-level="3.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#the-problem-with-deterministic-models"><i class="fa fa-check"></i><b>3.1</b> The problem with deterministic models</a></li>
<li class="chapter" data-level="3.2" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#what-is-a-probabilistic-model"><i class="fa fa-check"></i><b>3.2</b> What <em>is</em> a probabilistic model?</a></li>
<li class="chapter" data-level="3.3" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#example-dataset-and-model"><i class="fa fa-check"></i><b>3.3</b> Example dataset and model</a></li>
<li class="chapter" data-level="3.4" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#optimal-choice-plus-an-error"><i class="fa fa-check"></i><b>3.4</b> Optimal choice plus an error</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#estimating-a-model-1"><i class="fa fa-check"></i><b>3.4.1</b> Estimating a model</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#utility-based-models"><i class="fa fa-check"></i><b>3.5</b> Utility-based models</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#estimating-a-model-2"><i class="fa fa-check"></i><b>3.5.1</b> Estimating a model</a></li>
<li class="chapter" data-level="3.5.2" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#doing-something-with-the-estimates"><i class="fa fa-check"></i><b>3.5.2</b> Doing something with the estimates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="building-blocks.html"><a href="building-blocks.html"><i class="fa fa-check"></i>Building blocks</a></li>
<li class="chapter" data-level="4" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html"><i class="fa fa-check"></i><b>4</b> Representative agent and participant-specific models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#participant-specific-models"><i class="fa fa-check"></i><b>4.1</b> Participant-specific models</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#example-data-and-economic-model"><i class="fa fa-check"></i><b>4.1.1</b> Example data and economic model</a></li>
<li class="chapter" data-level="4.1.2" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#going-to-the-probabilistic-model"><i class="fa fa-check"></i><b>4.1.2</b> Going to the probabilistic model</a></li>
<li class="chapter" data-level="4.1.3" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#a-short-side-quest-into-canned-estimation-techniques"><i class="fa fa-check"></i><b>4.1.3</b> A short side quest into canned estimation techniques</a></li>
<li class="chapter" data-level="4.1.4" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#assigning-priors"><i class="fa fa-check"></i><b>4.1.4</b> Assigning priors</a></li>
<li class="chapter" data-level="4.1.5" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#estimating-the-model-for-one-participant"><i class="fa fa-check"></i><b>4.1.5</b> Estimating the model for one participant</a></li>
<li class="chapter" data-level="4.1.6" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#estimating-the-model-for-all-participants"><i class="fa fa-check"></i><b>4.1.6</b> Estimating the model for all participants</a></li>
<li class="chapter" data-level="4.1.7" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#but-we-could-be-learning-more"><i class="fa fa-check"></i><b>4.1.7</b> But we could be learning more!</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#actual-representative-agent-models-pooled-models"><i class="fa fa-check"></i><b>4.2</b> Actual representative agent models (pooled models)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="hierarchical-models.html"><a href="hierarchical-models.html"><i class="fa fa-check"></i><b>5</b> Hierarchical models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-random-sample-of-participants-walks-into-your-lab"><i class="fa fa-check"></i><b>5.1</b> A random sample of participants walks into your lab</a></li>
<li class="chapter" data-level="5.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#the-anatomy-of-a-basic-hierarchical-model"><i class="fa fa-check"></i><b>5.2</b> The anatomy of a basic hierarchical model</a></li>
<li class="chapter" data-level="5.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#accounting-for-unobserved-heterogeneity"><i class="fa fa-check"></i><b>5.3</b> Accounting for unobserved heterogeneity</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#the-last-time-you-will-integrate-the-likelihood-probably"><i class="fa fa-check"></i><b>5.3.1</b> The last time you will integrate the likelihood, probably</a></li>
<li class="chapter" data-level="5.3.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#data-augmentation"><i class="fa fa-check"></i><b>5.3.2</b> Data augmentation</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-multivariate-normal-hierarchical-model"><i class="fa fa-check"></i><b>5.4</b> A multivariate normal hierarchical model</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#decomposing-the-variance-covariance-matrix"><i class="fa fa-check"></i><b>5.4.1</b> Decomposing the variance-covariance matrix</a></li>
<li class="chapter" data-level="5.4.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#transformed-parameters-and-normal-distributions"><i class="fa fa-check"></i><b>5.4.2</b> Transformed parameters and normal distributions</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-again-with-bfs2019"><i class="fa fa-check"></i><b>5.5</b> Example: again with <span class="citation">Bruhin, Fehr, and Schunk (<span>2019</span>)</span></a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#no-correlation-between-individual-level-parameters"><i class="fa fa-check"></i><b>5.5.1</b> No correlation between individual-level parameters</a></li>
<li class="chapter" data-level="5.5.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#correlation-between-individual-level-parameters"><i class="fa fa-check"></i><b>5.5.2</b> Correlation between individual-level parameters</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="mixture-models.html"><a href="mixture-models.html"><i class="fa fa-check"></i><b>6</b> Mixture models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="mixture-models.html"><a href="mixture-models.html#a-menu-of-models"><i class="fa fa-check"></i><b>6.1</b> A menu of models</a></li>
<li class="chapter" data-level="6.2" data-path="mixture-models.html"><a href="mixture-models.html#dichotomous-and-toolbox-mixture-models"><i class="fa fa-check"></i><b>6.2</b> Dichotomous and toolbox mixture models</a></li>
<li class="chapter" data-level="6.3" data-path="mixture-models.html"><a href="mixture-models.html#coding-peculearities"><i class="fa fa-check"></i><b>6.3</b> Coding peculearities</a></li>
<li class="chapter" data-level="6.4" data-path="mixture-models.html"><a href="mixture-models.html#example-experiment-av2001"><i class="fa fa-check"></i><b>6.4</b> Example experiment: <span class="citation">Andreoni and Vesterlund (<span>2001</span>)</span></a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="mixture-models.html"><a href="mixture-models.html#as-basic-as-it-gets"><i class="fa fa-check"></i><b>6.4.1</b> As basic as it gets</a></li>
<li class="chapter" data-level="6.4.2" data-path="mixture-models.html"><a href="mixture-models.html#adding-some-heterogeneity"><i class="fa fa-check"></i><b>6.4.2</b> Adding some heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="mixture-models.html"><a href="mixture-models.html#some-code-used-to-estimate-the-models"><i class="fa fa-check"></i><b>6.5</b> Some code used to estimate the models</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i>Applications</a></li>
<li class="chapter" data-level="7" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html"><i class="fa fa-check"></i><b>7</b> Application: Experience-Weighted Attraction</a>
<ul>
<li class="chapter" data-level="7.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-model-at-the-individual-level"><i class="fa fa-check"></i><b>7.1</b> The model at the individual level</a></li>
<li class="chapter" data-level="7.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#some-computational-and-coding-issues"><i class="fa fa-check"></i><b>7.2</b> Some computational and coding issues</a></li>
<li class="chapter" data-level="7.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#representative-agent-models"><i class="fa fa-check"></i><b>7.3</b> Representative agent models</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#prior-calibration"><i class="fa fa-check"></i><b>7.3.1</b> Prior calibration</a></li>
<li class="chapter" data-level="7.3.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-stan-model"><i class="fa fa-check"></i><b>7.3.2</b> The <em>Stan</em> model</a></li>
<li class="chapter" data-level="7.3.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#results"><i class="fa fa-check"></i><b>7.3.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#hierarchical-model"><i class="fa fa-check"></i><b>7.4</b> Hierarchical model</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#prior-calibration-1"><i class="fa fa-check"></i><b>7.4.1</b> Prior calibration</a></li>
<li class="chapter" data-level="7.4.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-stan-model-1"><i class="fa fa-check"></i><b>7.4.2</b> The <em>Stan</em> model</a></li>
<li class="chapter" data-level="7.4.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#results-1"><i class="fa fa-check"></i><b>7.4.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#some-code-used-to-estimate-the-models-1"><i class="fa fa-check"></i><b>7.5</b> Some code used to estimate the models</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#loading-the-data"><i class="fa fa-check"></i><b>7.5.1</b> Loading the data</a></li>
<li class="chapter" data-level="7.5.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#estimating-the-representative-agent-models"><i class="fa fa-check"></i><b>7.5.2</b> Estimating the representative agent models</a></li>
<li class="chapter" data-level="7.5.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#estimating-the-hierarchical-model"><i class="fa fa-check"></i><b>7.5.3</b> Estimating the hierarchical model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="strategy-frequency-estimation.html"><a href="strategy-frequency-estimation.html"><i class="fa fa-check"></i><b>8</b> Strategy Frequency Estimation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="strategy-frequency-estimation.html"><a href="strategy-frequency-estimation.html#basic-model-and-data"><i class="fa fa-check"></i><b>8.1</b> Basic model and data</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="strategy-frequency-estimation.html"><a href="strategy-frequency-estimation.html#data-wrangling"><i class="fa fa-check"></i><b>8.1.1</b> Data wrangling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="outline-of-future-chapters.html"><a href="outline-of-future-chapters.html"><i class="fa fa-check"></i>Outline of future chapters</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Structural Bayesian Techniques for Experimental and Behavioral Economics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="application-experience-weighted-attraction" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> Application: Experience-Weighted Attraction<a href="application-experience-weighted-attraction.html#application-experience-weighted-attraction" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this application, I will run you through my take on a Bayesian version of Table 3 of <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span>, which reports estimates of parameters in the Experience-Weighted Attraction model <span class="citation">(<a href="#ref-Camerer1999" role="doc-biblioref">Camerer and Ho 1999</a>)</span>. In this experiment, participants played 80 rounds of a modification of Rock Paper Scissors called “Rock Paper Scissors Dumb”, which is shown in Table <a href="application-experience-weighted-attraction.html#tab:CFH2010TASPpayoffs">7.1</a>. Here the added strategy “Dumb” is never a best response to a pure strategy, but is played with probability <span class="math inline">\(\frac12\)</span> in mixed strategy Nash equilibrium. While the games share the same mixed strategy Nash equilibrium prediction, they diverge in their predictions assuming fictitious play-like learning: in the Stable game play will converge to the Nash equilibrium, whereas in the Unstable game there will be cycles.
Participants played in groups of 12, and were randomly re-matched each period with another participant in their group each round.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="application-experience-weighted-attraction.html#cb89-1" aria-hidden="true" tabindex="-1"></a>dStan<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">&quot;Data/CFH2010TASP/CFH2010TASP_dStan.rds&quot;</span>)</span>
<span id="cb89-2"><a href="application-experience-weighted-attraction.html#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="application-experience-weighted-attraction.html#cb89-3" aria-hidden="true" tabindex="-1"></a>TAB<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb89-4"><a href="application-experience-weighted-attraction.html#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Unstable =</span> dStan<span class="sc">$</span>payoffs[<span class="dv">1</span>,,],</span>
<span id="cb89-5"><a href="application-experience-weighted-attraction.html#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Stable   =</span> dStan<span class="sc">$</span>payoffs[<span class="dv">2</span>,,]</span>
<span id="cb89-6"><a href="application-experience-weighted-attraction.html#cb89-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb89-7"><a href="application-experience-weighted-attraction.html#cb89-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-8"><a href="application-experience-weighted-attraction.html#cb89-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (gg <span class="cf">in</span> <span class="fu">c</span>(<span class="st">&quot;Stable&quot;</span>,<span class="st">&quot;Unstable&quot;</span>)) {</span>
<span id="cb89-9"><a href="application-experience-weighted-attraction.html#cb89-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(TAB[[gg]])<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;rock&quot;</span>,<span class="st">&quot;paper&quot;</span>,<span class="st">&quot;scissors&quot;</span>,<span class="st">&quot;dumb&quot;</span>)</span>
<span id="cb89-10"><a href="application-experience-weighted-attraction.html#cb89-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames</span>(TAB[[gg]])<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;Rock&quot;</span>,<span class="st">&quot;Paper&quot;</span>,<span class="st">&quot;Scissors&quot;</span>,<span class="st">&quot;Dumb&quot;</span>)</span>
<span id="cb89-11"><a href="application-experience-weighted-attraction.html#cb89-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb89-12"><a href="application-experience-weighted-attraction.html#cb89-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-13"><a href="application-experience-weighted-attraction.html#cb89-13" aria-hidden="true" tabindex="-1"></a>TAB <span class="sc">|&gt;</span> <span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&#39;The &quot;Unstable&quot; and &quot;Stable&quot; Rock-Paper-Scissors-Dumb games. Just the payoffs of the row player are shown. The payoffs of the column player are the transpose of the row player.&#39;</span>) <span class="sc">|&gt;</span> <span class="fu">kable_classic</span>(<span class="at">full_width=</span>F) <span class="sc">|&gt;</span> <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">&quot;Unstable treatment&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;Stable treatment&quot;</span> <span class="ot">=</span> <span class="dv">1</span>))</span></code></pre></div>
<table class="kable_wrapper lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="1">
<div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
Unstable treatment
</div>
</th>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="1">
<div style="border-bottom: 1px solid #111111; margin-bottom: -1px; ">
Stable treatment
</div>
</th>
</tr>
</thead>
<caption>
<span id="tab:CFH2010TASPpayoffs">Table 7.1: </span>The “Unstable” and “Stable” Rock-Paper-Scissors-Dumb games. Just the payoffs of the row player are shown. The payoffs of the column player are the transpose of the row player.
</caption>
<tbody>
<tr>
<td>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
rock
</th>
<th style="text-align:right;">
paper
</th>
<th style="text-align:right;">
scissors
</th>
<th style="text-align:right;">
dumb
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Rock
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
120
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
Paper
</td>
<td style="text-align:right;">
120
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
Scissors
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
120
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
Dumb
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</td>
<td>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
rock
</th>
<th style="text-align:right;">
paper
</th>
<th style="text-align:right;">
scissors
</th>
<th style="text-align:right;">
dumb
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Rock
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
Paper
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
Scissors
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
150
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
Dumb
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
90
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<p>In addition to the Stable and Unstable games, participants were also assigned either to a high payoffs or low payoffs treatment, where the “Experimental Francs” in the above table were multiplied by 0.05 and 0.02 US dollars respectively.</p>
<p>In their Table 3, <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span> estimate several permutations of the Experience-Weighted Attraction (EWA) model <span class="citation">(<a href="#ref-Camerer1999" role="doc-biblioref">Camerer and Ho 1999</a>)</span>. This model nests some important special cases of learning models, including Stochastic Fictitious Play (SFP), which assumes that a player’s beliefs in period <span class="math inline">\(t\)</span> are equal to the (potentially weighted) average of empirical choice frequencies observed up to that point. As noted by <span class="citation">Wilcox (<a href="#ref-Wilcox2006" role="doc-biblioref">2006</a>)</span> however, the EWA model suffers from <em>heterogeneity bias</em>: if participants are heterogeneous in their parameters, then pooled estimates of these parameters will be biased. In particular, the pooled estimator favors reinforcement learning over belief learning. Fortunately, one remedy to this is relatively straightforward and lends itself to Bayesian estimation: model the heterogeneity! As such, estimating a hierarchical model makes a lot of sense here.</p>
<div id="the-model-at-the-individual-level" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> The model at the individual level<a href="application-experience-weighted-attraction.html#the-model-at-the-individual-level" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The EWA model <span class="citation">(<a href="#ref-Camerer1999" role="doc-biblioref">Camerer and Ho 1999</a>)</span> is a 4-parameter model that describes how players form expectations about payoffs based on the history of play. These expectations about payoffs are called “attractions”, which evolve according to the following equations:</p>
<p><span class="math display">\[
\begin{aligned}
A^j_{i,t}&amp;=\frac{\phi N_{i,t-1}A_{i,t-1}^j+\left[\delta+(1-\delta)I_{j,t-1}\right]\pi_{j,t-1}}{N_{i,t}}\\
N_{i,t}&amp;=\rho N_{i,t-1}+1
\end{aligned}
\]</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\(\pi_{j,t-1}\)</span> is the payoff the payer would have received had they taken action <span class="math inline">\(j\)</span> in the previous period. That is, it is a function of the action that their opponent took in the previous period.</li>
<li><span class="math inline">\(I_{j,t-1}=1\)</span> iff action <span class="math inline">\(j\)</span> was played in the previous period, zero otherwise.</li>
</ul>
<p>This part of the model has three parameters, all of which are constrained to the unit interval:</p>
<ul>
<li><span class="math inline">\(\phi\)</span> and <span class="math inline">\(\rho\)</span> are “recency” parameters. When both are equal to one, the participant takes a simple average of the payoffs from all previous periods (this is the fictitious play model). If they are both equal and less than one, the participant takes a weighted average of payoffs from all of the previous rounds (this is the weighted fictitious play model).</li>
<li><span class="math inline">\(\delta\)</span> is an “imagination factor”. When <span class="math inline">\(\delta=1\)</span> the player can “imagine” what would have happened if they played action <span class="math inline">\(j\)</span>, even if they had in fact not played action <span class="math inline">\(j\)</span>. On the other hand, when <span class="math inline">\(\delta=0\)</span>, they only consider the payoff that they get from the action they took in the previous period.</li>
</ul>
<p>Players then probabilistically best respond to these attractions. Specifically, the probability of player <span class="math inline">\(i\)</span> taking action <span class="math inline">\(j\)</span> in period <span class="math inline">\(t\)</span> follows a logit choice rule:</p>
<p><span class="math display">\[
p_{i,t}^j=\frac{\exp(\lambda A_{i,t}^{j})}{\sum_{k=1}^n\exp(\lambda A_{i,t}^{k})}
\]</span></p>
<p>where <span class="math inline">\(\lambda&gt;0\)</span> is the choice precision parameter.</p>
<p><span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span> set their initial conditions to <span class="math inline">\(A_{i,0}^j=1\)</span> and <span class="math inline">\(N_{i,0}=0\)</span>, noting that their results are “robust to alternative initial attraction and experience weights” (see their footnote 8). I will stick with this assumption for my analysis.</p>
</div>
<div id="some-computational-and-coding-issues" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Some computational and coding issues<a href="application-experience-weighted-attraction.html#some-computational-and-coding-issues" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>While we are mostly very lucky in experiments to collect our data in a very clean format that usually requires very little tidying, sometimes we get something special. In this case, there was a tornado during one of the sessions, and so these participants only got to play the game for 70 periods, instead of the planned 80.<a href="#fn25" class="footnote-ref" id="fnref25"><sup>25</sup></a> This is why you will see me pass a binary variable to <em>Stan</em> called <code>UseData</code>, which tells it whether or not to let an observation contribute to the likelihood. As you will see in other examples where I use cross-validation, having a variable like <code>UseData</code> is generally helpful anyway, as it allows us to easily turn on or off whether or not we are using some data, without modifying our <em>Stan</em> program. It is also useful if we want to get draws from the prior: just set all of its elements to zero!</p>
<p>Perhaps more importantly for your own applications, I want you to note that there is <em>a lot</em> we can do here to speed up computational time by pre-processing some of the variables in the model. Specifically, the variables <span class="math inline">\(I_{j,t}\)</span> and <span class="math inline">\(\pi_{j,t}\)</span> do not depend on the model’s parameters, and so we can pre-calculate these before passing them to <em>Stan</em>, which means we only have to evaluate these once.<a href="#fn26" class="footnote-ref" id="fnref26"><sup>26</sup></a> This will greatly reduce the computational time compared to doing these in the <code>model</code> or <code>transformed parameters</code> block, which are evaluated thousands of times.</p>
<p>Also, the recursive equation specifying <span class="math inline">\(A_{i,t}^j\)</span> means that we will not be able to avoid looping over the <span class="math inline">\(t\)</span> dimension of this problem: we cannot compute <span class="math inline">\(A_{i,t}^j\)</span> without knowing <span class="math inline">\(A_{i,t-1}^j\)</span>. Since there were 80 periods per participant, this could be a considerable time suck for <em>Stan</em>. That being said, with some careful thought to vectorization, we <em>will</em> be able to avoid looping over the <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> dimensions. This will greatly speed things up compared to a triple <code>for</code> loop. I have left my inefficient code looping over <span class="math inline">\(i\)</span> in the <em>Stan</em> file for the representative agent model, commented out, to show you what the double <code>for</code> loop would look like. Spotting these vectorized representations of the operations we need to do will usually come in handy, and while it might not save too much time for the representative agent model, the time savings will be carried through when we are estimating the hierarchical model. As you will see in my code for the representative agent model, I don’t give a hoot about eliminating triple <code>for</code> loops in the <code>transformed data</code> block. This block will only run once, so the time savings will be negligible. On the other hand, the <code>transformed parameters</code>, <code>model</code>, and to a lesser extent <code>generated quantities</code><a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a> blocks will have to run thousands of times to get your posterior simulation, so for these blocks it is usually worth vectorizing things.</p>
<p>Finally, while datasets from economic experiments are not usually that big, our posterior simulations from hierarchical models can get large. This is because the augmented data will have several individual-level parameters per participant.<a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a>
While I don’t run into any RAM constraints on my laptop in running this, I <em>do</em> like to back all of my work up in the cloud somewhere, so you might want to think about how much you save and where it goes. There is nothing in this chapter that cannot be re-run in a day if you have to, so saving just the code to get you the estimates in the cloud may be an appropriate choice if your Dropbox is getting full. This is why I use the <code>pars = ..., include = FALSE</code> options when calling <code>sampling</code> for the hierarchical model.</p>
</div>
<div id="representative-agent-models" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Representative agent models<a href="application-experience-weighted-attraction.html#representative-agent-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s start with estimating some representative agent models. I do this not because we should take them as seriously as the hierarchical model, but because they are a useful stepping stone for getting us to the hierarchical model. We can also compare these to the hierarchical model to see how much heterogeneity bias we might get. Additionally, as <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span> also estimate these representative agent models, I will have an opportunity to verify that my code is working correctly before going to the more complicated model.</p>
<div id="prior-calibration" class="section level3 hasAnchor" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Prior calibration<a href="application-experience-weighted-attraction.html#prior-calibration" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To begin with, let’s think about priors. We have four parameters: <span class="math inline">\(\phi\in(0,1)\)</span>, <span class="math inline">\(\rho\in(0,1)\)</span>, <span class="math inline">\(\delta\in(0,1)\)</span>, and <span class="math inline">\(\lambda\in(0,\infty)\)</span>. Since the first three are all constrained to the unit interval, a good starting place is to use the uniform distribution. In my code, I allow this to be a Beta distribution, which generalizes the uniform, but I will stick to the uniform to keep things simple.</p>
<p>For <span class="math inline">\(\lambda\)</span>, we want to constrain it to positive real numbers, so a log-normal distribution is appropriate:
<span class="math display">\[
\log\lambda\sim N(m_\lambda,s_\lambda^2)
\]</span>
The difficulty in choosing <span class="math inline">\(\lambda\)</span> is choosing an appropriate scale, which since we are dealing with a <em>log</em>-normal distribution, is as much about its median as it is about its standard deviation. Small <span class="math inline">\(\lambda\)</span> implies choices are not very precise, so participants will not be very sensitive to the attractions <span class="math inline">\(A_{i,t}^j\)</span>. On the other hand if <span class="math inline">\(\lambda\)</span> is large, choices will be precise, and small changes in <span class="math inline">\(A_{i,t}^j\)</span> will imply large changes in choice probabilities. But what exactly are “small” and “large” values of <span class="math inline">\(\lambda\)</span>? I find it helps here to plot some predicted choice probabilities over a relevant scale of payoffs. Note that in Table <a href="application-experience-weighted-attraction.html#tab:CFH2010TASPpayoffs">7.1</a>, the smallest payoff is zero points, and the largest payoff is 150 points. Therefore payoff differences must be in this range. Converting this to dollars by using the average of the two exchange rates, we therefore have a range of <span class="math inline">\([0,150\times 0.035]=[0,5.25]\)</span>. We can use the logit Quantal Response Equilibrium (QRE) predictions to further narrow down this scale. Fortunately in this game, computing the Quantal Response Equilibrium is really easy, because <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span> derive the results for us, and it turns out that we can characterize the Quantal Response Equilibrium as <span class="math inline">\(\hat p=\begin{pmatrix}m,m,m,k\end{pmatrix}\)</span>, where <span class="math inline">\(k\in[0.25,0.5]\)</span> and <span class="math inline">\(m = (1-k)/3\)</span>. Because there is a unique <span class="math inline">\(\lambda\)</span> for each QRE, we can back it out once we know the equilibrium probabilities:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="application-experience-weighted-attraction.html#cb90-1" aria-hidden="true" tabindex="-1"></a>pD<span class="ot">&lt;-</span><span class="fu">seq</span>(<span class="fl">0.25</span>,<span class="fl">0.5-1e-6</span>,<span class="at">length=</span><span class="dv">100</span>)</span>
<span id="cb90-2"><a href="application-experience-weighted-attraction.html#cb90-2" aria-hidden="true" tabindex="-1"></a>ExRate<span class="ot">&lt;-</span><span class="fl">0.035</span></span>
<span id="cb90-3"><a href="application-experience-weighted-attraction.html#cb90-3" aria-hidden="true" tabindex="-1"></a>Uunstable<span class="ot">&lt;-</span>dStan<span class="sc">$</span>payoffs[<span class="dv">1</span>,,]</span>
<span id="cb90-4"><a href="application-experience-weighted-attraction.html#cb90-4" aria-hidden="true" tabindex="-1"></a>Ustable<span class="ot">&lt;-</span>dStan<span class="sc">$</span>payoffs[<span class="dv">2</span>,,]</span>
<span id="cb90-5"><a href="application-experience-weighted-attraction.html#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="application-experience-weighted-attraction.html#cb90-6" aria-hidden="true" tabindex="-1"></a>QRE<span class="ot">&lt;-</span><span class="fu">tibble</span>()</span>
<span id="cb90-7"><a href="application-experience-weighted-attraction.html#cb90-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pp <span class="cf">in</span> pD) {</span>
<span id="cb90-8"><a href="application-experience-weighted-attraction.html#cb90-8" aria-hidden="true" tabindex="-1"></a>  p<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fu">rep</span>((<span class="dv">1</span><span class="sc">-</span>pp)<span class="sc">/</span><span class="dv">3</span>,<span class="dv">3</span>),pp)</span>
<span id="cb90-9"><a href="application-experience-weighted-attraction.html#cb90-9" aria-hidden="true" tabindex="-1"></a>  U<span class="ot">&lt;-</span>Uunstable<span class="sc">%*%</span>p<span class="sc">*</span>ExRate</span>
<span id="cb90-10"><a href="application-experience-weighted-attraction.html#cb90-10" aria-hidden="true" tabindex="-1"></a>  lambda<span class="ot">&lt;-</span>(<span class="fu">log</span>(p[<span class="dv">1</span>])<span class="sc">-</span><span class="fu">log</span>(p[<span class="dv">4</span>]))<span class="sc">/</span>(U[<span class="dv">1</span>]<span class="sc">-</span>U[<span class="dv">4</span>])</span>
<span id="cb90-11"><a href="application-experience-weighted-attraction.html#cb90-11" aria-hidden="true" tabindex="-1"></a>  QRE<span class="ot">&lt;-</span><span class="fu">rbind</span>(QRE,</span>
<span id="cb90-12"><a href="application-experience-weighted-attraction.html#cb90-12" aria-hidden="true" tabindex="-1"></a>             <span class="fu">tibble</span>(<span class="at">game=</span><span class="st">&quot;Unstable&quot;</span>,<span class="at">pD =</span> pp,<span class="at">lambda =</span> lambda)</span>
<span id="cb90-13"><a href="application-experience-weighted-attraction.html#cb90-13" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb90-14"><a href="application-experience-weighted-attraction.html#cb90-14" aria-hidden="true" tabindex="-1"></a>  U<span class="ot">&lt;-</span>Ustable<span class="sc">%*%</span>p<span class="sc">*</span>ExRate</span>
<span id="cb90-15"><a href="application-experience-weighted-attraction.html#cb90-15" aria-hidden="true" tabindex="-1"></a>  lambda<span class="ot">&lt;-</span>(<span class="fu">log</span>(p[<span class="dv">1</span>])<span class="sc">-</span><span class="fu">log</span>(p[<span class="dv">4</span>]))<span class="sc">/</span>(U[<span class="dv">1</span>]<span class="sc">-</span>U[<span class="dv">4</span>])</span>
<span id="cb90-16"><a href="application-experience-weighted-attraction.html#cb90-16" aria-hidden="true" tabindex="-1"></a>  QRE<span class="ot">&lt;-</span><span class="fu">rbind</span>(QRE,</span>
<span id="cb90-17"><a href="application-experience-weighted-attraction.html#cb90-17" aria-hidden="true" tabindex="-1"></a>             <span class="fu">tibble</span>(<span class="at">game=</span><span class="st">&quot;Stable&quot;</span>,<span class="at">pD =</span> pp,<span class="at">lambda =</span> lambda)</span>
<span id="cb90-18"><a href="application-experience-weighted-attraction.html#cb90-18" aria-hidden="true" tabindex="-1"></a>             )</span>
<span id="cb90-19"><a href="application-experience-weighted-attraction.html#cb90-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb90-20"><a href="application-experience-weighted-attraction.html#cb90-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-21"><a href="application-experience-weighted-attraction.html#cb90-21" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb90-22"><a href="application-experience-weighted-attraction.html#cb90-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(QRE,<span class="fu">aes</span>(<span class="at">x=</span>lambda,<span class="at">y=</span>pD,<span class="at">linetype =</span> game))</span>
<span id="cb90-23"><a href="application-experience-weighted-attraction.html#cb90-23" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_path</span>()</span>
<span id="cb90-24"><a href="application-experience-weighted-attraction.html#cb90-24" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">scale_x_continuous</span>(<span class="at">trans=</span><span class="st">&quot;log10&quot;</span>)</span>
<span id="cb90-25"><a href="application-experience-weighted-attraction.html#cb90-25" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb90-26"><a href="application-experience-weighted-attraction.html#cb90-26" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Probability of playing &#39;Dumb&#39;&quot;</span>)</span>
<span id="cb90-27"><a href="application-experience-weighted-attraction.html#cb90-27" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="fu">expression</span>(lambda))</span>
<span id="cb90-28"><a href="application-experience-weighted-attraction.html#cb90-28" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:CFH2010TASPqreplot"></span>
<img src="index_files/figure-html/CFH2010TASPqreplot-1.png" alt="Quantal Response Equilibrium probabilities of choosing 'Dumb'" width="672" />
<p class="caption">
Figure 7.1: Quantal Response Equilibrium probabilities of choosing ‘Dumb’
</p>
</div>
<p>Some things to note here:</p>
<ol style="list-style-type: decimal">
<li>The Quantal Response Equilibrium probability of playing Dumb is the same for both games (this is derived in <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span>). We can see this in the plot because both curves lie on top of each other.</li>
<li>All of the interesting stuff seems to be happening between <span class="math inline">\(\lambda=0.1\)</span> and <span class="math inline">\(\lambda = 100\)</span>.</li>
</ol>
<p>Let’s target our prior so that we place 95% prior probability mass in this “interesting” range. This sets up the following system of equations:</p>
<p><span class="math display">\[
\begin{aligned}
-1.96s_\lambda&amp;=\log(0.1)-m_\lambda\\
1.96s_\lambda&amp;=\log(100)-m_\lambda\\
\\
m_\lambda&amp;=\frac{1}{2}\left(\log(100)+\log(0.1)\right)\approx1.15\\
s_\lambda&amp;=\frac{\log(100)-\log(0.1)}{2\times 1.96}\approx1.76
\end{aligned}
\]</span></p>
<p>And so our prior for <span class="math inline">\(\lambda\)</span> is:</p>
<p><span class="math display">\[
\log\lambda \sim N(1.15,1.76^2)
\]</span></p>
</div>
<div id="the-stan-model" class="section level3 hasAnchor" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> The <em>Stan</em> model<a href="application-experience-weighted-attraction.html#the-stan-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here is the code I came up with to implement the model in <em>Stan</em>.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb91-1"><a href="application-experience-weighted-attraction.html#cb91-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-2"><a href="application-experience-weighted-attraction.html#cb91-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb91-3"><a href="application-experience-weighted-attraction.html#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> nPeriods<span class="op">;</span></span>
<span id="cb91-4"><a href="application-experience-weighted-attraction.html#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> nParticipants<span class="op">;</span></span>
<span id="cb91-5"><a href="application-experience-weighted-attraction.html#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> nGames<span class="op">;</span></span>
<span id="cb91-6"><a href="application-experience-weighted-attraction.html#cb91-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> nActions<span class="op">;</span></span>
<span id="cb91-7"><a href="application-experience-weighted-attraction.html#cb91-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-8"><a href="application-experience-weighted-attraction.html#cb91-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// action chosen. 1=Rock, 2=Paper, 3=Scissors, 4=Dumb</span></span>
<span id="cb91-9"><a href="application-experience-weighted-attraction.html#cb91-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> direction<span class="op">[</span>nPeriods<span class="op">,</span>nParticipants<span class="op">];</span></span>
<span id="cb91-10"><a href="application-experience-weighted-attraction.html#cb91-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-11"><a href="application-experience-weighted-attraction.html#cb91-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// =1 if low payoffs used, =2 if high payoffs used</span></span>
<span id="cb91-12"><a href="application-experience-weighted-attraction.html#cb91-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> HiPay<span class="op">[</span>nPeriods<span class="op">,</span>nParticipants<span class="op">];</span></span>
<span id="cb91-13"><a href="application-experience-weighted-attraction.html#cb91-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-14"><a href="application-experience-weighted-attraction.html#cb91-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// first element: low payoffs exchange rate</span></span>
<span id="cb91-15"><a href="application-experience-weighted-attraction.html#cb91-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// second element: high payoffs exchange rate</span></span>
<span id="cb91-16"><a href="application-experience-weighted-attraction.html#cb91-16" aria-hidden="true" tabindex="-1"></a>  real payoff_multipliers<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb91-17"><a href="application-experience-weighted-attraction.html#cb91-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-18"><a href="application-experience-weighted-attraction.html#cb91-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// =1 if the observation should contribute to the likelihood</span></span>
<span id="cb91-19"><a href="application-experience-weighted-attraction.html#cb91-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> UseData<span class="op">[</span>nPeriods<span class="op">,</span>nParticipants<span class="op">];</span></span>
<span id="cb91-20"><a href="application-experience-weighted-attraction.html#cb91-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-21"><a href="application-experience-weighted-attraction.html#cb91-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-22"><a href="application-experience-weighted-attraction.html#cb91-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Pre-calculated components of the EWA model</span></span>
<span id="cb91-23"><a href="application-experience-weighted-attraction.html#cb91-23" aria-hidden="true" tabindex="-1"></a>  real PI<span class="op">[</span>nPeriods<span class="op">,</span>nParticipants<span class="op">,</span>nActions<span class="op">];</span></span>
<span id="cb91-24"><a href="application-experience-weighted-attraction.html#cb91-24" aria-hidden="true" tabindex="-1"></a>  real I<span class="op">[</span>nPeriods<span class="op">,</span>nParticipants<span class="op">,</span>nActions<span class="op">];</span></span>
<span id="cb91-25"><a href="application-experience-weighted-attraction.html#cb91-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-26"><a href="application-experience-weighted-attraction.html#cb91-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb91-27"><a href="application-experience-weighted-attraction.html#cb91-27" aria-hidden="true" tabindex="-1"></a>  real prior_phi<span class="op">[</span><span class="dv">2</span><span class="op">];</span> <span class="co">// Beta</span></span>
<span id="cb91-28"><a href="application-experience-weighted-attraction.html#cb91-28" aria-hidden="true" tabindex="-1"></a>  real prior_delta<span class="op">[</span><span class="dv">2</span><span class="op">];</span> <span class="co">// Beta</span></span>
<span id="cb91-29"><a href="application-experience-weighted-attraction.html#cb91-29" aria-hidden="true" tabindex="-1"></a>  real prior_rho<span class="op">[</span><span class="dv">2</span><span class="op">];</span> <span class="co">// Beta</span></span>
<span id="cb91-30"><a href="application-experience-weighted-attraction.html#cb91-30" aria-hidden="true" tabindex="-1"></a>  real prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">];</span> <span class="co">// log-normal</span></span>
<span id="cb91-31"><a href="application-experience-weighted-attraction.html#cb91-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-32"><a href="application-experience-weighted-attraction.html#cb91-32" aria-hidden="true" tabindex="-1"></a>  real max_payoff<span class="op">;</span></span>
<span id="cb91-33"><a href="application-experience-weighted-attraction.html#cb91-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb91-34"><a href="application-experience-weighted-attraction.html#cb91-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-35"><a href="application-experience-weighted-attraction.html#cb91-35" aria-hidden="true" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb91-36"><a href="application-experience-weighted-attraction.html#cb91-36" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">[</span>nParticipants<span class="op">,</span>nActions<span class="op">]</span> DIRECTION<span class="op">[</span>nPeriods<span class="op">];</span></span>
<span id="cb91-37"><a href="application-experience-weighted-attraction.html#cb91-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-38"><a href="application-experience-weighted-attraction.html#cb91-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>tt in <span class="dv">1</span><span class="op">:</span>nPeriods<span class="op">)</span> <span class="op">{</span></span>
<span id="cb91-39"><a href="application-experience-weighted-attraction.html#cb91-39" aria-hidden="true" tabindex="-1"></a>    DIRECTION<span class="op">[</span>tt<span class="op">]</span> <span class="op">=</span> rep_matrix<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>nParticipants<span class="op">,</span>nActions<span class="op">);</span></span>
<span id="cb91-40"><a href="application-experience-weighted-attraction.html#cb91-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nParticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb91-41"><a href="application-experience-weighted-attraction.html#cb91-41" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>aa in <span class="dv">1</span><span class="op">:</span>nActions<span class="op">)</span> <span class="op">{</span></span>
<span id="cb91-42"><a href="application-experience-weighted-attraction.html#cb91-42" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>direction<span class="op">[</span>tt<span class="op">,</span>ii<span class="op">]==</span>aa<span class="op">)</span> <span class="op">{</span></span>
<span id="cb91-43"><a href="application-experience-weighted-attraction.html#cb91-43" aria-hidden="true" tabindex="-1"></a>          DIRECTION<span class="op">[</span>tt<span class="op">][</span>ii<span class="op">,</span>aa<span class="op">]</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb91-44"><a href="application-experience-weighted-attraction.html#cb91-44" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb91-45"><a href="application-experience-weighted-attraction.html#cb91-45" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb91-46"><a href="application-experience-weighted-attraction.html#cb91-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb91-47"><a href="application-experience-weighted-attraction.html#cb91-47" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb91-48"><a href="application-experience-weighted-attraction.html#cb91-48" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb91-49"><a href="application-experience-weighted-attraction.html#cb91-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-50"><a href="application-experience-weighted-attraction.html#cb91-50" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb91-51"><a href="application-experience-weighted-attraction.html#cb91-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-52"><a href="application-experience-weighted-attraction.html#cb91-52" aria-hidden="true" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">,</span>upper<span class="op">=</span><span class="dv">1</span><span class="op">&gt;</span> phi<span class="op">;</span> <span class="co">// recency</span></span>
<span id="cb91-53"><a href="application-experience-weighted-attraction.html#cb91-53" aria-hidden="true" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">,</span>upper<span class="op">=</span><span class="dv">1</span><span class="op">&gt;</span> rho<span class="op">;</span> <span class="co">// recency</span></span>
<span id="cb91-54"><a href="application-experience-weighted-attraction.html#cb91-54" aria-hidden="true" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">,</span>upper<span class="op">=</span><span class="dv">1</span><span class="op">&gt;</span> delta<span class="op">;</span> <span class="co">// imagination</span></span>
<span id="cb91-55"><a href="application-experience-weighted-attraction.html#cb91-55" aria-hidden="true" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> lambda<span class="op">;</span> <span class="co">// precision</span></span>
<span id="cb91-56"><a href="application-experience-weighted-attraction.html#cb91-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-57"><a href="application-experience-weighted-attraction.html#cb91-57" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb91-58"><a href="application-experience-weighted-attraction.html#cb91-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-59"><a href="application-experience-weighted-attraction.html#cb91-59" aria-hidden="true" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb91-60"><a href="application-experience-weighted-attraction.html#cb91-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-61"><a href="application-experience-weighted-attraction.html#cb91-61" aria-hidden="true" tabindex="-1"></a>  <span class="co">// initial conditions. See CFH201 footnote 8</span></span>
<span id="cb91-62"><a href="application-experience-weighted-attraction.html#cb91-62" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">[</span>nParticipants<span class="op">,</span>nActions<span class="op">]</span> A <span class="op">=</span> rep_matrix<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nParticipants<span class="op">,</span>nActions<span class="op">);</span></span>
<span id="cb91-63"><a href="application-experience-weighted-attraction.html#cb91-63" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>nParticipants<span class="op">]</span> N <span class="op">=</span> rep_vector<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>nParticipants<span class="op">);</span></span>
<span id="cb91-64"><a href="application-experience-weighted-attraction.html#cb91-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-65"><a href="application-experience-weighted-attraction.html#cb91-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-66"><a href="application-experience-weighted-attraction.html#cb91-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-67"><a href="application-experience-weighted-attraction.html#cb91-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>tt in <span class="dv">1</span><span class="op">:</span>nPeriods<span class="op">)</span> <span class="op">{</span></span>
<span id="cb91-68"><a href="application-experience-weighted-attraction.html#cb91-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-69"><a href="application-experience-weighted-attraction.html#cb91-69" aria-hidden="true" tabindex="-1"></a>    <span class="co">// increment the likelihood</span></span>
<span id="cb91-70"><a href="application-experience-weighted-attraction.html#cb91-70" aria-hidden="true" tabindex="-1"></a>    matrix<span class="op">[</span>nParticipants<span class="op">,</span>nActions<span class="op">]</span> lA <span class="op">=</span> lambda<span class="op">*(</span>to_vector<span class="op">(</span>payoff_multipliers<span class="op">[</span>HiPay<span class="op">[</span>tt<span class="op">,]])*</span>rep_row_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">)).*(</span>A<span class="op">-</span>max_payoff<span class="op">);</span></span>
<span id="cb91-71"><a href="application-experience-weighted-attraction.html#cb91-71" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">[</span>nParticipants<span class="op">]</span> lsum_lA <span class="op">=</span> log<span class="op">(</span>exp<span class="op">(</span>lA<span class="op">)*</span>rep_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">));</span></span>
<span id="cb91-72"><a href="application-experience-weighted-attraction.html#cb91-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-73"><a href="application-experience-weighted-attraction.html#cb91-73" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*</span></span>
<span id="cb91-74"><a href="application-experience-weighted-attraction.html#cb91-74" aria-hidden="true" tabindex="-1"></a><span class="co">    Note here the for loop that would do the same thing as the uncommented line below it</span></span>
<span id="cb91-75"><a href="application-experience-weighted-attraction.html#cb91-75" aria-hidden="true" tabindex="-1"></a><span class="co">    I construct DIRECTION in the transformed data block</span></span>
<span id="cb91-76"><a href="application-experience-weighted-attraction.html#cb91-76" aria-hidden="true" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb91-77"><a href="application-experience-weighted-attraction.html#cb91-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-78"><a href="application-experience-weighted-attraction.html#cb91-78" aria-hidden="true" tabindex="-1"></a>    <span class="co">//for (ii in 1:nParticipants) {</span></span>
<span id="cb91-79"><a href="application-experience-weighted-attraction.html#cb91-79" aria-hidden="true" tabindex="-1"></a>    <span class="co">//  target+= UseData[tt,ii]*(lA[tt,direction[tt,ii]]-lsum_lA[ii]);</span></span>
<span id="cb91-80"><a href="application-experience-weighted-attraction.html#cb91-80" aria-hidden="true" tabindex="-1"></a>    <span class="co">//}</span></span>
<span id="cb91-81"><a href="application-experience-weighted-attraction.html#cb91-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-82"><a href="application-experience-weighted-attraction.html#cb91-82" aria-hidden="true" tabindex="-1"></a>    target<span class="op">+=</span>to_vector<span class="op">(</span>UseData<span class="op">[</span>tt<span class="op">,])</span> <span class="op">.*</span> <span class="op">(((</span>lA<span class="op">-</span>lsum_lA<span class="op">*</span>rep_row_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">))</span> <span class="op">.*</span> DIRECTION<span class="op">[</span>tt<span class="op">])*</span>rep_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">));</span></span>
<span id="cb91-83"><a href="application-experience-weighted-attraction.html#cb91-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-84"><a href="application-experience-weighted-attraction.html#cb91-84" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-85"><a href="application-experience-weighted-attraction.html#cb91-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-86"><a href="application-experience-weighted-attraction.html#cb91-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-87"><a href="application-experience-weighted-attraction.html#cb91-87" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update A and N</span></span>
<span id="cb91-88"><a href="application-experience-weighted-attraction.html#cb91-88" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-89"><a href="application-experience-weighted-attraction.html#cb91-89" aria-hidden="true" tabindex="-1"></a>    matrix<span class="op">[</span>nParticipants<span class="op">,</span>nActions<span class="op">]</span> I_t <span class="op">=</span> to_matrix<span class="op">(</span>I<span class="op">[</span>tt<span class="op">,,]);</span></span>
<span id="cb91-90"><a href="application-experience-weighted-attraction.html#cb91-90" aria-hidden="true" tabindex="-1"></a>    matrix<span class="op">[</span>nParticipants<span class="op">,</span>nActions<span class="op">]</span> pi_t <span class="op">=</span> to_matrix<span class="op">(</span>PI<span class="op">[</span>tt<span class="op">,,]);</span></span>
<span id="cb91-91"><a href="application-experience-weighted-attraction.html#cb91-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-92"><a href="application-experience-weighted-attraction.html#cb91-92" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> <span class="op">(</span>phi<span class="op">*(</span>N<span class="op">*</span>rep_row_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">)).*</span>A<span class="op">+(</span>delta<span class="op">+(</span><span class="fl">1.0</span><span class="op">-</span>delta<span class="op">)*</span>I_t<span class="op">).*</span>pi_t<span class="op">)</span></span>
<span id="cb91-93"><a href="application-experience-weighted-attraction.html#cb91-93" aria-hidden="true" tabindex="-1"></a>          <span class="op">./</span> <span class="op">(</span>rho <span class="op">*</span> N <span class="op">*</span> rep_row_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">)+</span><span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb91-94"><a href="application-experience-weighted-attraction.html#cb91-94" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb91-95"><a href="application-experience-weighted-attraction.html#cb91-95" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> rho<span class="op">*</span>N<span class="op">+</span><span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb91-96"><a href="application-experience-weighted-attraction.html#cb91-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb91-97"><a href="application-experience-weighted-attraction.html#cb91-97" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb91-98"><a href="application-experience-weighted-attraction.html#cb91-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-99"><a href="application-experience-weighted-attraction.html#cb91-99" aria-hidden="true" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb91-100"><a href="application-experience-weighted-attraction.html#cb91-100" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-101"><a href="application-experience-weighted-attraction.html#cb91-101" aria-hidden="true" tabindex="-1"></a>  phi <span class="op">~</span> beta<span class="op">(</span>prior_phi<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_phi<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb91-102"><a href="application-experience-weighted-attraction.html#cb91-102" aria-hidden="true" tabindex="-1"></a>  rho <span class="op">~</span> beta<span class="op">(</span>prior_rho<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_rho<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb91-103"><a href="application-experience-weighted-attraction.html#cb91-103" aria-hidden="true" tabindex="-1"></a>  delta <span class="op">~</span> beta<span class="op">(</span>prior_delta<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_delta<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb91-104"><a href="application-experience-weighted-attraction.html#cb91-104" aria-hidden="true" tabindex="-1"></a>  lambda <span class="op">~</span> lognormal<span class="op">(</span>prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb91-105"><a href="application-experience-weighted-attraction.html#cb91-105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb91-106"><a href="application-experience-weighted-attraction.html#cb91-106" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>One thing to note from this code is that I have subtracted the variable <code>max_payoff</code> from all of the attractions before exponentiating them to compute choice probabilities. Mathematically this does absolutely nothing, because:</p>
<p><span class="math display">\[\frac{\exp(x-a)}{\exp(x-a)+\exp(y-a)}=\frac{\exp(x)}{\exp(y)+\exp(y)}\]</span></p>
<p>does not depend on <span class="math inline">\(a\)</span>. However this doesn’t do nothing for <em>computing</em> the choice probabilities. In particular, if <span class="math inline">\(x\)</span> is large, then <span class="math inline">\(\exp(x)\)</span> is <em>really</em> large, and our poor computer may have some trouble handling it. The solution I use is to subtract a large constant (i.e. the maximum payoff in the game) from all attractions. This way we are always exponentiating numbers that are less than zero. Since this is the functional form we are using for choice probabilities, we are taking logs of them when we increment the likelihood. If (in this simplified example) <span class="math inline">\(y\)</span> is very large and positive, then <code>exp(y)</code> might be “rounded” to <code>Inf</code>, in which case the fraction becomes indistinguishable from zero, and the log-likelihood is <code>-Inf</code>. Keeping the numbers that we are exponentiating in a <code>softmax</code> small will avoid this problem. In fact, I suspect that <em>Stan</em>’s inbuilt <code>softmax</code> function will do this for you, but unfortunately in this application it did not lend itself to my vectorization of the problem.</p>
</div>
<div id="results" class="section level3 hasAnchor" number="7.3.3">
<h3><span class="header-section-number">7.3.3</span> Results<a href="application-experience-weighted-attraction.html#results" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here I replicate the first panel Table 3 of <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span>, which estimates a pooled model for each of the four treatments. I also include a fifth column pooling all of the data.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="application-experience-weighted-attraction.html#cb92-1" aria-hidden="true" tabindex="-1"></a>rounding<span class="ot">&lt;-</span><span class="dv">3</span> </span>
<span id="cb92-2"><a href="application-experience-weighted-attraction.html#cb92-2" aria-hidden="true" tabindex="-1"></a>RAEstimatesList<span class="ot">&lt;-</span><span class="fu">dir</span>(<span class="at">path=</span><span class="st">&quot;Code/CFH2010TASP&quot;</span>,<span class="at">pattern=</span><span class="st">&quot;Estimates_RA_&quot;</span>)</span>
<span id="cb92-3"><a href="application-experience-weighted-attraction.html#cb92-3" aria-hidden="true" tabindex="-1"></a>TABLE<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb92-4"><a href="application-experience-weighted-attraction.html#cb92-4" aria-hidden="true" tabindex="-1"></a>names<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb92-5"><a href="application-experience-weighted-attraction.html#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ee <span class="cf">in</span> RAEstimatesList) {</span>
<span id="cb92-6"><a href="application-experience-weighted-attraction.html#cb92-6" aria-hidden="true" tabindex="-1"></a>  estimates<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="fu">paste0</span>(<span class="st">&quot;Code/CFH2010TASP/&quot;</span>,ee)) <span class="sc">|&gt;</span> <span class="fu">round</span>(rounding)</span>
<span id="cb92-7"><a href="application-experience-weighted-attraction.html#cb92-7" aria-hidden="true" tabindex="-1"></a>  msd<span class="ot">&lt;-</span><span class="fu">paste0</span>(estimates[,<span class="st">&quot;mean&quot;</span>],<span class="st">&quot; (&quot;</span>,estimates[,<span class="st">&quot;sd&quot;</span>],<span class="st">&quot;)&quot;</span>)</span>
<span id="cb92-8"><a href="application-experience-weighted-attraction.html#cb92-8" aria-hidden="true" tabindex="-1"></a>  TABLE<span class="ot">&lt;-</span><span class="fu">cbind</span>(TABLE,msd)</span>
<span id="cb92-9"><a href="application-experience-weighted-attraction.html#cb92-9" aria-hidden="true" tabindex="-1"></a>  names<span class="ot">&lt;-</span><span class="fu">c</span>(names,ee <span class="sc">|&gt;</span> <span class="fu">str_remove</span>(<span class="st">&quot;Estimates_RA_&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">str_remove</span>(<span class="st">&quot;.rds&quot;</span>))</span>
<span id="cb92-10"><a href="application-experience-weighted-attraction.html#cb92-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-11"><a href="application-experience-weighted-attraction.html#cb92-11" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(TABLE)<span class="ot">&lt;-</span>names</span>
<span id="cb92-12"><a href="application-experience-weighted-attraction.html#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(TABLE)<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;\u03d5&quot;</span>,<span class="st">&quot;\u03c1&quot;</span>,<span class="st">&quot;\u03b4&quot;</span>,<span class="st">&quot;\u03bb&quot;</span>,<span class="st">&quot;lp__&quot;</span>)</span>
<span id="cb92-13"><a href="application-experience-weighted-attraction.html#cb92-13" aria-hidden="true" tabindex="-1"></a>TABLE <span class="sc">|&gt;</span> <span class="fu">kbl</span>(<span class="at">caption=</span><span class="st">&quot;Posterior moments (means with standard deviations in parentheses) of the representative agent models. &quot;</span>) <span class="sc">|&gt;</span> <span class="fu">kable_classic</span>(<span class="at">full_width=</span>F)</span></code></pre></div>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:CFH2010TASPpooledestimates">Table 7.2: </span>Posterior moments (means with standard deviations in parentheses) of the representative agent models.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
Pooled
</th>
<th style="text-align:left;">
StableHi
</th>
<th style="text-align:left;">
StableLow
</th>
<th style="text-align:left;">
UnstableHi
</th>
<th style="text-align:left;">
UnstableLow
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ϕ
</td>
<td style="text-align:left;">
0.909 (0.004)
</td>
<td style="text-align:left;">
0.934 (0.006)
</td>
<td style="text-align:left;">
0.91 (0.007)
</td>
<td style="text-align:left;">
0.882 (0.011)
</td>
<td style="text-align:left;">
0.888 (0.009)
</td>
</tr>
<tr>
<td style="text-align:left;">
ρ
</td>
<td style="text-align:left;">
0.564 (0.063)
</td>
<td style="text-align:left;">
0.437 (0.184)
</td>
<td style="text-align:left;">
0.59 (0.106)
</td>
<td style="text-align:left;">
0.404 (0.157)
</td>
<td style="text-align:left;">
0.474 (0.166)
</td>
</tr>
<tr>
<td style="text-align:left;">
δ
</td>
<td style="text-align:left;">
0.007 (0.006)
</td>
<td style="text-align:left;">
0.018 (0.016)
</td>
<td style="text-align:left;">
0.012 (0.011)
</td>
<td style="text-align:left;">
0.032 (0.023)
</td>
<td style="text-align:left;">
0.021 (0.018)
</td>
</tr>
<tr>
<td style="text-align:left;">
λ
</td>
<td style="text-align:left;">
0.355 (0.046)
</td>
<td style="text-align:left;">
0.257 (0.082)
</td>
<td style="text-align:left;">
0.42 (0.088)
</td>
<td style="text-align:left;">
0.295 (0.074)
</td>
<td style="text-align:left;">
0.365 (0.102)
</td>
</tr>
<tr>
<td style="text-align:left;">
lp__
</td>
<td style="text-align:left;">
-12448.586 (1.498)
</td>
<td style="text-align:left;">
-3070.514 (1.575)
</td>
<td style="text-align:left;">
-3118.543 (1.622)
</td>
<td style="text-align:left;">
-3152.688 (1.551)
</td>
<td style="text-align:left;">
-3115.559 (1.617)
</td>
</tr>
</tbody>
</table>
<p>Comparing this to the left panel in Table 3 of <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span>, these estimates are very similar. This is especially the case for <span class="math inline">\(\phi\)</span>, whose posterior means match their MLE counterparts to at least two decimal places. Since <span class="math inline">\(\rho\)</span> is estimated with less precision than <span class="math inline">\(\phi\)</span> in both tables, it should be unsurprising that there is less agreement between these estimates, however everything is accurate to one standard deviation/error. The biggest discrepancy is for choice precision <span class="math inline">\(\lambda\)</span>, which I estimate to be much larger than do <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span>. I suspect that this is due to my model using US dollars as the unit for utility, whereas it looks like <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span> used experimental francs. Multiplying my estimates of <span class="math inline">\(\lambda\)</span> by the exchange rate at least achieves estimates in the same order of magnitude as their Table 3.</p>
</div>
</div>
<div id="hierarchical-model" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Hierarchical model<a href="application-experience-weighted-attraction.html#hierarchical-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>So now that we have a representative agent model that works, we can move on to extending it to a hierarchical model. To modify the <em>Stan</em> program, we will need to:</p>
<ol style="list-style-type: decimal">
<li>Convert the scalar individual-level parameters <span class="math inline">\(\phi\)</span>, <span class="math inline">\(\rho\)</span>, <span class="math inline">\(\delta\)</span>, and <span class="math inline">\(\lambda\)</span> into vectors of length <code>nParticipants</code>.</li>
<li>Specify the population level parameters and choose some appropriate priors for them</li>
<li>Link the distribution of these individual-level parameters to the new population-level parameters.</li>
</ol>
<p>To speed up computation, I will also use Cholesky factorization of the covariance matrix, which I discuss in the hierarchical models chapter of this book.</p>
<p>The hierarchical specification I will use for this model is:</p>
<p><span class="math display">\[
\begin{aligned}
\begin{pmatrix}
\Phi^{-1}(\phi_i)\\ \Phi^{-1}(\rho_i) \\ \Phi^{-1}(\delta_i) \\ \log (\lambda_i)
\end{pmatrix}=\theta_i\sim N(\mu,\mathrm{diag\_matrix(\tau)}\Omega\mathrm{diag\_matrix(\tau)})
\end{aligned}
\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> is a vector of transformed population means, <span class="math inline">\(\tau\)</span> is a vector of standard deviations, and <span class="math inline">\(\Omega\)</span> is a correlation matrix. The inverse normal cdf transform <span class="math inline">\(\Phi^{-1}(\cdot)\)</span> ensures that parameters <span class="math inline">\(\phi_i\)</span>, <span class="math inline">\(\rho_i\)</span>, and <span class="math inline">\(\delta_i\)</span> are between zero and one, and the log transform ensures that <span class="math inline">\(\lambda_i\)</span> is positive.</p>
<p>Apart from the differences due to my Bayesian implementation and the MLE implementation in <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span>, there are few important differences in this specification:</p>
<ol style="list-style-type: decimal">
<li>I permit correlation between the individual-level parameters through the correlation matrix <span class="math inline">\(\Omega\)</span>. In Table 3 of <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span> these parameters are assumed to be uncorrelated</li>
<li>I assume that all the individual-level parameters are heterogeneous. Note that in the middle panel of Table 3 of <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span>, there is not a measure of spread for parameter <span class="math inline">\(\delta_i\)</span>, whereas there is one for the other three parameters. I take this to mean that <span class="math inline">\(\delta_i\)</span> is assumed to be constant across participants in their models.</li>
</ol>
<div id="prior-calibration-1" class="section level3 hasAnchor" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> Prior calibration<a href="application-experience-weighted-attraction.html#prior-calibration-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here I use the normal-half Cauchy-LKJ type of prior for the population-level parameters <span class="math inline">\(\mu\)</span> <span class="math inline">\(\tau\)</span> and <span class="math inline">\(\Omega\)</span> discussed in the Hierarchical Models chapter of this book. For <span class="math inline">\(\mu\)</span>, I center the priors on each parameter’s prior median from the representative agent models. For the probit-normal parameters <span class="math inline">\(\phi_i\)</span>, <span class="math inline">\(\rho_i\)</span>, and <span class="math inline">\(\delta_i\)</span>, note that the corresponding element for <span class="math inline">\(\mu\)</span> pins down their prior medians. Setting a <em>standard</em> normal prior for, say, <span class="math inline">\(\mu_\phi\sim N(0,1)\)</span> would therefore mean that our prior belief was that the median of <span class="math inline">\(\phi_i\)</span> was uniformly distributed. As the median being very close to 0 or 1 for these parameters seems unlikely, I choose a slightly smaller prior standard deviation for these:</p>
<p><span class="math display">\[
\mu_\phi,\ \mu_\rho,\ \mu_\delta\ \sim N(0,0.25^2)
\]</span></p>
<p>Similarly for <span class="math inline">\(\lambda_i\)</span>:</p>
<p><span class="math display">\[
\mu_\lambda\sim N(1.15,0.75^2)
\]</span></p>
<p>centers the median of this prior over the prior we used for the representative agents model, but reduces some of its variance: our prior uncertainty about a parameter’s median should be lower than our prior uncertainty about the parameter itself.</p>
<p>For <span class="math inline">\(\tau\)</span>, I select:</p>
<p><span class="math display">\[
\tau_\phi,\ \tau_\rho,\ \tau_\delta,\ \tau_\lambda \sim \mathrm{Cauchy}^+(0,0.05)
\]</span></p>
<p>This makes the 95th percentile of the prior distribution for each of these about 0.6. For perspective, for the log-normal distribution of <span class="math inline">\(\lambda_i\)</span>, <span class="math inline">\(\tau_\lambda=0.6\)</span> implies that <span class="math inline">\(\lambda_i\)</span> will be within about 31% and 320% of its population median with probability 95%. For the other, probit-normally distributed parameters, this ensures that their distributions are single-peaked.</p>
<p>Finally, for the prior for <span class="math inline">\(\Omega\)</span> I choose:</p>
<p><span class="math display">\[
\Omega \sim \mathrm{LKJ}(5)
\]</span></p>
</div>
<div id="the-stan-model-1" class="section level3 hasAnchor" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> The <em>Stan</em> model<a href="application-experience-weighted-attraction.html#the-stan-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here is how I modified my representative agent model to a hierarchical model. Hopefully you can see that a lot of it is exactly the same as the representative agent model. The hardest part for me came from converting all of the individual-level parameters from <code>real</code>s to <code>vector</code>s, as this meant I had to change some of the lines that calculated the attractions so that matrix sizes agreed again, and so on.<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb93-1"><a href="application-experience-weighted-attraction.html#cb93-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-2"><a href="application-experience-weighted-attraction.html#cb93-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb93-3"><a href="application-experience-weighted-attraction.html#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> nPeriods<span class="op">;</span></span>
<span id="cb93-4"><a href="application-experience-weighted-attraction.html#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> nParticipants<span class="op">;</span></span>
<span id="cb93-5"><a href="application-experience-weighted-attraction.html#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> nGames<span class="op">;</span></span>
<span id="cb93-6"><a href="application-experience-weighted-attraction.html#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> nActions<span class="op">;</span></span>
<span id="cb93-7"><a href="application-experience-weighted-attraction.html#cb93-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-8"><a href="application-experience-weighted-attraction.html#cb93-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// action chosen. 1=Rock, 2=Paper, 3=Scissors, 4=Dumb</span></span>
<span id="cb93-9"><a href="application-experience-weighted-attraction.html#cb93-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> direction<span class="op">[</span>nPeriods<span class="op">,</span>nParticipants<span class="op">];</span></span>
<span id="cb93-10"><a href="application-experience-weighted-attraction.html#cb93-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-11"><a href="application-experience-weighted-attraction.html#cb93-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// =1 if low payoffs used, =2 if high payoffs used</span></span>
<span id="cb93-12"><a href="application-experience-weighted-attraction.html#cb93-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> HiPay<span class="op">[</span>nPeriods<span class="op">,</span>nParticipants<span class="op">];</span></span>
<span id="cb93-13"><a href="application-experience-weighted-attraction.html#cb93-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-14"><a href="application-experience-weighted-attraction.html#cb93-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// first element: low payoffs exchange rate</span></span>
<span id="cb93-15"><a href="application-experience-weighted-attraction.html#cb93-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// second element: high payoffs exchange rate</span></span>
<span id="cb93-16"><a href="application-experience-weighted-attraction.html#cb93-16" aria-hidden="true" tabindex="-1"></a>  real payoff_multipliers<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb93-17"><a href="application-experience-weighted-attraction.html#cb93-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-18"><a href="application-experience-weighted-attraction.html#cb93-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// =1 if the observation should contribute to the likelihood</span></span>
<span id="cb93-19"><a href="application-experience-weighted-attraction.html#cb93-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> UseData<span class="op">[</span>nPeriods<span class="op">,</span>nParticipants<span class="op">];</span></span>
<span id="cb93-20"><a href="application-experience-weighted-attraction.html#cb93-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-21"><a href="application-experience-weighted-attraction.html#cb93-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-22"><a href="application-experience-weighted-attraction.html#cb93-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Pre-calculated components of the EWA model</span></span>
<span id="cb93-23"><a href="application-experience-weighted-attraction.html#cb93-23" aria-hidden="true" tabindex="-1"></a>  real PI<span class="op">[</span>nPeriods<span class="op">,</span>nParticipants<span class="op">,</span>nActions<span class="op">];</span></span>
<span id="cb93-24"><a href="application-experience-weighted-attraction.html#cb93-24" aria-hidden="true" tabindex="-1"></a>  real I<span class="op">[</span>nPeriods<span class="op">,</span>nParticipants<span class="op">,</span>nActions<span class="op">];</span></span>
<span id="cb93-25"><a href="application-experience-weighted-attraction.html#cb93-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-26"><a href="application-experience-weighted-attraction.html#cb93-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb93-27"><a href="application-experience-weighted-attraction.html#cb93-27" aria-hidden="true" tabindex="-1"></a>  real prior_phi<span class="op">[</span><span class="dv">2</span><span class="op">];</span> <span class="co">// Beta</span></span>
<span id="cb93-28"><a href="application-experience-weighted-attraction.html#cb93-28" aria-hidden="true" tabindex="-1"></a>  real prior_delta<span class="op">[</span><span class="dv">2</span><span class="op">];</span> <span class="co">// Beta</span></span>
<span id="cb93-29"><a href="application-experience-weighted-attraction.html#cb93-29" aria-hidden="true" tabindex="-1"></a>  real prior_rho<span class="op">[</span><span class="dv">2</span><span class="op">];</span> <span class="co">// Beta</span></span>
<span id="cb93-30"><a href="application-experience-weighted-attraction.html#cb93-30" aria-hidden="true" tabindex="-1"></a>  real prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">];</span> <span class="co">// log-normal</span></span>
<span id="cb93-31"><a href="application-experience-weighted-attraction.html#cb93-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-32"><a href="application-experience-weighted-attraction.html#cb93-32" aria-hidden="true" tabindex="-1"></a>  real max_payoff<span class="op">;</span></span>
<span id="cb93-33"><a href="application-experience-weighted-attraction.html#cb93-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-34"><a href="application-experience-weighted-attraction.html#cb93-34" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_MU<span class="op">[</span><span class="dv">4</span><span class="op">];</span></span>
<span id="cb93-35"><a href="application-experience-weighted-attraction.html#cb93-35" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">4</span><span class="op">]</span> prior_TAU<span class="op">;</span></span>
<span id="cb93-36"><a href="application-experience-weighted-attraction.html#cb93-36" aria-hidden="true" tabindex="-1"></a>  real prior_OMEGA<span class="op">;</span></span>
<span id="cb93-37"><a href="application-experience-weighted-attraction.html#cb93-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-38"><a href="application-experience-weighted-attraction.html#cb93-38" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> nSimPars<span class="op">;</span></span>
<span id="cb93-39"><a href="application-experience-weighted-attraction.html#cb93-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb93-40"><a href="application-experience-weighted-attraction.html#cb93-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-41"><a href="application-experience-weighted-attraction.html#cb93-41" aria-hidden="true" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb93-42"><a href="application-experience-weighted-attraction.html#cb93-42" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">[</span>nParticipants<span class="op">,</span>nActions<span class="op">]</span> DIRECTION<span class="op">[</span>nPeriods<span class="op">];</span></span>
<span id="cb93-43"><a href="application-experience-weighted-attraction.html#cb93-43" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">[</span><span class="dv">4</span><span class="op">,</span>nSimPars<span class="op">]</span> zsim<span class="op">;</span></span>
<span id="cb93-44"><a href="application-experience-weighted-attraction.html#cb93-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-45"><a href="application-experience-weighted-attraction.html#cb93-45" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>pp in <span class="dv">1</span><span class="op">:</span><span class="dv">4</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-46"><a href="application-experience-weighted-attraction.html#cb93-46" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>ss in <span class="dv">1</span><span class="op">:</span>nSimPars<span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-47"><a href="application-experience-weighted-attraction.html#cb93-47" aria-hidden="true" tabindex="-1"></a>      zsim<span class="op">[</span>pp<span class="op">,</span>ss<span class="op">]</span> <span class="op">=</span> std_normal_rng<span class="op">();</span></span>
<span id="cb93-48"><a href="application-experience-weighted-attraction.html#cb93-48" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb93-49"><a href="application-experience-weighted-attraction.html#cb93-49" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb93-50"><a href="application-experience-weighted-attraction.html#cb93-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-51"><a href="application-experience-weighted-attraction.html#cb93-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-52"><a href="application-experience-weighted-attraction.html#cb93-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>tt in <span class="dv">1</span><span class="op">:</span>nPeriods<span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-53"><a href="application-experience-weighted-attraction.html#cb93-53" aria-hidden="true" tabindex="-1"></a>    DIRECTION<span class="op">[</span>tt<span class="op">]</span> <span class="op">=</span> rep_matrix<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>nParticipants<span class="op">,</span>nActions<span class="op">);</span></span>
<span id="cb93-54"><a href="application-experience-weighted-attraction.html#cb93-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nParticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-55"><a href="application-experience-weighted-attraction.html#cb93-55" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>aa in <span class="dv">1</span><span class="op">:</span>nActions<span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-56"><a href="application-experience-weighted-attraction.html#cb93-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>direction<span class="op">[</span>tt<span class="op">,</span>ii<span class="op">]==</span>aa<span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-57"><a href="application-experience-weighted-attraction.html#cb93-57" aria-hidden="true" tabindex="-1"></a>          DIRECTION<span class="op">[</span>tt<span class="op">][</span>ii<span class="op">,</span>aa<span class="op">]</span> <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb93-58"><a href="application-experience-weighted-attraction.html#cb93-58" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb93-59"><a href="application-experience-weighted-attraction.html#cb93-59" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb93-60"><a href="application-experience-weighted-attraction.html#cb93-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb93-61"><a href="application-experience-weighted-attraction.html#cb93-61" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb93-62"><a href="application-experience-weighted-attraction.html#cb93-62" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb93-63"><a href="application-experience-weighted-attraction.html#cb93-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-64"><a href="application-experience-weighted-attraction.html#cb93-64" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb93-65"><a href="application-experience-weighted-attraction.html#cb93-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-66"><a href="application-experience-weighted-attraction.html#cb93-66" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">4</span><span class="op">]</span> MU<span class="op">;</span></span>
<span id="cb93-67"><a href="application-experience-weighted-attraction.html#cb93-67" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;[</span><span class="dv">4</span><span class="op">]</span> TAU<span class="op">;</span></span>
<span id="cb93-68"><a href="application-experience-weighted-attraction.html#cb93-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-69"><a href="application-experience-weighted-attraction.html#cb93-69" aria-hidden="true" tabindex="-1"></a>  cholesky_factor_corr<span class="op">[</span><span class="dv">4</span><span class="op">]</span> L_OMEGA<span class="op">;</span></span>
<span id="cb93-70"><a href="application-experience-weighted-attraction.html#cb93-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-71"><a href="application-experience-weighted-attraction.html#cb93-71" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">[</span><span class="dv">4</span><span class="op">,</span>nParticipants<span class="op">]</span> z<span class="op">;</span></span>
<span id="cb93-72"><a href="application-experience-weighted-attraction.html#cb93-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-73"><a href="application-experience-weighted-attraction.html#cb93-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-74"><a href="application-experience-weighted-attraction.html#cb93-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-75"><a href="application-experience-weighted-attraction.html#cb93-75" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb93-76"><a href="application-experience-weighted-attraction.html#cb93-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-77"><a href="application-experience-weighted-attraction.html#cb93-77" aria-hidden="true" tabindex="-1"></a>transformed parameters <span class="op">{</span></span>
<span id="cb93-78"><a href="application-experience-weighted-attraction.html#cb93-78" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>nParticipants<span class="op">]</span> phi<span class="op">;</span></span>
<span id="cb93-79"><a href="application-experience-weighted-attraction.html#cb93-79" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>nParticipants<span class="op">]</span> rho<span class="op">;</span></span>
<span id="cb93-80"><a href="application-experience-weighted-attraction.html#cb93-80" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>nParticipants<span class="op">]</span> delta<span class="op">;</span></span>
<span id="cb93-81"><a href="application-experience-weighted-attraction.html#cb93-81" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>nParticipants<span class="op">]</span> lambda<span class="op">;</span></span>
<span id="cb93-82"><a href="application-experience-weighted-attraction.html#cb93-82" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-83"><a href="application-experience-weighted-attraction.html#cb93-83" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb93-84"><a href="application-experience-weighted-attraction.html#cb93-84" aria-hidden="true" tabindex="-1"></a>    matrix<span class="op">[</span><span class="dv">4</span><span class="op">,</span>nParticipants<span class="op">]</span> theta <span class="op">=</span> MU<span class="op">*</span>rep_row_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nParticipants<span class="op">)+</span> diag_pre_multiply<span class="op">(</span>TAU<span class="op">,</span> L_OMEGA<span class="op">)</span> <span class="op">*</span> z<span class="op">;</span></span>
<span id="cb93-85"><a href="application-experience-weighted-attraction.html#cb93-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-86"><a href="application-experience-weighted-attraction.html#cb93-86" aria-hidden="true" tabindex="-1"></a>    phi <span class="op">=</span> Phi_approx<span class="op">(</span>to_vector<span class="op">(</span>theta<span class="op">[</span><span class="dv">1</span><span class="op">,]));</span></span>
<span id="cb93-87"><a href="application-experience-weighted-attraction.html#cb93-87" aria-hidden="true" tabindex="-1"></a>    rho <span class="op">=</span> Phi_approx<span class="op">(</span>to_vector<span class="op">(</span>theta<span class="op">[</span><span class="dv">2</span><span class="op">,]));</span></span>
<span id="cb93-88"><a href="application-experience-weighted-attraction.html#cb93-88" aria-hidden="true" tabindex="-1"></a>    delta <span class="op">=</span> Phi_approx<span class="op">(</span>to_vector<span class="op">(</span>theta<span class="op">[</span><span class="dv">3</span><span class="op">,]));</span></span>
<span id="cb93-89"><a href="application-experience-weighted-attraction.html#cb93-89" aria-hidden="true" tabindex="-1"></a>    lambda <span class="op">=</span> Phi_approx<span class="op">(</span>to_vector<span class="op">(</span>theta<span class="op">[</span><span class="dv">4</span><span class="op">,]));</span></span>
<span id="cb93-90"><a href="application-experience-weighted-attraction.html#cb93-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-91"><a href="application-experience-weighted-attraction.html#cb93-91" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb93-92"><a href="application-experience-weighted-attraction.html#cb93-92" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb93-93"><a href="application-experience-weighted-attraction.html#cb93-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-94"><a href="application-experience-weighted-attraction.html#cb93-94" aria-hidden="true" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb93-95"><a href="application-experience-weighted-attraction.html#cb93-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-96"><a href="application-experience-weighted-attraction.html#cb93-96" aria-hidden="true" tabindex="-1"></a>  <span class="co">// hierarchical structure</span></span>
<span id="cb93-97"><a href="application-experience-weighted-attraction.html#cb93-97" aria-hidden="true" tabindex="-1"></a>  to_vector<span class="op">(</span>z<span class="op">)</span> <span class="op">~</span> std_normal<span class="op">();</span></span>
<span id="cb93-98"><a href="application-experience-weighted-attraction.html#cb93-98" aria-hidden="true" tabindex="-1"></a>  L_OMEGA <span class="op">~</span> lkj_corr_cholesky<span class="op">(</span>prior_OMEGA<span class="op">);</span></span>
<span id="cb93-99"><a href="application-experience-weighted-attraction.html#cb93-99" aria-hidden="true" tabindex="-1"></a>  TAU <span class="op">~</span> cauchy<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>prior_TAU<span class="op">);</span></span>
<span id="cb93-100"><a href="application-experience-weighted-attraction.html#cb93-100" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-101"><a href="application-experience-weighted-attraction.html#cb93-101" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>pp in <span class="dv">1</span><span class="op">:</span><span class="dv">4</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-102"><a href="application-experience-weighted-attraction.html#cb93-102" aria-hidden="true" tabindex="-1"></a>    MU<span class="op">[</span>pp<span class="op">]</span> <span class="op">~</span> normal<span class="op">(</span>prior_MU<span class="op">[</span>pp<span class="op">][</span><span class="dv">1</span><span class="op">],</span>prior_MU<span class="op">[</span>pp<span class="op">][</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb93-103"><a href="application-experience-weighted-attraction.html#cb93-103" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb93-104"><a href="application-experience-weighted-attraction.html#cb93-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-105"><a href="application-experience-weighted-attraction.html#cb93-105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-106"><a href="application-experience-weighted-attraction.html#cb93-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-107"><a href="application-experience-weighted-attraction.html#cb93-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-108"><a href="application-experience-weighted-attraction.html#cb93-108" aria-hidden="true" tabindex="-1"></a>  <span class="co">// initial conditions. See CFH201 footnote 8</span></span>
<span id="cb93-109"><a href="application-experience-weighted-attraction.html#cb93-109" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">[</span>nParticipants<span class="op">,</span>nActions<span class="op">]</span> A <span class="op">=</span> rep_matrix<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nParticipants<span class="op">,</span>nActions<span class="op">);</span></span>
<span id="cb93-110"><a href="application-experience-weighted-attraction.html#cb93-110" aria-hidden="true" tabindex="-1"></a>  vector<span class="op">[</span>nParticipants<span class="op">]</span> N <span class="op">=</span> rep_vector<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>nParticipants<span class="op">);</span></span>
<span id="cb93-111"><a href="application-experience-weighted-attraction.html#cb93-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-112"><a href="application-experience-weighted-attraction.html#cb93-112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-113"><a href="application-experience-weighted-attraction.html#cb93-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-114"><a href="application-experience-weighted-attraction.html#cb93-114" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>tt in <span class="dv">1</span><span class="op">:</span>nPeriods<span class="op">)</span> <span class="op">{</span></span>
<span id="cb93-115"><a href="application-experience-weighted-attraction.html#cb93-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-116"><a href="application-experience-weighted-attraction.html#cb93-116" aria-hidden="true" tabindex="-1"></a>    <span class="co">// increment the likelihood</span></span>
<span id="cb93-117"><a href="application-experience-weighted-attraction.html#cb93-117" aria-hidden="true" tabindex="-1"></a>    matrix<span class="op">[</span>nParticipants<span class="op">,</span>nActions<span class="op">]</span> lA <span class="op">=</span> lambda<span class="op">*</span>rep_row_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">)</span> <span class="op">.*(</span>to_vector<span class="op">(</span>payoff_multipliers<span class="op">[</span>HiPay<span class="op">[</span>tt<span class="op">,]])*</span>rep_row_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">)).*(</span>A<span class="op">-</span>max_payoff<span class="op">);</span></span>
<span id="cb93-118"><a href="application-experience-weighted-attraction.html#cb93-118" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">[</span>nParticipants<span class="op">]</span> lsum_lA <span class="op">=</span> log<span class="op">(</span>exp<span class="op">(</span>lA<span class="op">)*</span>rep_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">));</span></span>
<span id="cb93-119"><a href="application-experience-weighted-attraction.html#cb93-119" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb93-120"><a href="application-experience-weighted-attraction.html#cb93-120" aria-hidden="true" tabindex="-1"></a>    target<span class="op">+=</span>to_vector<span class="op">(</span>UseData<span class="op">[</span>tt<span class="op">,])</span> <span class="op">.*</span> <span class="op">(((</span>lA<span class="op">-</span>lsum_lA<span class="op">*</span>rep_row_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">))</span> <span class="op">.*</span> DIRECTION<span class="op">[</span>tt<span class="op">])*</span>rep_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">));</span></span>
<span id="cb93-121"><a href="application-experience-weighted-attraction.html#cb93-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-122"><a href="application-experience-weighted-attraction.html#cb93-122" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-123"><a href="application-experience-weighted-attraction.html#cb93-123" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-124"><a href="application-experience-weighted-attraction.html#cb93-124" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-125"><a href="application-experience-weighted-attraction.html#cb93-125" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update A and N</span></span>
<span id="cb93-126"><a href="application-experience-weighted-attraction.html#cb93-126" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-127"><a href="application-experience-weighted-attraction.html#cb93-127" aria-hidden="true" tabindex="-1"></a>    matrix<span class="op">[</span>nParticipants<span class="op">,</span>nActions<span class="op">]</span> I_t <span class="op">=</span> to_matrix<span class="op">(</span>I<span class="op">[</span>tt<span class="op">,,]);</span></span>
<span id="cb93-128"><a href="application-experience-weighted-attraction.html#cb93-128" aria-hidden="true" tabindex="-1"></a>    matrix<span class="op">[</span>nParticipants<span class="op">,</span>nActions<span class="op">]</span> pi_t <span class="op">=</span> to_matrix<span class="op">(</span>PI<span class="op">[</span>tt<span class="op">,,]);</span></span>
<span id="cb93-129"><a href="application-experience-weighted-attraction.html#cb93-129" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-130"><a href="application-experience-weighted-attraction.html#cb93-130" aria-hidden="true" tabindex="-1"></a>    A <span class="op">=</span> <span class="op">((</span>phi<span class="op">*</span>rep_row_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">))</span> <span class="op">.*(</span>N<span class="op">*</span>rep_row_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">)).*</span>A<span class="op">+(</span>delta<span class="op">*</span>rep_row_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">)+(</span><span class="fl">1.0</span><span class="op">-(</span>delta<span class="op">*</span>rep_row_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">)))</span> <span class="op">.*</span>I_t<span class="op">).*</span>pi_t<span class="op">)</span></span>
<span id="cb93-131"><a href="application-experience-weighted-attraction.html#cb93-131" aria-hidden="true" tabindex="-1"></a>          <span class="op">./</span> <span class="op">((</span>rho<span class="op">*</span>rep_row_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">))</span> <span class="op">.*</span> <span class="op">(</span>N <span class="op">*</span> rep_row_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nActions<span class="op">))+</span><span class="fl">1.0</span><span class="op">);</span></span>
<span id="cb93-132"><a href="application-experience-weighted-attraction.html#cb93-132" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb93-133"><a href="application-experience-weighted-attraction.html#cb93-133" aria-hidden="true" tabindex="-1"></a>    N <span class="op">=</span> rho <span class="op">.*</span> N<span class="op">+</span><span class="fl">1.0</span><span class="op">;</span></span>
<span id="cb93-134"><a href="application-experience-weighted-attraction.html#cb93-134" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-135"><a href="application-experience-weighted-attraction.html#cb93-135" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb93-136"><a href="application-experience-weighted-attraction.html#cb93-136" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-137"><a href="application-experience-weighted-attraction.html#cb93-137" aria-hidden="true" tabindex="-1"></a>  <span class="co">// priors</span></span>
<span id="cb93-138"><a href="application-experience-weighted-attraction.html#cb93-138" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-139"><a href="application-experience-weighted-attraction.html#cb93-139" aria-hidden="true" tabindex="-1"></a>  phi <span class="op">~</span> beta<span class="op">(</span>prior_phi<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_phi<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb93-140"><a href="application-experience-weighted-attraction.html#cb93-140" aria-hidden="true" tabindex="-1"></a>  rho <span class="op">~</span> beta<span class="op">(</span>prior_rho<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_rho<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb93-141"><a href="application-experience-weighted-attraction.html#cb93-141" aria-hidden="true" tabindex="-1"></a>  delta <span class="op">~</span> beta<span class="op">(</span>prior_delta<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_delta<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb93-142"><a href="application-experience-weighted-attraction.html#cb93-142" aria-hidden="true" tabindex="-1"></a>  lambda <span class="op">~</span> lognormal<span class="op">(</span>prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb93-143"><a href="application-experience-weighted-attraction.html#cb93-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-144"><a href="application-experience-weighted-attraction.html#cb93-144" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb93-145"><a href="application-experience-weighted-attraction.html#cb93-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-146"><a href="application-experience-weighted-attraction.html#cb93-146" aria-hidden="true" tabindex="-1"></a>generated quantities <span class="op">{</span></span>
<span id="cb93-147"><a href="application-experience-weighted-attraction.html#cb93-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-148"><a href="application-experience-weighted-attraction.html#cb93-148" aria-hidden="true" tabindex="-1"></a>  real mean_phi<span class="op">;</span></span>
<span id="cb93-149"><a href="application-experience-weighted-attraction.html#cb93-149" aria-hidden="true" tabindex="-1"></a>  real mean_rho<span class="op">;</span></span>
<span id="cb93-150"><a href="application-experience-weighted-attraction.html#cb93-150" aria-hidden="true" tabindex="-1"></a>  real mean_delta<span class="op">;</span></span>
<span id="cb93-151"><a href="application-experience-weighted-attraction.html#cb93-151" aria-hidden="true" tabindex="-1"></a>  real mean_lambda <span class="op">=</span> exp<span class="op">(</span>MU<span class="op">[</span><span class="dv">4</span><span class="op">]+</span><span class="fl">0.5</span><span class="op">*</span>TAU<span class="op">[</span><span class="dv">4</span><span class="op">]^</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb93-152"><a href="application-experience-weighted-attraction.html#cb93-152" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-153"><a href="application-experience-weighted-attraction.html#cb93-153" aria-hidden="true" tabindex="-1"></a>  real median_phi <span class="op">=</span> Phi_approx<span class="op">(</span>MU<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span>
<span id="cb93-154"><a href="application-experience-weighted-attraction.html#cb93-154" aria-hidden="true" tabindex="-1"></a>  real median_rho <span class="op">=</span> Phi_approx<span class="op">(</span>MU<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb93-155"><a href="application-experience-weighted-attraction.html#cb93-155" aria-hidden="true" tabindex="-1"></a>  real median_delta <span class="op">=</span> Phi_approx<span class="op">(</span>MU<span class="op">[</span><span class="dv">3</span><span class="op">]);</span></span>
<span id="cb93-156"><a href="application-experience-weighted-attraction.html#cb93-156" aria-hidden="true" tabindex="-1"></a>  real median_lambda <span class="op">=</span> exp<span class="op">(</span>MU<span class="op">[</span><span class="dv">4</span><span class="op">]);</span></span>
<span id="cb93-157"><a href="application-experience-weighted-attraction.html#cb93-157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-158"><a href="application-experience-weighted-attraction.html#cb93-158" aria-hidden="true" tabindex="-1"></a>  real sd_phi<span class="op">;</span></span>
<span id="cb93-159"><a href="application-experience-weighted-attraction.html#cb93-159" aria-hidden="true" tabindex="-1"></a>  real sd_rho<span class="op">;</span></span>
<span id="cb93-160"><a href="application-experience-weighted-attraction.html#cb93-160" aria-hidden="true" tabindex="-1"></a>  real sd_delta<span class="op">;</span></span>
<span id="cb93-161"><a href="application-experience-weighted-attraction.html#cb93-161" aria-hidden="true" tabindex="-1"></a>  real sd_lambda <span class="op">=</span> sqrt<span class="op">((</span>exp<span class="op">(</span>TAU<span class="op">[</span><span class="dv">4</span><span class="op">]^</span><span class="dv">2</span><span class="op">)-</span><span class="fl">1.0</span><span class="op">)*</span>exp<span class="op">(</span><span class="dv">2</span><span class="op">*</span>MU<span class="op">[</span><span class="dv">4</span><span class="op">]+</span>TAU<span class="op">[</span><span class="dv">4</span><span class="op">]^</span><span class="dv">2</span><span class="op">));</span></span>
<span id="cb93-162"><a href="application-experience-weighted-attraction.html#cb93-162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-163"><a href="application-experience-weighted-attraction.html#cb93-163" aria-hidden="true" tabindex="-1"></a>  real CV_phi<span class="op">;</span></span>
<span id="cb93-164"><a href="application-experience-weighted-attraction.html#cb93-164" aria-hidden="true" tabindex="-1"></a>  real CV_rho<span class="op">;</span></span>
<span id="cb93-165"><a href="application-experience-weighted-attraction.html#cb93-165" aria-hidden="true" tabindex="-1"></a>  real CV_delta<span class="op">;</span></span>
<span id="cb93-166"><a href="application-experience-weighted-attraction.html#cb93-166" aria-hidden="true" tabindex="-1"></a>  real CV_lambda<span class="op">;</span></span>
<span id="cb93-167"><a href="application-experience-weighted-attraction.html#cb93-167" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-168"><a href="application-experience-weighted-attraction.html#cb93-168" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-169"><a href="application-experience-weighted-attraction.html#cb93-169" aria-hidden="true" tabindex="-1"></a>  matrix<span class="op">[</span><span class="dv">4</span><span class="op">,</span><span class="dv">4</span><span class="op">]</span> OMEGA<span class="op">;</span></span>
<span id="cb93-170"><a href="application-experience-weighted-attraction.html#cb93-170" aria-hidden="true" tabindex="-1"></a>  OMEGA <span class="op">=</span> L_OMEGA<span class="op">*</span>L_OMEGA&#39;<span class="op">;</span></span>
<span id="cb93-171"><a href="application-experience-weighted-attraction.html#cb93-171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-172"><a href="application-experience-weighted-attraction.html#cb93-172" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-173"><a href="application-experience-weighted-attraction.html#cb93-173" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb93-174"><a href="application-experience-weighted-attraction.html#cb93-174" aria-hidden="true" tabindex="-1"></a>    matrix<span class="op">[</span><span class="dv">4</span><span class="op">,</span>nSimPars<span class="op">]</span> theta <span class="op">=</span> MU<span class="op">*</span>rep_row_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span>nSimPars<span class="op">)+</span> diag_pre_multiply<span class="op">(</span>TAU<span class="op">,</span> L_OMEGA<span class="op">)</span> <span class="op">*</span> zsim<span class="op">;</span></span>
<span id="cb93-175"><a href="application-experience-weighted-attraction.html#cb93-175" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-176"><a href="application-experience-weighted-attraction.html#cb93-176" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">[</span>nSimPars<span class="op">]</span> phi_sim <span class="op">=</span> Phi_approx<span class="op">(</span>to_vector<span class="op">(</span>theta<span class="op">[</span><span class="dv">1</span><span class="op">,]));</span></span>
<span id="cb93-177"><a href="application-experience-weighted-attraction.html#cb93-177" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">[</span>nSimPars<span class="op">]</span> rho_sim <span class="op">=</span> Phi_approx<span class="op">(</span>to_vector<span class="op">(</span>theta<span class="op">[</span><span class="dv">2</span><span class="op">,]));</span></span>
<span id="cb93-178"><a href="application-experience-weighted-attraction.html#cb93-178" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">[</span>nSimPars<span class="op">]</span> delta_sim <span class="op">=</span> Phi_approx<span class="op">(</span>to_vector<span class="op">(</span>theta<span class="op">[</span><span class="dv">3</span><span class="op">,]));</span></span>
<span id="cb93-179"><a href="application-experience-weighted-attraction.html#cb93-179" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">[</span>nSimPars<span class="op">]</span> lambda_sim <span class="op">=</span> Phi_approx<span class="op">(</span>to_vector<span class="op">(</span>theta<span class="op">[</span><span class="dv">4</span><span class="op">,]));</span></span>
<span id="cb93-180"><a href="application-experience-weighted-attraction.html#cb93-180" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-181"><a href="application-experience-weighted-attraction.html#cb93-181" aria-hidden="true" tabindex="-1"></a>    mean_phi <span class="op">=</span> mean<span class="op">(</span>phi_sim<span class="op">);</span></span>
<span id="cb93-182"><a href="application-experience-weighted-attraction.html#cb93-182" aria-hidden="true" tabindex="-1"></a>    mean_rho <span class="op">=</span> mean<span class="op">(</span>rho_sim<span class="op">);</span></span>
<span id="cb93-183"><a href="application-experience-weighted-attraction.html#cb93-183" aria-hidden="true" tabindex="-1"></a>    mean_delta <span class="op">=</span> mean<span class="op">(</span>delta_sim<span class="op">);</span></span>
<span id="cb93-184"><a href="application-experience-weighted-attraction.html#cb93-184" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb93-185"><a href="application-experience-weighted-attraction.html#cb93-185" aria-hidden="true" tabindex="-1"></a>    sd_phi <span class="op">=</span> sd<span class="op">(</span>phi_sim<span class="op">);</span></span>
<span id="cb93-186"><a href="application-experience-weighted-attraction.html#cb93-186" aria-hidden="true" tabindex="-1"></a>    sd_rho <span class="op">=</span> sd<span class="op">(</span>rho_sim<span class="op">);</span></span>
<span id="cb93-187"><a href="application-experience-weighted-attraction.html#cb93-187" aria-hidden="true" tabindex="-1"></a>    sd_delta <span class="op">=</span> sd<span class="op">(</span>delta_sim<span class="op">);</span></span>
<span id="cb93-188"><a href="application-experience-weighted-attraction.html#cb93-188" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb93-189"><a href="application-experience-weighted-attraction.html#cb93-189" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb93-190"><a href="application-experience-weighted-attraction.html#cb93-190" aria-hidden="true" tabindex="-1"></a>  CV_phi <span class="op">=</span> sd_phi<span class="op">/</span>mean_phi<span class="op">;</span></span>
<span id="cb93-191"><a href="application-experience-weighted-attraction.html#cb93-191" aria-hidden="true" tabindex="-1"></a>  CV_rho <span class="op">=</span> sd_rho<span class="op">/</span>mean_rho<span class="op">;</span></span>
<span id="cb93-192"><a href="application-experience-weighted-attraction.html#cb93-192" aria-hidden="true" tabindex="-1"></a>  CV_delta <span class="op">=</span> sd_delta<span class="op">/</span>mean_delta<span class="op">;</span></span>
<span id="cb93-193"><a href="application-experience-weighted-attraction.html#cb93-193" aria-hidden="true" tabindex="-1"></a>  CV_lambda <span class="op">=</span> sd_lambda<span class="op">/</span>mean_lambda<span class="op">;</span></span>
<span id="cb93-194"><a href="application-experience-weighted-attraction.html#cb93-194" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>If you look at the <em>R</em> code below implementing this estimator, I got the <code>bulk ESS low</code> error when running this with <em>Stan</em>’s default <code>iter = 2000</code>, where ESS stands for “Effective Sample Size”. This means that the 4,000 posterior draws<a href="#fn30" class="footnote-ref" id="fnref30"><sup>30</sup></a> were dependent enough that they did not provide sufficient information to accurately approximate posterior moments.
The simple fix to this, which worked for me, was just to run the chains for longer. Doubling the number of iterations to <code>iter = 4000</code> fixed this.<a href="#fn31" class="footnote-ref" id="fnref31"><sup>31</sup></a></p>
<p>As mentioned above if left unchecked, this <em>Stan</em> fit object will take up quite a bit of space if we save all of the variables. As I don’t want to report anything on the standardized individual-level parameters <span class="math inline">\(z\)</span>, I use the <code>pars = c("z"), include=FALSE,</code> options in <code>sampling</code>, which drops these variables. What is left are the the individual-level parameters <span class="math inline">\(\begin{pmatrix}\phi_i&amp; \rho_i &amp; \delta_i &amp; \lambda_i\end{pmatrix}\)</span>, and the population-level draws for <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\tau\)</span>, and <span class="math inline">\(\Omega\)</span>. Even so, this produces a <em>Stan</em> fit object that takes up about 140MB, most of which is storing the individual-level parameters.<a href="#fn32" class="footnote-ref" id="fnref32"><sup>32</sup></a></p>
</div>
<div id="results-1" class="section level3 hasAnchor" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> Results<a href="application-experience-weighted-attraction.html#results-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For the hierarchical model, I just estimate one model using all of the data from all four treatments. This is because I was having trouble getting <em>Stan</em> to estimate the treatment-specific hierarchical models without returning a <code>divergent transitions</code> error. I will work on fixing these errors in a future iteration of this chapter.</p>
<p>A summary of this model in shown in Table <a href="application-experience-weighted-attraction.html#tab:CFH2010TASPHierarchicalSummary">7.3</a>. One of the things I really like about the way <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span> display the estimates from their hierarchical models in Table 3 is that instead of reporting the models’ fundamental population-level parameters (i.e. <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\tau\)</span>, and <span class="math inline">\(\Omega\)</span> for me), they instead focus on moments of the implied individual-level parameters. That is, they report the mean, median, and coefficient of variation (standard deviation divided by mean) for <span class="math inline">\(\phi_i\)</span>, <span class="math inline">\(\rho_i\)</span>, and <span class="math inline">\(\lambda_i\)</span>. This makes their marginal distributions much easier to interpret.
I follow suit in doing this, as well as reporting the standard deviations. As you can see in the <code>generated quantities</code> block of my <em>Stan</em> program above, these are fairly easy to compute using explicit formulas for the median and for all moments of <span class="math inline">\(\lambda_i\)</span>, which is log-normally distributed. The other parameters are probit-normally distributed, and so explicit expressions of the mean and standard deviations do not exist. I use Monte Carlo integration to evaluate these.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="application-experience-weighted-attraction.html#cb94-1" aria-hidden="true" tabindex="-1"></a>rounding<span class="ot">&lt;-</span><span class="dv">3</span></span>
<span id="cb94-2"><a href="application-experience-weighted-attraction.html#cb94-2" aria-hidden="true" tabindex="-1"></a>pars<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;phi&quot;</span>,<span class="st">&quot;rho&quot;</span>,<span class="st">&quot;delta&quot;</span>,<span class="st">&quot;lambda&quot;</span>)</span>
<span id="cb94-3"><a href="application-experience-weighted-attraction.html#cb94-3" aria-hidden="true" tabindex="-1"></a>parUnicode<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;\u03d5&quot;</span>,<span class="st">&quot;\u03c1&quot;</span>,<span class="st">&quot;\u03b4&quot;</span>,<span class="st">&quot;\u03bb&quot;</span>)</span>
<span id="cb94-4"><a href="application-experience-weighted-attraction.html#cb94-4" aria-hidden="true" tabindex="-1"></a>summaries<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;mean&quot;</span>,<span class="st">&quot;median&quot;</span>,<span class="st">&quot;sd&quot;</span>,<span class="st">&quot;CV&quot;</span>)</span>
<span id="cb94-5"><a href="application-experience-weighted-attraction.html#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="application-experience-weighted-attraction.html#cb94-6" aria-hidden="true" tabindex="-1"></a>param_list<span class="ot">&lt;-</span><span class="fu">c</span>() </span>
<span id="cb94-7"><a href="application-experience-weighted-attraction.html#cb94-7" aria-hidden="true" tabindex="-1"></a>param_labels<span class="ot">&lt;-</span><span class="fu">c</span>() </span>
<span id="cb94-8"><a href="application-experience-weighted-attraction.html#cb94-8" aria-hidden="true" tabindex="-1"></a>param_summaries<span class="ot">&lt;-</span><span class="fu">c</span>()</span>
<span id="cb94-9"><a href="application-experience-weighted-attraction.html#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (pp <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pars)) {</span>
<span id="cb94-10"><a href="application-experience-weighted-attraction.html#cb94-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ss <span class="cf">in</span> summaries) {</span>
<span id="cb94-11"><a href="application-experience-weighted-attraction.html#cb94-11" aria-hidden="true" tabindex="-1"></a>    param_list<span class="ot">&lt;-</span><span class="fu">c</span>(param_list,<span class="fu">paste0</span>(ss,<span class="st">&quot;_&quot;</span>,pars[pp]))</span>
<span id="cb94-12"><a href="application-experience-weighted-attraction.html#cb94-12" aria-hidden="true" tabindex="-1"></a>    param_labels<span class="ot">&lt;-</span><span class="fu">c</span>(param_labels,<span class="fu">paste0</span>(parUnicode[pp]))</span>
<span id="cb94-13"><a href="application-experience-weighted-attraction.html#cb94-13" aria-hidden="true" tabindex="-1"></a>    param_summaries<span class="ot">&lt;-</span><span class="fu">c</span>(param_summaries,ss)</span>
<span id="cb94-14"><a href="application-experience-weighted-attraction.html#cb94-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb94-15"><a href="application-experience-weighted-attraction.html#cb94-15" aria-hidden="true" tabindex="-1"></a>} </span>
<span id="cb94-16"><a href="application-experience-weighted-attraction.html#cb94-16" aria-hidden="true" tabindex="-1"></a>FitALL<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">&quot;Code/CFH2010TASP/Estimates_Hierarchical_Pooled.rds&quot;</span>)</span>
<span id="cb94-17"><a href="application-experience-weighted-attraction.html#cb94-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-18"><a href="application-experience-weighted-attraction.html#cb94-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(FitALL <span class="sc">|&gt;</span> <span class="fu">check_hmc_diagnostics</span>())</span></code></pre></div>
<pre><code>## 
## Divergences:</code></pre>
<pre><code>## 0 of 8000 iterations ended with a divergence.</code></pre>
<pre><code>## 
## Tree depth:</code></pre>
<pre><code>## 0 of 8000 iterations saturated the maximum tree depth of 10.</code></pre>
<pre><code>## 
## Energy:</code></pre>
<pre><code>## E-BFMI indicated no pathological behavior.</code></pre>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="application-experience-weighted-attraction.html#cb102-1" aria-hidden="true" tabindex="-1"></a>  estimates<span class="ot">&lt;-</span><span class="fu">summary</span>(FitALL)<span class="sc">$</span>summary<span class="sc">|&gt;</span></span>
<span id="cb102-2"><a href="application-experience-weighted-attraction.html#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb102-3"><a href="application-experience-weighted-attraction.html#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">msd =</span> <span class="fu">paste0</span>(mean <span class="sc">|&gt;</span> <span class="fu">round</span>(rounding),<span class="st">&quot; (&quot;</span>,sd <span class="sc">|&gt;</span> <span class="fu">round</span>(rounding),<span class="st">&quot;)&quot;</span>))</span>
<span id="cb102-4"><a href="application-experience-weighted-attraction.html#cb102-4" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb102-5"><a href="application-experience-weighted-attraction.html#cb102-5" aria-hidden="true" tabindex="-1"></a>   TAB<span class="ot">&lt;-</span><span class="fu">tibble</span>(<span class="at">estimates =</span> estimates[param_list,<span class="st">&quot;msd&quot;</span>],</span>
<span id="cb102-6"><a href="application-experience-weighted-attraction.html#cb102-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">param_labels =</span> param_labels,</span>
<span id="cb102-7"><a href="application-experience-weighted-attraction.html#cb102-7" aria-hidden="true" tabindex="-1"></a>               <span class="st">`</span><span class="at">Population property</span><span class="st">`</span> <span class="ot">=</span> param_summaries) <span class="sc">|&gt;</span></span>
<span id="cb102-8"><a href="application-experience-weighted-attraction.html#cb102-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="st">`</span><span class="at">Population property</span><span class="st">`</span>,<span class="at">names_from =</span> param_labels,<span class="at">values_from =</span> estimates) </span>
<span id="cb102-9"><a href="application-experience-weighted-attraction.html#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="application-experience-weighted-attraction.html#cb102-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-11"><a href="application-experience-weighted-attraction.html#cb102-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-12"><a href="application-experience-weighted-attraction.html#cb102-12" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb102-13"><a href="application-experience-weighted-attraction.html#cb102-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-14"><a href="application-experience-weighted-attraction.html#cb102-14" aria-hidden="true" tabindex="-1"></a>TAB <span class="sc">|&gt;</span></span>
<span id="cb102-15"><a href="application-experience-weighted-attraction.html#cb102-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">caption=</span><span class="st">&quot;Properties of the marginal distributions of parameters. Posterior means with standard deviations in parentheses.&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb102-16"><a href="application-experience-weighted-attraction.html#cb102-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;Parameter&quot;</span> <span class="ot">=</span> <span class="dv">4</span>)) <span class="sc">|&gt;</span></span>
<span id="cb102-17"><a href="application-experience-weighted-attraction.html#cb102-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width=</span>F)</span></code></pre></div>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:CFH2010TASPHierarchicalSummary">Table 7.3: </span>Properties of the marginal distributions of parameters. Posterior means with standard deviations in parentheses.
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Parameter
</div>
</th>
</tr>
<tr>
<th style="text-align:left;">
Population property
</th>
<th style="text-align:left;">
ϕ
</th>
<th style="text-align:left;">
ρ
</th>
<th style="text-align:left;">
δ
</th>
<th style="text-align:left;">
λ
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
mean
</td>
<td style="text-align:left;">
0.861 (0.013)
</td>
<td style="text-align:left;">
0.369 (0.051)
</td>
<td style="text-align:left;">
0.072 (0.016)
</td>
<td style="text-align:left;">
0.706 (0.073)
</td>
</tr>
<tr>
<td style="text-align:left;">
median
</td>
<td style="text-align:left;">
0.888 (0.012)
</td>
<td style="text-align:left;">
0.347 (0.057)
</td>
<td style="text-align:left;">
0.069 (0.014)
</td>
<td style="text-align:left;">
0.602 (0.056)
</td>
</tr>
<tr>
<td style="text-align:left;">
sd
</td>
<td style="text-align:left;">
0.112 (0.013)
</td>
<td style="text-align:left;">
0.195 (0.041)
</td>
<td style="text-align:left;">
0.016 (0.023)
</td>
<td style="text-align:left;">
0.431 (0.094)
</td>
</tr>
<tr>
<td style="text-align:left;">
CV
</td>
<td style="text-align:left;">
0.13 (0.017)
</td>
<td style="text-align:left;">
0.533 (0.114)
</td>
<td style="text-align:left;">
0.203 (0.241)
</td>
<td style="text-align:left;">
0.607 (0.089)
</td>
</tr>
</tbody>
</table>
<p>While I don’t have a direct comparison to the middle panel in Table 3 of <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span>, note that my posterior mean estimates of <span class="math inline">\(\phi\)</span> and <span class="math inline">\(\delta\)</span> are in the same ballpark, but I get much smaller estimates for <span class="math inline">\(\rho\)</span> (their estimates are much closer to one). Again, I get larger estimates for <span class="math inline">\(\lambda\)</span>, but I suspect this is due to using different exchange rates. The conclusion that estimated behavior is much closer to reinforcement learning than stochastic fictitious play (i.e. that <span class="math inline">\(\delta\)</span> is far away from one) is supported both by my hierarchical model, and the original hierarchical models in <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span>.</p>
<p>What about the correlation matrix <span class="math inline">\(\Omega\)</span>? This is the one big piece of information that is hidden from us in Table <a href="application-experience-weighted-attraction.html#tab:CFH2010TASPHierarchicalSummary">7.3</a>. I show this correlation matrix in Table <a href="application-experience-weighted-attraction.html#tab:CFH2010TASPcorrmatrix">7.4</a>. Note that this shows posterior moments of <span class="math inline">\(\Omega\)</span>, which is the correlation matrix of the <em>transformed</em> individual-level parameters. If we wanted to estimate the correlation matrix of the actual parameters, we could do this using Monte Carlo integration, similarly to how I calculated some of the poseterior means for Table <a href="application-experience-weighted-attraction.html#tab:CFH2010TASPHierarchicalSummary">7.3</a>. As all transforms are monotonic, we can at lest interpret positive numbers in this table as positive correlations between the real individual-level parameters. Here we can see that there appears to be a substantial positive correlation between <span class="math inline">\(\phi\)</span> and <span class="math inline">\(\rho\)</span>, and substantial negative correlations between <span class="math inline">\(\phi\)</span> and <span class="math inline">\(\lambda\)</span>, and <span class="math inline">\(\rho\)</span> and <span class="math inline">\(\lambda\)</span>. Note that in Table 3 of <span class="citation">Cason, Friedman, and Hopkins (<a href="#ref-Cason2010" role="doc-biblioref">2010</a>)</span>, they assume that there is no correlation between the individual-level parameters, and so their correlation matrix would just be the identity matrix.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="application-experience-weighted-attraction.html#cb103-1" aria-hidden="true" tabindex="-1"></a>rounding<span class="ot">&lt;-</span><span class="dv">3</span></span>
<span id="cb103-2"><a href="application-experience-weighted-attraction.html#cb103-2" aria-hidden="true" tabindex="-1"></a>CORR <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">extract</span>(FitALL)<span class="sc">$</span>OMEGA</span>
<span id="cb103-3"><a href="application-experience-weighted-attraction.html#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="application-experience-weighted-attraction.html#cb103-4" aria-hidden="true" tabindex="-1"></a>CORRmean<span class="ot">&lt;-</span>CORR <span class="sc">|&gt;</span> <span class="fu">apply</span>(<span class="at">MARGIN =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>),<span class="at">FUN =</span> mean) <span class="sc">|&gt;</span> <span class="fu">round</span>(rounding)</span>
<span id="cb103-5"><a href="application-experience-weighted-attraction.html#cb103-5" aria-hidden="true" tabindex="-1"></a>CORRsd<span class="ot">&lt;-</span>CORR <span class="sc">|&gt;</span> <span class="fu">apply</span>(<span class="at">MARGIN =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>),<span class="at">FUN =</span> sd) <span class="sc">|&gt;</span> <span class="fu">round</span>(rounding)</span>
<span id="cb103-6"><a href="application-experience-weighted-attraction.html#cb103-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-7"><a href="application-experience-weighted-attraction.html#cb103-7" aria-hidden="true" tabindex="-1"></a>CORRmsd<span class="ot">&lt;-</span><span class="fu">paste0</span>(CORRmean,<span class="st">&quot; (&quot;</span>,CORRsd,<span class="st">&quot;)&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">matrix</span>(<span class="at">nrow=</span><span class="dv">4</span>)</span>
<span id="cb103-8"><a href="application-experience-weighted-attraction.html#cb103-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-9"><a href="application-experience-weighted-attraction.html#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(CORRmsd)<span class="ot">&lt;-</span>parUnicode</span>
<span id="cb103-10"><a href="application-experience-weighted-attraction.html#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(CORRmsd)<span class="ot">&lt;-</span>parUnicode</span>
<span id="cb103-11"><a href="application-experience-weighted-attraction.html#cb103-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-12"><a href="application-experience-weighted-attraction.html#cb103-12" aria-hidden="true" tabindex="-1"></a>CORRmsd[CORRmsd<span class="sc">==</span><span class="st">&quot;1 (0)&quot;</span>]<span class="ot">&lt;-</span><span class="st">&quot;1&quot;</span></span>
<span id="cb103-13"><a href="application-experience-weighted-attraction.html#cb103-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-14"><a href="application-experience-weighted-attraction.html#cb103-14" aria-hidden="true" tabindex="-1"></a>CORRmsd <span class="sc">|&gt;</span> <span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Correlation matrix from the hierarchical model using all data. Posterior means with standard deviations in parentheses. Correlations are for transformed parameters, all of which are marginally normal.&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">kable_classic</span>(<span class="at">full_width=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:CFH2010TASPcorrmatrix">Table 7.4: </span>Correlation matrix from the hierarchical model using all data. Posterior means with standard deviations in parentheses. Correlations are for transformed parameters, all of which are marginally normal.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
ϕ
</th>
<th style="text-align:left;">
ρ
</th>
<th style="text-align:left;">
δ
</th>
<th style="text-align:left;">
λ
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ϕ
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0.593 (0.17)
</td>
<td style="text-align:left;">
0.006 (0.262)
</td>
<td style="text-align:left;">
-0.676 (0.101)
</td>
</tr>
<tr>
<td style="text-align:left;">
ρ
</td>
<td style="text-align:left;">
0.593 (0.17)
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0.042 (0.269)
</td>
<td style="text-align:left;">
-0.418 (0.185)
</td>
</tr>
<tr>
<td style="text-align:left;">
δ
</td>
<td style="text-align:left;">
0.006 (0.262)
</td>
<td style="text-align:left;">
0.042 (0.269)
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
-0.07 (0.264)
</td>
</tr>
<tr>
<td style="text-align:left;">
λ
</td>
<td style="text-align:left;">
-0.676 (0.101)
</td>
<td style="text-align:left;">
-0.418 (0.185)
</td>
<td style="text-align:left;">
-0.07 (0.264)
</td>
<td style="text-align:left;">
1
</td>
</tr>
</tbody>
</table>
<p>One of the cool things you get out of a hierarchical model estimated using data augmentation, that you don’t get from one using Monte Carlo integration, is “shrinkage” estimates of the individual-level parameters.<a href="#fn33" class="footnote-ref" id="fnref33"><sup>33</sup></a> Figure <a href="application-experience-weighted-attraction.html#fig:CFH2010TASPIndParamsHist">7.2</a> shows histograms of the posterior means of these.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="application-experience-weighted-attraction.html#cb104-1" aria-hidden="true" tabindex="-1"></a>phi<span class="ot">&lt;-</span><span class="fu">extract</span>(FitALL)<span class="sc">$</span>phi</span>
<span id="cb104-2"><a href="application-experience-weighted-attraction.html#cb104-2" aria-hidden="true" tabindex="-1"></a>rho<span class="ot">&lt;-</span><span class="fu">extract</span>(FitALL)<span class="sc">$</span>rho</span>
<span id="cb104-3"><a href="application-experience-weighted-attraction.html#cb104-3" aria-hidden="true" tabindex="-1"></a>delta<span class="ot">&lt;-</span><span class="fu">extract</span>(FitALL)<span class="sc">$</span>delta</span>
<span id="cb104-4"><a href="application-experience-weighted-attraction.html#cb104-4" aria-hidden="true" tabindex="-1"></a>lambda<span class="ot">&lt;-</span><span class="fu">extract</span>(FitALL)<span class="sc">$</span>lambda</span>
<span id="cb104-5"><a href="application-experience-weighted-attraction.html#cb104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-6"><a href="application-experience-weighted-attraction.html#cb104-6" aria-hidden="true" tabindex="-1"></a>IndParams<span class="ot">&lt;-</span><span class="fu">tibble</span>()</span>
<span id="cb104-7"><a href="application-experience-weighted-attraction.html#cb104-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-8"><a href="application-experience-weighted-attraction.html#cb104-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(phi)[<span class="dv">2</span>]) {</span>
<span id="cb104-9"><a href="application-experience-weighted-attraction.html#cb104-9" aria-hidden="true" tabindex="-1"></a>  IndParams<span class="ot">&lt;-</span><span class="fu">rbind</span>(</span>
<span id="cb104-10"><a href="application-experience-weighted-attraction.html#cb104-10" aria-hidden="true" tabindex="-1"></a>    IndParams,</span>
<span id="cb104-11"><a href="application-experience-weighted-attraction.html#cb104-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb104-12"><a href="application-experience-weighted-attraction.html#cb104-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">id =</span> ii,</span>
<span id="cb104-13"><a href="application-experience-weighted-attraction.html#cb104-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">phi =</span> phi[,ii],</span>
<span id="cb104-14"><a href="application-experience-weighted-attraction.html#cb104-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">rho =</span> rho[,ii],</span>
<span id="cb104-15"><a href="application-experience-weighted-attraction.html#cb104-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">delta =</span> delta[,ii],</span>
<span id="cb104-16"><a href="application-experience-weighted-attraction.html#cb104-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">lambda =</span> lambda[,ii]</span>
<span id="cb104-17"><a href="application-experience-weighted-attraction.html#cb104-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb104-18"><a href="application-experience-weighted-attraction.html#cb104-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb104-19"><a href="application-experience-weighted-attraction.html#cb104-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb104-20"><a href="application-experience-weighted-attraction.html#cb104-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-21"><a href="application-experience-weighted-attraction.html#cb104-21" aria-hidden="true" tabindex="-1"></a>IndParamsLong<span class="ot">&lt;-</span>IndParams <span class="sc">|&gt;</span></span>
<span id="cb104-22"><a href="application-experience-weighted-attraction.html#cb104-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(phi,rho,delta,lambda),<span class="at">names_to=</span><span class="st">&quot;parameter&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="application-experience-weighted-attraction.html#cb105-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb105-2"><a href="application-experience-weighted-attraction.html#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb105-3"><a href="application-experience-weighted-attraction.html#cb105-3" aria-hidden="true" tabindex="-1"></a>    IndParamsLong <span class="sc">|&gt;</span></span>
<span id="cb105-4"><a href="application-experience-weighted-attraction.html#cb105-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(id,parameter) <span class="sc">|&gt;</span></span>
<span id="cb105-5"><a href="application-experience-weighted-attraction.html#cb105-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value)),</span>
<span id="cb105-6"><a href="application-experience-weighted-attraction.html#cb105-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x=</span>mean)</span>
<span id="cb105-7"><a href="application-experience-weighted-attraction.html#cb105-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb105-8"><a href="application-experience-weighted-attraction.html#cb105-8" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_histogram</span>()</span>
<span id="cb105-9"><a href="application-experience-weighted-attraction.html#cb105-9" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb105-10"><a href="application-experience-weighted-attraction.html#cb105-10" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>parameter,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>)</span>
<span id="cb105-11"><a href="application-experience-weighted-attraction.html#cb105-11" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;posterior mean estimate&quot;</span>)</span>
<span id="cb105-12"><a href="application-experience-weighted-attraction.html#cb105-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:CFH2010TASPIndParamsHist"></span>
<img src="index_files/figure-html/CFH2010TASPIndParamsHist-1.png" alt="Posterior mean estimates of individual-level parameters." width="672" />
<p class="caption">
Figure 7.2: Posterior mean estimates of individual-level parameters.
</p>
</div>
<p>One way I like to visualize the individual-level parameters is to show the empirical cumulative density function (ecdf) of the posterior mean overlaid with a Bayesian credible region. This gives you a sense of both scale and precision for these parameters. I do this in Figure <a href="application-experience-weighted-attraction.html#fig:CFH2010TASPIndParamsECDF">7.3</a>, which overlays the ecdf with 90% Bayesian credible regions. Here we can see that there is very little heterogeneity in <span class="math inline">\(\delta\)</span>, evidenced by the near vertical ecdf and small horizontal scale on this panel. Coupled with the narrow credible regions only covering values close to zero, we can be fairly certain for most participants that reinforcement learning (<span class="math inline">\(\delta = 0\)</span>) is a <em>much</em> better approximation of behavior than is weighted fictitious play (<span class="math inline">\(\delta = 1\)</span>). <span class="math inline">\(\rho\)</span> appears to be the parameter that we learn the least about, as many of its credible regions cover a wide range of the unit interval. On the other hand, <span class="math inline">\(\phi\)</span> is estimated reasonably accurately.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="application-experience-weighted-attraction.html#cb106-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb106-2"><a href="application-experience-weighted-attraction.html#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb106-3"><a href="application-experience-weighted-attraction.html#cb106-3" aria-hidden="true" tabindex="-1"></a>    IndParamsLong <span class="sc">|&gt;</span></span>
<span id="cb106-4"><a href="application-experience-weighted-attraction.html#cb106-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(id,parameter) <span class="sc">|&gt;</span></span>
<span id="cb106-5"><a href="application-experience-weighted-attraction.html#cb106-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb106-6"><a href="application-experience-weighted-attraction.html#cb106-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">p05 =</span> <span class="fu">quantile</span>(value,<span class="at">probs =</span> <span class="fl">0.05</span>),</span>
<span id="cb106-7"><a href="application-experience-weighted-attraction.html#cb106-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">p95 =</span> <span class="fu">quantile</span>(value,<span class="at">probs =</span> <span class="fl">0.95</span>)</span>
<span id="cb106-8"><a href="application-experience-weighted-attraction.html#cb106-8" aria-hidden="true" tabindex="-1"></a>                ) <span class="sc">|&gt;</span></span>
<span id="cb106-9"><a href="application-experience-weighted-attraction.html#cb106-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb106-10"><a href="application-experience-weighted-attraction.html#cb106-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(parameter) <span class="sc">|&gt;</span></span>
<span id="cb106-11"><a href="application-experience-weighted-attraction.html#cb106-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(mean) <span class="sc">|&gt;</span></span>
<span id="cb106-12"><a href="application-experience-weighted-attraction.html#cb106-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">ecdf =</span> (<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())<span class="sc">/</span><span class="fu">n</span>())</span>
<span id="cb106-13"><a href="application-experience-weighted-attraction.html#cb106-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb106-14"><a href="application-experience-weighted-attraction.html#cb106-14" aria-hidden="true" tabindex="-1"></a>    ,</span>
<span id="cb106-15"><a href="application-experience-weighted-attraction.html#cb106-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x=</span>mean,<span class="at">y=</span>ecdf,<span class="at">xmin=</span>p05,<span class="at">xmax=</span>p95)</span>
<span id="cb106-16"><a href="application-experience-weighted-attraction.html#cb106-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb106-17"><a href="application-experience-weighted-attraction.html#cb106-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#+geom_point(size = 0.2)</span></span>
<span id="cb106-18"><a href="application-experience-weighted-attraction.html#cb106-18" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">stat_ecdf</span>()</span>
<span id="cb106-19"><a href="application-experience-weighted-attraction.html#cb106-19" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_errorbar</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>)</span>
<span id="cb106-20"><a href="application-experience-weighted-attraction.html#cb106-20" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb106-21"><a href="application-experience-weighted-attraction.html#cb106-21" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">facet_wrap</span>(<span class="sc">~</span>parameter,<span class="at">scales=</span><span class="st">&quot;free&quot;</span>)</span>
<span id="cb106-22"><a href="application-experience-weighted-attraction.html#cb106-22" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;posterior mean estimate&quot;</span>)</span>
<span id="cb106-23"><a href="application-experience-weighted-attraction.html#cb106-23" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;empirical cumulative density&quot;</span>)</span>
<span id="cb106-24"><a href="application-experience-weighted-attraction.html#cb106-24" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:CFH2010TASPIndParamsECDF"></span>
<img src="index_files/figure-html/CFH2010TASPIndParamsECDF-1.png" alt="Posterior estimates of individual-level parameters. Empirical cumulative density of posterior means overlayed with 90% Bayesian credible regions." width="672" />
<p class="caption">
Figure 7.3: Posterior estimates of individual-level parameters. Empirical cumulative density of posterior means overlayed with 90% Bayesian credible regions.
</p>
</div>
</div>
</div>
<div id="some-code-used-to-estimate-the-models-1" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Some code used to estimate the models<a href="application-experience-weighted-attraction.html#some-code-used-to-estimate-the-models-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Here is the <em>R</em> code used to load the data and estimate the models.</p>
<div id="loading-the-data" class="section level3 hasAnchor" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> Loading the data<a href="application-experience-weighted-attraction.html#loading-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="application-experience-weighted-attraction.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb107-2"><a href="application-experience-weighted-attraction.html#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb107-3"><a href="application-experience-weighted-attraction.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb107-4"><a href="application-experience-weighted-attraction.html#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb107-5"><a href="application-experience-weighted-attraction.html#cb107-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-6"><a href="application-experience-weighted-attraction.html#cb107-6" aria-hidden="true" tabindex="-1"></a>D<span class="ot">&lt;-</span> <span class="st">&quot;Data/CFH2010TASP/TASP-12Sess.csv&quot;</span> <span class="sc">|&gt;</span> </span>
<span id="cb107-7"><a href="application-experience-weighted-attraction.html#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.csv</span>() <span class="sc">|&gt;</span></span>
<span id="cb107-8"><a href="application-experience-weighted-attraction.html#cb107-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(session,period,subject,stableID,hi_payID,group,direction) <span class="sc">|&gt;</span></span>
<span id="cb107-9"><a href="application-experience-weighted-attraction.html#cb107-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">paste</span>(session,subject) <span class="sc">|&gt;</span> <span class="fu">as.factor</span>() <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>()) <span class="sc">|&gt;</span></span>
<span id="cb107-10"><a href="application-experience-weighted-attraction.html#cb107-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># direction is coded as 0,1,2,3. If I code it as 1,2,3,4 then I can reference</span></span>
<span id="cb107-11"><a href="application-experience-weighted-attraction.html#cb107-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the payoff matrix</span></span>
<span id="cb107-12"><a href="application-experience-weighted-attraction.html#cb107-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">direction =</span> direction<span class="sc">+</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb107-13"><a href="application-experience-weighted-attraction.html#cb107-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(id,period) <span class="sc">|&gt;</span></span>
<span id="cb107-14"><a href="application-experience-weighted-attraction.html#cb107-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(period,session,group) <span class="sc">|&gt;</span></span>
<span id="cb107-15"><a href="application-experience-weighted-attraction.html#cb107-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">direction_other =</span> <span class="fu">sum</span>(direction)<span class="sc">-</span>direction) <span class="sc">|&gt;</span></span>
<span id="cb107-16"><a href="application-experience-weighted-attraction.html#cb107-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb107-17"><a href="application-experience-weighted-attraction.html#cb107-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Link this to the payoff matrices below</span></span>
<span id="cb107-18"><a href="application-experience-weighted-attraction.html#cb107-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gameCode =</span> stableID<span class="sc">+</span><span class="dv">1</span>,</span>
<span id="cb107-19"><a href="application-experience-weighted-attraction.html#cb107-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">hi_payID =</span> hi_payID<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb107-20"><a href="application-experience-weighted-attraction.html#cb107-20" aria-hidden="true" tabindex="-1"></a>         ) </span>
<span id="cb107-21"><a href="application-experience-weighted-attraction.html#cb107-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-22"><a href="application-experience-weighted-attraction.html#cb107-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-23"><a href="application-experience-weighted-attraction.html#cb107-23" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------</span></span>
<span id="cb107-24"><a href="application-experience-weighted-attraction.html#cb107-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrangle data into a Stan-friendly format</span></span>
<span id="cb107-25"><a href="application-experience-weighted-attraction.html#cb107-25" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------</span></span>
<span id="cb107-26"><a href="application-experience-weighted-attraction.html#cb107-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-27"><a href="application-experience-weighted-attraction.html#cb107-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Here I am going to make everything TxN arrays, or in some cases TxNx4</span></span>
<span id="cb107-28"><a href="application-experience-weighted-attraction.html#cb107-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-29"><a href="application-experience-weighted-attraction.html#cb107-29" aria-hidden="true" tabindex="-1"></a>nPeriods<span class="ot">&lt;-</span><span class="fu">length</span>(D<span class="sc">$</span>period <span class="sc">|&gt;</span> <span class="fu">unique</span>())</span>
<span id="cb107-30"><a href="application-experience-weighted-attraction.html#cb107-30" aria-hidden="true" tabindex="-1"></a>nParticipants<span class="ot">&lt;-</span><span class="fu">length</span>(D<span class="sc">$</span>id <span class="sc">|&gt;</span> <span class="fu">unique</span>())</span>
<span id="cb107-31"><a href="application-experience-weighted-attraction.html#cb107-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-32"><a href="application-experience-weighted-attraction.html#cb107-32" aria-hidden="true" tabindex="-1"></a><span class="co"># PROBLEM: There was a tornado during session 4, and so these participants</span></span>
<span id="cb107-33"><a href="application-experience-weighted-attraction.html#cb107-33" aria-hidden="true" tabindex="-1"></a><span class="co"># only played 70 rounds, not 80. To see this, note this</span></span>
<span id="cb107-34"><a href="application-experience-weighted-attraction.html#cb107-34" aria-hidden="true" tabindex="-1"></a>D <span class="sc">|&gt;</span> <span class="fu">group_by</span>(session) <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="at">maxPeriod=</span><span class="fu">max</span>(period))</span>
<span id="cb107-35"><a href="application-experience-weighted-attraction.html#cb107-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-36"><a href="application-experience-weighted-attraction.html#cb107-36" aria-hidden="true" tabindex="-1"></a>ID <span class="ot">&lt;-</span><span class="fu">array</span>(<span class="dv">0</span>,<span class="at">dim =</span> <span class="fu">c</span>(nPeriods,nParticipants))</span>
<span id="cb107-37"><a href="application-experience-weighted-attraction.html#cb107-37" aria-hidden="true" tabindex="-1"></a>PERIOD <span class="ot">&lt;-</span><span class="fu">array</span>(<span class="dv">0</span>,<span class="at">dim =</span> <span class="fu">c</span>(nPeriods,nParticipants))</span>
<span id="cb107-38"><a href="application-experience-weighted-attraction.html#cb107-38" aria-hidden="true" tabindex="-1"></a>DIRECTION<span class="ot">&lt;-</span><span class="fu">array</span>(<span class="dv">1</span>,<span class="at">dim =</span> <span class="fu">c</span>(nPeriods,nParticipants))</span>
<span id="cb107-39"><a href="application-experience-weighted-attraction.html#cb107-39" aria-hidden="true" tabindex="-1"></a>DIRECTION_OTHER<span class="ot">&lt;-</span><span class="fu">array</span>(<span class="dv">1</span>,<span class="at">dim =</span> <span class="fu">c</span>(nPeriods,nParticipants))</span>
<span id="cb107-40"><a href="application-experience-weighted-attraction.html#cb107-40" aria-hidden="true" tabindex="-1"></a>GAME_CODE<span class="ot">&lt;-</span><span class="fu">array</span>(<span class="dv">1</span>,<span class="at">dim =</span> <span class="fu">c</span>(nPeriods,nParticipants))</span>
<span id="cb107-41"><a href="application-experience-weighted-attraction.html#cb107-41" aria-hidden="true" tabindex="-1"></a>HIPAY<span class="ot">&lt;-</span><span class="fu">array</span>(<span class="dv">1</span>,<span class="at">dim =</span> <span class="fu">c</span>(nPeriods,nParticipants))</span>
<span id="cb107-42"><a href="application-experience-weighted-attraction.html#cb107-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-43"><a href="application-experience-weighted-attraction.html#cb107-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unique</span>(D<span class="sc">$</span>id))) {</span>
<span id="cb107-44"><a href="application-experience-weighted-attraction.html#cb107-44" aria-hidden="true" tabindex="-1"></a>  d<span class="ot">&lt;-</span>D <span class="sc">|&gt;</span> <span class="fu">filter</span>(id<span class="sc">==</span>ii)</span>
<span id="cb107-45"><a href="application-experience-weighted-attraction.html#cb107-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb107-46"><a href="application-experience-weighted-attraction.html#cb107-46" aria-hidden="true" tabindex="-1"></a>  ID[<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(d)[<span class="dv">1</span>],ii]<span class="ot">&lt;-</span>d<span class="sc">$</span>id</span>
<span id="cb107-47"><a href="application-experience-weighted-attraction.html#cb107-47" aria-hidden="true" tabindex="-1"></a>  PERIOD[<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(d)[<span class="dv">1</span>],ii]<span class="ot">&lt;-</span>d<span class="sc">$</span>period</span>
<span id="cb107-48"><a href="application-experience-weighted-attraction.html#cb107-48" aria-hidden="true" tabindex="-1"></a>  DIRECTION[<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(d)[<span class="dv">1</span>],ii]<span class="ot">&lt;-</span>d<span class="sc">$</span>direction</span>
<span id="cb107-49"><a href="application-experience-weighted-attraction.html#cb107-49" aria-hidden="true" tabindex="-1"></a>  DIRECTION_OTHER[<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(d)[<span class="dv">1</span>],ii]<span class="ot">&lt;-</span>d<span class="sc">$</span>direction_other</span>
<span id="cb107-50"><a href="application-experience-weighted-attraction.html#cb107-50" aria-hidden="true" tabindex="-1"></a>  GAME_CODE[,ii]<span class="ot">&lt;-</span>d<span class="sc">$</span>gameCode[<span class="dv">1</span>]</span>
<span id="cb107-51"><a href="application-experience-weighted-attraction.html#cb107-51" aria-hidden="true" tabindex="-1"></a>  HIPAY[<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(d)[<span class="dv">1</span>],ii]<span class="ot">&lt;-</span>d<span class="sc">$</span>hi_payID</span>
<span id="cb107-52"><a href="application-experience-weighted-attraction.html#cb107-52" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-53"><a href="application-experience-weighted-attraction.html#cb107-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-54"><a href="application-experience-weighted-attraction.html#cb107-54" aria-hidden="true" tabindex="-1"></a>USEDATA<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">*</span>(ID<span class="sc">!=</span><span class="dv">0</span>)</span>
<span id="cb107-55"><a href="application-experience-weighted-attraction.html#cb107-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-56"><a href="application-experience-weighted-attraction.html#cb107-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-57"><a href="application-experience-weighted-attraction.html#cb107-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-58"><a href="application-experience-weighted-attraction.html#cb107-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-59"><a href="application-experience-weighted-attraction.html#cb107-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-60"><a href="application-experience-weighted-attraction.html#cb107-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-61"><a href="application-experience-weighted-attraction.html#cb107-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-62"><a href="application-experience-weighted-attraction.html#cb107-62" aria-hidden="true" tabindex="-1"></a>payoffs<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb107-63"><a href="application-experience-weighted-attraction.html#cb107-63" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Unstable</span></span>
<span id="cb107-64"><a href="application-experience-weighted-attraction.html#cb107-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(</span>
<span id="cb107-65"><a href="application-experience-weighted-attraction.html#cb107-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">90</span>,<span class="dv">0</span>,<span class="dv">120</span>,<span class="dv">20</span>),</span>
<span id="cb107-66"><a href="application-experience-weighted-attraction.html#cb107-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">120</span>,<span class="dv">90</span>,<span class="dv">0</span>,<span class="dv">20</span>),</span>
<span id="cb107-67"><a href="application-experience-weighted-attraction.html#cb107-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">120</span>,<span class="dv">90</span>,<span class="dv">20</span>),</span>
<span id="cb107-68"><a href="application-experience-weighted-attraction.html#cb107-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">90</span>,<span class="dv">90</span>,<span class="dv">90</span>,<span class="dv">0</span>)</span>
<span id="cb107-69"><a href="application-experience-weighted-attraction.html#cb107-69" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb107-70"><a href="application-experience-weighted-attraction.html#cb107-70" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Stable</span></span>
<span id="cb107-71"><a href="application-experience-weighted-attraction.html#cb107-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(</span>
<span id="cb107-72"><a href="application-experience-weighted-attraction.html#cb107-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">60</span>,<span class="dv">0</span>,<span class="dv">150</span>,<span class="dv">20</span>),</span>
<span id="cb107-73"><a href="application-experience-weighted-attraction.html#cb107-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">150</span>,<span class="dv">60</span>,<span class="dv">0</span>,<span class="dv">20</span>),</span>
<span id="cb107-74"><a href="application-experience-weighted-attraction.html#cb107-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">150</span>,<span class="dv">60</span>,<span class="dv">20</span>),</span>
<span id="cb107-75"><a href="application-experience-weighted-attraction.html#cb107-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">90</span>,<span class="dv">90</span>,<span class="dv">90</span>,<span class="dv">0</span>)</span>
<span id="cb107-76"><a href="application-experience-weighted-attraction.html#cb107-76" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb107-77"><a href="application-experience-weighted-attraction.html#cb107-77" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-78"><a href="application-experience-weighted-attraction.html#cb107-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-79"><a href="application-experience-weighted-attraction.html#cb107-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-80"><a href="application-experience-weighted-attraction.html#cb107-80" aria-hidden="true" tabindex="-1"></a>nActions<span class="ot">&lt;-</span><span class="fu">dim</span>(payoffs[[<span class="dv">1</span>]])[<span class="dv">1</span>]</span>
<span id="cb107-81"><a href="application-experience-weighted-attraction.html#cb107-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-82"><a href="application-experience-weighted-attraction.html#cb107-82" aria-hidden="true" tabindex="-1"></a>PAYOFFS<span class="ot">&lt;-</span><span class="fu">array</span>(<span class="cn">NA</span>,<span class="at">dim=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">4</span>))</span>
<span id="cb107-83"><a href="application-experience-weighted-attraction.html#cb107-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-84"><a href="application-experience-weighted-attraction.html#cb107-84" aria-hidden="true" tabindex="-1"></a>PAYOFFS[<span class="dv">1</span>,,]<span class="ot">&lt;-</span>payoffs[[<span class="dv">1</span>]]</span>
<span id="cb107-85"><a href="application-experience-weighted-attraction.html#cb107-85" aria-hidden="true" tabindex="-1"></a>PAYOFFS[<span class="dv">2</span>,,]<span class="ot">&lt;-</span>payoffs[[<span class="dv">2</span>]]</span>
<span id="cb107-86"><a href="application-experience-weighted-attraction.html#cb107-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-87"><a href="application-experience-weighted-attraction.html#cb107-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-88"><a href="application-experience-weighted-attraction.html#cb107-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-89"><a href="application-experience-weighted-attraction.html#cb107-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-90"><a href="application-experience-weighted-attraction.html#cb107-90" aria-hidden="true" tabindex="-1"></a>gameCode<span class="ot">&lt;-</span>(D <span class="sc">|&gt;</span> <span class="fu">filter</span>(period<span class="sc">==</span><span class="dv">1</span>))<span class="sc">$</span>gameCode</span>
<span id="cb107-91"><a href="application-experience-weighted-attraction.html#cb107-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-92"><a href="application-experience-weighted-attraction.html#cb107-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-93"><a href="application-experience-weighted-attraction.html#cb107-93" aria-hidden="true" tabindex="-1"></a>PI<span class="ot">&lt;-</span><span class="fu">array</span>(<span class="dv">0</span>,<span class="at">dim=</span><span class="fu">c</span>(nPeriods,nParticipants,nActions))</span>
<span id="cb107-94"><a href="application-experience-weighted-attraction.html#cb107-94" aria-hidden="true" tabindex="-1"></a>I<span class="ot">&lt;-</span><span class="fu">array</span>(<span class="dv">0</span>,<span class="at">dim=</span><span class="fu">c</span>(nPeriods,nParticipants,nActions))</span>
<span id="cb107-95"><a href="application-experience-weighted-attraction.html#cb107-95" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (ii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nParticipants) {</span>
<span id="cb107-96"><a href="application-experience-weighted-attraction.html#cb107-96" aria-hidden="true" tabindex="-1"></a>  U<span class="ot">&lt;-</span>payoffs[[gameCode[ii]]]</span>
<span id="cb107-97"><a href="application-experience-weighted-attraction.html#cb107-97" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (aa <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>nActions) {</span>
<span id="cb107-98"><a href="application-experience-weighted-attraction.html#cb107-98" aria-hidden="true" tabindex="-1"></a>    PI[,ii,aa]<span class="ot">&lt;-</span>U[aa,DIRECTION_OTHER[,ii]]</span>
<span id="cb107-99"><a href="application-experience-weighted-attraction.html#cb107-99" aria-hidden="true" tabindex="-1"></a>    I[,ii,aa]<span class="ot">&lt;-</span><span class="dv">1</span><span class="sc">*</span>(DIRECTION[,ii]<span class="sc">==</span>aa)</span>
<span id="cb107-100"><a href="application-experience-weighted-attraction.html#cb107-100" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb107-101"><a href="application-experience-weighted-attraction.html#cb107-101" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb107-102"><a href="application-experience-weighted-attraction.html#cb107-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-103"><a href="application-experience-weighted-attraction.html#cb107-103" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb107-104"><a href="application-experience-weighted-attraction.html#cb107-104" aria-hidden="true" tabindex="-1"></a>dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb107-105"><a href="application-experience-weighted-attraction.html#cb107-105" aria-hidden="true" tabindex="-1"></a> <span class="at">nPeriods =</span> nPeriods,</span>
<span id="cb107-106"><a href="application-experience-weighted-attraction.html#cb107-106" aria-hidden="true" tabindex="-1"></a> <span class="at">nParticipants =</span> nParticipants,</span>
<span id="cb107-107"><a href="application-experience-weighted-attraction.html#cb107-107" aria-hidden="true" tabindex="-1"></a> <span class="at">nGames =</span> <span class="fu">length</span>(payoffs),</span>
<span id="cb107-108"><a href="application-experience-weighted-attraction.html#cb107-108" aria-hidden="true" tabindex="-1"></a> <span class="at">nActions =</span> nActions,</span>
<span id="cb107-109"><a href="application-experience-weighted-attraction.html#cb107-109" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb107-110"><a href="application-experience-weighted-attraction.html#cb107-110" aria-hidden="true" tabindex="-1"></a> <span class="at">direction =</span> DIRECTION,</span>
<span id="cb107-111"><a href="application-experience-weighted-attraction.html#cb107-111" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb107-112"><a href="application-experience-weighted-attraction.html#cb107-112" aria-hidden="true" tabindex="-1"></a> <span class="at">UseData =</span> USEDATA,</span>
<span id="cb107-113"><a href="application-experience-weighted-attraction.html#cb107-113" aria-hidden="true" tabindex="-1"></a> <span class="at">GameCode =</span> GAME_CODE,</span>
<span id="cb107-114"><a href="application-experience-weighted-attraction.html#cb107-114" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb107-115"><a href="application-experience-weighted-attraction.html#cb107-115" aria-hidden="true" tabindex="-1"></a> <span class="at">HiPay =</span> HIPAY,</span>
<span id="cb107-116"><a href="application-experience-weighted-attraction.html#cb107-116" aria-hidden="true" tabindex="-1"></a> <span class="at">payoff_multipliers =</span> <span class="fu">c</span>(<span class="fl">0.035</span>,<span class="fl">0.035</span>),</span>
<span id="cb107-117"><a href="application-experience-weighted-attraction.html#cb107-117" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb107-118"><a href="application-experience-weighted-attraction.html#cb107-118" aria-hidden="true" tabindex="-1"></a> <span class="at">payoffs =</span> PAYOFFS,</span>
<span id="cb107-119"><a href="application-experience-weighted-attraction.html#cb107-119" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb107-120"><a href="application-experience-weighted-attraction.html#cb107-120" aria-hidden="true" tabindex="-1"></a> <span class="at">PI =</span> PI,</span>
<span id="cb107-121"><a href="application-experience-weighted-attraction.html#cb107-121" aria-hidden="true" tabindex="-1"></a> <span class="at">I  =</span> I,</span>
<span id="cb107-122"><a href="application-experience-weighted-attraction.html#cb107-122" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb107-123"><a href="application-experience-weighted-attraction.html#cb107-123" aria-hidden="true" tabindex="-1"></a> <span class="at">prior_phi =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb107-124"><a href="application-experience-weighted-attraction.html#cb107-124" aria-hidden="true" tabindex="-1"></a> <span class="at">prior_delta =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb107-125"><a href="application-experience-weighted-attraction.html#cb107-125" aria-hidden="true" tabindex="-1"></a> <span class="at">prior_rho =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb107-126"><a href="application-experience-weighted-attraction.html#cb107-126" aria-hidden="true" tabindex="-1"></a> <span class="at">prior_lambda =</span> <span class="fu">c</span>(<span class="fl">1.15</span>,<span class="fl">1.76</span>),</span>
<span id="cb107-127"><a href="application-experience-weighted-attraction.html#cb107-127" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb107-128"><a href="application-experience-weighted-attraction.html#cb107-128" aria-hidden="true" tabindex="-1"></a> <span class="at">max_payoff =</span> <span class="dv">150</span><span class="sc">*</span><span class="fl">0.035</span></span>
<span id="cb107-129"><a href="application-experience-weighted-attraction.html#cb107-129" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb107-130"><a href="application-experience-weighted-attraction.html#cb107-130" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb107-131"><a href="application-experience-weighted-attraction.html#cb107-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-132"><a href="application-experience-weighted-attraction.html#cb107-132" aria-hidden="true" tabindex="-1"></a>dStan <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(<span class="st">&quot;Data/CFH2010TASP/CFH2010TASP_dStan.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="estimating-the-representative-agent-models" class="section level3 hasAnchor" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> Estimating the representative agent models<a href="application-experience-weighted-attraction.html#estimating-the-representative-agent-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="application-experience-weighted-attraction.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb108-2"><a href="application-experience-weighted-attraction.html#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb108-3"><a href="application-experience-weighted-attraction.html#cb108-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-4"><a href="application-experience-weighted-attraction.html#cb108-4" aria-hidden="true" tabindex="-1"></a>dStan <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;Data/CFH2010TASP/CFH2010TASP_dStan.rds&quot;</span>)</span>
<span id="cb108-5"><a href="application-experience-weighted-attraction.html#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="application-experience-weighted-attraction.html#cb108-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-7"><a href="application-experience-weighted-attraction.html#cb108-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-8"><a href="application-experience-weighted-attraction.html#cb108-8" aria-hidden="true" tabindex="-1"></a>RAmodel<span class="ot">&lt;-</span><span class="fu">stan_model</span>(<span class="st">&quot;Code/CFH2010TASP/EWA.stan&quot;</span>)</span>
<span id="cb108-9"><a href="application-experience-weighted-attraction.html#cb108-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-10"><a href="application-experience-weighted-attraction.html#cb108-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Model pooling all data</span></span>
<span id="cb108-11"><a href="application-experience-weighted-attraction.html#cb108-11" aria-hidden="true" tabindex="-1"></a>file<span class="ot">&lt;-</span><span class="st">&quot;Code/CFH2010TASP/Estimates_RA_Pooled.rds&quot;</span></span>
<span id="cb108-12"><a href="application-experience-weighted-attraction.html#cb108-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) {</span>
<span id="cb108-13"><a href="application-experience-weighted-attraction.html#cb108-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;estimating&quot;</span>,file))</span>
<span id="cb108-14"><a href="application-experience-weighted-attraction.html#cb108-14" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">sampling</span>(RAmodel,<span class="at">data=</span>dStan,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb108-15"><a href="application-experience-weighted-attraction.html#cb108-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(Fit)<span class="sc">$</span>summary <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(<span class="at">file=</span>file)</span>
<span id="cb108-16"><a href="application-experience-weighted-attraction.html#cb108-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-17"><a href="application-experience-weighted-attraction.html#cb108-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-18"><a href="application-experience-weighted-attraction.html#cb108-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Unstable low payoffs</span></span>
<span id="cb108-19"><a href="application-experience-weighted-attraction.html#cb108-19" aria-hidden="true" tabindex="-1"></a>dd<span class="ot">&lt;-</span>dStan<span class="sc">$</span>UseData <span class="sc">*</span> (dStan<span class="sc">$</span>HiPay<span class="sc">==</span><span class="dv">1</span>) <span class="sc">*</span> (dStan<span class="sc">$</span>GameCode<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb108-20"><a href="application-experience-weighted-attraction.html#cb108-20" aria-hidden="true" tabindex="-1"></a>d<span class="ot">&lt;-</span>dStan</span>
<span id="cb108-21"><a href="application-experience-weighted-attraction.html#cb108-21" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>UseData<span class="ot">&lt;-</span>dd</span>
<span id="cb108-22"><a href="application-experience-weighted-attraction.html#cb108-22" aria-hidden="true" tabindex="-1"></a>file<span class="ot">&lt;-</span><span class="st">&quot;Code/CFH2010TASP/Estimates_RA_UnstableLow.rds&quot;</span></span>
<span id="cb108-23"><a href="application-experience-weighted-attraction.html#cb108-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) { </span>
<span id="cb108-24"><a href="application-experience-weighted-attraction.html#cb108-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;estimating&quot;</span>,file))</span>
<span id="cb108-25"><a href="application-experience-weighted-attraction.html#cb108-25" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">sampling</span>(RAmodel,<span class="at">data=</span>d,<span class="at">seed=</span><span class="dv">42</span>,<span class="at">iter=</span><span class="dv">2000</span>)</span>
<span id="cb108-26"><a href="application-experience-weighted-attraction.html#cb108-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(Fit)<span class="sc">$</span>summary <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(<span class="at">file=</span>file)</span>
<span id="cb108-27"><a href="application-experience-weighted-attraction.html#cb108-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-28"><a href="application-experience-weighted-attraction.html#cb108-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-29"><a href="application-experience-weighted-attraction.html#cb108-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Unstable high payoffs</span></span>
<span id="cb108-30"><a href="application-experience-weighted-attraction.html#cb108-30" aria-hidden="true" tabindex="-1"></a>dd<span class="ot">&lt;-</span>dStan<span class="sc">$</span>UseData <span class="sc">*</span> (dStan<span class="sc">$</span>HiPay<span class="sc">==</span><span class="dv">2</span>) <span class="sc">*</span> (dStan<span class="sc">$</span>GameCode<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb108-31"><a href="application-experience-weighted-attraction.html#cb108-31" aria-hidden="true" tabindex="-1"></a>d<span class="ot">&lt;-</span>dStan</span>
<span id="cb108-32"><a href="application-experience-weighted-attraction.html#cb108-32" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>UseData<span class="ot">&lt;-</span>dd</span>
<span id="cb108-33"><a href="application-experience-weighted-attraction.html#cb108-33" aria-hidden="true" tabindex="-1"></a>file<span class="ot">&lt;-</span><span class="st">&quot;Code/CFH2010TASP/Estimates_RA_UnstableHi.rds&quot;</span></span>
<span id="cb108-34"><a href="application-experience-weighted-attraction.html#cb108-34" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) {</span>
<span id="cb108-35"><a href="application-experience-weighted-attraction.html#cb108-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;estimating&quot;</span>,file))</span>
<span id="cb108-36"><a href="application-experience-weighted-attraction.html#cb108-36" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">sampling</span>(RAmodel,<span class="at">data=</span>d,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb108-37"><a href="application-experience-weighted-attraction.html#cb108-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(Fit)<span class="sc">$</span>summary <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(<span class="at">file=</span>file)</span>
<span id="cb108-38"><a href="application-experience-weighted-attraction.html#cb108-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-39"><a href="application-experience-weighted-attraction.html#cb108-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-40"><a href="application-experience-weighted-attraction.html#cb108-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Stable low payoffs</span></span>
<span id="cb108-41"><a href="application-experience-weighted-attraction.html#cb108-41" aria-hidden="true" tabindex="-1"></a>dd<span class="ot">&lt;-</span>dStan<span class="sc">$</span>UseData <span class="sc">*</span> (dStan<span class="sc">$</span>HiPay<span class="sc">==</span><span class="dv">1</span>) <span class="sc">*</span> (dStan<span class="sc">$</span>GameCode<span class="sc">==</span><span class="dv">2</span>)</span>
<span id="cb108-42"><a href="application-experience-weighted-attraction.html#cb108-42" aria-hidden="true" tabindex="-1"></a>d<span class="ot">&lt;-</span>dStan</span>
<span id="cb108-43"><a href="application-experience-weighted-attraction.html#cb108-43" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>UseData<span class="ot">&lt;-</span>dd</span>
<span id="cb108-44"><a href="application-experience-weighted-attraction.html#cb108-44" aria-hidden="true" tabindex="-1"></a>file<span class="ot">&lt;-</span><span class="st">&quot;Code/CFH2010TASP/Estimates_RA_StableLow.rds&quot;</span></span>
<span id="cb108-45"><a href="application-experience-weighted-attraction.html#cb108-45" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) {</span>
<span id="cb108-46"><a href="application-experience-weighted-attraction.html#cb108-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;estimating&quot;</span>,file))</span>
<span id="cb108-47"><a href="application-experience-weighted-attraction.html#cb108-47" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">sampling</span>(RAmodel,<span class="at">data=</span>d,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb108-48"><a href="application-experience-weighted-attraction.html#cb108-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(Fit)<span class="sc">$</span>summary <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(<span class="at">file=</span>file)</span>
<span id="cb108-49"><a href="application-experience-weighted-attraction.html#cb108-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb108-50"><a href="application-experience-weighted-attraction.html#cb108-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-51"><a href="application-experience-weighted-attraction.html#cb108-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Stable high payoffs</span></span>
<span id="cb108-52"><a href="application-experience-weighted-attraction.html#cb108-52" aria-hidden="true" tabindex="-1"></a>dd<span class="ot">&lt;-</span>dStan<span class="sc">$</span>UseData <span class="sc">*</span> (dStan<span class="sc">$</span>HiPay<span class="sc">==</span><span class="dv">2</span>) <span class="sc">*</span> (dStan<span class="sc">$</span>GameCode<span class="sc">==</span><span class="dv">2</span>)</span>
<span id="cb108-53"><a href="application-experience-weighted-attraction.html#cb108-53" aria-hidden="true" tabindex="-1"></a>d<span class="ot">&lt;-</span>dStan</span>
<span id="cb108-54"><a href="application-experience-weighted-attraction.html#cb108-54" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>UseData<span class="ot">&lt;-</span>dd</span>
<span id="cb108-55"><a href="application-experience-weighted-attraction.html#cb108-55" aria-hidden="true" tabindex="-1"></a>file<span class="ot">&lt;-</span><span class="st">&quot;Code/CFH2010TASP/Estimates_RA_StableHi.rds&quot;</span></span>
<span id="cb108-56"><a href="application-experience-weighted-attraction.html#cb108-56" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) {</span>
<span id="cb108-57"><a href="application-experience-weighted-attraction.html#cb108-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;estimating&quot;</span>,file))</span>
<span id="cb108-58"><a href="application-experience-weighted-attraction.html#cb108-58" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">sampling</span>(RAmodel,<span class="at">data=</span>d,<span class="at">seed=</span><span class="dv">42</span>)</span>
<span id="cb108-59"><a href="application-experience-weighted-attraction.html#cb108-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(Fit)<span class="sc">$</span>summary <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(<span class="at">file=</span>file)</span>
<span id="cb108-60"><a href="application-experience-weighted-attraction.html#cb108-60" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="estimating-the-hierarchical-model" class="section level3 hasAnchor" number="7.5.3">
<h3><span class="header-section-number">7.5.3</span> Estimating the hierarchical model<a href="application-experience-weighted-attraction.html#estimating-the-hierarchical-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="application-experience-weighted-attraction.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb109-2"><a href="application-experience-weighted-attraction.html#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb109-3"><a href="application-experience-weighted-attraction.html#cb109-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb109-4"><a href="application-experience-weighted-attraction.html#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb109-5"><a href="application-experience-weighted-attraction.html#cb109-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb109-6"><a href="application-experience-weighted-attraction.html#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="application-experience-weighted-attraction.html#cb109-7" aria-hidden="true" tabindex="-1"></a>dStan <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;Data/CFH2010TASP/CFH2010TASP_dStan.rds&quot;</span>)</span>
<span id="cb109-8"><a href="application-experience-weighted-attraction.html#cb109-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-9"><a href="application-experience-weighted-attraction.html#cb109-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-10"><a href="application-experience-weighted-attraction.html#cb109-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-11"><a href="application-experience-weighted-attraction.html#cb109-11" aria-hidden="true" tabindex="-1"></a>model<span class="ot">&lt;-</span><span class="fu">stan_model</span>(<span class="st">&quot;Code/CFH2010TASP/EWAhierarchical.stan&quot;</span>)</span>
<span id="cb109-12"><a href="application-experience-weighted-attraction.html#cb109-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-13"><a href="application-experience-weighted-attraction.html#cb109-13" aria-hidden="true" tabindex="-1"></a>dStan<span class="sc">$</span>prior_MU<span class="ot">&lt;-</span><span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.25</span>),</span>
<span id="cb109-14"><a href="application-experience-weighted-attraction.html#cb109-14" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.25</span>),</span>
<span id="cb109-15"><a href="application-experience-weighted-attraction.html#cb109-15" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.25</span>),</span>
<span id="cb109-16"><a href="application-experience-weighted-attraction.html#cb109-16" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">c</span>(<span class="fl">1.15</span>,<span class="fl">0.75</span>))</span>
<span id="cb109-17"><a href="application-experience-weighted-attraction.html#cb109-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-18"><a href="application-experience-weighted-attraction.html#cb109-18" aria-hidden="true" tabindex="-1"></a>dStan<span class="sc">$</span>prior_TAU<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>,<span class="fl">0.05</span>)</span>
<span id="cb109-19"><a href="application-experience-weighted-attraction.html#cb109-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-20"><a href="application-experience-weighted-attraction.html#cb109-20" aria-hidden="true" tabindex="-1"></a>dStan<span class="sc">$</span>prior_OMEGA<span class="ot">&lt;-</span><span class="dv">5</span></span>
<span id="cb109-21"><a href="application-experience-weighted-attraction.html#cb109-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-22"><a href="application-experience-weighted-attraction.html#cb109-22" aria-hidden="true" tabindex="-1"></a>dStan<span class="sc">$</span>nSimPars<span class="ot">&lt;-</span><span class="dv">1000</span></span>
<span id="cb109-23"><a href="application-experience-weighted-attraction.html#cb109-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-24"><a href="application-experience-weighted-attraction.html#cb109-24" aria-hidden="true" tabindex="-1"></a>file<span class="ot">&lt;-</span><span class="st">&quot;Code/CFH2010TASP/Estimates_Hierarchical_Pooled.rds&quot;</span></span>
<span id="cb109-25"><a href="application-experience-weighted-attraction.html#cb109-25" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(file)) {</span>
<span id="cb109-26"><a href="application-experience-weighted-attraction.html#cb109-26" aria-hidden="true" tabindex="-1"></a>  Fit<span class="ot">&lt;-</span><span class="fu">sampling</span>(model,</span>
<span id="cb109-27"><a href="application-experience-weighted-attraction.html#cb109-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>dStan,</span>
<span id="cb109-28"><a href="application-experience-weighted-attraction.html#cb109-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;z&quot;</span>),<span class="at">include=</span><span class="cn">FALSE</span>,</span>
<span id="cb109-29"><a href="application-experience-weighted-attraction.html#cb109-29" aria-hidden="true" tabindex="-1"></a>                <span class="at">seed=</span><span class="dv">42</span>,</span>
<span id="cb109-30"><a href="application-experience-weighted-attraction.html#cb109-30" aria-hidden="true" tabindex="-1"></a>                <span class="co"># The first time running this with the default iter = 2000</span></span>
<span id="cb109-31"><a href="application-experience-weighted-attraction.html#cb109-31" aria-hidden="true" tabindex="-1"></a>                <span class="co"># yielded the &quot;Bulk ESS low&quot; error. This can be remedied with</span></span>
<span id="cb109-32"><a href="application-experience-weighted-attraction.html#cb109-32" aria-hidden="true" tabindex="-1"></a>                <span class="co"># a larger simulation size. Running with these options </span></span>
<span id="cb109-33"><a href="application-experience-weighted-attraction.html#cb109-33" aria-hidden="true" tabindex="-1"></a>                <span class="co"># produced no error</span></span>
<span id="cb109-34"><a href="application-experience-weighted-attraction.html#cb109-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">iter=</span><span class="dv">4000</span>)</span>
<span id="cb109-35"><a href="application-experience-weighted-attraction.html#cb109-35" aria-hidden="true" tabindex="-1"></a>  Fit <span class="sc">|&gt;</span> <span class="fu">saveRDS</span>(file)</span>
<span id="cb109-36"><a href="application-experience-weighted-attraction.html#cb109-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb109-37"><a href="application-experience-weighted-attraction.html#cb109-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-38"><a href="application-experience-weighted-attraction.html#cb109-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-39"><a href="application-experience-weighted-attraction.html#cb109-39" aria-hidden="true" tabindex="-1"></a><span class="co"># I need to work on fixing the divergences here </span></span>
<span id="cb109-40"><a href="application-experience-weighted-attraction.html#cb109-40" aria-hidden="true" tabindex="-1"></a><span class="co"># So I will hold off on estimating the treatment-specific </span></span>
<span id="cb109-41"><a href="application-experience-weighted-attraction.html#cb109-41" aria-hidden="true" tabindex="-1"></a><span class="co"># models</span></span></code></pre></div>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Bland2019JMP" class="csl-entry">
Bland, James R. 2019. <span>“How Many Games Are We Playing? An Experimental Analysis of Choice Bracketing in Games.”</span> <em>Journal of Behavioral and Experimental Economics</em> 80: 80–91. <a href="https://doi.org/10.1016/j.socec.2019.03.011">https://doi.org/10.1016/j.socec.2019.03.011</a>.
</div>
<div id="ref-Camerer1999" class="csl-entry">
Camerer, Colin, and Teck Hua Ho. 1999. <span>“Experience-Weighted Attraction Learning in Normal Form Games.”</span> <em>Econometrica</em> 67 (4): 827–74.
</div>
<div id="ref-Cason2010" class="csl-entry">
Cason, Timothy N., Daniel Friedman, and Ed Hopkins. 2010. <span>“Testing the TASP: An Experimental Investigation of Learning in Games with Unstable Equilibria.”</span> <em>Journal of Economic Theory</em> 145 (6): 2309–31. https://doi.org/<a href="http://dx.doi.org/10.1016/j.jet.2010.08.011">http://dx.doi.org/10.1016/j.jet.2010.08.011</a>.
</div>
<div id="ref-Wilcox2006" class="csl-entry">
Wilcox, Nathaniel T. 2006. <span>“Theories of Learning in Games and Heterogeneity Bias.”</span> <em>Econometrica</em> 74 (5): 1271–92.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="25">
<li id="fn25"><p>If you’re playing along at home, these participants are coded as <code>session = 4</code>.<a href="application-experience-weighted-attraction.html#fnref25" class="footnote-back">↩︎</a></p></li>
<li id="fn26"><p>Another alternative would be to calculate these in the <code>transformed data</code> block. For some reason <em>Stan</em> was crashing on me when I did this.<a href="application-experience-weighted-attraction.html#fnref26" class="footnote-back">↩︎</a></p></li>
<li id="fn27"><p><em>Stan</em> does not have to evaluate derivatives in the <code>generated quantities</code> block, so things should compute faster here anyway.<a href="application-experience-weighted-attraction.html#fnref27" class="footnote-back">↩︎</a></p></li>
<li id="fn28"><p>The hierarchical model using all of the data produced a <em>Stan</em> fit object that took up about 140MB, and this was after I told it to drop the normalized augmented data. This is certainly not huge by any modern hard drive or RAM requirements, but it is 7% of what Dropbox gives you for free (at the time of writing). <a href="application-experience-weighted-attraction.html#fnref28" class="footnote-back">↩︎</a></p></li>
<li id="fn29"><p>But this was still fairly trivial. The kids were having a Nerf battle nearby while I coded, and I was still able to do it :)<a href="application-experience-weighted-attraction.html#fnref29" class="footnote-back">↩︎</a></p></li>
<li id="fn30"><p>By default, <em>Stan</em> runs 4 chains with 2,000 iterations, but uses 1,000 of these for warm-up. So we are left with 1,000 draws per chain.<a href="application-experience-weighted-attraction.html#fnref30" class="footnote-back">↩︎</a></p></li>
<li id="fn31"><p>The model using all of the data took a little bit over four hours to run on my laptop with this configuration, so while there is plenty of time to solve a shrine or two while it runs, Hyrule will have to wait a little while longer for its salvation.<a href="application-experience-weighted-attraction.html#fnref31" class="footnote-back">↩︎</a></p></li>
<li id="fn32"><p>In contrast though, my job market paper <span class="citation">(<a href="#ref-Bland2019JMP" role="doc-biblioref">Bland 2019</a>)</span> estimates a hierarchical model with a similar number of individual-level parameters and participants, but took up something closer to 1GB on my hard drive. This is because the Metropolis-Hastings within Gibbs sampler I implemented for that paper requires many more posterior draws to get the same effective sample size. Hamiltonian Monte Carlo, which is what <em>Stan</em> uses, generally is much more efficient with its draws.<a href="application-experience-weighted-attraction.html#fnref32" class="footnote-back">↩︎</a></p></li>
<li id="fn33"><p>These <em>can</em> be computed post-estimation from models that use Monte Carlo integration, but they are computed by default when when we use data augmentation.<a href="application-experience-weighted-attraction.html#fnref33" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="applications.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="strategy-frequency-estimation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

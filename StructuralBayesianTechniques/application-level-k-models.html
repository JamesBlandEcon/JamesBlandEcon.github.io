<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>20 Application: Level-\(k\) models | Structural Bayesian Techniques for Experimental and Behavioral Economics</title>
  <meta name="description" content="20 Application: Level-\(k\) models | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  <meta name="generator" content="bookdown 0.45 and GitBook 2.6.7" />

  <meta property="og:title" content="20 Application: Level-\(k\) models | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="20 Application: Level-\(k\) models | Structural Bayesian Techniques for Experimental and Behavioral Economics" />
  
  
  

<meta name="author" content="James R. Bland" />


<meta name="date" content="2026-01-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"/>
<link rel="next" href="application-estimating-risk-preferences.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="section.html#section" id="toc-section"></a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="setting-the-stage.html"><a href="setting-the-stage.html"><i class="fa fa-check"></i>Setting the stage</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-does-your-theory-say-about-your-data"><i class="fa fa-check"></i><b>1.1</b> What does your theory say about your data?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#what-do-your-data-say-about-your-theory"><i class="fa fa-check"></i><b>1.2</b> What do your data say about your theory?</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-do-your-parameters-say-about-other-things"><i class="fa fa-check"></i><b>1.3</b> What do your parameters say about other things?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#what-does-your-expertise-say-about-your-parameters"><i class="fa fa-check"></i><b>1.4</b> What does your expertise say about your parameters?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html"><i class="fa fa-check"></i><b>2</b> Getting started in <em>Stan</em></a>
<ul>
<li class="chapter" data-level="2.1" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#installation-in-r"><i class="fa fa-check"></i><b>2.1</b> Installation in <em>R</em></a></li>
<li class="chapter" data-level="2.2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#the-anatomy-of-a-stan-program"><i class="fa fa-check"></i><b>2.2</b> The anatomy of a <em>Stan</em> program</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#data-block"><i class="fa fa-check"></i><b>2.2.1</b> Data block</a></li>
<li class="chapter" data-level="2.2.2" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#transformed-data-block"><i class="fa fa-check"></i><b>2.2.2</b> Transformed data block</a></li>
<li class="chapter" data-level="2.2.3" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#parameters-block"><i class="fa fa-check"></i><b>2.2.3</b> Parameters block</a></li>
<li class="chapter" data-level="2.2.4" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#model-block"><i class="fa fa-check"></i><b>2.2.4</b> Model block</a></li>
<li class="chapter" data-level="2.2.5" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#generated-quantities-block"><i class="fa fa-check"></i><b>2.2.5</b> Generated quantities block</a></li>
<li class="chapter" data-level="2.2.6" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#the-final-product"><i class="fa fa-check"></i><b>2.2.6</b> The final product</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#estimating-a-model"><i class="fa fa-check"></i><b>2.3</b> Estimating a model</a></li>
<li class="chapter" data-level="2.4" data-path="getting-started-in-stan.html"><a href="getting-started-in-stan.html#looking-at-the-results"><i class="fa fa-check"></i><b>2.4</b> Looking at the results</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html"><i class="fa fa-check"></i><b>3</b> Probabilistic models of behavior</a>
<ul>
<li class="chapter" data-level="3.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#the-problem-with-deterministic-models"><i class="fa fa-check"></i><b>3.1</b> The problem with deterministic models</a></li>
<li class="chapter" data-level="3.2" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#what-is-a-probabilistic-model"><i class="fa fa-check"></i><b>3.2</b> What <em>is</em> a probabilistic model?</a></li>
<li class="chapter" data-level="3.3" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#example-dataset-and-model"><i class="fa fa-check"></i><b>3.3</b> Example dataset and model</a></li>
<li class="chapter" data-level="3.4" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#optimal-choice-plus-an-error"><i class="fa fa-check"></i><b>3.4</b> Optimal choice plus an error</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#estimating-a-model-1"><i class="fa fa-check"></i><b>3.4.1</b> Estimating a model</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#utility-based-models"><i class="fa fa-check"></i><b>3.5</b> Utility-based models</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#estimating-a-model-2"><i class="fa fa-check"></i><b>3.5.1</b> Estimating a model</a></li>
<li class="chapter" data-level="3.5.2" data-path="probabilistic-models-of-behavior.html"><a href="probabilistic-models-of-behavior.html#doing-something-with-the-estimates"><i class="fa fa-check"></i><b>3.5.2</b> Doing something with the estimates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html"><i class="fa fa-check"></i><b>4</b> Considerations for choosing a prior</a>
<ul>
<li class="chapter" data-level="4.1" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#example-model-and-experiment"><i class="fa fa-check"></i><b>4.1</b> Example model and experiment</a></li>
<li class="chapter" data-level="4.2" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#getting-the-support-right"><i class="fa fa-check"></i><b>4.2</b> Getting the support right</a></li>
<li class="chapter" data-level="4.3" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#eliciting-reasonable-priors"><i class="fa fa-check"></i><b>4.3</b> Eliciting reasonable priors</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#parameter-values-and-the-prior-pushforward-check"><i class="fa fa-check"></i><b>4.3.1</b> Parameter values and the prior pushforward check</a></li>
<li class="chapter" data-level="4.3.2" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#predictions-and-other-derived-quantities-the-prior-predictive-check"><i class="fa fa-check"></i><b>4.3.2</b> Predictions and other derived quantities: The prior predictive check</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#assessing-the-sampling-performance-of-a-prior"><i class="fa fa-check"></i><b>4.4</b> Assessing the sampling performance of a prior</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#does-our-model-recover-its-parameters-well"><i class="fa fa-check"></i><b>4.4.1</b> Does our model recover its parameters well?</a></li>
<li class="chapter" data-level="4.4.2" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#do-we-see-any-pathologies-in-the-estimation-process"><i class="fa fa-check"></i><b>4.4.2</b> Do we see any pathologies in the estimation process?</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="considerations-for-choosing-a-prior.html"><a href="considerations-for-choosing-a-prior.html#r-code-used-for-this-chapter"><i class="fa fa-check"></i><b>4.5</b> <em>R</em> code used for this chapter</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="building-blocks.html"><a href="building-blocks.html"><i class="fa fa-check"></i>Building blocks</a></li>
<li class="chapter" data-level="5" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html"><i class="fa fa-check"></i><b>5</b> Representative agent and participant-specific models</a>
<ul>
<li class="chapter" data-level="5.1" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#participant-specific-models"><i class="fa fa-check"></i><b>5.1</b> Participant-specific models</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#example-data-and-economic-model"><i class="fa fa-check"></i><b>5.1.1</b> Example data and economic model</a></li>
<li class="chapter" data-level="5.1.2" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#going-to-the-probabilistic-model"><i class="fa fa-check"></i><b>5.1.2</b> Going to the probabilistic model</a></li>
<li class="chapter" data-level="5.1.3" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#a-short-side-quest-into-canned-estimation-techniques"><i class="fa fa-check"></i><b>5.1.3</b> A short side quest into canned estimation techniques</a></li>
<li class="chapter" data-level="5.1.4" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#assigning-priors"><i class="fa fa-check"></i><b>5.1.4</b> Assigning priors</a></li>
<li class="chapter" data-level="5.1.5" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#estimating-the-model-for-one-participant"><i class="fa fa-check"></i><b>5.1.5</b> Estimating the model for one participant</a></li>
<li class="chapter" data-level="5.1.6" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#estimating-the-model-for-all-participants"><i class="fa fa-check"></i><b>5.1.6</b> Estimating the model for all participants</a></li>
<li class="chapter" data-level="5.1.7" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#but-we-could-be-learning-more"><i class="fa fa-check"></i><b>5.1.7</b> But we could be learning more!</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="representative-agent-and-participant-specific-models.html"><a href="representative-agent-and-participant-specific-models.html#actual-representative-agent-models-pooled-models"><i class="fa fa-check"></i><b>5.2</b> Actual representative agent models (pooled models)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="hierarchical-models.html"><a href="hierarchical-models.html"><i class="fa fa-check"></i><b>6</b> Hierarchical models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-random-sample-of-participants-walks-into-your-lab"><i class="fa fa-check"></i><b>6.1</b> A random sample of participants walks into your lab</a></li>
<li class="chapter" data-level="6.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#the-anatomy-of-a-basic-hierarchical-model"><i class="fa fa-check"></i><b>6.2</b> The anatomy of a basic hierarchical model</a></li>
<li class="chapter" data-level="6.3" data-path="hierarchical-models.html"><a href="hierarchical-models.html#accounting-for-unobserved-heterogeneity"><i class="fa fa-check"></i><b>6.3</b> Accounting for unobserved heterogeneity</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#the-last-time-you-will-integrate-the-likelihood-probably"><i class="fa fa-check"></i><b>6.3.1</b> The last time you will integrate the likelihood, probably</a></li>
<li class="chapter" data-level="6.3.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#data-augmentation"><i class="fa fa-check"></i><b>6.3.2</b> Data augmentation</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="hierarchical-models.html"><a href="hierarchical-models.html#a-multivariate-normal-hierarchical-model"><i class="fa fa-check"></i><b>6.4</b> A multivariate normal hierarchical model</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#decomposing-the-variance-covariance-matrix"><i class="fa fa-check"></i><b>6.4.1</b> Decomposing the variance-covariance matrix</a></li>
<li class="chapter" data-level="6.4.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#transformed-parameters-and-normal-distributions"><i class="fa fa-check"></i><b>6.4.2</b> Transformed parameters and normal distributions</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="hierarchical-models.html"><a href="hierarchical-models.html#example-again-with-bfs2019"><i class="fa fa-check"></i><b>6.5</b> Example: again with <span class="citation">Bruhin, Fehr, and Schunk (2019)</span></a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="hierarchical-models.html"><a href="hierarchical-models.html#no-correlation-between-individual-level-parameters"><i class="fa fa-check"></i><b>6.5.1</b> No correlation between individual-level parameters</a></li>
<li class="chapter" data-level="6.5.2" data-path="hierarchical-models.html"><a href="hierarchical-models.html#correlation-between-individual-level-parameters"><i class="fa fa-check"></i><b>6.5.2</b> Correlation between individual-level parameters</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="mixture-models.html"><a href="mixture-models.html"><i class="fa fa-check"></i><b>7</b> Mixture models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="mixture-models.html"><a href="mixture-models.html#a-menu-of-models"><i class="fa fa-check"></i><b>7.1</b> A menu of models</a></li>
<li class="chapter" data-level="7.2" data-path="mixture-models.html"><a href="mixture-models.html#dichotomous-and-toolbox-mixture-models"><i class="fa fa-check"></i><b>7.2</b> Dichotomous and toolbox mixture models</a></li>
<li class="chapter" data-level="7.3" data-path="mixture-models.html"><a href="mixture-models.html#coding-peculearities"><i class="fa fa-check"></i><b>7.3</b> Coding peculearities</a></li>
<li class="chapter" data-level="7.4" data-path="mixture-models.html"><a href="mixture-models.html#example-experiment-av2001"><i class="fa fa-check"></i><b>7.4</b> Example experiment: <span class="citation">Andreoni and Vesterlund (2001)</span></a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="mixture-models.html"><a href="mixture-models.html#as-basic-as-it-gets"><i class="fa fa-check"></i><b>7.4.1</b> As basic as it gets</a></li>
<li class="chapter" data-level="7.4.2" data-path="mixture-models.html"><a href="mixture-models.html#adding-some-heterogeneity"><i class="fa fa-check"></i><b>7.4.2</b> Adding some heterogeneity</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="mixture-models.html"><a href="mixture-models.html#some-code-used-to-estimate-the-models"><i class="fa fa-check"></i><b>7.5</b> Some code used to estimate the models</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html"><i class="fa fa-check"></i><b>8</b> Filling in the blanks: Imputation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#example-model-and-dataset-yet-again-with-bfs2019"><i class="fa fa-check"></i><b>8.1</b> Example model and dataset: yet again with <span class="citation">Bruhin, Fehr, and Schunk (2019)</span></a></li>
<li class="chapter" data-level="8.2" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#how-is-this-going-to-work"><i class="fa fa-check"></i><b>8.2</b> How is this going to work?</a></li>
<li class="chapter" data-level="8.3" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#implementation"><i class="fa fa-check"></i><b>8.3</b> Implementation</a></li>
<li class="chapter" data-level="8.4" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#results"><i class="fa fa-check"></i><b>8.4</b> Results</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#using-the-correlation-matrix"><i class="fa fa-check"></i><b>8.4.1</b> Using the correlation matrix</a></li>
<li class="chapter" data-level="8.4.2" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#the-correlation-matrix-is-doing-a-lot-of-heavy-lifting-here"><i class="fa fa-check"></i><b>8.4.2</b> The correlation matrix is doing a lot of heavy lifting here</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#conclusion"><i class="fa fa-check"></i><b>8.5</b> Conclusion</a></li>
<li class="chapter" data-level="8.6" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#r-code-used-for-this-chapter-1"><i class="fa fa-check"></i><b>8.6</b> <em>R</em> code used for this chapter</a></li>
<li class="chapter" data-level="" data-path="filling-in-the-blanks-imputation.html"><a href="filling-in-the-blanks-imputation.html#acknowedgements"><i class="fa fa-check"></i>Acknowedgements</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="more-filling-in-the-blanks-data-augmentation.html"><a href="more-filling-in-the-blanks-data-augmentation.html"><i class="fa fa-check"></i><b>9</b> More filling in the blanks: data augmentation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="more-filling-in-the-blanks-data-augmentation.html"><a href="more-filling-in-the-blanks-data-augmentation.html#example-1-two-ways-to-estimate-a-probit-model"><i class="fa fa-check"></i><b>9.1</b> Example 1: two ways to estimate a probit model</a></li>
<li class="chapter" data-level="9.2" data-path="more-filling-in-the-blanks-data-augmentation.html"><a href="more-filling-in-the-blanks-data-augmentation.html#example-2-accounting-for-rounded-answers"><i class="fa fa-check"></i><b>9.2</b> Example 2: accounting for rounded answers</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="more-filling-in-the-blanks-data-augmentation.html"><a href="more-filling-in-the-blanks-data-augmentation.html#the-hs2016-task"><i class="fa fa-check"></i><b>9.2.1</b> The <span class="citation">Holt and Smith (2016)</span> task</a></li>
<li class="chapter" data-level="9.2.2" data-path="more-filling-in-the-blanks-data-augmentation.html"><a href="more-filling-in-the-blanks-data-augmentation.html#a-model-for-behavior-in-hs2016"><i class="fa fa-check"></i><b>9.2.2</b> A model for behavior in <span class="citation">Holt and Smith (2016)</span></a></li>
<li class="chapter" data-level="9.2.3" data-path="more-filling-in-the-blanks-data-augmentation.html"><a href="more-filling-in-the-blanks-data-augmentation.html#a-note-on-replication"><i class="fa fa-check"></i><b>9.2.3</b> A note on replication</a></li>
<li class="chapter" data-level="9.2.4" data-path="more-filling-in-the-blanks-data-augmentation.html"><a href="more-filling-in-the-blanks-data-augmentation.html#augmenting-the-data"><i class="fa fa-check"></i><b>9.2.4</b> Augmenting the data</a></li>
<li class="chapter" data-level="9.2.5" data-path="more-filling-in-the-blanks-data-augmentation.html"><a href="more-filling-in-the-blanks-data-augmentation.html#results-1"><i class="fa fa-check"></i><b>9.2.5</b> Results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><i class="fa fa-check"></i><b>10</b> Using your structural estimates as explanatory variables in regression models</a>
<ul>
<li class="chapter" data-level="10.1" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#example-1-a-probit-model-with-risk-preferences-measured-by-holt2002."><i class="fa fa-check"></i><b>10.1</b> Example 1: a probit model with risk preferences measured by <span class="citation">Holt and Laury (2002)</span>.</a></li>
<li class="chapter" data-level="10.2" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#example-2-a-random-effects-logit-model-with-risk-and-time-preferences."><i class="fa fa-check"></i><b>10.2</b> Example 2: A random effects logit model with risk and time preferences.</a></li>
<li class="chapter" data-level="10.3" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#example-3-logit-and-ordered-logit-with-risk-preferences-from-gneezy1997"><i class="fa fa-check"></i><b>10.3</b> Example 3: Logit and ordered logit with risk preferences from <span class="citation">Gneezy and Potters (1997)</span></a></li>
<li class="chapter" data-level="10.4" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#a-note-of-caution"><i class="fa fa-check"></i><b>10.4</b> A note of caution</a></li>
<li class="chapter" data-level="10.5" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#conclusion-1"><i class="fa fa-check"></i><b>10.5</b> Conclusion</a></li>
<li class="chapter" data-level="10.6" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#r-code-used-for-this-chapter-2"><i class="fa fa-check"></i><b>10.6</b> <em>R</em> code used for this chapter</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#example-1"><i class="fa fa-check"></i><b>10.6.1</b> Example 1</a></li>
<li class="chapter" data-level="10.6.2" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#example-2"><i class="fa fa-check"></i><b>10.6.2</b> Example 2</a></li>
<li class="chapter" data-level="10.6.3" data-path="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html"><a href="using-your-structural-estimates-as-explanatory-variables-in-regression-models.html#example-3"><i class="fa fa-check"></i><b>10.6.3</b> Example 3</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="model-evaluation.html"><a href="model-evaluation.html"><i class="fa fa-check"></i><b>11</b> Model evaluation</a>
<ul>
<li class="chapter" data-level="11.1" data-path="model-evaluation.html"><a href="model-evaluation.html#example-dataset-and-models"><i class="fa fa-check"></i><b>11.1</b> Example dataset and models</a></li>
<li class="chapter" data-level="11.2" data-path="model-evaluation.html"><a href="model-evaluation.html#model-posterior-probabilities"><i class="fa fa-check"></i><b>11.2</b> Model posterior probabilities</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="model-evaluation.html"><a href="model-evaluation.html#implementation-using-bridge-sampling-and-the-bridgesampling-library"><i class="fa fa-check"></i><b>11.2.1</b> Implementation using bridge sampling and the <code>bridgesampling</code> library</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="model-evaluation.html"><a href="model-evaluation.html#cross-validation"><i class="fa fa-check"></i><b>11.3</b> Cross-validation</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="model-evaluation.html"><a href="model-evaluation.html#expected-log-predicted-density-elpd-and-other-measures-of-goodness-of-fit"><i class="fa fa-check"></i><b>11.3.1</b> Expected Log Predicted Density (ELPD) and other measures of goodness of fit</a></li>
<li class="chapter" data-level="11.3.2" data-path="model-evaluation.html"><a href="model-evaluation.html#round-cross-validation"><i class="fa fa-check"></i><b>11.3.2</b> 1-round cross-validation</a></li>
<li class="chapter" data-level="11.3.3" data-path="model-evaluation.html"><a href="model-evaluation.html#leave-one-out-cross-validation-loo"><i class="fa fa-check"></i><b>11.3.3</b> Leave-one-out cross-validation (LOO)</a></li>
<li class="chapter" data-level="11.3.4" data-path="model-evaluation.html"><a href="model-evaluation.html#approximate-loo"><i class="fa fa-check"></i><b>11.3.4</b> Approximate LOO</a></li>
<li class="chapter" data-level="11.3.5" data-path="model-evaluation.html"><a href="model-evaluation.html#k-fold-cross-validation"><i class="fa fa-check"></i><b>11.3.5</b> <span class="math inline">\(k\)</span>-fold cross-validation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html"><i class="fa fa-check"></i><b>12</b> Speeding up your <em>Stan</em> code</a>
<ul>
<li class="chapter" data-level="12.1" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#example-dataset-and-model-1"><i class="fa fa-check"></i><b>12.1</b> Example dataset and model</a></li>
<li class="chapter" data-level="12.2" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#a-really-slow-way-to-estimate-the-model"><i class="fa fa-check"></i><b>12.2</b> A really slow way to estimate the model</a></li>
<li class="chapter" data-level="12.3" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#pre-computing-things"><i class="fa fa-check"></i><b>12.3</b> Pre-computing things</a></li>
<li class="chapter" data-level="12.4" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#vectorization"><i class="fa fa-check"></i><b>12.4</b> Vectorization</a></li>
<li class="chapter" data-level="12.5" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#within-chain-parallelization-with-reduce_sum"><i class="fa fa-check"></i><b>12.5</b> Within-chain parallelization with <code>reduce_sum()</code></a></li>
<li class="chapter" data-level="12.6" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#evaluating-the-implementations"><i class="fa fa-check"></i><b>12.6</b> Evaluating the implementations</a>
<ul>
<li class="chapter" data-level="12.6.1" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#pre-computing-and-vectorization"><i class="fa fa-check"></i><b>12.6.1</b> Pre-computing and vectorization</a></li>
<li class="chapter" data-level="12.6.2" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#within-chain-parallelization"><i class="fa fa-check"></i><b>12.6.2</b> Within-chain parallelization</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#r-code-to-estimate-models"><i class="fa fa-check"></i><b>12.7</b> <em>R</em> code to estimate models</a>
<ul>
<li class="chapter" data-level="12.7.1" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#slow-pre-computed-and-vectorized-models"><i class="fa fa-check"></i><b>12.7.1</b> Slow, pre-computed, and vectorized models</a></li>
<li class="chapter" data-level="12.7.2" data-path="speeding-up-your-stan-code.html"><a href="speeding-up-your-stan-code.html#parallelized-model"><i class="fa fa-check"></i><b>12.7.2</b> Parallelized model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i>Applications</a></li>
<li class="chapter" data-level="13" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html"><i class="fa fa-check"></i><b>13</b> Application: Experience-Weighted Attraction</a>
<ul>
<li class="chapter" data-level="13.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-model-at-the-individual-level"><i class="fa fa-check"></i><b>13.1</b> The model at the individual level</a></li>
<li class="chapter" data-level="13.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#some-computational-and-coding-issues"><i class="fa fa-check"></i><b>13.2</b> Some computational and coding issues</a></li>
<li class="chapter" data-level="13.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#representative-agent-models"><i class="fa fa-check"></i><b>13.3</b> Representative agent models</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#prior-calibration"><i class="fa fa-check"></i><b>13.3.1</b> Prior calibration</a></li>
<li class="chapter" data-level="13.3.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-stan-model"><i class="fa fa-check"></i><b>13.3.2</b> The <em>Stan</em> model</a></li>
<li class="chapter" data-level="13.3.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#results-2"><i class="fa fa-check"></i><b>13.3.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#hierarchical-model"><i class="fa fa-check"></i><b>13.4</b> Hierarchical model</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#prior-calibration-1"><i class="fa fa-check"></i><b>13.4.1</b> Prior calibration</a></li>
<li class="chapter" data-level="13.4.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#the-stan-model-1"><i class="fa fa-check"></i><b>13.4.2</b> The <em>Stan</em> model</a></li>
<li class="chapter" data-level="13.4.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#results-3"><i class="fa fa-check"></i><b>13.4.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#some-code-used-to-estimate-the-models-1"><i class="fa fa-check"></i><b>13.5</b> Some code used to estimate the models</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#loading-the-data"><i class="fa fa-check"></i><b>13.5.1</b> Loading the data</a></li>
<li class="chapter" data-level="13.5.2" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#estimating-the-representative-agent-models"><i class="fa fa-check"></i><b>13.5.2</b> Estimating the representative agent models</a></li>
<li class="chapter" data-level="13.5.3" data-path="application-experience-weighted-attraction.html"><a href="application-experience-weighted-attraction.html#estimating-the-hierarchical-model"><i class="fa fa-check"></i><b>13.5.3</b> Estimating the hierarchical model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html"><i class="fa fa-check"></i><b>14</b> Application: Strategy Frequency Estimation</a>
<ul>
<li class="chapter" data-level="14.1" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#simplifying-the-individual-likelihood-functions"><i class="fa fa-check"></i><b>14.1</b> Simplifying the individual likelihood functions</a></li>
<li class="chapter" data-level="14.2" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#example-experiment-dbf2011"><i class="fa fa-check"></i><b>14.2</b> Example experiment: <span class="citation">Dal Bó and Fréchette (2011)</span></a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#the-sfem-with-homogeneous-trembles"><i class="fa fa-check"></i><b>14.2.1</b> The SFEM with homogeneous trembles</a></li>
<li class="chapter" data-level="14.2.2" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#adding-heterogeneous-trembles-and-integrating-the-likelihood"><i class="fa fa-check"></i><b>14.2.2</b> Adding heterogeneous trembles and integrating the likelihood</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="application-strategy-frequency-estimation.html"><a href="application-strategy-frequency-estimation.html#r-code-to-do-these-estimations"><i class="fa fa-check"></i><b>14.3</b> <em>R</em> code to do these estimations</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><i class="fa fa-check"></i><b>15</b> Application: Strategy frequency estimation with a mixed strategy</a>
<ul>
<li class="chapter" data-level="15.1" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#example-dataset-and-strategies"><i class="fa fa-check"></i><b>15.1</b> Example dataset and strategies</a></li>
<li class="chapter" data-level="15.2" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#the-likelihood-function"><i class="fa fa-check"></i><b>15.2</b> The likelihood function</a></li>
<li class="chapter" data-level="15.3" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#implementation-in-stan"><i class="fa fa-check"></i><b>15.3</b> Implementation in <em>Stan</em></a></li>
<li class="chapter" data-level="15.4" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#results-4"><i class="fa fa-check"></i><b>15.4</b> Results</a></li>
<li class="chapter" data-level="15.5" data-path="application-strategy-frequency-estimation-with-a-mixed-strategy.html"><a href="application-strategy-frequency-estimation-with-a-mixed-strategy.html#r-code-used-to-estimate-the-models"><i class="fa fa-check"></i><b>15.5</b> <em>R</em> code used to estimate the models</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html"><i class="fa fa-check"></i><b>16</b> Computing Quantal Response Equilibrium</a>
<ul>
<li class="chapter" data-level="16.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#overview-of-quantal-response-equilibrium"><i class="fa fa-check"></i><b>16.1</b> Overview of quantal response equilibrium</a></li>
<li class="chapter" data-level="16.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#computing-quantal-response-equilibrium-1"><i class="fa fa-check"></i><b>16.2</b> Computing Quantal Response Equilibrium</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#setting-up-the-problem"><i class="fa fa-check"></i><b>16.2.1</b> Setting up the problem</a></li>
<li class="chapter" data-level="16.2.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#a-predictor-corrector-algorithm"><i class="fa fa-check"></i><b>16.2.2</b> A predictor-corrector algorithm</a></li>
<li class="chapter" data-level="16.2.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#initial-conditions"><i class="fa fa-check"></i><b>16.2.3</b> Initial conditions</a></li>
<li class="chapter" data-level="16.2.4" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#algorithm-tuning"><i class="fa fa-check"></i><b>16.2.4</b> Algorithm tuning</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#the-predictor-corrector-algorithm-in-r"><i class="fa fa-check"></i><b>16.3</b> The predictor-corrector algorithm in <em>R</em></a></li>
<li class="chapter" data-level="16.4" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#some-example-games"><i class="fa fa-check"></i><b>16.4</b> Some example games</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#generalized-matching-pennies-ochs1995"><i class="fa fa-check"></i><b>16.4.1</b> Generalized matching pennies <span class="citation">(Ochs 1995)</span></a></li>
<li class="chapter" data-level="16.4.2" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#stag-hunt"><i class="fa fa-check"></i><b>16.4.2</b> Stag hunt</a></li>
<li class="chapter" data-level="16.4.3" data-path="computing-quantal-response-equilibrium.html"><a href="computing-quantal-response-equilibrium.html#n-player-volunteers-dilemma-imposing-symmetric-strategies"><i class="fa fa-check"></i><b>16.4.3</b> <span class="math inline">\(n\)</span>-player Volunteer’s Dilemma imposing symmetric strategies</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><i class="fa fa-check"></i><b>17</b> Application: Quantal Response Equilibrium and the Volunteer’s Dilemma <span class="citation">(Goeree, Holt, and Smith 2017)</span></a>
<ul>
<li class="chapter" data-level="17.1" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#solving-logit-qre-and-estimating-the-model"><i class="fa fa-check"></i><b>17.1</b> Solving logit QRE and estimating the model</a></li>
<li class="chapter" data-level="17.2" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#adding-some-heterogeneity-1"><i class="fa fa-check"></i><b>17.2</b> Adding some heterogeneity</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#computing-quantal-response-equilibrium-with-heterogeneous-parameters"><i class="fa fa-check"></i><b>17.2.1</b> Computing quantal response equilibrium with heterogeneous parameters</a></li>
<li class="chapter" data-level="17.2.2" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#warm-glow-volunteering"><i class="fa fa-check"></i><b>17.2.2</b> Warm glow volunteering</a></li>
<li class="chapter" data-level="17.2.3" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#duplicate-aversion"><i class="fa fa-check"></i><b>17.2.3</b> Duplicate aversion</a></li>
<li class="chapter" data-level="17.2.4" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#results-5"><i class="fa fa-check"></i><b>17.2.4</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html"><a href="application-quantal-response-equilibrium-and-the-volunteers-dilemma-goeree2017.html#r-code-to-run-estimations"><i class="fa fa-check"></i><b>17.3</b> <em>R</em> code to run estimations</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html"><i class="fa fa-check"></i><b>18</b> Application: A Quantal Response Equilibrium with discrete types</a>
<ul>
<li class="chapter" data-level="18.1" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#example-dataset-and-models-1"><i class="fa fa-check"></i><b>18.1</b> Example dataset and models</a></li>
<li class="chapter" data-level="18.2" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#a-note-on-replication-1"><i class="fa fa-check"></i><b>18.2</b> A note on replication</a></li>
<li class="chapter" data-level="18.3" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#three-models-that-make-different-assumptions-about-bracketing"><i class="fa fa-check"></i><b>18.3</b> Three models that make different assumptions about bracketing</a>
<ul>
<li class="chapter" data-level="18.3.1" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#broad-bracketing-only"><i class="fa fa-check"></i><b>18.3.1</b> Broad bracketing only</a></li>
<li class="chapter" data-level="18.3.2" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#narrow-bracketing-only"><i class="fa fa-check"></i><b>18.3.2</b> Narrow bracketing only</a></li>
<li class="chapter" data-level="18.3.3" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#a-mixture-of-broad-and-narrow-bracketing"><i class="fa fa-check"></i><b>18.3.3</b> A mixture of broad and narrow bracketing</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#results-6"><i class="fa fa-check"></i><b>18.4</b> Results</a></li>
<li class="chapter" data-level="18.5" data-path="application-a-quantal-response-equilibrium-with-discrete-types.html"><a href="application-a-quantal-response-equilibrium-with-discrete-types.html#r-code-used-to-estimate-these-models"><i class="fa fa-check"></i><b>18.5</b> <em>R</em> code used to estimate these models</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><i class="fa fa-check"></i><b>19</b> Application: QRE in a Bayesian game and cursed equilibrium</a>
<ul>
<li class="chapter" data-level="19.1" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#example-game-and-dataset"><i class="fa fa-check"></i><b>19.1</b> Example game and dataset</a></li>
<li class="chapter" data-level="19.2" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#solving-for-qre"><i class="fa fa-check"></i><b>19.2</b> Solving for QRE</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#baseline-model"><i class="fa fa-check"></i><b>19.2.1</b> Baseline model</a></li>
<li class="chapter" data-level="19.2.2" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#cursed-equilibrium"><i class="fa fa-check"></i><b>19.2.2</b> Cursed equilibrium</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#a-quick-prior-calibration-1"><i class="fa fa-check"></i><b>19.3</b> A quick prior calibration</a></li>
<li class="chapter" data-level="19.4" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#model-results"><i class="fa fa-check"></i><b>19.4</b> Model results</a></li>
<li class="chapter" data-level="19.5" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#model-evaluation-1"><i class="fa fa-check"></i><b>19.5</b> Model evaluation</a></li>
<li class="chapter" data-level="19.6" data-path="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html"><a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html#r-code-used-in-this-chapter"><i class="fa fa-check"></i><b>19.6</b> <em>R</em> code used in this chapter</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="application-level-k-models.html"><a href="application-level-k-models.html"><i class="fa fa-check"></i><b>20</b> Application: Level-<span class="math inline">\(k\)</span> models</a>
<ul>
<li class="chapter" data-level="20.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#data-and-game"><i class="fa fa-check"></i><b>20.1</b> Data and game</a></li>
<li class="chapter" data-level="20.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-level-k-model"><i class="fa fa-check"></i><b>20.2</b> The level-<span class="math inline">\(k\)</span> model</a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-deterministic-component-of-the-model"><i class="fa fa-check"></i><b>20.2.1</b> The deterministic component of the model</a></li>
<li class="chapter" data-level="20.2.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#exact-and-probabilistic-play"><i class="fa fa-check"></i><b>20.2.2</b> Exact and probabilistic play</a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#assigning-probabilities-to-types-for-each-participant-separately"><i class="fa fa-check"></i><b>20.3</b> Assigning probabilities to types for each participant separately</a>
<ul>
<li class="chapter" data-level="20.3.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-stan-program"><i class="fa fa-check"></i><b>20.3.1</b> The <em>Stan</em> program</a></li>
<li class="chapter" data-level="20.3.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#prior-calibration-2"><i class="fa fa-check"></i><b>20.3.2</b> Prior calibration</a></li>
<li class="chapter" data-level="20.3.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-7"><i class="fa fa-check"></i><b>20.3.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="application-level-k-models.html"><a href="application-level-k-models.html#doing-the-averaging-within-one-program"><i class="fa fa-check"></i><b>20.4</b> Doing the averaging within one program</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#the-stan-program-1"><i class="fa fa-check"></i><b>20.4.1</b> The <em>Stan</em> program</a></li>
<li class="chapter" data-level="20.4.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-8"><i class="fa fa-check"></i><b>20.4.2</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-mixture-model"><i class="fa fa-check"></i><b>20.5</b> A mixture model</a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#stan-program"><i class="fa fa-check"></i><b>20.5.1</b> <em>Stan</em> program</a></li>
<li class="chapter" data-level="20.5.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-prior-for-psi"><i class="fa fa-check"></i><b>20.5.2</b> A prior for <span class="math inline">\(\psi\)</span></a></li>
<li class="chapter" data-level="20.5.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-9"><i class="fa fa-check"></i><b>20.5.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-mixture-over-levels-and-hierarchical-nuisance-parameters"><i class="fa fa-check"></i><b>20.6</b> A mixture over levels and hierarchical nuisance parameters</a>
<ul>
<li class="chapter" data-level="20.6.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#prior-calibration-3"><i class="fa fa-check"></i><b>20.6.1</b> Prior calibration</a></li>
<li class="chapter" data-level="20.6.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#stan-program-1"><i class="fa fa-check"></i><b>20.6.2</b> <em>Stan</em> program</a></li>
<li class="chapter" data-level="20.6.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-10"><i class="fa fa-check"></i><b>20.6.3</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="20.7" data-path="application-level-k-models.html"><a href="application-level-k-models.html#a-different-assumption-about-mixing"><i class="fa fa-check"></i><b>20.7</b> A different assumption about mixing</a>
<ul>
<li class="chapter" data-level="20.7.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#stan-program-2"><i class="fa fa-check"></i><b>20.7.1</b> <em>Stan</em> program</a></li>
<li class="chapter" data-level="20.7.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#results-11"><i class="fa fa-check"></i><b>20.7.2</b> Results</a></li>
</ul></li>
<li class="chapter" data-level="20.8" data-path="application-level-k-models.html"><a href="application-level-k-models.html#r-code-to-estimate-the-models"><i class="fa fa-check"></i><b>20.8</b> <em>R</em> code to estimate the models</a>
<ul>
<li class="chapter" data-level="20.8.1" data-path="application-level-k-models.html"><a href="application-level-k-models.html#participant-specific-estimation-conditional-on-k-with-bayesian-model-averaging"><i class="fa fa-check"></i><b>20.8.1</b> Participant-specific estimation conditional on <span class="math inline">\(k\)</span> with Bayesian model averaging</a></li>
<li class="chapter" data-level="20.8.2" data-path="application-level-k-models.html"><a href="application-level-k-models.html#participant-specific-estimation-with-a-prior-over-k"><i class="fa fa-check"></i><b>20.8.2</b> Participant-specific estimation with a prior over <span class="math inline">\(k\)</span></a></li>
<li class="chapter" data-level="20.8.3" data-path="application-level-k-models.html"><a href="application-level-k-models.html#mixture-model"><i class="fa fa-check"></i><b>20.8.3</b> Mixture model</a></li>
<li class="chapter" data-level="20.8.4" data-path="application-level-k-models.html"><a href="application-level-k-models.html#hierarchical-model-1"><i class="fa fa-check"></i><b>20.8.4</b> Hierarchical model</a></li>
<li class="chapter" data-level="20.8.5" data-path="application-level-k-models.html"><a href="application-level-k-models.html#mixture-model-with-beliefs-consistent-with-truncated-type-distribution"><i class="fa fa-check"></i><b>20.8.5</b> Mixture model with beliefs consistent with truncated type distribution</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html"><i class="fa fa-check"></i><b>21</b> Application: Estimating risk preferences</a>
<ul>
<li class="chapter" data-level="21.1" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#example-dataset"><i class="fa fa-check"></i><b>21.1</b> Example dataset</a></li>
<li class="chapter" data-level="21.2" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#we-might-not-just-be-interested-in-the-parameters"><i class="fa fa-check"></i><b>21.2</b> We might not just be interested in the parameters</a></li>
<li class="chapter" data-level="21.3" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#introducing-some-important-models"><i class="fa fa-check"></i><b>21.3</b> Introducing some important models</a>
<ul>
<li class="chapter" data-level="21.3.1" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#expected-utility-theory"><i class="fa fa-check"></i><b>21.3.1</b> Expected utility theory</a></li>
<li class="chapter" data-level="21.3.2" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#rank-dependent-utility-quiggin1982"><i class="fa fa-check"></i><b>21.3.2</b> Rank-dependent utility <span class="citation">(Quiggin 1982)</span></a></li>
<li class="chapter" data-level="21.3.3" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#comparing-the-certainty-equivalents-estimated-using-eut-and-rdu"><i class="fa fa-check"></i><b>21.3.3</b> Comparing the certainty equivalents estimated using EUT and RDU</a></li>
</ul></li>
<li class="chapter" data-level="21.4" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#a-hierarchical-specification"><i class="fa fa-check"></i><b>21.4</b> A hierarchical specification</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#population-level-estimates"><i class="fa fa-check"></i><b>21.4.1</b> Population-level estimates</a></li>
<li class="chapter" data-level="21.4.2" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#participant-level-estimates"><i class="fa fa-check"></i><b>21.4.2</b> Participant-level estimates</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="application-estimating-risk-preferences.html"><a href="application-estimating-risk-preferences.html#r-code-used-to-estimate-these-models-1"><i class="fa fa-check"></i><b>21.5</b> <em>R</em> code used to estimate these models</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html"><i class="fa fa-check"></i><b>22</b> Application: Meta-analysis using (some of) the METARET data</a>
<ul>
<li class="chapter" data-level="22.1" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#data"><i class="fa fa-check"></i><b>22.1</b> Data</a></li>
<li class="chapter" data-level="22.2" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#a-basic-model"><i class="fa fa-check"></i><b>22.2</b> A basic model</a></li>
<li class="chapter" data-level="22.3" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#but-the-data-are-really-interval-valued"><i class="fa fa-check"></i><b>22.3</b> But the data are really interval-valued!</a></li>
<li class="chapter" data-level="22.4" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#heterogeneous-standard-deviations"><i class="fa fa-check"></i><b>22.4</b> Heterogeneous standard deviations</a></li>
<li class="chapter" data-level="22.5" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#student-t-distributions-because-why-not"><i class="fa fa-check"></i><b>22.5</b> Student-<span class="math inline">\(t\)</span> distributions, because why not?</a></li>
<li class="chapter" data-level="22.6" data-path="application-meta-analysis-using-some-of-the-metaret-data.html"><a href="application-meta-analysis-using-some-of-the-metaret-data.html#r-code-to-estimate-the-models-1"><i class="fa fa-check"></i><b>22.6</b> <em>R</em> code to estimate the models</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html"><i class="fa fa-check"></i><b>23</b> Application: choice bracketing</a>
<ul>
<li class="chapter" data-level="23.1" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html#data-and-model"><i class="fa fa-check"></i><b>23.1</b> Data and model</a></li>
<li class="chapter" data-level="23.2" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html#representative-agent-and-individual-estimation"><i class="fa fa-check"></i><b>23.2</b> Representative agent and individual estimation</a></li>
<li class="chapter" data-level="23.3" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html#hierarchical-model-2"><i class="fa fa-check"></i><b>23.3</b> Hierarchical model</a></li>
<li class="chapter" data-level="23.4" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html#a-mixture-model-1"><i class="fa fa-check"></i><b>23.4</b> A mixture model</a></li>
<li class="chapter" data-level="23.5" data-path="application-choice-bracketing.html"><a href="application-choice-bracketing.html#what-do-we-get-out-of-the-structural-models-and-what-could-we-miss"><i class="fa fa-check"></i><b>23.5</b> What do we get out of the structural models, and what could we miss?</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html"><i class="fa fa-check"></i><b>24</b> Application: Ranked choices and the Thurstonian model</a>
<ul>
<li class="chapter" data-level="24.1" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#the-thurstonian-model"><i class="fa fa-check"></i><b>24.1</b> The Thurstonian model</a></li>
<li class="chapter" data-level="24.2" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#computational-issues"><i class="fa fa-check"></i><b>24.2</b> Computational issues</a></li>
<li class="chapter" data-level="24.3" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#example-dataset-and-model-2"><i class="fa fa-check"></i><b>24.3</b> Example dataset and model</a></li>
<li class="chapter" data-level="24.4" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#a-representative-agent-model"><i class="fa fa-check"></i><b>24.4</b> A representative agent model</a></li>
<li class="chapter" data-level="24.5" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#a-hierarchical-model"><i class="fa fa-check"></i><b>24.5</b> A hierarchical model</a></li>
<li class="chapter" data-level="24.6" data-path="application-ranked-choices-and-the-thurstonian-model.html"><a href="application-ranked-choices-and-the-thurstonian-model.html#r-code-used-to-run-this"><i class="fa fa-check"></i><b>24.6</b> <em>R</em> code used to run this</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="links-to-data.html"><a href="links-to-data.html"><i class="fa fa-check"></i>Links to data</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Structural Bayesian Techniques for Experimental and Behavioral Economics</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="application-level-k-models" class="section level1 hasAnchor" number="20">
<h1><span class="header-section-number">20</span> Application: Level-<span class="math inline">\(k\)</span> models<a href="application-level-k-models.html#application-level-k-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this chapter, I will show you a few ways of estimating a level-<span class="math inline">\(k\)</span> model <span class="citation">(<a href="#ref-Stahl1994">Stahl and Wilson 1994</a>)</span> using data from a guessing game <span class="citation">(<a href="#ref-CGC2006">Costa-Gomes and Crawford 2006</a>)</span>. The level-<span class="math inline">\(k\)</span> model is particularly useful for modeling initial play in games (or play without feedback) because it is a plausible way that participants might reason their way through their decision problem in order to choose an action.</p>
<p>Computationally, the model poses a slight problem for us because the parameter of interest, <span class="math inline">\(k\)</span>, is an integer, and <em>Stan</em> can’t cope with integer parameters. Fortunately, it is very easy (albeit somewhat slow) to estimate a model assuming a given value of <span class="math inline">\(k\)</span>. From here, we can build up a model-averaged <span class="math inline">\(k\)</span> that has a nice interpretation. But, perhaps more satisfyingly, this really lends itself to a finite mixture model, where we estimate the distribution of <span class="math inline">\(k\)</span> in the population. The final product also has a hierarchical specification for some nuisance parameters, which we don’t necessarily care about directly, but nevertheless have to be estimated alongside the quantities that we do care about.</p>
<div id="data-and-game" class="section level2 hasAnchor" number="20.1">
<h2><span class="header-section-number">20.1</span> Data and game<a href="application-level-k-models.html#data-and-game" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Participants in <span class="citation">Costa-Gomes and Crawford (<a href="#ref-CGC2006">2006</a>)</span> played sixteen 2-player guessing games without feedback. In each game, player <span class="math inline">\(i\in\{1,2\}\)</span> chose a number <span class="math inline">\(x^i\in[a^i,b^i]\)</span>.<a href="#fn88" class="footnote-ref" id="fnref88"><sup>88</sup></a> Their payoff functions rewarded choices that were closer to <span class="math inline">\(p^i\)</span> multiplied by their opponent’s choice. Specifically, their payoff function was:</p>
<p><span class="math display">\[
\pi^i(x^i,x^j)=\max\{0,200-|x^i-p^ix^j|\}+\max\{0,100-|x^i-p^ix^j|/10\}
\]</span></p>
<p>Note that this payoff function is single-peaked at <span class="math inline">\(x^i=p^ix^j\)</span>, where the player receives a payoff of 300.</p>
<p>When I got my hands on these data, one of the first things I noticed was that there was a <em>lot</em> of rounding of participants’ choices. Specifically, there were very few choices that were not multiples of 10. The best way for me to visualize this was to plot a histogram of the digit in the ones place of participants’ choices, which is shown in Figure <a href="application-level-k-models.html#fig:CGC2006rounding">20.1</a>:</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="application-level-k-models.html#cb243-1" tabindex="-1"></a>D<span class="ot">&lt;-</span><span class="st">&quot;Code/CGC2006/CGC2006cleaned.rds&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb243-2"><a href="application-level-k-models.html#cb243-2" tabindex="-1"></a>  <span class="fu">readRDS</span>() <span class="sc">|&gt;</span></span>
<span id="cb243-3"><a href="application-level-k-models.html#cb243-3" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb243-4"><a href="application-level-k-models.html#cb243-4" tabindex="-1"></a>    <span class="at">intchoice =</span> choice <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">0</span>),</span>
<span id="cb243-5"><a href="application-level-k-models.html#cb243-5" tabindex="-1"></a>    <span class="at">onesplace =</span> intchoice<span class="dv">-10</span><span class="sc">*</span><span class="fu">floor</span>(intchoice<span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb243-6"><a href="application-level-k-models.html#cb243-6" tabindex="-1"></a>  )</span>
<span id="cb243-7"><a href="application-level-k-models.html#cb243-7" tabindex="-1"></a></span>
<span id="cb243-8"><a href="application-level-k-models.html#cb243-8" tabindex="-1"></a>(</span>
<span id="cb243-9"><a href="application-level-k-models.html#cb243-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(D,<span class="fu">aes</span>(<span class="at">x=</span>onesplace))</span>
<span id="cb243-10"><a href="application-level-k-models.html#cb243-10" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">10</span>,<span class="at">binwidth=</span><span class="dv">1</span>)</span>
<span id="cb243-11"><a href="application-level-k-models.html#cb243-11" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb243-12"><a href="application-level-k-models.html#cb243-12" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb243-13"><a href="application-level-k-models.html#cb243-13" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;Digit in ones place of players&#39; choices&quot;</span>)</span>
<span id="cb243-14"><a href="application-level-k-models.html#cb243-14" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:CGC2006rounding"></span>
<img src="index_files/figure-html/CGC2006rounding-1.png" alt="Prevalence of rounding." width="672" />
<p class="caption">
Figure 20.1: Prevalence of rounding.
</p>
</div>
<p>This is plausible because participants in a typical game could choose between a few hundred numbers: restricting attention to just the multiples of ten probably cut out a lot of the cost of making a decision in this experiment. I therefore decided to deal exclusively with the rounded data. For example, for Game 1 player 1 has to choose a number between 100 and 500 that they think will be closest to 70% of their opponent’s choice (which must be between 100 and 900). I divide these bounds and participants’ choices by 10, round them to the nearest integer, and treat these as the data. Therefore the payoff function becomes:</p>
<p><span class="math display">\[
\pi^i(x^i,x^j)=\max\{0,200-10|x^i-p^ix^j|\}+\max\{0,100-|x^i-p^ix^j|\}
\]</span></p>
<p>which means that if Player 2 chooses <span class="math inline">\(x^2=50\)</span> (really <span class="math inline">\(x^2=500\)</span> before dealing with rounded numbers), Player 1’s payoff function looks like this:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="application-level-k-models.html#cb244-1" tabindex="-1"></a><span class="co"># payoff parameters for Player 1 in Game 1</span></span>
<span id="cb244-2"><a href="application-level-k-models.html#cb244-2" tabindex="-1"></a>p1<span class="ot">&lt;-</span><span class="fl">0.7</span></span>
<span id="cb244-3"><a href="application-level-k-models.html#cb244-3" tabindex="-1"></a>lb1<span class="ot">&lt;-</span><span class="dv">10</span></span>
<span id="cb244-4"><a href="application-level-k-models.html#cb244-4" tabindex="-1"></a>ub1<span class="ot">&lt;-</span><span class="dv">50</span></span>
<span id="cb244-5"><a href="application-level-k-models.html#cb244-5" tabindex="-1"></a></span>
<span id="cb244-6"><a href="application-level-k-models.html#cb244-6" tabindex="-1"></a><span class="co"># opponent&#39;s choice</span></span>
<span id="cb244-7"><a href="application-level-k-models.html#cb244-7" tabindex="-1"></a>x_other<span class="ot">&lt;-</span><span class="dv">50</span></span>
<span id="cb244-8"><a href="application-level-k-models.html#cb244-8" tabindex="-1"></a></span>
<span id="cb244-9"><a href="application-level-k-models.html#cb244-9" tabindex="-1"></a></span>
<span id="cb244-10"><a href="application-level-k-models.html#cb244-10" tabindex="-1"></a>d<span class="ot">&lt;-</span><span class="fu">tibble</span>(</span>
<span id="cb244-11"><a href="application-level-k-models.html#cb244-11" tabindex="-1"></a>  <span class="co"># choice set</span></span>
<span id="cb244-12"><a href="application-level-k-models.html#cb244-12" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(lb1,ub1,<span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb244-13"><a href="application-level-k-models.html#cb244-13" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb244-14"><a href="application-level-k-models.html#cb244-14" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb244-15"><a href="application-level-k-models.html#cb244-15" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb244-16"><a href="application-level-k-models.html#cb244-16" tabindex="-1"></a>    <span class="at">u =</span> <span class="fu">max</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">200</span><span class="sc">-</span><span class="fu">abs</span>(x<span class="sc">-</span>p1<span class="sc">*</span>x_other)<span class="sc">*</span><span class="dv">10</span>))<span class="sc">+</span><span class="fu">max</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span><span class="sc">-</span><span class="fu">abs</span>(x<span class="sc">-</span>p1<span class="sc">*</span>x_other)))</span>
<span id="cb244-17"><a href="application-level-k-models.html#cb244-17" tabindex="-1"></a>  )</span>
<span id="cb244-18"><a href="application-level-k-models.html#cb244-18" tabindex="-1"></a></span>
<span id="cb244-19"><a href="application-level-k-models.html#cb244-19" tabindex="-1"></a>(</span>
<span id="cb244-20"><a href="application-level-k-models.html#cb244-20" tabindex="-1"></a>  <span class="fu">ggplot</span>(d,<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>u))</span>
<span id="cb244-21"><a href="application-level-k-models.html#cb244-21" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_path</span>()</span>
<span id="cb244-22"><a href="application-level-k-models.html#cb244-22" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb244-23"><a href="application-level-k-models.html#cb244-23" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">300</span>))</span>
<span id="cb244-24"><a href="application-level-k-models.html#cb244-24" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:CGC2006payofffun"></span>
<img src="index_files/figure-html/CGC2006payofffun-1.png" alt="An example of a payoff function." width="672" />
<p class="caption">
Figure 20.2: An example of a payoff function.
</p>
</div>
</div>
<div id="the-level-k-model" class="section level2 hasAnchor" number="20.2">
<h2><span class="header-section-number">20.2</span> The level-<span class="math inline">\(k\)</span> model<a href="application-level-k-models.html#the-level-k-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="the-deterministic-component-of-the-model" class="section level3 hasAnchor" number="20.2.1">
<h3><span class="header-section-number">20.2.1</span> The deterministic component of the model<a href="application-level-k-models.html#the-deterministic-component-of-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The level-<span class="math inline">\(k\)</span> model <span class="citation">(<a href="#ref-Stahl1994">Stahl and Wilson 1994</a>)</span> is a model of introspection in games. The model assumes that there are (possibly infinite) player types (or “levels”) indexed by non-negative integers <span class="math inline">\(k=0,1,2,\ldots\)</span>. Tye level-0 type is usually assumed to randomize their action uniformly over their action space. The level-1 type best responds to the level-0 type, and so on, so that the level-<span class="math inline">\(k\)</span> type best responds to the level-<span class="math inline">\((k-1)\)</span> type.<a href="#fn89" class="footnote-ref" id="fnref89"><sup>89</sup></a></p>
<p>When we take a level-<span class="math inline">\(k\)</span> model to our data, we are usually interested in estimating <span class="math inline">\(k\)</span>. That is, we want to comment on the number of steps of strategic reasoning that our participants are using.<a href="#fn90" class="footnote-ref" id="fnref90"><sup>90</sup></a> Since <span class="math inline">\(k\)</span> can only take on integers, and <em>Stan</em> cannot deal with integer parameters, we need to be careful with how we set this up. I will walk you through a few ways of doing this. These will include Bayesian model averaging, where we estimate the model for every possible value of <span class="math inline">\(k\)</span> under consideration, and a mixture specification, where we estimate the fraction of participants who have each value of <span class="math inline">\(k\)</span>. Whichever way seems more appealing to you, we will have to assume that participants can only be one of a finite number of possible values of <span class="math inline">\(k\)</span>. In the Bayesian model averaging case, this is because we cannot estimate “infinity” models! In the mixture model case, this is because we cannot have “infinity” behavioral types in our model. Practically in these games, as <span class="math inline">\(k\)</span> gets large, the prediction approaches Nash equilibrium, and so at some point a <span class="math inline">\(k\)</span> will be “large enough” that behavior should not be too different for any <span class="math inline">\(k\)</span> larger than this. I will proceed with estimating everything assuming that <span class="math inline">\(k\leq 5\)</span>, but I have written my code so that this upper bound can be easily changed. If you’re playing along at home and your CPU has nothing better to do, all you need to do is change the <code>kmax</code> variable to something larger.</p>
</div>
<div id="exact-and-probabilistic-play" class="section level3 hasAnchor" number="20.2.2">
<h3><span class="header-section-number">20.2.2</span> Exact and probabilistic play<a href="application-level-k-models.html#exact-and-probabilistic-play" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The level-<span class="math inline">\(k\)</span> model (as I have described it above) makes deterministic predictions. This is going to be a problem for our Bayesian model, as we need to have <em>probabilistic</em> predictions in order to write down a likelihood function. In fact, <span class="citation">Costa-Gomes and Crawford (<a href="#ref-CGC2006">2006</a>)</span> note that a substantial fraction of their participants choose <em>exactly</em> according to one of their models under consideration, at least for a subset of the the games played. That is, it appears that some participants are behaving exactly according to the level-<span class="math inline">\(k\)</span> model, and we should therefore take a model to the data that respects this kind of behavior. The solution <span class="citation">Costa-Gomes and Crawford (<a href="#ref-CGC2006">2006</a>)</span> use, which I also adopt here, is to use a “spike logit” model, which assumes that players <em>best</em> respond to their belief aboth their opponent’s (possibly mixed) strategy with probability <span class="math inline">\(1-\epsilon\)</span>, and with probability <span class="math inline">\(\epsilon\)</span> they <em>logit</em> respond to this belief. For the games studied here, which have relatively large action spaces, this makes for a mostly smooth probabilistic best response, except for a large mass point on the optimal action.</p>
<p>So how do we code this into a likelihood function? Let’s parameterize the model as <span class="math inline">\(\rho=1-\epsilon\in(0,1)\)</span>, the probability that a participant chooses their optimal action, and <span class="math inline">\(\lambda&gt;0\)</span>, logit choice precision. Then let <span class="math inline">\(u_t(a\mid k)\)</span> be the player’s expected utility in game <span class="math inline">\(t\)</span> given that they are a level-<span class="math inline">\(k\)</span> type, and <span class="math inline">\(a_t^*(k)\)</span> is their optimal action given that they are a lvele-<span class="math inline">\(k\)</span> type. We can then split up the likelihood contribution into two cases:</p>
<ol style="list-style-type: decimal">
<li>if they choose their optimal action, then that choice could have been a best response <em>or</em> they just happened to logit respond with this action, or</li>
<li>if they did not choose their optimal action, then they must have logit responded.</li>
</ol>
<p>This makes our log-likelihood for an individual choice <span class="math inline">\(y_t\)</span> in Game <span class="math inline">\(t\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\log p(y_t\mid \rho,\lambda,k)&amp;=\begin{cases}
\log\left(\rho+(1-\rho)\frac{\exp(\lambda u(y_t\mid k))}{\sum_a\exp(\lambda u(a\mid k))}\right)&amp; \text{if } y_t = a_t^*(k)\\
\log\left((1-\rho)\frac{\exp(\lambda u(y_t\mid k))}{\sum_a\exp(\lambda u(a\mid k))}\right) &amp; \text{otherwise}
\end{cases}
\end{aligned}
\]</span></p>
</div>
</div>
<div id="assigning-probabilities-to-types-for-each-participant-separately" class="section level2 hasAnchor" number="20.3">
<h2><span class="header-section-number">20.3</span> Assigning probabilities to types for each participant separately<a href="application-level-k-models.html#assigning-probabilities-to-types-for-each-participant-separately" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One approach to the data, which is probably the closest in this chapter to its original treatment in <span class="citation">Costa-Gomes and Crawford (<a href="#ref-CGC2006">2006</a>)</span>, is to estimate the level-<span class="math inline">\(k\)</span> model for each participant separately, assuming various different values of <span class="math inline">\(k\)</span>, then using some kind of model evaluation to select the value of <span class="math inline">\(k\)</span> that best characterizes that participant. In this section, I estimate the model for each participant assuming <span class="math inline">\(k=1, 2, 3, 4, 5\)</span>, and then use Bayes factors and model averaging to determine which <span class="math inline">\(k\)</span> best characterizes their behavior.</p>
<div id="the-stan-program" class="section level3 hasAnchor" number="20.3.1">
<h3><span class="header-section-number">20.3.1</span> The <em>Stan</em> program<a href="application-level-k-models.html#the-stan-program" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here is the <em>Stan</em> program I came up with. Importantly, note that each level-<span class="math inline">\(k\)</span> strategy can be pre-computed, which is going to speed things up substantially. You can see this done in the <code>transformed data</code> block. The predictions are stored in the arrays <code>LKpredictions1</code> for player 1, and <code>LKpredictions2</code> for player 2.</p>
<p>Another thing to note is that I am incementing the target by the full likelihood, and not just the kernel. Hence, the extensive use of <code>target += ...</code>. This is so that we can compute the log marginal likelihood, which will be needed for model comparison.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb245-1"><a href="application-level-k-models.html#cb245-1" tabindex="-1"></a>functions <span class="op">{</span></span>
<span id="cb245-2"><a href="application-level-k-models.html#cb245-2" tabindex="-1"></a>  </span>
<span id="cb245-3"><a href="application-level-k-models.html#cb245-3" tabindex="-1"></a>  vector payofffun<span class="op">(</span>vector x1<span class="op">,</span>row_vector x2<span class="op">,</span>real p1<span class="op">)</span> <span class="op">{</span></span>
<span id="cb245-4"><a href="application-level-k-models.html#cb245-4" tabindex="-1"></a>    </span>
<span id="cb245-5"><a href="application-level-k-models.html#cb245-5" tabindex="-1"></a>    <span class="co">/*</span></span>
<span id="cb245-6"><a href="application-level-k-models.html#cb245-6" tabindex="-1"></a><span class="co">    x1 is the action space of the first player</span></span>
<span id="cb245-7"><a href="application-level-k-models.html#cb245-7" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb245-8"><a href="application-level-k-models.html#cb245-8" tabindex="-1"></a><span class="co">    x2 is the distribution of actions of the second player. That is, for level 0 </span></span>
<span id="cb245-9"><a href="application-level-k-models.html#cb245-9" tabindex="-1"></a><span class="co">    player 2, it is the action space (which gets averaged over a uniform </span></span>
<span id="cb245-10"><a href="application-level-k-models.html#cb245-10" tabindex="-1"></a><span class="co">    distribution), and for level k&gt;0 is just populated by the prediction of this</span></span>
<span id="cb245-11"><a href="application-level-k-models.html#cb245-11" tabindex="-1"></a><span class="co">    type</span></span>
<span id="cb245-12"><a href="application-level-k-models.html#cb245-12" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb245-13"><a href="application-level-k-models.html#cb245-13" tabindex="-1"></a>    </span>
<span id="cb245-14"><a href="application-level-k-models.html#cb245-14" tabindex="-1"></a>    <span class="dt">int</span> n1 <span class="op">=</span> size<span class="op">(</span>x1<span class="op">);</span></span>
<span id="cb245-15"><a href="application-level-k-models.html#cb245-15" tabindex="-1"></a>    <span class="dt">int</span> n2 <span class="op">=</span> size<span class="op">(</span>x2<span class="op">);</span></span>
<span id="cb245-16"><a href="application-level-k-models.html#cb245-16" tabindex="-1"></a>    </span>
<span id="cb245-17"><a href="application-level-k-models.html#cb245-17" tabindex="-1"></a>    matrix<span class="op">[</span>n1<span class="op">,</span>n2<span class="op">]</span> err <span class="op">=</span> fabs<span class="op">(</span>rep_matrix<span class="op">(</span>x1<span class="op">,</span>n2<span class="op">)-</span>p1<span class="op">*</span>rep_matrix<span class="op">(</span>x2<span class="op">,</span>n1<span class="op">));</span></span>
<span id="cb245-18"><a href="application-level-k-models.html#cb245-18" tabindex="-1"></a>    </span>
<span id="cb245-19"><a href="application-level-k-models.html#cb245-19" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> pay <span class="op">=</span> <span class="op">(</span>fmax<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span><span class="dv">200</span><span class="op">-</span>err<span class="op">*</span><span class="dv">10</span><span class="op">)+</span>fmax<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span><span class="dv">100</span><span class="op">-</span>err<span class="op">))*</span>rep_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">/</span>n1<span class="op">,</span>n2<span class="op">);</span></span>
<span id="cb245-20"><a href="application-level-k-models.html#cb245-20" tabindex="-1"></a>    </span>
<span id="cb245-21"><a href="application-level-k-models.html#cb245-21" tabindex="-1"></a>    <span class="cf">return</span> pay<span class="op">;</span></span>
<span id="cb245-22"><a href="application-level-k-models.html#cb245-22" tabindex="-1"></a>    </span>
<span id="cb245-23"><a href="application-level-k-models.html#cb245-23" tabindex="-1"></a>    </span>
<span id="cb245-24"><a href="application-level-k-models.html#cb245-24" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb245-25"><a href="application-level-k-models.html#cb245-25" tabindex="-1"></a>  </span>
<span id="cb245-26"><a href="application-level-k-models.html#cb245-26" tabindex="-1"></a>  <span class="dt">int</span> which_max<span class="op">(</span>vector x<span class="op">,</span>real tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb245-27"><a href="application-level-k-models.html#cb245-27" tabindex="-1"></a>    <span class="co">/*</span></span>
<span id="cb245-28"><a href="application-level-k-models.html#cb245-28" tabindex="-1"></a><span class="co">    Returns the index of the vector x which corresponds to the maximum in x</span></span>
<span id="cb245-29"><a href="application-level-k-models.html#cb245-29" tabindex="-1"></a><span class="co">    Returns the largest index if there are more than one element equal to this</span></span>
<span id="cb245-30"><a href="application-level-k-models.html#cb245-30" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb245-31"><a href="application-level-k-models.html#cb245-31" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> size<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb245-32"><a href="application-level-k-models.html#cb245-32" tabindex="-1"></a>    </span>
<span id="cb245-33"><a href="application-level-k-models.html#cb245-33" tabindex="-1"></a>    <span class="dt">int</span> ind <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb245-34"><a href="application-level-k-models.html#cb245-34" tabindex="-1"></a>    </span>
<span id="cb245-35"><a href="application-level-k-models.html#cb245-35" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb245-36"><a href="application-level-k-models.html#cb245-36" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>abs<span class="op">(</span>x<span class="op">[</span>ii<span class="op">]-</span>max<span class="op">(</span>x<span class="op">))&lt;</span>tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb245-37"><a href="application-level-k-models.html#cb245-37" tabindex="-1"></a>        ind <span class="op">=</span> ii<span class="op">;</span></span>
<span id="cb245-38"><a href="application-level-k-models.html#cb245-38" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb245-39"><a href="application-level-k-models.html#cb245-39" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb245-40"><a href="application-level-k-models.html#cb245-40" tabindex="-1"></a>    </span>
<span id="cb245-41"><a href="application-level-k-models.html#cb245-41" tabindex="-1"></a>    <span class="cf">return</span> ind<span class="op">;</span></span>
<span id="cb245-42"><a href="application-level-k-models.html#cb245-42" tabindex="-1"></a>    </span>
<span id="cb245-43"><a href="application-level-k-models.html#cb245-43" tabindex="-1"></a>    </span>
<span id="cb245-44"><a href="application-level-k-models.html#cb245-44" tabindex="-1"></a>    </span>
<span id="cb245-45"><a href="application-level-k-models.html#cb245-45" tabindex="-1"></a>    </span>
<span id="cb245-46"><a href="application-level-k-models.html#cb245-46" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb245-47"><a href="application-level-k-models.html#cb245-47" tabindex="-1"></a>  </span>
<span id="cb245-48"><a href="application-level-k-models.html#cb245-48" tabindex="-1"></a>  </span>
<span id="cb245-49"><a href="application-level-k-models.html#cb245-49" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb245-50"><a href="application-level-k-models.html#cb245-50" tabindex="-1"></a></span>
<span id="cb245-51"><a href="application-level-k-models.html#cb245-51" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb245-52"><a href="application-level-k-models.html#cb245-52" tabindex="-1"></a>  </span>
<span id="cb245-53"><a href="application-level-k-models.html#cb245-53" tabindex="-1"></a>  <span class="dt">int</span> ngames<span class="op">;</span> <span class="co">// number of games</span></span>
<span id="cb245-54"><a href="application-level-k-models.html#cb245-54" tabindex="-1"></a>  </span>
<span id="cb245-55"><a href="application-level-k-models.html#cb245-55" tabindex="-1"></a>  <span class="dt">int</span> k<span class="op">;</span> <span class="co">// level k to evaluate</span></span>
<span id="cb245-56"><a href="application-level-k-models.html#cb245-56" tabindex="-1"></a>  </span>
<span id="cb245-57"><a href="application-level-k-models.html#cb245-57" tabindex="-1"></a>  <span class="co">// game data</span></span>
<span id="cb245-58"><a href="application-level-k-models.html#cb245-58" tabindex="-1"></a>  vector<span class="op">[</span>ngames<span class="op">]</span> P1<span class="op">;</span> <span class="co">// target for player 1</span></span>
<span id="cb245-59"><a href="application-level-k-models.html#cb245-59" tabindex="-1"></a>  vector<span class="op">[</span>ngames<span class="op">]</span> P2<span class="op">;</span> <span class="co">// target for player 2</span></span>
<span id="cb245-60"><a href="application-level-k-models.html#cb245-60" tabindex="-1"></a>  <span class="dt">int</span> LB1<span class="op">[</span>ngames<span class="op">];</span> <span class="co">// lower bound for player 1</span></span>
<span id="cb245-61"><a href="application-level-k-models.html#cb245-61" tabindex="-1"></a>  <span class="dt">int</span> UB1<span class="op">[</span>ngames<span class="op">];</span> <span class="co">// upper bound for player 1</span></span>
<span id="cb245-62"><a href="application-level-k-models.html#cb245-62" tabindex="-1"></a>  <span class="dt">int</span> LB2<span class="op">[</span>ngames<span class="op">];</span> <span class="co">// lower bound for player 2</span></span>
<span id="cb245-63"><a href="application-level-k-models.html#cb245-63" tabindex="-1"></a>  <span class="dt">int</span> UB2<span class="op">[</span>ngames<span class="op">];</span> <span class="co">// upper bound for player 2</span></span>
<span id="cb245-64"><a href="application-level-k-models.html#cb245-64" tabindex="-1"></a>  </span>
<span id="cb245-65"><a href="application-level-k-models.html#cb245-65" tabindex="-1"></a>  <span class="co">// player 1 choice</span></span>
<span id="cb245-66"><a href="application-level-k-models.html#cb245-66" tabindex="-1"></a>  <span class="dt">int</span> choice1<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb245-67"><a href="application-level-k-models.html#cb245-67" tabindex="-1"></a>  </span>
<span id="cb245-68"><a href="application-level-k-models.html#cb245-68" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> prior_probExact<span class="op">[</span><span class="dv">2</span><span class="op">];</span> <span class="co">// Beta prior</span></span>
<span id="cb245-69"><a href="application-level-k-models.html#cb245-69" tabindex="-1"></a>  real prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">];</span> <span class="co">// lognormal prior </span></span>
<span id="cb245-70"><a href="application-level-k-models.html#cb245-70" tabindex="-1"></a>  </span>
<span id="cb245-71"><a href="application-level-k-models.html#cb245-71" tabindex="-1"></a>  <span class="co">// tolerance for identifying a maximum in function which_max(,)</span></span>
<span id="cb245-72"><a href="application-level-k-models.html#cb245-72" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> tol<span class="op">;</span></span>
<span id="cb245-73"><a href="application-level-k-models.html#cb245-73" tabindex="-1"></a>  </span>
<span id="cb245-74"><a href="application-level-k-models.html#cb245-74" tabindex="-1"></a>  </span>
<span id="cb245-75"><a href="application-level-k-models.html#cb245-75" tabindex="-1"></a>  </span>
<span id="cb245-76"><a href="application-level-k-models.html#cb245-76" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb245-77"><a href="application-level-k-models.html#cb245-77" tabindex="-1"></a></span>
<span id="cb245-78"><a href="application-level-k-models.html#cb245-78" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb245-79"><a href="application-level-k-models.html#cb245-79" tabindex="-1"></a>  </span>
<span id="cb245-80"><a href="application-level-k-models.html#cb245-80" tabindex="-1"></a>  <span class="dt">int</span> choice1_i<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb245-81"><a href="application-level-k-models.html#cb245-81" tabindex="-1"></a>  </span>
<span id="cb245-82"><a href="application-level-k-models.html#cb245-82" tabindex="-1"></a>  <span class="co">// pre-compute level-k predictions</span></span>
<span id="cb245-83"><a href="application-level-k-models.html#cb245-83" tabindex="-1"></a>  </span>
<span id="cb245-84"><a href="application-level-k-models.html#cb245-84" tabindex="-1"></a>  vector<span class="op">[</span>k<span class="op">]</span> LKpredictions1<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb245-85"><a href="application-level-k-models.html#cb245-85" tabindex="-1"></a>  vector<span class="op">[</span>k<span class="op">]</span> LKpredictions2<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb245-86"><a href="application-level-k-models.html#cb245-86" tabindex="-1"></a>  </span>
<span id="cb245-87"><a href="application-level-k-models.html#cb245-87" tabindex="-1"></a>  </span>
<span id="cb245-88"><a href="application-level-k-models.html#cb245-88" tabindex="-1"></a>  </span>
<span id="cb245-89"><a href="application-level-k-models.html#cb245-89" tabindex="-1"></a>  </span>
<span id="cb245-90"><a href="application-level-k-models.html#cb245-90" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>gg in <span class="dv">1</span><span class="op">:</span>ngames<span class="op">)</span> <span class="op">{</span></span>
<span id="cb245-91"><a href="application-level-k-models.html#cb245-91" tabindex="-1"></a>    real p1 <span class="op">=</span> P1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb245-92"><a href="application-level-k-models.html#cb245-92" tabindex="-1"></a>    real p2 <span class="op">=</span> P2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb245-93"><a href="application-level-k-models.html#cb245-93" tabindex="-1"></a>    <span class="dt">int</span> lb1 <span class="op">=</span> LB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb245-94"><a href="application-level-k-models.html#cb245-94" tabindex="-1"></a>    <span class="dt">int</span> ub1 <span class="op">=</span> UB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb245-95"><a href="application-level-k-models.html#cb245-95" tabindex="-1"></a>    <span class="dt">int</span> lb2 <span class="op">=</span> LB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb245-96"><a href="application-level-k-models.html#cb245-96" tabindex="-1"></a>    <span class="dt">int</span> ub2 <span class="op">=</span> UB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb245-97"><a href="application-level-k-models.html#cb245-97" tabindex="-1"></a>    </span>
<span id="cb245-98"><a href="application-level-k-models.html#cb245-98" tabindex="-1"></a>    <span class="dt">int</span> n1 <span class="op">=</span> ub1<span class="op">-</span>lb1<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb245-99"><a href="application-level-k-models.html#cb245-99" tabindex="-1"></a>    <span class="dt">int</span> n2 <span class="op">=</span> ub2<span class="op">-</span>lb2<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb245-100"><a href="application-level-k-models.html#cb245-100" tabindex="-1"></a>    </span>
<span id="cb245-101"><a href="application-level-k-models.html#cb245-101" tabindex="-1"></a>    choice1_i<span class="op">[</span>gg<span class="op">]</span> <span class="op">=</span> choice1<span class="op">[</span>gg<span class="op">]-</span>lb1<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb245-102"><a href="application-level-k-models.html#cb245-102" tabindex="-1"></a>    </span>
<span id="cb245-103"><a href="application-level-k-models.html#cb245-103" tabindex="-1"></a>    <span class="co">// choice sets</span></span>
<span id="cb245-104"><a href="application-level-k-models.html#cb245-104" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> X1 <span class="op">=</span> linspaced_vector<span class="op">(</span>n1<span class="op">,</span>lb1<span class="op">,</span>ub1<span class="op">);</span></span>
<span id="cb245-105"><a href="application-level-k-models.html#cb245-105" tabindex="-1"></a>    row_vector<span class="op">[</span>n2<span class="op">]</span> X2 <span class="op">=</span> linspaced_row_vector<span class="op">(</span>n2<span class="op">,</span>lb2<span class="op">,</span>ub2<span class="op">);</span></span>
<span id="cb245-106"><a href="application-level-k-models.html#cb245-106" tabindex="-1"></a>    </span>
<span id="cb245-107"><a href="application-level-k-models.html#cb245-107" tabindex="-1"></a>    <span class="co">// choices to get uniform distribution over actions</span></span>
<span id="cb245-108"><a href="application-level-k-models.html#cb245-108" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> x1 <span class="op">=</span> linspaced_vector<span class="op">(</span>n1<span class="op">,</span>lb1<span class="op">,</span>ub1<span class="op">);</span></span>
<span id="cb245-109"><a href="application-level-k-models.html#cb245-109" tabindex="-1"></a>    row_vector<span class="op">[</span>n2<span class="op">]</span> x2 <span class="op">=</span> linspaced_row_vector<span class="op">(</span>n2<span class="op">,</span>lb2<span class="op">,</span>ub2<span class="op">);</span></span>
<span id="cb245-110"><a href="application-level-k-models.html#cb245-110" tabindex="-1"></a>    </span>
<span id="cb245-111"><a href="application-level-k-models.html#cb245-111" tabindex="-1"></a>    </span>
<span id="cb245-112"><a href="application-level-k-models.html#cb245-112" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>kk in <span class="dv">1</span><span class="op">:</span>k<span class="op">)</span> <span class="op">{</span></span>
<span id="cb245-113"><a href="application-level-k-models.html#cb245-113" tabindex="-1"></a>      </span>
<span id="cb245-114"><a href="application-level-k-models.html#cb245-114" tabindex="-1"></a>      vector<span class="op">[</span>n1<span class="op">]</span> payoff1 <span class="op">=</span> payofffun<span class="op">(</span>X1<span class="op">,</span>x2<span class="op">,</span>p1<span class="op">);</span></span>
<span id="cb245-115"><a href="application-level-k-models.html#cb245-115" tabindex="-1"></a>      vector<span class="op">[</span>n2<span class="op">]</span> payoff2 <span class="op">=</span> payofffun<span class="op">(</span>X2<span class="ch">&#39;,</span><span class="er">x1</span><span class="ch">&#39;</span><span class="op">,</span>p2<span class="op">);</span></span>
<span id="cb245-116"><a href="application-level-k-models.html#cb245-116" tabindex="-1"></a>      </span>
<span id="cb245-117"><a href="application-level-k-models.html#cb245-117" tabindex="-1"></a>      x1 <span class="op">=</span> rep_vector<span class="op">(</span>X1<span class="op">[</span>which_max<span class="op">(</span>payoff1<span class="op">,</span>tol<span class="op">)],</span>n1<span class="op">);</span></span>
<span id="cb245-118"><a href="application-level-k-models.html#cb245-118" tabindex="-1"></a>      x2 <span class="op">=</span> rep_row_vector<span class="op">(</span>X2<span class="op">[</span>which_max<span class="op">(</span>payoff2<span class="op">,</span>tol<span class="op">)],</span>n2<span class="op">);</span></span>
<span id="cb245-119"><a href="application-level-k-models.html#cb245-119" tabindex="-1"></a>      </span>
<span id="cb245-120"><a href="application-level-k-models.html#cb245-120" tabindex="-1"></a>      LKpredictions1<span class="op">[</span>gg<span class="op">][</span>kk<span class="op">]</span> <span class="op">=</span> X1<span class="op">[</span>which_max<span class="op">(</span>payoff1<span class="op">,</span>tol<span class="op">)];</span></span>
<span id="cb245-121"><a href="application-level-k-models.html#cb245-121" tabindex="-1"></a>      LKpredictions2<span class="op">[</span>gg<span class="op">][</span>kk<span class="op">]</span> <span class="op">=</span> X2<span class="op">[</span>which_max<span class="op">(</span>payoff2<span class="op">,</span>tol<span class="op">)];</span></span>
<span id="cb245-122"><a href="application-level-k-models.html#cb245-122" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb245-123"><a href="application-level-k-models.html#cb245-123" tabindex="-1"></a>    </span>
<span id="cb245-124"><a href="application-level-k-models.html#cb245-124" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb245-125"><a href="application-level-k-models.html#cb245-125" tabindex="-1"></a>  </span>
<span id="cb245-126"><a href="application-level-k-models.html#cb245-126" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb245-127"><a href="application-level-k-models.html#cb245-127" tabindex="-1"></a></span>
<span id="cb245-128"><a href="application-level-k-models.html#cb245-128" tabindex="-1"></a></span>
<span id="cb245-129"><a href="application-level-k-models.html#cb245-129" tabindex="-1"></a></span>
<span id="cb245-130"><a href="application-level-k-models.html#cb245-130" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb245-131"><a href="application-level-k-models.html#cb245-131" tabindex="-1"></a>  </span>
<span id="cb245-132"><a href="application-level-k-models.html#cb245-132" tabindex="-1"></a>  <span class="co">// probability the player chooses exactly according to the level-k model</span></span>
<span id="cb245-133"><a href="application-level-k-models.html#cb245-133" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">,</span>upper<span class="op">=</span><span class="dv">1</span><span class="op">&gt;</span> probExact<span class="op">;</span></span>
<span id="cb245-134"><a href="application-level-k-models.html#cb245-134" tabindex="-1"></a>  <span class="co">// logit choice precision for the rest of the choices</span></span>
<span id="cb245-135"><a href="application-level-k-models.html#cb245-135" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> lambda<span class="op">;</span></span>
<span id="cb245-136"><a href="application-level-k-models.html#cb245-136" tabindex="-1"></a>  </span>
<span id="cb245-137"><a href="application-level-k-models.html#cb245-137" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb245-138"><a href="application-level-k-models.html#cb245-138" tabindex="-1"></a></span>
<span id="cb245-139"><a href="application-level-k-models.html#cb245-139" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb245-140"><a href="application-level-k-models.html#cb245-140" tabindex="-1"></a>  </span>
<span id="cb245-141"><a href="application-level-k-models.html#cb245-141" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>gg in <span class="dv">1</span><span class="op">:</span>ngames<span class="op">)</span> <span class="op">{</span></span>
<span id="cb245-142"><a href="application-level-k-models.html#cb245-142" tabindex="-1"></a>    real p1 <span class="op">=</span> P1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb245-143"><a href="application-level-k-models.html#cb245-143" tabindex="-1"></a>    real p2 <span class="op">=</span> P2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb245-144"><a href="application-level-k-models.html#cb245-144" tabindex="-1"></a>    <span class="dt">int</span> lb1 <span class="op">=</span> LB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb245-145"><a href="application-level-k-models.html#cb245-145" tabindex="-1"></a>    <span class="dt">int</span> ub1 <span class="op">=</span> UB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb245-146"><a href="application-level-k-models.html#cb245-146" tabindex="-1"></a>    <span class="dt">int</span> lb2 <span class="op">=</span> LB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb245-147"><a href="application-level-k-models.html#cb245-147" tabindex="-1"></a>    <span class="dt">int</span> ub2 <span class="op">=</span> UB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb245-148"><a href="application-level-k-models.html#cb245-148" tabindex="-1"></a>    </span>
<span id="cb245-149"><a href="application-level-k-models.html#cb245-149" tabindex="-1"></a>    <span class="dt">int</span> n1 <span class="op">=</span> ub1<span class="op">-</span>lb1<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb245-150"><a href="application-level-k-models.html#cb245-150" tabindex="-1"></a>    <span class="dt">int</span> n2 <span class="op">=</span> ub2<span class="op">-</span>lb2<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb245-151"><a href="application-level-k-models.html#cb245-151" tabindex="-1"></a>    </span>
<span id="cb245-152"><a href="application-level-k-models.html#cb245-152" tabindex="-1"></a>    <span class="co">// choice sets for Player 1</span></span>
<span id="cb245-153"><a href="application-level-k-models.html#cb245-153" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> X1 <span class="op">=</span> linspaced_vector<span class="op">(</span>n1<span class="op">,</span>lb1<span class="op">,</span>ub1<span class="op">);</span></span>
<span id="cb245-154"><a href="application-level-k-models.html#cb245-154" tabindex="-1"></a>    </span>
<span id="cb245-155"><a href="application-level-k-models.html#cb245-155" tabindex="-1"></a>    row_vector<span class="op">[</span>n2<span class="op">]</span> x2<span class="op">;</span></span>
<span id="cb245-156"><a href="application-level-k-models.html#cb245-156" tabindex="-1"></a>    </span>
<span id="cb245-157"><a href="application-level-k-models.html#cb245-157" tabindex="-1"></a>    <span class="co">// action of Player 2</span></span>
<span id="cb245-158"><a href="application-level-k-models.html#cb245-158" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>k<span class="op">==</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb245-159"><a href="application-level-k-models.html#cb245-159" tabindex="-1"></a>      x2 <span class="op">=</span> linspaced_vector<span class="op">(</span>n2<span class="op">,</span>lb2<span class="op">,</span>ub2<span class="op">)</span><span class="ch">&#39;;</span></span>
<span id="cb245-160"><a href="application-level-k-models.html#cb245-160" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb245-161"><a href="application-level-k-models.html#cb245-161" tabindex="-1"></a>      x2 <span class="op">=</span> rep_row_vector<span class="op">(</span>LKpredictions2<span class="op">[</span>gg<span class="op">][</span>k<span class="op">-</span><span class="dv">1</span><span class="op">],</span>n2<span class="op">);</span></span>
<span id="cb245-162"><a href="application-level-k-models.html#cb245-162" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb245-163"><a href="application-level-k-models.html#cb245-163" tabindex="-1"></a>    </span>
<span id="cb245-164"><a href="application-level-k-models.html#cb245-164" tabindex="-1"></a>    <span class="co">// Player 1 payoff</span></span>
<span id="cb245-165"><a href="application-level-k-models.html#cb245-165" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> payoff1 <span class="op">=</span> payofffun<span class="op">(</span>X1<span class="op">,</span>x2<span class="op">,</span>p1<span class="op">);</span></span>
<span id="cb245-166"><a href="application-level-k-models.html#cb245-166" tabindex="-1"></a>    </span>
<span id="cb245-167"><a href="application-level-k-models.html#cb245-167" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>choice1<span class="op">[</span>gg<span class="op">]==</span>LKpredictions1<span class="op">[</span>gg<span class="op">][</span>k<span class="op">])</span> <span class="op">{</span></span>
<span id="cb245-168"><a href="application-level-k-models.html#cb245-168" tabindex="-1"></a>    <span class="co">// If the choice matches exactly with the prediction, then ...</span></span>
<span id="cb245-169"><a href="application-level-k-models.html#cb245-169" tabindex="-1"></a>     target <span class="op">+=</span> log<span class="op">(</span></span>
<span id="cb245-170"><a href="application-level-k-models.html#cb245-170" tabindex="-1"></a>       probExact <span class="co">// best respond probability</span></span>
<span id="cb245-171"><a href="application-level-k-models.html#cb245-171" tabindex="-1"></a>        <span class="op">+(</span><span class="fl">1.0</span><span class="op">-</span>probExact<span class="op">)*</span>softmax<span class="op">(</span>lambda<span class="op">*</span>payoff1<span class="op">)[</span>choice1_i<span class="op">[</span>gg<span class="op">]]</span> <span class="co">// logit response</span></span>
<span id="cb245-172"><a href="application-level-k-models.html#cb245-172" tabindex="-1"></a>      <span class="op">);</span></span>
<span id="cb245-173"><a href="application-level-k-models.html#cb245-173" tabindex="-1"></a>      </span>
<span id="cb245-174"><a href="application-level-k-models.html#cb245-174" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb245-175"><a href="application-level-k-models.html#cb245-175" tabindex="-1"></a>      <span class="co">// if the choice does not match exactly with the prediction, then ...</span></span>
<span id="cb245-176"><a href="application-level-k-models.html#cb245-176" tabindex="-1"></a>      target <span class="op">+=</span> log<span class="op">(</span></span>
<span id="cb245-177"><a href="application-level-k-models.html#cb245-177" tabindex="-1"></a>       <span class="op">(</span><span class="fl">1.0</span><span class="op">-</span>probExact<span class="op">)*</span>softmax<span class="op">(</span>lambda<span class="op">*</span>payoff1<span class="op">)[</span>choice1_i<span class="op">[</span>gg<span class="op">]]</span></span>
<span id="cb245-178"><a href="application-level-k-models.html#cb245-178" tabindex="-1"></a>      <span class="op">);</span></span>
<span id="cb245-179"><a href="application-level-k-models.html#cb245-179" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb245-180"><a href="application-level-k-models.html#cb245-180" tabindex="-1"></a>    </span>
<span id="cb245-181"><a href="application-level-k-models.html#cb245-181" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb245-182"><a href="application-level-k-models.html#cb245-182" tabindex="-1"></a>  </span>
<span id="cb245-183"><a href="application-level-k-models.html#cb245-183" tabindex="-1"></a>  </span>
<span id="cb245-184"><a href="application-level-k-models.html#cb245-184" tabindex="-1"></a>  </span>
<span id="cb245-185"><a href="application-level-k-models.html#cb245-185" tabindex="-1"></a>  <span class="co">// priors </span></span>
<span id="cb245-186"><a href="application-level-k-models.html#cb245-186" tabindex="-1"></a>  target <span class="op">+=</span> beta_lpdf<span class="op">(</span>probExact <span class="op">|</span> prior_probExact<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_probExact<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb245-187"><a href="application-level-k-models.html#cb245-187" tabindex="-1"></a>  target <span class="op">+=</span> lognormal_lpdf<span class="op">(</span>lambda <span class="op">|</span> prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb245-188"><a href="application-level-k-models.html#cb245-188" tabindex="-1"></a>  </span>
<span id="cb245-189"><a href="application-level-k-models.html#cb245-189" tabindex="-1"></a>  </span>
<span id="cb245-190"><a href="application-level-k-models.html#cb245-190" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<div id="prior-calibration-2" class="section level3 hasAnchor" number="20.3.2">
<h3><span class="header-section-number">20.3.2</span> Prior calibration<a href="application-level-k-models.html#prior-calibration-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The model has two parameters: <span class="math inline">\(\rho\in(0,1)\)</span> (the probability that the player chooses their best response), and <span class="math inline">\(\lambda&gt;0\)</span> (logit choice precision).</p>
<p>As <span class="math inline">\(\rho\)</span> is restricted to the unit interval, a Beta prior makes sense here. I ended up unsing the uniform distribution, or <span class="math inline">\(\rho\sim\mathrm{Beta}(1,1)\)</span> for this prior.</p>
<p>For <span class="math inline">\(\lambda\)</span>, a log-normal distribution makes sure that the parameter is non-negative, so <span class="math inline">\(\log\lambda\sim N(m_\lambda,s_\lambda^2)\)</span>. For an idea of what might be a good choice of <span class="math inline">\(m_\lambda\)</span> and <span class="math inline">\(s_\lambda\)</span>, let’s look at the logit response in Game 1 to player 2 choosing <code>x_other=500</code> (as we did for the payoff function above in Figure <a href="application-level-k-models.html#fig:CGC2006payofffun">20.2</a>).</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="application-level-k-models.html#cb246-1" tabindex="-1"></a>logitResponse<span class="ot">&lt;-</span><span class="fu">expand.grid</span>(</span>
<span id="cb246-2"><a href="application-level-k-models.html#cb246-2" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(lb1,ub1,<span class="at">by=</span><span class="dv">1</span>),</span>
<span id="cb246-3"><a href="application-level-k-models.html#cb246-3" tabindex="-1"></a>  <span class="at">lambda =</span> <span class="fu">c</span>(<span class="fl">0.01</span>,<span class="fl">0.02</span>,<span class="fl">0.05</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">2</span>)</span>
<span id="cb246-4"><a href="application-level-k-models.html#cb246-4" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb246-5"><a href="application-level-k-models.html#cb246-5" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">|&gt;</span></span>
<span id="cb246-6"><a href="application-level-k-models.html#cb246-6" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb246-7"><a href="application-level-k-models.html#cb246-7" tabindex="-1"></a>    <span class="at">u =</span> <span class="fu">max</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">200</span><span class="sc">-</span><span class="fu">abs</span>(x<span class="sc">-</span>p1<span class="sc">*</span>x_other)<span class="sc">*</span><span class="dv">10</span>))<span class="sc">+</span><span class="fu">max</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span><span class="sc">-</span><span class="fu">abs</span>(x<span class="sc">-</span>p1<span class="sc">*</span>x_other)))</span>
<span id="cb246-8"><a href="application-level-k-models.html#cb246-8" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb246-9"><a href="application-level-k-models.html#cb246-9" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb246-10"><a href="application-level-k-models.html#cb246-10" tabindex="-1"></a>  <span class="fu">group_by</span>(lambda) <span class="sc">|&gt;</span></span>
<span id="cb246-11"><a href="application-level-k-models.html#cb246-11" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb246-12"><a href="application-level-k-models.html#cb246-12" tabindex="-1"></a>    <span class="at">u =</span> u<span class="sc">-</span><span class="fu">min</span>(u),</span>
<span id="cb246-13"><a href="application-level-k-models.html#cb246-13" tabindex="-1"></a>    <span class="at">pr =</span> <span class="fu">exp</span>(lambda<span class="sc">*</span>u)<span class="sc">/</span><span class="fu">sum</span>(lambda<span class="sc">*</span>u),</span>
<span id="cb246-14"><a href="application-level-k-models.html#cb246-14" tabindex="-1"></a>    <span class="at">pr_scaled =</span> pr<span class="sc">/</span><span class="fu">max</span>(pr)</span>
<span id="cb246-15"><a href="application-level-k-models.html#cb246-15" tabindex="-1"></a>  )</span>
<span id="cb246-16"><a href="application-level-k-models.html#cb246-16" tabindex="-1"></a></span>
<span id="cb246-17"><a href="application-level-k-models.html#cb246-17" tabindex="-1"></a>(</span>
<span id="cb246-18"><a href="application-level-k-models.html#cb246-18" tabindex="-1"></a>  <span class="fu">ggplot</span>(logitResponse,<span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>pr_scaled,<span class="at">color =</span> <span class="fu">as.factor</span>(lambda)))</span>
<span id="cb246-19"><a href="application-level-k-models.html#cb246-19" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">labs</span>(<span class="at">color =</span> <span class="fu">expression</span>(lambda),<span class="at">x =</span> <span class="st">&quot;choice&quot;</span>,<span class="at">y=</span><span class="st">&quot;probability (scaled so max=1)&quot;</span>)</span>
<span id="cb246-20"><a href="application-level-k-models.html#cb246-20" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_path</span>()</span>
<span id="cb246-21"><a href="application-level-k-models.html#cb246-21" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb246-22"><a href="application-level-k-models.html#cb246-22" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-429-1.png" width="672" /></p>
<p>I then pin down the 2.5th and 97.5th percentiles of the prior with the most extreme cases of this plot:</p>
<p><span class="math display">\[
\begin{aligned}
\log0.01&amp;=m_\lambda-1.96 s_\lambda\\
\log2&amp;=m_\lambda+1.96s_\lambda\\
2m_\lambda&amp;=\log0.01+\log 2\\
m_\lambda&amp;=\frac{\log0.01+\log 2}{2}\approx-1.96\\
2\times 1.96 s_\lambda&amp;=\log 2-\log0.01\\
s_\lambda&amp;=\frac{\log 2-\log0.01}{2\times1.96}\approx 1.35\\
\implies \log\lambda&amp;\sim N(-1.96,1.35^2)
\end{aligned}
\]</span></p>
</div>
<div id="results-7" class="section level3 hasAnchor" number="20.3.3">
<h3><span class="header-section-number">20.3.3</span> Results<a href="application-level-k-models.html#results-7" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this section, I estimate one model for each participant, and for each level <span class="math inline">\(k\in\{1, 2, 3, 4, 5\}\)</span>. This takes a while, but runs without any errors with <em>RStan</em>’s default options.<a href="#fn91" class="footnote-ref" id="fnref91"><sup>91</sup></a></p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="application-level-k-models.html#cb247-1" tabindex="-1"></a>Estimates<span class="ot">&lt;-</span><span class="st">&quot;Code/CGC2006/EstimatesLevelkRepAgent.rds&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb247-2"><a href="application-level-k-models.html#cb247-2" tabindex="-1"></a>  <span class="fu">readRDS</span>()</span>
<span id="cb247-3"><a href="application-level-k-models.html#cb247-3" tabindex="-1"></a></span>
<span id="cb247-4"><a href="application-level-k-models.html#cb247-4" tabindex="-1"></a><span class="co"># whoops! I forgot to add in the parameter names into the estimation code.</span></span>
<span id="cb247-5"><a href="application-level-k-models.html#cb247-5" tabindex="-1"></a><span class="co"># Fortunately this information is stored in the rownames of the estimates</span></span>
<span id="cb247-6"><a href="application-level-k-models.html#cb247-6" tabindex="-1"></a>Estimates<span class="sc">$</span>parameter<span class="ot">&lt;-</span><span class="fu">gsub</span>(<span class="st">&#39;[[:digit:]]+&#39;</span>, <span class="st">&#39;&#39;</span>,<span class="fu">rownames</span>(Estimates))</span>
<span id="cb247-7"><a href="application-level-k-models.html#cb247-7" tabindex="-1"></a></span>
<span id="cb247-8"><a href="application-level-k-models.html#cb247-8" tabindex="-1"></a></span>
<span id="cb247-9"><a href="application-level-k-models.html#cb247-9" tabindex="-1"></a>Estimates<span class="ot">&lt;-</span>Estimates <span class="sc">|&gt;</span></span>
<span id="cb247-10"><a href="application-level-k-models.html#cb247-10" tabindex="-1"></a>  <span class="fu">group_by</span>(id,parameter) <span class="sc">|&gt;</span></span>
<span id="cb247-11"><a href="application-level-k-models.html#cb247-11" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb247-12"><a href="application-level-k-models.html#cb247-12" tabindex="-1"></a>    <span class="at">postprob =</span> <span class="fu">exp</span>(logml<span class="sc">-</span><span class="fu">max</span>(logml))<span class="sc">/</span><span class="fu">sum</span>(<span class="fu">exp</span>(logml<span class="sc">-</span><span class="fu">max</span>(logml))),</span>
<span id="cb247-13"><a href="application-level-k-models.html#cb247-13" tabindex="-1"></a>    <span class="at">meantype =</span> <span class="fu">sum</span>(k<span class="sc">*</span>postprob),</span>
<span id="cb247-14"><a href="application-level-k-models.html#cb247-14" tabindex="-1"></a>    <span class="at">meanpar =</span> <span class="fu">sum</span>(mean<span class="sc">*</span>postprob)</span>
<span id="cb247-15"><a href="application-level-k-models.html#cb247-15" tabindex="-1"></a>  )</span>
<span id="cb247-16"><a href="application-level-k-models.html#cb247-16" tabindex="-1"></a></span>
<span id="cb247-17"><a href="application-level-k-models.html#cb247-17" tabindex="-1"></a>(</span>
<span id="cb247-18"><a href="application-level-k-models.html#cb247-18" tabindex="-1"></a>  <span class="fu">ggplot</span>(Estimates <span class="sc">|&gt;</span> <span class="fu">filter</span>(parameter<span class="sc">==</span><span class="st">&quot;probExact&quot;</span>),<span class="fu">aes</span>(<span class="at">x=</span>meantype,<span class="at">y=</span>meanpar))</span>
<span id="cb247-19"><a href="application-level-k-models.html#cb247-19" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_point</span>()</span>
<span id="cb247-20"><a href="application-level-k-models.html#cb247-20" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;Level-k type&quot;</span>)</span>
<span id="cb247-21"><a href="application-level-k-models.html#cb247-21" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Probability of choosing exactly accorindg to the model&quot;</span>)</span>
<span id="cb247-22"><a href="application-level-k-models.html#cb247-22" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb247-23"><a href="application-level-k-models.html#cb247-23" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:CGC2006individual"></span>
<img src="index_files/figure-html/CGC2006individual-1.png" alt="Bayesian model averages for the level-$k$ type (horizontal axis) and the probability of choosing exactly accorindg to the model (vertical axis)." width="672" />
<p class="caption">
Figure 20.3: Bayesian model averages for the level-<span class="math inline">\(k\)</span> type (horizontal axis) and the probability of choosing exactly accorindg to the model (vertical axis).
</p>
</div>
</div>
</div>
<div id="doing-the-averaging-within-one-program" class="section level2 hasAnchor" number="20.4">
<h2><span class="header-section-number">20.4</span> Doing the averaging within one program<a href="application-level-k-models.html#doing-the-averaging-within-one-program" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The previous section provided us with a rather tedious way of estimating <span class="math inline">\(k\)</span> for each participant: we estimated the model once for every <span class="math inline">\(k\)</span> under consideration, then averaged over these models. While there is nothing wrong with estimating <span class="math inline">\(k\)</span> this way, it is somewhat inefficient. To see this, note that we could have written down a model prior over the different values of <span class="math inline">\(k\)</span>, and then estimated <span class="math inline">\(\rho\)</span> and <span class="math inline">\(\lambda\)</span> assuming that <span class="math inline">\(k\)</span> is drawn from this prior. To keep things simple, I will stick with a discrete uniform prior over <span class="math inline">\(k\)</span>, so that each <span class="math inline">\(k\in\{1, 2, 3, 4, 5\}\)</span> has a 20% prior probability of being the true <span class="math inline">\(k\)</span>. Letting <span class="math inline">\(\{\psi_k\}_{k=1}^5\)</span> be these prior probabilities, we can write the likelihood contribution for a participant’s 16 decisions as:</p>
<p><span class="math display">\[
\begin{aligned}
\log p(y_t\mid \rho,\lambda)&amp;=\log\left(\sum_{k=1}^5\psi_k\prod_{t=1}^{16}p(y_t\mid \rho,\lambda,k)\right)\\
&amp;=\log\left(\sum_{k=1}^5\exp\left(\log \psi_k+\sum_{t=1}^{16}\log p(y_t\mid \rho,\lambda,k)\right)\right)
\end{aligned}
\]</span></p>
<p>This is enough information to estimate parameters <span class="math inline">\(\rho\)</span> and <span class="math inline">\(\lambda\)</span>, but what we really care about i <span class="math inline">\(k\)</span>. So how can we go about estimating this? What we first need to do is to take our prior over <span class="math inline">\(k\)</span>, and update it based on decisions, <span class="math inline">\(\rho\)</span>, and <span class="math inline">\(\lambda\)</span>. That is, using Bayes’ rule:</p>
<p><span class="math display">\[
\begin{aligned}
p(k\mid y,\rho,\lambda) &amp;=\frac{p(y\mid k,\rho,\lambda)p(k)}{p(y\mid \rho,\lambda)}\\
&amp;\propto p(y\mid k,\rho,\lambda)p(k)\\
\implies p(k\mid y,\rho,\lambda) &amp;=\frac{p(y\mid k,\rho,\lambda)p(k)}{\sum_{\kappa=1}^5p(y\mid \kappa,\rho,\lambda)p(\kappa)}
\end{aligned}
\]</span></p>
<p>Note that we can compute everything on the right-hand side once we have posterior draws of <span class="math inline">\(\rho\)</span> and <span class="math inline">\(\lambda\)</span>, so we can do this in the <code>generated quantities</code> block in <em>Stan</em>! The posterior means of these quantities will then be marginal posterior probabilities that we are after. That is, taking the expectation over <span class="math inline">\(\rho,\lambda\mid y\)</span>:</p>
<p><span class="math display">\[
E_{\rho,\lambda\mid y}\left[p(k\mid y,\rho,\lambda)\right] =p(k\mid y)
\]</span></p>
<p>Further inspection of the final expression for <span class="math inline">\(p(k\mid y,\rho,\lambda)\)</span> also reveals a useful similarity with our expression for the likelihood. In particular:</p>
<p><span class="math display">\[
\begin{aligned}
p(y\mid k,\rho,\lambda)p(k)&amp;=\exp(\log p(y\mid k,\rho,\lambda)+\log p(k))\\
&amp;=\exp(\log \psi_k+\log p(y\mid k,\rho,\lambda))\\
\implies p(k\mid y,\rho,\lambda)&amp;= \frac{\exp(\log \psi_k+\log p(y\mid k,\rho,\lambda))}{\sum_{\kappa=1}^5\exp(\log \psi_\kappa+\log p(y\mid \kappa,\rho,\lambda))}
\end{aligned}
\]</span></p>
<p>which is the <code>softmax</code> of the vector <span class="math inline">\(\{\log \psi_k+\log p(y\mid k,\rho,\lambda)\}_{k=1}^5\)</span>. All of this is to say, if we compute <span class="math inline">\(\log \psi_k+\log p(y\mid k,\rho,\lambda)\)</span> in the <code>transformed parameters</code> block, we can then use it in the <code>model</code> block to increment the likelihood, and again in the <code>generated quantities</code> block to compute these posterior probabilities.</p>
<p>Once we have an expression for <span class="math inline">\(p(k\mid y,\rho,\lambda)\)</span>, it is straightforward to estimate <span class="math inline">\(k\)</span> by taking the expectation in the <code>generated quantities</code> block. That is:</p>
<p><span class="math display">\[
E\left[k\mid  y,\rho,\lambda\right]=\sum_{k=1}^5k p(k\mid y,\rho,\lambda)
\]</span></p>
<p>And then the posterior mean of this will be the <em>marginal</em> posterior mean of <span class="math inline">\(k\)</span>, which is exactly what we are after:</p>
<p><span class="math display">\[
E[k\mid y]=E\left[E[k\mid  y,\rho,\lambda]\mid y\right]
\]</span></p>
<div id="the-stan-program-1" class="section level3 hasAnchor" number="20.4.1">
<h3><span class="header-section-number">20.4.1</span> The <em>Stan</em> program<a href="application-level-k-models.html#the-stan-program-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb248"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb248-1"><a href="application-level-k-models.html#cb248-1" tabindex="-1"></a>functions <span class="op">{</span></span>
<span id="cb248-2"><a href="application-level-k-models.html#cb248-2" tabindex="-1"></a>  </span>
<span id="cb248-3"><a href="application-level-k-models.html#cb248-3" tabindex="-1"></a>  vector payofffun<span class="op">(</span>vector x1<span class="op">,</span>row_vector x2<span class="op">,</span>real p1<span class="op">)</span> <span class="op">{</span></span>
<span id="cb248-4"><a href="application-level-k-models.html#cb248-4" tabindex="-1"></a>    </span>
<span id="cb248-5"><a href="application-level-k-models.html#cb248-5" tabindex="-1"></a>    <span class="co">/*</span></span>
<span id="cb248-6"><a href="application-level-k-models.html#cb248-6" tabindex="-1"></a><span class="co">    x1 is the action space of the first player</span></span>
<span id="cb248-7"><a href="application-level-k-models.html#cb248-7" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb248-8"><a href="application-level-k-models.html#cb248-8" tabindex="-1"></a><span class="co">    x2 is the distribution of actions of the second player. That is, for level 0 </span></span>
<span id="cb248-9"><a href="application-level-k-models.html#cb248-9" tabindex="-1"></a><span class="co">    player 2, it is the action space (which gets averaged over a uniform </span></span>
<span id="cb248-10"><a href="application-level-k-models.html#cb248-10" tabindex="-1"></a><span class="co">    distribution), and for level k&gt;0 is just populated by the prediction of this</span></span>
<span id="cb248-11"><a href="application-level-k-models.html#cb248-11" tabindex="-1"></a><span class="co">    type</span></span>
<span id="cb248-12"><a href="application-level-k-models.html#cb248-12" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb248-13"><a href="application-level-k-models.html#cb248-13" tabindex="-1"></a>    </span>
<span id="cb248-14"><a href="application-level-k-models.html#cb248-14" tabindex="-1"></a>    <span class="dt">int</span> n1 <span class="op">=</span> size<span class="op">(</span>x1<span class="op">);</span></span>
<span id="cb248-15"><a href="application-level-k-models.html#cb248-15" tabindex="-1"></a>    <span class="dt">int</span> n2 <span class="op">=</span> size<span class="op">(</span>x2<span class="op">);</span></span>
<span id="cb248-16"><a href="application-level-k-models.html#cb248-16" tabindex="-1"></a>    </span>
<span id="cb248-17"><a href="application-level-k-models.html#cb248-17" tabindex="-1"></a>    matrix<span class="op">[</span>n1<span class="op">,</span>n2<span class="op">]</span> err <span class="op">=</span> fabs<span class="op">(</span>rep_matrix<span class="op">(</span>x1<span class="op">,</span>n2<span class="op">)-</span>p1<span class="op">*</span>rep_matrix<span class="op">(</span>x2<span class="op">,</span>n1<span class="op">));</span></span>
<span id="cb248-18"><a href="application-level-k-models.html#cb248-18" tabindex="-1"></a>    </span>
<span id="cb248-19"><a href="application-level-k-models.html#cb248-19" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> pay <span class="op">=</span> <span class="op">(</span>fmax<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span><span class="dv">200</span><span class="op">-</span>err<span class="op">*</span><span class="dv">10</span><span class="op">)+</span>fmax<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span><span class="dv">100</span><span class="op">-</span>err<span class="op">))*</span>rep_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">/</span>n1<span class="op">,</span>n2<span class="op">);</span></span>
<span id="cb248-20"><a href="application-level-k-models.html#cb248-20" tabindex="-1"></a>    </span>
<span id="cb248-21"><a href="application-level-k-models.html#cb248-21" tabindex="-1"></a>    <span class="cf">return</span> pay<span class="op">;</span></span>
<span id="cb248-22"><a href="application-level-k-models.html#cb248-22" tabindex="-1"></a>    </span>
<span id="cb248-23"><a href="application-level-k-models.html#cb248-23" tabindex="-1"></a>    </span>
<span id="cb248-24"><a href="application-level-k-models.html#cb248-24" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb248-25"><a href="application-level-k-models.html#cb248-25" tabindex="-1"></a>  </span>
<span id="cb248-26"><a href="application-level-k-models.html#cb248-26" tabindex="-1"></a>  <span class="dt">int</span> which_max<span class="op">(</span>vector x<span class="op">,</span>real tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb248-27"><a href="application-level-k-models.html#cb248-27" tabindex="-1"></a>    </span>
<span id="cb248-28"><a href="application-level-k-models.html#cb248-28" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> size<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb248-29"><a href="application-level-k-models.html#cb248-29" tabindex="-1"></a>    </span>
<span id="cb248-30"><a href="application-level-k-models.html#cb248-30" tabindex="-1"></a>    <span class="dt">int</span> ind <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb248-31"><a href="application-level-k-models.html#cb248-31" tabindex="-1"></a>    </span>
<span id="cb248-32"><a href="application-level-k-models.html#cb248-32" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb248-33"><a href="application-level-k-models.html#cb248-33" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>abs<span class="op">(</span>x<span class="op">[</span>ii<span class="op">]-</span>max<span class="op">(</span>x<span class="op">))&lt;</span>tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb248-34"><a href="application-level-k-models.html#cb248-34" tabindex="-1"></a>        ind <span class="op">=</span> ii<span class="op">;</span></span>
<span id="cb248-35"><a href="application-level-k-models.html#cb248-35" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb248-36"><a href="application-level-k-models.html#cb248-36" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb248-37"><a href="application-level-k-models.html#cb248-37" tabindex="-1"></a>    </span>
<span id="cb248-38"><a href="application-level-k-models.html#cb248-38" tabindex="-1"></a>    <span class="cf">return</span> ind<span class="op">;</span></span>
<span id="cb248-39"><a href="application-level-k-models.html#cb248-39" tabindex="-1"></a>    </span>
<span id="cb248-40"><a href="application-level-k-models.html#cb248-40" tabindex="-1"></a>    </span>
<span id="cb248-41"><a href="application-level-k-models.html#cb248-41" tabindex="-1"></a>    </span>
<span id="cb248-42"><a href="application-level-k-models.html#cb248-42" tabindex="-1"></a>    </span>
<span id="cb248-43"><a href="application-level-k-models.html#cb248-43" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb248-44"><a href="application-level-k-models.html#cb248-44" tabindex="-1"></a>  </span>
<span id="cb248-45"><a href="application-level-k-models.html#cb248-45" tabindex="-1"></a>  </span>
<span id="cb248-46"><a href="application-level-k-models.html#cb248-46" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb248-47"><a href="application-level-k-models.html#cb248-47" tabindex="-1"></a></span>
<span id="cb248-48"><a href="application-level-k-models.html#cb248-48" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb248-49"><a href="application-level-k-models.html#cb248-49" tabindex="-1"></a>  </span>
<span id="cb248-50"><a href="application-level-k-models.html#cb248-50" tabindex="-1"></a>  <span class="dt">int</span> ngames<span class="op">;</span> <span class="co">// number of games</span></span>
<span id="cb248-51"><a href="application-level-k-models.html#cb248-51" tabindex="-1"></a>  </span>
<span id="cb248-52"><a href="application-level-k-models.html#cb248-52" tabindex="-1"></a>  <span class="dt">int</span> kmax<span class="op">;</span> <span class="co">// max level-k to evaluate</span></span>
<span id="cb248-53"><a href="application-level-k-models.html#cb248-53" tabindex="-1"></a>  </span>
<span id="cb248-54"><a href="application-level-k-models.html#cb248-54" tabindex="-1"></a>  <span class="co">// game data</span></span>
<span id="cb248-55"><a href="application-level-k-models.html#cb248-55" tabindex="-1"></a>  vector<span class="op">[</span>ngames<span class="op">]</span> P1<span class="op">;</span></span>
<span id="cb248-56"><a href="application-level-k-models.html#cb248-56" tabindex="-1"></a>  vector<span class="op">[</span>ngames<span class="op">]</span> P2<span class="op">;</span></span>
<span id="cb248-57"><a href="application-level-k-models.html#cb248-57" tabindex="-1"></a>  <span class="dt">int</span> LB1<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb248-58"><a href="application-level-k-models.html#cb248-58" tabindex="-1"></a>  <span class="dt">int</span> UB1<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb248-59"><a href="application-level-k-models.html#cb248-59" tabindex="-1"></a>  <span class="dt">int</span> LB2<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb248-60"><a href="application-level-k-models.html#cb248-60" tabindex="-1"></a>  <span class="dt">int</span> UB2<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb248-61"><a href="application-level-k-models.html#cb248-61" tabindex="-1"></a>  </span>
<span id="cb248-62"><a href="application-level-k-models.html#cb248-62" tabindex="-1"></a>  <span class="co">// player 1 choice</span></span>
<span id="cb248-63"><a href="application-level-k-models.html#cb248-63" tabindex="-1"></a>  <span class="dt">int</span> choice1<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb248-64"><a href="application-level-k-models.html#cb248-64" tabindex="-1"></a>  </span>
<span id="cb248-65"><a href="application-level-k-models.html#cb248-65" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> prior_probExact<span class="op">[</span><span class="dv">2</span><span class="op">];</span> <span class="co">// Beta prior</span></span>
<span id="cb248-66"><a href="application-level-k-models.html#cb248-66" tabindex="-1"></a>  real prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">];</span> <span class="co">// lognormal prior </span></span>
<span id="cb248-67"><a href="application-level-k-models.html#cb248-67" tabindex="-1"></a>  vector<span class="op">[</span>kmax<span class="op">]</span> prior_k<span class="op">;</span> <span class="co">// categorical prior</span></span>
<span id="cb248-68"><a href="application-level-k-models.html#cb248-68" tabindex="-1"></a>  </span>
<span id="cb248-69"><a href="application-level-k-models.html#cb248-69" tabindex="-1"></a>  <span class="co">// tolerance for identifying a maximum in function which_max(,)</span></span>
<span id="cb248-70"><a href="application-level-k-models.html#cb248-70" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> tol<span class="op">;</span></span>
<span id="cb248-71"><a href="application-level-k-models.html#cb248-71" tabindex="-1"></a>  </span>
<span id="cb248-72"><a href="application-level-k-models.html#cb248-72" tabindex="-1"></a>  </span>
<span id="cb248-73"><a href="application-level-k-models.html#cb248-73" tabindex="-1"></a>  </span>
<span id="cb248-74"><a href="application-level-k-models.html#cb248-74" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb248-75"><a href="application-level-k-models.html#cb248-75" tabindex="-1"></a></span>
<span id="cb248-76"><a href="application-level-k-models.html#cb248-76" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb248-77"><a href="application-level-k-models.html#cb248-77" tabindex="-1"></a>  </span>
<span id="cb248-78"><a href="application-level-k-models.html#cb248-78" tabindex="-1"></a>  <span class="dt">int</span> choice1_i<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb248-79"><a href="application-level-k-models.html#cb248-79" tabindex="-1"></a>  </span>
<span id="cb248-80"><a href="application-level-k-models.html#cb248-80" tabindex="-1"></a>  <span class="co">// pre-compute level-k predictions</span></span>
<span id="cb248-81"><a href="application-level-k-models.html#cb248-81" tabindex="-1"></a>  </span>
<span id="cb248-82"><a href="application-level-k-models.html#cb248-82" tabindex="-1"></a>  vector<span class="op">[</span>kmax<span class="op">]</span> LKpredictions1<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb248-83"><a href="application-level-k-models.html#cb248-83" tabindex="-1"></a>  vector<span class="op">[</span>kmax<span class="op">]</span> LKpredictions2<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb248-84"><a href="application-level-k-models.html#cb248-84" tabindex="-1"></a>  </span>
<span id="cb248-85"><a href="application-level-k-models.html#cb248-85" tabindex="-1"></a>  </span>
<span id="cb248-86"><a href="application-level-k-models.html#cb248-86" tabindex="-1"></a>  </span>
<span id="cb248-87"><a href="application-level-k-models.html#cb248-87" tabindex="-1"></a>  </span>
<span id="cb248-88"><a href="application-level-k-models.html#cb248-88" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>gg in <span class="dv">1</span><span class="op">:</span>ngames<span class="op">)</span> <span class="op">{</span></span>
<span id="cb248-89"><a href="application-level-k-models.html#cb248-89" tabindex="-1"></a>    real p1 <span class="op">=</span> P1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb248-90"><a href="application-level-k-models.html#cb248-90" tabindex="-1"></a>    real p2 <span class="op">=</span> P2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb248-91"><a href="application-level-k-models.html#cb248-91" tabindex="-1"></a>    <span class="dt">int</span> lb1 <span class="op">=</span> LB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb248-92"><a href="application-level-k-models.html#cb248-92" tabindex="-1"></a>    <span class="dt">int</span> ub1 <span class="op">=</span> UB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb248-93"><a href="application-level-k-models.html#cb248-93" tabindex="-1"></a>    <span class="dt">int</span> lb2 <span class="op">=</span> LB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb248-94"><a href="application-level-k-models.html#cb248-94" tabindex="-1"></a>    <span class="dt">int</span> ub2 <span class="op">=</span> UB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb248-95"><a href="application-level-k-models.html#cb248-95" tabindex="-1"></a>    </span>
<span id="cb248-96"><a href="application-level-k-models.html#cb248-96" tabindex="-1"></a>    <span class="dt">int</span> n1 <span class="op">=</span> ub1<span class="op">-</span>lb1<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb248-97"><a href="application-level-k-models.html#cb248-97" tabindex="-1"></a>    <span class="dt">int</span> n2 <span class="op">=</span> ub2<span class="op">-</span>lb2<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb248-98"><a href="application-level-k-models.html#cb248-98" tabindex="-1"></a>    </span>
<span id="cb248-99"><a href="application-level-k-models.html#cb248-99" tabindex="-1"></a>    choice1_i<span class="op">[</span>gg<span class="op">]</span> <span class="op">=</span> choice1<span class="op">[</span>gg<span class="op">]-</span>lb1<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb248-100"><a href="application-level-k-models.html#cb248-100" tabindex="-1"></a>    </span>
<span id="cb248-101"><a href="application-level-k-models.html#cb248-101" tabindex="-1"></a>    <span class="co">// choice sets</span></span>
<span id="cb248-102"><a href="application-level-k-models.html#cb248-102" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> X1 <span class="op">=</span> linspaced_vector<span class="op">(</span>n1<span class="op">,</span>lb1<span class="op">,</span>ub1<span class="op">);</span></span>
<span id="cb248-103"><a href="application-level-k-models.html#cb248-103" tabindex="-1"></a>    row_vector<span class="op">[</span>n2<span class="op">]</span> X2 <span class="op">=</span> linspaced_row_vector<span class="op">(</span>n2<span class="op">,</span>lb2<span class="op">,</span>ub2<span class="op">);</span></span>
<span id="cb248-104"><a href="application-level-k-models.html#cb248-104" tabindex="-1"></a>    </span>
<span id="cb248-105"><a href="application-level-k-models.html#cb248-105" tabindex="-1"></a>    <span class="co">// choices to get uniform distribution over actions</span></span>
<span id="cb248-106"><a href="application-level-k-models.html#cb248-106" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> x1 <span class="op">=</span> linspaced_vector<span class="op">(</span>n1<span class="op">,</span>lb1<span class="op">,</span>ub1<span class="op">);</span></span>
<span id="cb248-107"><a href="application-level-k-models.html#cb248-107" tabindex="-1"></a>    row_vector<span class="op">[</span>n2<span class="op">]</span> x2 <span class="op">=</span> linspaced_row_vector<span class="op">(</span>n2<span class="op">,</span>lb2<span class="op">,</span>ub2<span class="op">);</span></span>
<span id="cb248-108"><a href="application-level-k-models.html#cb248-108" tabindex="-1"></a>    </span>
<span id="cb248-109"><a href="application-level-k-models.html#cb248-109" tabindex="-1"></a>    </span>
<span id="cb248-110"><a href="application-level-k-models.html#cb248-110" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>kk in <span class="dv">1</span><span class="op">:</span>kmax<span class="op">)</span> <span class="op">{</span></span>
<span id="cb248-111"><a href="application-level-k-models.html#cb248-111" tabindex="-1"></a>      </span>
<span id="cb248-112"><a href="application-level-k-models.html#cb248-112" tabindex="-1"></a>      vector<span class="op">[</span>n1<span class="op">]</span> payoff1 <span class="op">=</span> payofffun<span class="op">(</span>X1<span class="op">,</span>x2<span class="op">,</span>p1<span class="op">);</span></span>
<span id="cb248-113"><a href="application-level-k-models.html#cb248-113" tabindex="-1"></a>      vector<span class="op">[</span>n2<span class="op">]</span> payoff2 <span class="op">=</span> payofffun<span class="op">(</span>X2<span class="ch">&#39;,</span><span class="er">x1</span><span class="ch">&#39;</span><span class="op">,</span>p2<span class="op">);</span></span>
<span id="cb248-114"><a href="application-level-k-models.html#cb248-114" tabindex="-1"></a>      </span>
<span id="cb248-115"><a href="application-level-k-models.html#cb248-115" tabindex="-1"></a>      x1 <span class="op">=</span> rep_vector<span class="op">(</span>X1<span class="op">[</span>which_max<span class="op">(</span>payoff1<span class="op">,</span>tol<span class="op">)],</span>n1<span class="op">);</span></span>
<span id="cb248-116"><a href="application-level-k-models.html#cb248-116" tabindex="-1"></a>      x2 <span class="op">=</span> rep_row_vector<span class="op">(</span>X2<span class="op">[</span>which_max<span class="op">(</span>payoff2<span class="op">,</span>tol<span class="op">)],</span>n2<span class="op">);</span></span>
<span id="cb248-117"><a href="application-level-k-models.html#cb248-117" tabindex="-1"></a>      </span>
<span id="cb248-118"><a href="application-level-k-models.html#cb248-118" tabindex="-1"></a>      LKpredictions1<span class="op">[</span>gg<span class="op">][</span>kk<span class="op">]</span> <span class="op">=</span> X1<span class="op">[</span>which_max<span class="op">(</span>payoff1<span class="op">,</span>tol<span class="op">)];</span></span>
<span id="cb248-119"><a href="application-level-k-models.html#cb248-119" tabindex="-1"></a>      LKpredictions2<span class="op">[</span>gg<span class="op">][</span>kk<span class="op">]</span> <span class="op">=</span> X2<span class="op">[</span>which_max<span class="op">(</span>payoff2<span class="op">,</span>tol<span class="op">)];</span></span>
<span id="cb248-120"><a href="application-level-k-models.html#cb248-120" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb248-121"><a href="application-level-k-models.html#cb248-121" tabindex="-1"></a>    </span>
<span id="cb248-122"><a href="application-level-k-models.html#cb248-122" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb248-123"><a href="application-level-k-models.html#cb248-123" tabindex="-1"></a>  </span>
<span id="cb248-124"><a href="application-level-k-models.html#cb248-124" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb248-125"><a href="application-level-k-models.html#cb248-125" tabindex="-1"></a></span>
<span id="cb248-126"><a href="application-level-k-models.html#cb248-126" tabindex="-1"></a></span>
<span id="cb248-127"><a href="application-level-k-models.html#cb248-127" tabindex="-1"></a></span>
<span id="cb248-128"><a href="application-level-k-models.html#cb248-128" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb248-129"><a href="application-level-k-models.html#cb248-129" tabindex="-1"></a>  </span>
<span id="cb248-130"><a href="application-level-k-models.html#cb248-130" tabindex="-1"></a>  <span class="co">// probability the player chooses exactly according to the level-k model</span></span>
<span id="cb248-131"><a href="application-level-k-models.html#cb248-131" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">,</span>upper<span class="op">=</span><span class="dv">1</span><span class="op">&gt;</span> probExact<span class="op">;</span></span>
<span id="cb248-132"><a href="application-level-k-models.html#cb248-132" tabindex="-1"></a>  <span class="co">// logit choice precision for the rest of the choices</span></span>
<span id="cb248-133"><a href="application-level-k-models.html#cb248-133" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> lambda<span class="op">;</span></span>
<span id="cb248-134"><a href="application-level-k-models.html#cb248-134" tabindex="-1"></a>  </span>
<span id="cb248-135"><a href="application-level-k-models.html#cb248-135" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb248-136"><a href="application-level-k-models.html#cb248-136" tabindex="-1"></a></span>
<span id="cb248-137"><a href="application-level-k-models.html#cb248-137" tabindex="-1"></a>transformed parameters <span class="op">{</span></span>
<span id="cb248-138"><a href="application-level-k-models.html#cb248-138" tabindex="-1"></a>  </span>
<span id="cb248-139"><a href="application-level-k-models.html#cb248-139" tabindex="-1"></a>  </span>
<span id="cb248-140"><a href="application-level-k-models.html#cb248-140" tabindex="-1"></a>  vector<span class="op">[</span>kmax<span class="op">]</span> like_levelk <span class="op">=</span> log<span class="op">(</span>prior_k<span class="op">);</span></span>
<span id="cb248-141"><a href="application-level-k-models.html#cb248-141" tabindex="-1"></a>  </span>
<span id="cb248-142"><a href="application-level-k-models.html#cb248-142" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>gg in <span class="dv">1</span><span class="op">:</span>ngames<span class="op">)</span> <span class="op">{</span></span>
<span id="cb248-143"><a href="application-level-k-models.html#cb248-143" tabindex="-1"></a>    real p1 <span class="op">=</span> P1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb248-144"><a href="application-level-k-models.html#cb248-144" tabindex="-1"></a>    real p2 <span class="op">=</span> P2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb248-145"><a href="application-level-k-models.html#cb248-145" tabindex="-1"></a>    <span class="dt">int</span> lb1 <span class="op">=</span> LB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb248-146"><a href="application-level-k-models.html#cb248-146" tabindex="-1"></a>    <span class="dt">int</span> ub1 <span class="op">=</span> UB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb248-147"><a href="application-level-k-models.html#cb248-147" tabindex="-1"></a>    <span class="dt">int</span> lb2 <span class="op">=</span> LB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb248-148"><a href="application-level-k-models.html#cb248-148" tabindex="-1"></a>    <span class="dt">int</span> ub2 <span class="op">=</span> UB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb248-149"><a href="application-level-k-models.html#cb248-149" tabindex="-1"></a>    </span>
<span id="cb248-150"><a href="application-level-k-models.html#cb248-150" tabindex="-1"></a>    <span class="dt">int</span> n1 <span class="op">=</span> ub1<span class="op">-</span>lb1<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb248-151"><a href="application-level-k-models.html#cb248-151" tabindex="-1"></a>    <span class="dt">int</span> n2 <span class="op">=</span> ub2<span class="op">-</span>lb2<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb248-152"><a href="application-level-k-models.html#cb248-152" tabindex="-1"></a>    </span>
<span id="cb248-153"><a href="application-level-k-models.html#cb248-153" tabindex="-1"></a>    <span class="co">// choice sets for Player 1</span></span>
<span id="cb248-154"><a href="application-level-k-models.html#cb248-154" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> X1 <span class="op">=</span> linspaced_vector<span class="op">(</span>n1<span class="op">,</span>lb1<span class="op">,</span>ub1<span class="op">);</span></span>
<span id="cb248-155"><a href="application-level-k-models.html#cb248-155" tabindex="-1"></a>    </span>
<span id="cb248-156"><a href="application-level-k-models.html#cb248-156" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>kk in <span class="dv">1</span><span class="op">:</span>kmax<span class="op">)</span> <span class="op">{</span></span>
<span id="cb248-157"><a href="application-level-k-models.html#cb248-157" tabindex="-1"></a>    </span>
<span id="cb248-158"><a href="application-level-k-models.html#cb248-158" tabindex="-1"></a>      row_vector<span class="op">[</span>n2<span class="op">]</span> x2<span class="op">;</span></span>
<span id="cb248-159"><a href="application-level-k-models.html#cb248-159" tabindex="-1"></a>    </span>
<span id="cb248-160"><a href="application-level-k-models.html#cb248-160" tabindex="-1"></a>      <span class="co">// action of Player 2</span></span>
<span id="cb248-161"><a href="application-level-k-models.html#cb248-161" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>kk<span class="op">==</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb248-162"><a href="application-level-k-models.html#cb248-162" tabindex="-1"></a>        x2 <span class="op">=</span> linspaced_vector<span class="op">(</span>n2<span class="op">,</span>lb2<span class="op">,</span>ub2<span class="op">)</span><span class="ch">&#39;;</span></span>
<span id="cb248-163"><a href="application-level-k-models.html#cb248-163" tabindex="-1"></a>      <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb248-164"><a href="application-level-k-models.html#cb248-164" tabindex="-1"></a>        x2 <span class="op">=</span> rep_row_vector<span class="op">(</span>LKpredictions2<span class="op">[</span>gg<span class="op">][</span>kk<span class="op">-</span><span class="dv">1</span><span class="op">],</span>n2<span class="op">);</span></span>
<span id="cb248-165"><a href="application-level-k-models.html#cb248-165" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb248-166"><a href="application-level-k-models.html#cb248-166" tabindex="-1"></a>    </span>
<span id="cb248-167"><a href="application-level-k-models.html#cb248-167" tabindex="-1"></a>      vector<span class="op">[</span>n1<span class="op">]</span> payoff1 <span class="op">=</span> payofffun<span class="op">(</span>X1<span class="op">,</span>x2<span class="op">,</span>p1<span class="op">);</span></span>
<span id="cb248-168"><a href="application-level-k-models.html#cb248-168" tabindex="-1"></a>    </span>
<span id="cb248-169"><a href="application-level-k-models.html#cb248-169" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>choice1<span class="op">[</span>gg<span class="op">]==</span>LKpredictions1<span class="op">[</span>gg<span class="op">][</span>kk<span class="op">])</span> <span class="op">{</span></span>
<span id="cb248-170"><a href="application-level-k-models.html#cb248-170" tabindex="-1"></a>      <span class="co">// If the choice matches exactly with the prediction, then ...</span></span>
<span id="cb248-171"><a href="application-level-k-models.html#cb248-171" tabindex="-1"></a>      like_levelk<span class="op">[</span>kk<span class="op">]</span> <span class="op">+=</span> log<span class="op">(</span></span>
<span id="cb248-172"><a href="application-level-k-models.html#cb248-172" tabindex="-1"></a>         probExact</span>
<span id="cb248-173"><a href="application-level-k-models.html#cb248-173" tabindex="-1"></a>          <span class="op">+(</span><span class="fl">1.0</span><span class="op">-</span>probExact<span class="op">)*</span>softmax<span class="op">(</span>lambda<span class="op">*</span>payoff1<span class="op">)[</span>choice1_i<span class="op">[</span>gg<span class="op">]]</span></span>
<span id="cb248-174"><a href="application-level-k-models.html#cb248-174" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb248-175"><a href="application-level-k-models.html#cb248-175" tabindex="-1"></a>        </span>
<span id="cb248-176"><a href="application-level-k-models.html#cb248-176" tabindex="-1"></a>      <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb248-177"><a href="application-level-k-models.html#cb248-177" tabindex="-1"></a>        <span class="co">// if the choice does not match exactly with the prediction, then ...</span></span>
<span id="cb248-178"><a href="application-level-k-models.html#cb248-178" tabindex="-1"></a>        like_levelk<span class="op">[</span>kk<span class="op">]</span> <span class="op">+=</span> log<span class="op">(</span></span>
<span id="cb248-179"><a href="application-level-k-models.html#cb248-179" tabindex="-1"></a>         <span class="op">(</span><span class="fl">1.0</span><span class="op">-</span>probExact<span class="op">)*</span>softmax<span class="op">(</span>lambda<span class="op">*</span>payoff1<span class="op">)[</span>choice1_i<span class="op">[</span>gg<span class="op">]]</span></span>
<span id="cb248-180"><a href="application-level-k-models.html#cb248-180" tabindex="-1"></a>        <span class="op">);</span></span>
<span id="cb248-181"><a href="application-level-k-models.html#cb248-181" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb248-182"><a href="application-level-k-models.html#cb248-182" tabindex="-1"></a>    </span>
<span id="cb248-183"><a href="application-level-k-models.html#cb248-183" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb248-184"><a href="application-level-k-models.html#cb248-184" tabindex="-1"></a>    </span>
<span id="cb248-185"><a href="application-level-k-models.html#cb248-185" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb248-186"><a href="application-level-k-models.html#cb248-186" tabindex="-1"></a>  </span>
<span id="cb248-187"><a href="application-level-k-models.html#cb248-187" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb248-188"><a href="application-level-k-models.html#cb248-188" tabindex="-1"></a></span>
<span id="cb248-189"><a href="application-level-k-models.html#cb248-189" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb248-190"><a href="application-level-k-models.html#cb248-190" tabindex="-1"></a>  </span>
<span id="cb248-191"><a href="application-level-k-models.html#cb248-191" tabindex="-1"></a>  </span>
<span id="cb248-192"><a href="application-level-k-models.html#cb248-192" tabindex="-1"></a>  <span class="co">// likelihood</span></span>
<span id="cb248-193"><a href="application-level-k-models.html#cb248-193" tabindex="-1"></a>  </span>
<span id="cb248-194"><a href="application-level-k-models.html#cb248-194" tabindex="-1"></a>  target <span class="op">+=</span> log_sum_exp<span class="op">(</span>like_levelk<span class="op">);</span></span>
<span id="cb248-195"><a href="application-level-k-models.html#cb248-195" tabindex="-1"></a>  </span>
<span id="cb248-196"><a href="application-level-k-models.html#cb248-196" tabindex="-1"></a>  </span>
<span id="cb248-197"><a href="application-level-k-models.html#cb248-197" tabindex="-1"></a>  <span class="co">// priors </span></span>
<span id="cb248-198"><a href="application-level-k-models.html#cb248-198" tabindex="-1"></a>  target <span class="op">+=</span> beta_lpdf<span class="op">(</span>probExact <span class="op">|</span> prior_probExact<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_probExact<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb248-199"><a href="application-level-k-models.html#cb248-199" tabindex="-1"></a>  target <span class="op">+=</span> lognormal_lpdf<span class="op">(</span>lambda <span class="op">|</span> prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb248-200"><a href="application-level-k-models.html#cb248-200" tabindex="-1"></a>  </span>
<span id="cb248-201"><a href="application-level-k-models.html#cb248-201" tabindex="-1"></a>  </span>
<span id="cb248-202"><a href="application-level-k-models.html#cb248-202" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb248-203"><a href="application-level-k-models.html#cb248-203" tabindex="-1"></a></span>
<span id="cb248-204"><a href="application-level-k-models.html#cb248-204" tabindex="-1"></a>generated quantities <span class="op">{</span></span>
<span id="cb248-205"><a href="application-level-k-models.html#cb248-205" tabindex="-1"></a>  </span>
<span id="cb248-206"><a href="application-level-k-models.html#cb248-206" tabindex="-1"></a>  vector<span class="op">[</span>kmax<span class="op">]</span> postprob <span class="op">=</span> softmax<span class="op">(</span>like_levelk<span class="op">);</span></span>
<span id="cb248-207"><a href="application-level-k-models.html#cb248-207" tabindex="-1"></a>  </span>
<span id="cb248-208"><a href="application-level-k-models.html#cb248-208" tabindex="-1"></a>  real postk <span class="op">=</span> postprob<span class="ch">&#39;*</span><span class="er">linspaced_vector(kmax,1,kmax);</span></span>
<span id="cb248-209"><a href="application-level-k-models.html#cb248-209" tabindex="-1"></a>  </span>
<span id="cb248-210"><a href="application-level-k-models.html#cb248-210" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<div id="results-8" class="section level3 hasAnchor" number="20.4.2">
<h3><span class="header-section-number">20.4.2</span> Results<a href="application-level-k-models.html#results-8" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="application-level-k-models.html#cb249-1" tabindex="-1"></a>BMA<span class="ot">&lt;-</span><span class="st">&quot;Code/CGC2006/EstimatesLevelkBMA.rds&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb249-2"><a href="application-level-k-models.html#cb249-2" tabindex="-1"></a>  <span class="fu">readRDS</span>() <span class="sc">|&gt;</span></span>
<span id="cb249-3"><a href="application-level-k-models.html#cb249-3" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb249-4"><a href="application-level-k-models.html#cb249-4" tabindex="-1"></a>    parameter<span class="sc">==</span><span class="st">&quot;probExact&quot;</span></span>
<span id="cb249-5"><a href="application-level-k-models.html#cb249-5" tabindex="-1"></a>    <span class="sc">|</span> parameter <span class="sc">==</span> <span class="st">&quot;lambda&quot;</span></span>
<span id="cb249-6"><a href="application-level-k-models.html#cb249-6" tabindex="-1"></a>    <span class="sc">|</span> parameter <span class="sc">==</span> <span class="st">&quot;postk&quot;</span></span>
<span id="cb249-7"><a href="application-level-k-models.html#cb249-7" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb249-8"><a href="application-level-k-models.html#cb249-8" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb249-9"><a href="application-level-k-models.html#cb249-9" tabindex="-1"></a>    <span class="at">id_cols=</span>id,</span>
<span id="cb249-10"><a href="application-level-k-models.html#cb249-10" tabindex="-1"></a>    <span class="at">names_from =</span> parameter,</span>
<span id="cb249-11"><a href="application-level-k-models.html#cb249-11" tabindex="-1"></a>    <span class="at">values_from =</span> mean</span>
<span id="cb249-12"><a href="application-level-k-models.html#cb249-12" tabindex="-1"></a>  )</span>
<span id="cb249-13"><a href="application-level-k-models.html#cb249-13" tabindex="-1"></a></span>
<span id="cb249-14"><a href="application-level-k-models.html#cb249-14" tabindex="-1"></a>(</span>
<span id="cb249-15"><a href="application-level-k-models.html#cb249-15" tabindex="-1"></a>  <span class="fu">ggplot</span>(BMA,<span class="fu">aes</span>(<span class="at">x=</span>postk,<span class="at">y=</span>probExact,<span class="at">color =</span> <span class="fu">log</span>(lambda)))</span>
<span id="cb249-16"><a href="application-level-k-models.html#cb249-16" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_point</span>()</span>
<span id="cb249-17"><a href="application-level-k-models.html#cb249-17" tabindex="-1"></a>    <span class="sc">+</span><span class="fu">labs</span>(<span class="at">color=</span><span class="fu">expression</span>(<span class="st">&quot;log(&quot;</span><span class="sc">~</span>lambda<span class="sc">~</span><span class="st">&quot;)&quot;</span>))</span>
<span id="cb249-18"><a href="application-level-k-models.html#cb249-18" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb249-19"><a href="application-level-k-models.html#cb249-19" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">scale_color_viridis</span>()</span>
<span id="cb249-20"><a href="application-level-k-models.html#cb249-20" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;k&quot;</span>)</span>
<span id="cb249-21"><a href="application-level-k-models.html#cb249-21" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="fu">expression</span>(rho))</span>
<span id="cb249-22"><a href="application-level-k-models.html#cb249-22" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:CGC2006MBA"></span>
<img src="index_files/figure-html/CGC2006MBA-1.png" alt="Individual-level estimates from the model assuming a discrete uniform prior over $k$. " width="672" />
<p class="caption">
Figure 20.4: Individual-level estimates from the model assuming a discrete uniform prior over <span class="math inline">\(k\)</span>.
</p>
</div>
</div>
</div>
<div id="a-mixture-model" class="section level2 hasAnchor" number="20.5">
<h2><span class="header-section-number">20.5</span> A mixture model<a href="application-level-k-models.html#a-mixture-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A natural extension of the participant-specific models estimated in the previous section is to use data from all participants to estimate the fraction of participants who behave according to each type. That is, the <span class="math inline">\(\psi_k\)</span>s in the previous section are now <em>parameters</em>, rather than a <em>prior</em>, and we instead assign a prior to these new parameters. The nice product we get from this is that instead of using our flat (discrete uniform) prior over <span class="math inline">\(k\)</span> to get our estimate of <span class="math inline">\(k\)</span> for each participant, we now are using all of the data to get a better idea of what the fraction of types actually are in the population. Hence, if there are a lot of level-1 types in the data (which it turns out there are), then this will be reflected in our estimates of <span class="math inline">\(\psi\)</span>, and then be carried forward to our estimate of <span class="math inline">\(E[k_i\mid y_i]\)</span>.</p>
<div id="stan-program" class="section level3 hasAnchor" number="20.5.1">
<h3><span class="header-section-number">20.5.1</span> <em>Stan</em> program<a href="application-level-k-models.html#stan-program" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Extending the one-participant program to this one was not too difficult, but it certainly helped to have started there! The trick here was to keep track of the individual likelihoods “<code>like_choices</code>” in the <code>transformed data</code> block so that I could use them in the <code>model</code> block for incrementing the likelihood, and the <code>generated quantities</code> block for the posterior type probabilities.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb250-1"><a href="application-level-k-models.html#cb250-1" tabindex="-1"></a>functions <span class="op">{</span></span>
<span id="cb250-2"><a href="application-level-k-models.html#cb250-2" tabindex="-1"></a>  </span>
<span id="cb250-3"><a href="application-level-k-models.html#cb250-3" tabindex="-1"></a>  vector payofffun<span class="op">(</span>vector x1<span class="op">,</span>row_vector x2<span class="op">,</span>real p1<span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-4"><a href="application-level-k-models.html#cb250-4" tabindex="-1"></a>    </span>
<span id="cb250-5"><a href="application-level-k-models.html#cb250-5" tabindex="-1"></a>    <span class="co">/*</span></span>
<span id="cb250-6"><a href="application-level-k-models.html#cb250-6" tabindex="-1"></a><span class="co">    x1 is the action space of the first player</span></span>
<span id="cb250-7"><a href="application-level-k-models.html#cb250-7" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb250-8"><a href="application-level-k-models.html#cb250-8" tabindex="-1"></a><span class="co">    x2 is the distribution of actions of the second player. That is, for level 0 </span></span>
<span id="cb250-9"><a href="application-level-k-models.html#cb250-9" tabindex="-1"></a><span class="co">    player 2, it is the action space (which gets averaged over a uniform </span></span>
<span id="cb250-10"><a href="application-level-k-models.html#cb250-10" tabindex="-1"></a><span class="co">    distribution), and for level k&gt;0 is just populated by the prediction of this</span></span>
<span id="cb250-11"><a href="application-level-k-models.html#cb250-11" tabindex="-1"></a><span class="co">    type</span></span>
<span id="cb250-12"><a href="application-level-k-models.html#cb250-12" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb250-13"><a href="application-level-k-models.html#cb250-13" tabindex="-1"></a>    </span>
<span id="cb250-14"><a href="application-level-k-models.html#cb250-14" tabindex="-1"></a>    <span class="dt">int</span> n1 <span class="op">=</span> size<span class="op">(</span>x1<span class="op">);</span></span>
<span id="cb250-15"><a href="application-level-k-models.html#cb250-15" tabindex="-1"></a>    <span class="dt">int</span> n2 <span class="op">=</span> size<span class="op">(</span>x2<span class="op">);</span></span>
<span id="cb250-16"><a href="application-level-k-models.html#cb250-16" tabindex="-1"></a>    </span>
<span id="cb250-17"><a href="application-level-k-models.html#cb250-17" tabindex="-1"></a>    matrix<span class="op">[</span>n1<span class="op">,</span>n2<span class="op">]</span> err <span class="op">=</span> fabs<span class="op">(</span>rep_matrix<span class="op">(</span>x1<span class="op">,</span>n2<span class="op">)-</span>p1<span class="op">*</span>rep_matrix<span class="op">(</span>x2<span class="op">,</span>n1<span class="op">));</span></span>
<span id="cb250-18"><a href="application-level-k-models.html#cb250-18" tabindex="-1"></a>    </span>
<span id="cb250-19"><a href="application-level-k-models.html#cb250-19" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> pay <span class="op">=</span> <span class="op">(</span>fmax<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span><span class="dv">200</span><span class="op">-</span>err<span class="op">*</span><span class="dv">10</span><span class="op">)+</span>fmax<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span><span class="dv">100</span><span class="op">-</span>err<span class="op">))*</span>rep_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">/</span>n1<span class="op">,</span>n2<span class="op">);</span></span>
<span id="cb250-20"><a href="application-level-k-models.html#cb250-20" tabindex="-1"></a>    </span>
<span id="cb250-21"><a href="application-level-k-models.html#cb250-21" tabindex="-1"></a>    <span class="cf">return</span> pay<span class="op">;</span></span>
<span id="cb250-22"><a href="application-level-k-models.html#cb250-22" tabindex="-1"></a>    </span>
<span id="cb250-23"><a href="application-level-k-models.html#cb250-23" tabindex="-1"></a>    </span>
<span id="cb250-24"><a href="application-level-k-models.html#cb250-24" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb250-25"><a href="application-level-k-models.html#cb250-25" tabindex="-1"></a>  </span>
<span id="cb250-26"><a href="application-level-k-models.html#cb250-26" tabindex="-1"></a>  <span class="dt">int</span> which_max<span class="op">(</span>vector x<span class="op">,</span>real tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-27"><a href="application-level-k-models.html#cb250-27" tabindex="-1"></a>    </span>
<span id="cb250-28"><a href="application-level-k-models.html#cb250-28" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> size<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb250-29"><a href="application-level-k-models.html#cb250-29" tabindex="-1"></a>    </span>
<span id="cb250-30"><a href="application-level-k-models.html#cb250-30" tabindex="-1"></a>    <span class="dt">int</span> ind <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb250-31"><a href="application-level-k-models.html#cb250-31" tabindex="-1"></a>    </span>
<span id="cb250-32"><a href="application-level-k-models.html#cb250-32" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-33"><a href="application-level-k-models.html#cb250-33" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>abs<span class="op">(</span>x<span class="op">[</span>ii<span class="op">]-</span>max<span class="op">(</span>x<span class="op">))&lt;</span>tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-34"><a href="application-level-k-models.html#cb250-34" tabindex="-1"></a>        ind <span class="op">=</span> ii<span class="op">;</span></span>
<span id="cb250-35"><a href="application-level-k-models.html#cb250-35" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb250-36"><a href="application-level-k-models.html#cb250-36" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb250-37"><a href="application-level-k-models.html#cb250-37" tabindex="-1"></a>    </span>
<span id="cb250-38"><a href="application-level-k-models.html#cb250-38" tabindex="-1"></a>    <span class="cf">return</span> ind<span class="op">;</span></span>
<span id="cb250-39"><a href="application-level-k-models.html#cb250-39" tabindex="-1"></a>    </span>
<span id="cb250-40"><a href="application-level-k-models.html#cb250-40" tabindex="-1"></a>    </span>
<span id="cb250-41"><a href="application-level-k-models.html#cb250-41" tabindex="-1"></a>    </span>
<span id="cb250-42"><a href="application-level-k-models.html#cb250-42" tabindex="-1"></a>    </span>
<span id="cb250-43"><a href="application-level-k-models.html#cb250-43" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb250-44"><a href="application-level-k-models.html#cb250-44" tabindex="-1"></a>  </span>
<span id="cb250-45"><a href="application-level-k-models.html#cb250-45" tabindex="-1"></a>  </span>
<span id="cb250-46"><a href="application-level-k-models.html#cb250-46" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb250-47"><a href="application-level-k-models.html#cb250-47" tabindex="-1"></a></span>
<span id="cb250-48"><a href="application-level-k-models.html#cb250-48" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb250-49"><a href="application-level-k-models.html#cb250-49" tabindex="-1"></a>  </span>
<span id="cb250-50"><a href="application-level-k-models.html#cb250-50" tabindex="-1"></a>  <span class="dt">int</span> ngames<span class="op">;</span> <span class="co">// number of games</span></span>
<span id="cb250-51"><a href="application-level-k-models.html#cb250-51" tabindex="-1"></a>  <span class="dt">int</span> nparticipants<span class="op">;</span> <span class="co">// number of participants</span></span>
<span id="cb250-52"><a href="application-level-k-models.html#cb250-52" tabindex="-1"></a>  </span>
<span id="cb250-53"><a href="application-level-k-models.html#cb250-53" tabindex="-1"></a>  <span class="dt">int</span> kmax<span class="op">;</span> <span class="co">// max level k to evaluate</span></span>
<span id="cb250-54"><a href="application-level-k-models.html#cb250-54" tabindex="-1"></a>  </span>
<span id="cb250-55"><a href="application-level-k-models.html#cb250-55" tabindex="-1"></a>  <span class="co">// game data</span></span>
<span id="cb250-56"><a href="application-level-k-models.html#cb250-56" tabindex="-1"></a>  vector<span class="op">[</span>ngames<span class="op">]</span> P1<span class="op">;</span></span>
<span id="cb250-57"><a href="application-level-k-models.html#cb250-57" tabindex="-1"></a>  vector<span class="op">[</span>ngames<span class="op">]</span> P2<span class="op">;</span></span>
<span id="cb250-58"><a href="application-level-k-models.html#cb250-58" tabindex="-1"></a>  <span class="dt">int</span> LB1<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb250-59"><a href="application-level-k-models.html#cb250-59" tabindex="-1"></a>  <span class="dt">int</span> UB1<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb250-60"><a href="application-level-k-models.html#cb250-60" tabindex="-1"></a>  <span class="dt">int</span> LB2<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb250-61"><a href="application-level-k-models.html#cb250-61" tabindex="-1"></a>  <span class="dt">int</span> UB2<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb250-62"><a href="application-level-k-models.html#cb250-62" tabindex="-1"></a>  </span>
<span id="cb250-63"><a href="application-level-k-models.html#cb250-63" tabindex="-1"></a>  <span class="co">// player 1 choice</span></span>
<span id="cb250-64"><a href="application-level-k-models.html#cb250-64" tabindex="-1"></a>  <span class="dt">int</span> choice1<span class="op">[</span>nparticipants<span class="op">,</span>ngames<span class="op">];</span></span>
<span id="cb250-65"><a href="application-level-k-models.html#cb250-65" tabindex="-1"></a>  </span>
<span id="cb250-66"><a href="application-level-k-models.html#cb250-66" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_probExact<span class="op">;</span></span>
<span id="cb250-67"><a href="application-level-k-models.html#cb250-67" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_lambda<span class="op">;</span></span>
<span id="cb250-68"><a href="application-level-k-models.html#cb250-68" tabindex="-1"></a>  </span>
<span id="cb250-69"><a href="application-level-k-models.html#cb250-69" tabindex="-1"></a>  vector<span class="op">[</span>kmax<span class="op">]</span> prior_mix<span class="op">;</span></span>
<span id="cb250-70"><a href="application-level-k-models.html#cb250-70" tabindex="-1"></a>  </span>
<span id="cb250-71"><a href="application-level-k-models.html#cb250-71" tabindex="-1"></a>  <span class="co">// tolerance for identifying a maximum in function which_max(,)</span></span>
<span id="cb250-72"><a href="application-level-k-models.html#cb250-72" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> tol<span class="op">;</span></span>
<span id="cb250-73"><a href="application-level-k-models.html#cb250-73" tabindex="-1"></a>  </span>
<span id="cb250-74"><a href="application-level-k-models.html#cb250-74" tabindex="-1"></a>  </span>
<span id="cb250-75"><a href="application-level-k-models.html#cb250-75" tabindex="-1"></a>  </span>
<span id="cb250-76"><a href="application-level-k-models.html#cb250-76" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb250-77"><a href="application-level-k-models.html#cb250-77" tabindex="-1"></a></span>
<span id="cb250-78"><a href="application-level-k-models.html#cb250-78" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb250-79"><a href="application-level-k-models.html#cb250-79" tabindex="-1"></a>  </span>
<span id="cb250-80"><a href="application-level-k-models.html#cb250-80" tabindex="-1"></a>  <span class="dt">int</span> choice1_i<span class="op">[</span>nparticipants<span class="op">,</span>ngames<span class="op">];</span></span>
<span id="cb250-81"><a href="application-level-k-models.html#cb250-81" tabindex="-1"></a>  </span>
<span id="cb250-82"><a href="application-level-k-models.html#cb250-82" tabindex="-1"></a>  <span class="co">// pre-compute level-k predictions</span></span>
<span id="cb250-83"><a href="application-level-k-models.html#cb250-83" tabindex="-1"></a>  </span>
<span id="cb250-84"><a href="application-level-k-models.html#cb250-84" tabindex="-1"></a>  vector<span class="op">[</span>kmax<span class="op">]</span> LKpredictions1<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb250-85"><a href="application-level-k-models.html#cb250-85" tabindex="-1"></a>  vector<span class="op">[</span>kmax<span class="op">]</span> LKpredictions2<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb250-86"><a href="application-level-k-models.html#cb250-86" tabindex="-1"></a>  </span>
<span id="cb250-87"><a href="application-level-k-models.html#cb250-87" tabindex="-1"></a>  </span>
<span id="cb250-88"><a href="application-level-k-models.html#cb250-88" tabindex="-1"></a>  </span>
<span id="cb250-89"><a href="application-level-k-models.html#cb250-89" tabindex="-1"></a>  </span>
<span id="cb250-90"><a href="application-level-k-models.html#cb250-90" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>gg in <span class="dv">1</span><span class="op">:</span>ngames<span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-91"><a href="application-level-k-models.html#cb250-91" tabindex="-1"></a>    real p1 <span class="op">=</span> P1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb250-92"><a href="application-level-k-models.html#cb250-92" tabindex="-1"></a>    real p2 <span class="op">=</span> P2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb250-93"><a href="application-level-k-models.html#cb250-93" tabindex="-1"></a>    <span class="dt">int</span> lb1 <span class="op">=</span> LB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb250-94"><a href="application-level-k-models.html#cb250-94" tabindex="-1"></a>    <span class="dt">int</span> ub1 <span class="op">=</span> UB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb250-95"><a href="application-level-k-models.html#cb250-95" tabindex="-1"></a>    <span class="dt">int</span> lb2 <span class="op">=</span> LB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb250-96"><a href="application-level-k-models.html#cb250-96" tabindex="-1"></a>    <span class="dt">int</span> ub2 <span class="op">=</span> UB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb250-97"><a href="application-level-k-models.html#cb250-97" tabindex="-1"></a>    </span>
<span id="cb250-98"><a href="application-level-k-models.html#cb250-98" tabindex="-1"></a>    <span class="dt">int</span> n1 <span class="op">=</span> ub1<span class="op">-</span>lb1<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb250-99"><a href="application-level-k-models.html#cb250-99" tabindex="-1"></a>    <span class="dt">int</span> n2 <span class="op">=</span> ub2<span class="op">-</span>lb2<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb250-100"><a href="application-level-k-models.html#cb250-100" tabindex="-1"></a>    </span>
<span id="cb250-101"><a href="application-level-k-models.html#cb250-101" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nparticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-102"><a href="application-level-k-models.html#cb250-102" tabindex="-1"></a>      choice1_i<span class="op">[</span>ii<span class="op">,</span>gg<span class="op">]</span> <span class="op">=</span> choice1<span class="op">[</span>ii<span class="op">,</span>gg<span class="op">]-</span>lb1<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb250-103"><a href="application-level-k-models.html#cb250-103" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb250-104"><a href="application-level-k-models.html#cb250-104" tabindex="-1"></a>    <span class="co">// choice sets</span></span>
<span id="cb250-105"><a href="application-level-k-models.html#cb250-105" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> X1 <span class="op">=</span> linspaced_vector<span class="op">(</span>n1<span class="op">,</span>lb1<span class="op">,</span>ub1<span class="op">);</span></span>
<span id="cb250-106"><a href="application-level-k-models.html#cb250-106" tabindex="-1"></a>    row_vector<span class="op">[</span>n2<span class="op">]</span> X2 <span class="op">=</span> linspaced_row_vector<span class="op">(</span>n2<span class="op">,</span>lb2<span class="op">,</span>ub2<span class="op">);</span></span>
<span id="cb250-107"><a href="application-level-k-models.html#cb250-107" tabindex="-1"></a>    </span>
<span id="cb250-108"><a href="application-level-k-models.html#cb250-108" tabindex="-1"></a>    <span class="co">// choices to get uniform distribution over actions</span></span>
<span id="cb250-109"><a href="application-level-k-models.html#cb250-109" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> x1 <span class="op">=</span> linspaced_vector<span class="op">(</span>n1<span class="op">,</span>lb1<span class="op">,</span>ub1<span class="op">);</span></span>
<span id="cb250-110"><a href="application-level-k-models.html#cb250-110" tabindex="-1"></a>    row_vector<span class="op">[</span>n2<span class="op">]</span> x2 <span class="op">=</span> linspaced_row_vector<span class="op">(</span>n2<span class="op">,</span>lb2<span class="op">,</span>ub2<span class="op">);</span></span>
<span id="cb250-111"><a href="application-level-k-models.html#cb250-111" tabindex="-1"></a>    </span>
<span id="cb250-112"><a href="application-level-k-models.html#cb250-112" tabindex="-1"></a>    </span>
<span id="cb250-113"><a href="application-level-k-models.html#cb250-113" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>kk in <span class="dv">1</span><span class="op">:</span>kmax<span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-114"><a href="application-level-k-models.html#cb250-114" tabindex="-1"></a>      </span>
<span id="cb250-115"><a href="application-level-k-models.html#cb250-115" tabindex="-1"></a>      vector<span class="op">[</span>n1<span class="op">]</span> payoff1 <span class="op">=</span> payofffun<span class="op">(</span>X1<span class="op">,</span>x2<span class="op">,</span>p1<span class="op">);</span></span>
<span id="cb250-116"><a href="application-level-k-models.html#cb250-116" tabindex="-1"></a>      vector<span class="op">[</span>n2<span class="op">]</span> payoff2 <span class="op">=</span> payofffun<span class="op">(</span>X2<span class="ch">&#39;,</span><span class="er">x1</span><span class="ch">&#39;</span><span class="op">,</span>p2<span class="op">);</span></span>
<span id="cb250-117"><a href="application-level-k-models.html#cb250-117" tabindex="-1"></a>      </span>
<span id="cb250-118"><a href="application-level-k-models.html#cb250-118" tabindex="-1"></a>      x1 <span class="op">=</span> rep_vector<span class="op">(</span>X1<span class="op">[</span>which_max<span class="op">(</span>payoff1<span class="op">,</span>tol<span class="op">)],</span>n1<span class="op">);</span></span>
<span id="cb250-119"><a href="application-level-k-models.html#cb250-119" tabindex="-1"></a>      x2 <span class="op">=</span> rep_row_vector<span class="op">(</span>X2<span class="op">[</span>which_max<span class="op">(</span>payoff2<span class="op">,</span>tol<span class="op">)],</span>n2<span class="op">);</span></span>
<span id="cb250-120"><a href="application-level-k-models.html#cb250-120" tabindex="-1"></a>      </span>
<span id="cb250-121"><a href="application-level-k-models.html#cb250-121" tabindex="-1"></a>      LKpredictions1<span class="op">[</span>gg<span class="op">][</span>kk<span class="op">]</span> <span class="op">=</span> X1<span class="op">[</span>which_max<span class="op">(</span>payoff1<span class="op">,</span>tol<span class="op">)];</span></span>
<span id="cb250-122"><a href="application-level-k-models.html#cb250-122" tabindex="-1"></a>      LKpredictions2<span class="op">[</span>gg<span class="op">][</span>kk<span class="op">]</span> <span class="op">=</span> X2<span class="op">[</span>which_max<span class="op">(</span>payoff2<span class="op">,</span>tol<span class="op">)];</span></span>
<span id="cb250-123"><a href="application-level-k-models.html#cb250-123" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb250-124"><a href="application-level-k-models.html#cb250-124" tabindex="-1"></a>    </span>
<span id="cb250-125"><a href="application-level-k-models.html#cb250-125" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb250-126"><a href="application-level-k-models.html#cb250-126" tabindex="-1"></a>  </span>
<span id="cb250-127"><a href="application-level-k-models.html#cb250-127" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb250-128"><a href="application-level-k-models.html#cb250-128" tabindex="-1"></a></span>
<span id="cb250-129"><a href="application-level-k-models.html#cb250-129" tabindex="-1"></a></span>
<span id="cb250-130"><a href="application-level-k-models.html#cb250-130" tabindex="-1"></a></span>
<span id="cb250-131"><a href="application-level-k-models.html#cb250-131" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb250-132"><a href="application-level-k-models.html#cb250-132" tabindex="-1"></a>  </span>
<span id="cb250-133"><a href="application-level-k-models.html#cb250-133" tabindex="-1"></a>  simplex<span class="op">[</span>kmax<span class="op">]</span> mix<span class="op">;</span> </span>
<span id="cb250-134"><a href="application-level-k-models.html#cb250-134" tabindex="-1"></a>  </span>
<span id="cb250-135"><a href="application-level-k-models.html#cb250-135" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">,</span>upper<span class="op">=</span><span class="dv">1</span><span class="op">&gt;</span> probExact<span class="op">;</span></span>
<span id="cb250-136"><a href="application-level-k-models.html#cb250-136" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> lambda<span class="op">;</span></span>
<span id="cb250-137"><a href="application-level-k-models.html#cb250-137" tabindex="-1"></a></span>
<span id="cb250-138"><a href="application-level-k-models.html#cb250-138" tabindex="-1"></a>  </span>
<span id="cb250-139"><a href="application-level-k-models.html#cb250-139" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb250-140"><a href="application-level-k-models.html#cb250-140" tabindex="-1"></a></span>
<span id="cb250-141"><a href="application-level-k-models.html#cb250-141" tabindex="-1"></a>transformed parameters <span class="op">{</span></span>
<span id="cb250-142"><a href="application-level-k-models.html#cb250-142" tabindex="-1"></a>  </span>
<span id="cb250-143"><a href="application-level-k-models.html#cb250-143" tabindex="-1"></a>  matrix<span class="op">[</span>nparticipants<span class="op">,</span>kmax<span class="op">]</span> like_choices <span class="op">=</span> rep_matrix<span class="op">(</span>log<span class="op">(</span>mix<span class="ch">&#39;)</span><span class="er">,nparticipants);</span></span>
<span id="cb250-144"><a href="application-level-k-models.html#cb250-144" tabindex="-1"></a>  </span>
<span id="cb250-145"><a href="application-level-k-models.html#cb250-145" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>gg in <span class="dv">1</span><span class="op">:</span>ngames<span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-146"><a href="application-level-k-models.html#cb250-146" tabindex="-1"></a>    real p1 <span class="op">=</span> P1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb250-147"><a href="application-level-k-models.html#cb250-147" tabindex="-1"></a>    real p2 <span class="op">=</span> P2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb250-148"><a href="application-level-k-models.html#cb250-148" tabindex="-1"></a>    <span class="dt">int</span> lb1 <span class="op">=</span> LB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb250-149"><a href="application-level-k-models.html#cb250-149" tabindex="-1"></a>    <span class="dt">int</span> ub1 <span class="op">=</span> UB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb250-150"><a href="application-level-k-models.html#cb250-150" tabindex="-1"></a>    <span class="dt">int</span> lb2 <span class="op">=</span> LB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb250-151"><a href="application-level-k-models.html#cb250-151" tabindex="-1"></a>    <span class="dt">int</span> ub2 <span class="op">=</span> UB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb250-152"><a href="application-level-k-models.html#cb250-152" tabindex="-1"></a>    </span>
<span id="cb250-153"><a href="application-level-k-models.html#cb250-153" tabindex="-1"></a>    <span class="dt">int</span> n1 <span class="op">=</span> ub1<span class="op">-</span>lb1<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb250-154"><a href="application-level-k-models.html#cb250-154" tabindex="-1"></a>    <span class="dt">int</span> n2 <span class="op">=</span> ub2<span class="op">-</span>lb2<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb250-155"><a href="application-level-k-models.html#cb250-155" tabindex="-1"></a>    </span>
<span id="cb250-156"><a href="application-level-k-models.html#cb250-156" tabindex="-1"></a>    <span class="co">// choice sets for Player 1</span></span>
<span id="cb250-157"><a href="application-level-k-models.html#cb250-157" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> X1 <span class="op">=</span> linspaced_vector<span class="op">(</span>n1<span class="op">,</span>lb1<span class="op">,</span>ub1<span class="op">);</span></span>
<span id="cb250-158"><a href="application-level-k-models.html#cb250-158" tabindex="-1"></a>    </span>
<span id="cb250-159"><a href="application-level-k-models.html#cb250-159" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>kk in <span class="dv">1</span><span class="op">:</span>kmax<span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-160"><a href="application-level-k-models.html#cb250-160" tabindex="-1"></a>      row_vector<span class="op">[</span>n2<span class="op">]</span> x2<span class="op">;</span></span>
<span id="cb250-161"><a href="application-level-k-models.html#cb250-161" tabindex="-1"></a>      </span>
<span id="cb250-162"><a href="application-level-k-models.html#cb250-162" tabindex="-1"></a>      <span class="co">// action of Player 2</span></span>
<span id="cb250-163"><a href="application-level-k-models.html#cb250-163" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>kk<span class="op">==</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-164"><a href="application-level-k-models.html#cb250-164" tabindex="-1"></a>        x2 <span class="op">=</span> linspaced_vector<span class="op">(</span>n2<span class="op">,</span>lb2<span class="op">,</span>ub2<span class="op">)</span><span class="ch">&#39;;</span></span>
<span id="cb250-165"><a href="application-level-k-models.html#cb250-165" tabindex="-1"></a>      <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb250-166"><a href="application-level-k-models.html#cb250-166" tabindex="-1"></a>        x2 <span class="op">=</span> rep_row_vector<span class="op">(</span>LKpredictions2<span class="op">[</span>gg<span class="op">][</span>kk<span class="op">-</span><span class="dv">1</span><span class="op">],</span>n2<span class="op">);</span></span>
<span id="cb250-167"><a href="application-level-k-models.html#cb250-167" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb250-168"><a href="application-level-k-models.html#cb250-168" tabindex="-1"></a>      </span>
<span id="cb250-169"><a href="application-level-k-models.html#cb250-169" tabindex="-1"></a>      vector<span class="op">[</span>n1<span class="op">]</span> payoff1 <span class="op">=</span> payofffun<span class="op">(</span>X1<span class="op">,</span>x2<span class="op">,</span>p1<span class="op">);</span></span>
<span id="cb250-170"><a href="application-level-k-models.html#cb250-170" tabindex="-1"></a>      </span>
<span id="cb250-171"><a href="application-level-k-models.html#cb250-171" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nparticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-172"><a href="application-level-k-models.html#cb250-172" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>choice1<span class="op">[</span>ii<span class="op">,</span>gg<span class="op">]==</span>LKpredictions1<span class="op">[</span>gg<span class="op">][</span>kk<span class="op">])</span> <span class="op">{</span></span>
<span id="cb250-173"><a href="application-level-k-models.html#cb250-173" tabindex="-1"></a>         <span class="co">// If the choice matches exactly with the prediction, then ...</span></span>
<span id="cb250-174"><a href="application-level-k-models.html#cb250-174" tabindex="-1"></a>           like_choices<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]</span> <span class="op">+=</span> log<span class="op">(</span></span>
<span id="cb250-175"><a href="application-level-k-models.html#cb250-175" tabindex="-1"></a>           probExact</span>
<span id="cb250-176"><a href="application-level-k-models.html#cb250-176" tabindex="-1"></a>              <span class="op">+(</span><span class="fl">1.0</span><span class="op">-</span>probExact<span class="op">)*</span>softmax<span class="op">(</span>lambda<span class="op">*</span>payoff1<span class="op">)[</span>choice1_i<span class="op">[</span>ii<span class="op">,</span>gg<span class="op">]]</span></span>
<span id="cb250-177"><a href="application-level-k-models.html#cb250-177" tabindex="-1"></a>            <span class="op">);</span></span>
<span id="cb250-178"><a href="application-level-k-models.html#cb250-178" tabindex="-1"></a>      </span>
<span id="cb250-179"><a href="application-level-k-models.html#cb250-179" tabindex="-1"></a>          <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb250-180"><a href="application-level-k-models.html#cb250-180" tabindex="-1"></a>      <span class="co">// if the choice does not match exactly with the prediction, then ...</span></span>
<span id="cb250-181"><a href="application-level-k-models.html#cb250-181" tabindex="-1"></a>           like_choices<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]</span> <span class="op">+=</span> log<span class="op">(</span></span>
<span id="cb250-182"><a href="application-level-k-models.html#cb250-182" tabindex="-1"></a>            <span class="op">(</span><span class="fl">1.0</span><span class="op">-</span>probExact<span class="op">)*</span>softmax<span class="op">(</span>lambda<span class="op">*</span>payoff1<span class="op">)[</span>choice1_i<span class="op">[</span>ii<span class="op">,</span>gg<span class="op">]]</span></span>
<span id="cb250-183"><a href="application-level-k-models.html#cb250-183" tabindex="-1"></a>            <span class="op">);</span></span>
<span id="cb250-184"><a href="application-level-k-models.html#cb250-184" tabindex="-1"></a>          <span class="op">}</span></span>
<span id="cb250-185"><a href="application-level-k-models.html#cb250-185" tabindex="-1"></a>      <span class="op">}</span> <span class="co">// loop over participants ends here</span></span>
<span id="cb250-186"><a href="application-level-k-models.html#cb250-186" tabindex="-1"></a>      </span>
<span id="cb250-187"><a href="application-level-k-models.html#cb250-187" tabindex="-1"></a>    <span class="op">}</span> <span class="co">// loop over k ends here</span></span>
<span id="cb250-188"><a href="application-level-k-models.html#cb250-188" tabindex="-1"></a>    </span>
<span id="cb250-189"><a href="application-level-k-models.html#cb250-189" tabindex="-1"></a>  <span class="op">}</span> <span class="co">// loop over games ends here</span></span>
<span id="cb250-190"><a href="application-level-k-models.html#cb250-190" tabindex="-1"></a>  </span>
<span id="cb250-191"><a href="application-level-k-models.html#cb250-191" tabindex="-1"></a>  </span>
<span id="cb250-192"><a href="application-level-k-models.html#cb250-192" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb250-193"><a href="application-level-k-models.html#cb250-193" tabindex="-1"></a></span>
<span id="cb250-194"><a href="application-level-k-models.html#cb250-194" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb250-195"><a href="application-level-k-models.html#cb250-195" tabindex="-1"></a>  </span>
<span id="cb250-196"><a href="application-level-k-models.html#cb250-196" tabindex="-1"></a>  </span>
<span id="cb250-197"><a href="application-level-k-models.html#cb250-197" tabindex="-1"></a>  <span class="co">// priors --------------------------------------------------------------------</span></span>
<span id="cb250-198"><a href="application-level-k-models.html#cb250-198" tabindex="-1"></a>  mix <span class="op">~</span> dirichlet<span class="op">(</span>prior_mix<span class="op">);</span></span>
<span id="cb250-199"><a href="application-level-k-models.html#cb250-199" tabindex="-1"></a>  probExact <span class="op">~</span> beta<span class="op">(</span>prior_probExact<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_probExact<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb250-200"><a href="application-level-k-models.html#cb250-200" tabindex="-1"></a>  lambda <span class="op">~</span> lognormal<span class="op">(</span>prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb250-201"><a href="application-level-k-models.html#cb250-201" tabindex="-1"></a>  </span>
<span id="cb250-202"><a href="application-level-k-models.html#cb250-202" tabindex="-1"></a></span>
<span id="cb250-203"><a href="application-level-k-models.html#cb250-203" tabindex="-1"></a>  </span>
<span id="cb250-204"><a href="application-level-k-models.html#cb250-204" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nparticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-205"><a href="application-level-k-models.html#cb250-205" tabindex="-1"></a>    target <span class="op">+=</span> log_sum_exp<span class="op">(</span>like_choices<span class="op">[</span>ii<span class="op">,]);</span></span>
<span id="cb250-206"><a href="application-level-k-models.html#cb250-206" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb250-207"><a href="application-level-k-models.html#cb250-207" tabindex="-1"></a>  </span>
<span id="cb250-208"><a href="application-level-k-models.html#cb250-208" tabindex="-1"></a>  </span>
<span id="cb250-209"><a href="application-level-k-models.html#cb250-209" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb250-210"><a href="application-level-k-models.html#cb250-210" tabindex="-1"></a></span>
<span id="cb250-211"><a href="application-level-k-models.html#cb250-211" tabindex="-1"></a>generated quantities <span class="op">{</span></span>
<span id="cb250-212"><a href="application-level-k-models.html#cb250-212" tabindex="-1"></a>  </span>
<span id="cb250-213"><a href="application-level-k-models.html#cb250-213" tabindex="-1"></a>  matrix<span class="op">[</span>nparticipants<span class="op">,</span>kmax<span class="op">]</span> postprob<span class="op">;</span></span>
<span id="cb250-214"><a href="application-level-k-models.html#cb250-214" tabindex="-1"></a>  vector<span class="op">[</span>nparticipants<span class="op">]</span> postk<span class="op">;</span></span>
<span id="cb250-215"><a href="application-level-k-models.html#cb250-215" tabindex="-1"></a>  </span>
<span id="cb250-216"><a href="application-level-k-models.html#cb250-216" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nparticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb250-217"><a href="application-level-k-models.html#cb250-217" tabindex="-1"></a>    postprob<span class="op">[</span>ii<span class="op">,]</span> <span class="op">=</span> softmax<span class="op">(</span>like_choices<span class="op">[</span>ii<span class="op">,]</span><span class="ch">&#39;)&#39;</span><span class="op">;</span></span>
<span id="cb250-218"><a href="application-level-k-models.html#cb250-218" tabindex="-1"></a>    postk<span class="op">[</span>ii<span class="op">]</span> <span class="op">=</span> postprob<span class="op">[</span>ii<span class="op">,]*</span>linspaced_vector<span class="op">(</span>kmax<span class="op">,</span><span class="dv">1</span><span class="op">,</span>kmax<span class="op">);</span></span>
<span id="cb250-219"><a href="application-level-k-models.html#cb250-219" tabindex="-1"></a>    </span>
<span id="cb250-220"><a href="application-level-k-models.html#cb250-220" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb250-221"><a href="application-level-k-models.html#cb250-221" tabindex="-1"></a>  </span>
<span id="cb250-222"><a href="application-level-k-models.html#cb250-222" tabindex="-1"></a>  </span>
<span id="cb250-223"><a href="application-level-k-models.html#cb250-223" tabindex="-1"></a>  </span>
<span id="cb250-224"><a href="application-level-k-models.html#cb250-224" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<div id="a-prior-for-psi" class="section level3 hasAnchor" number="20.5.2">
<h3><span class="header-section-number">20.5.2</span> A prior for <span class="math inline">\(\psi\)</span><a href="application-level-k-models.html#a-prior-for-psi" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The parameters <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\rho\)</span> have the same interpretation as the previous models, so I keep their priors the same for the mixture model. The new parameter his is <span class="math inline">\(\psi\)</span>, the vector of mixing probabilities. For this, I assume:</p>
<p><span class="math display">\[
\psi\sim \mathrm{Dirichlet}(1,1,1,1,1)
\]</span></p>
<p>Which means that the prior mean for each mixing probability is <span class="math inline">\(\frac{1}{5}\)</span>, and the marginal distribution of each mixing probability is:</p>
<p><span class="math display">\[
\psi_k\sim \mathrm{Beta}(1,4)\quad \forall k
\]</span></p>
</div>
<div id="results-9" class="section level3 hasAnchor" number="20.5.3">
<h3><span class="header-section-number">20.5.3</span> Results<a href="application-level-k-models.html#results-9" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="application-level-k-models.html#cb251-1" tabindex="-1"></a>Mix<span class="ot">&lt;-</span><span class="fu">summary</span>(<span class="st">&quot;Code/CGC2006/EstimatesLevelkMixture.rds&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb251-2"><a href="application-level-k-models.html#cb251-2" tabindex="-1"></a>  <span class="fu">readRDS</span>()</span>
<span id="cb251-3"><a href="application-level-k-models.html#cb251-3" tabindex="-1"></a>)<span class="sc">$</span>summary <span class="sc">|&gt;</span></span>
<span id="cb251-4"><a href="application-level-k-models.html#cb251-4" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span>
<span id="cb251-5"><a href="application-level-k-models.html#cb251-5" tabindex="-1"></a></span>
<span id="cb251-6"><a href="application-level-k-models.html#cb251-6" tabindex="-1"></a></span>
<span id="cb251-7"><a href="application-level-k-models.html#cb251-7" tabindex="-1"></a>Mix[<span class="fu">c</span>(<span class="st">&quot;mix[1]&quot;</span>,<span class="st">&quot;mix[2]&quot;</span>,<span class="st">&quot;mix[3]&quot;</span>,<span class="st">&quot;mix[4]&quot;</span>,<span class="st">&quot;mix[5]&quot;</span>,<span class="st">&quot;probExact&quot;</span>,<span class="st">&quot;lambda&quot;</span>),] <span class="sc">|&gt;</span></span>
<span id="cb251-8"><a href="application-level-k-models.html#cb251-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>n_eff,<span class="sc">-</span>Rhat) <span class="sc">|&gt;</span></span>
<span id="cb251-9"><a href="application-level-k-models.html#cb251-9" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb251-10"><a href="application-level-k-models.html#cb251-10" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Estimates from the mixture model&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb251-11"><a href="application-level-k-models.html#cb251-11" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<table class=" lightable-classic" style="color: black; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:CGC2006MixEstimates">Table 20.1: </span>Estimates from the mixture model
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
se_mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
X2.5.
</th>
<th style="text-align:right;">
X25.
</th>
<th style="text-align:right;">
X50.
</th>
<th style="text-align:right;">
X75.
</th>
<th style="text-align:right;">
X97.5.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
mix[1]
</td>
<td style="text-align:right;">
0.574
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.055
</td>
<td style="text-align:right;">
0.465
</td>
<td style="text-align:right;">
0.537
</td>
<td style="text-align:right;">
0.575
</td>
<td style="text-align:right;">
0.612
</td>
<td style="text-align:right;">
0.680
</td>
</tr>
<tr>
<td style="text-align:left;">
mix[2]
</td>
<td style="text-align:right;">
0.248
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.050
</td>
<td style="text-align:right;">
0.158
</td>
<td style="text-align:right;">
0.212
</td>
<td style="text-align:right;">
0.246
</td>
<td style="text-align:right;">
0.281
</td>
<td style="text-align:right;">
0.352
</td>
</tr>
<tr>
<td style="text-align:left;">
mix[3]
</td>
<td style="text-align:right;">
0.065
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.028
</td>
<td style="text-align:right;">
0.021
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:right;">
0.062
</td>
<td style="text-align:right;">
0.081
</td>
<td style="text-align:right;">
0.128
</td>
</tr>
<tr>
<td style="text-align:left;">
mix[4]
</td>
<td style="text-align:right;">
0.040
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.025
</td>
<td style="text-align:right;">
0.005
</td>
<td style="text-align:right;">
0.022
</td>
<td style="text-align:right;">
0.036
</td>
<td style="text-align:right;">
0.055
</td>
<td style="text-align:right;">
0.101
</td>
</tr>
<tr>
<td style="text-align:left;">
mix[5]
</td>
<td style="text-align:right;">
0.073
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.031
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
0.050
</td>
<td style="text-align:right;">
0.069
</td>
<td style="text-align:right;">
0.092
</td>
<td style="text-align:right;">
0.145
</td>
</tr>
<tr>
<td style="text-align:left;">
probExact
</td>
<td style="text-align:right;">
0.331
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.013
</td>
<td style="text-align:right;">
0.306
</td>
<td style="text-align:right;">
0.323
</td>
<td style="text-align:right;">
0.331
</td>
<td style="text-align:right;">
0.340
</td>
<td style="text-align:right;">
0.357
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.006
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
0.007
</td>
<td style="text-align:right;">
0.008
</td>
<td style="text-align:right;">
0.009
</td>
</tr>
</tbody>
</table>
<p>Table <a href="application-level-k-models.html#tab:CGC2006MixEstimates">20.1</a> shows a summary of the posterior distribution of the mixture model. Here we can see that most participants are level-1, with the next most type being level 2. There seems to be a substantial spike in the probabilistic best response function, with <span class="math inline">\(\rho\)</span> estimated to be about 0.33 (0.01).</p>
</div>
</div>
<div id="a-mixture-over-levels-and-hierarchical-nuisance-parameters" class="section level2 hasAnchor" number="20.6">
<h2><span class="header-section-number">20.6</span> A mixture over levels and hierarchical nuisance parameters<a href="application-level-k-models.html#a-mixture-over-levels-and-hierarchical-nuisance-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Up to this point, we have either estimated one model for each participant, or assumed that the parameters <span class="math inline">\(\rho\)</span> and <span class="math inline">\(\lambda\)</span> were constant for all participants. We can relax this with a hierarchical specification. That is, here we will preserve the mixture part of the mixture model discussed in the previous section, but add in a hierarchical specification for these parameters.</p>
<p>Before moving to the model specification, which at this point will not be too dissimilar from other hierarchical specifications (just with a different individual-level likelihood function), it is useful to think about <em>why</em> we might want to go down this route of taking participant-level heterogeneity seriously on two levels. That is, we will be assuming that participants are heterogeneous because:</p>
<ol style="list-style-type: decimal">
<li>They have different levels of reasoning. That is, they have different <span class="math inline">\(k\)</span>s, and</li>
<li>They have different parameters in the probabilistic choice rule: <span class="math inline">\(\rho_i\)</span> and <span class="math inline">\(\lambda_i\)</span>.</li>
</ol>
<p>On the one hand, we might be interested in all of these parameters and types, and how they are different between participants. Estimating a model that allows them to be different is therefore critical for being able to comment on these things. On the other hand, and perhaps more common in the literature on level-<span class="math inline">\(k\)</span> reasoning, we might just be interested in commenting on the distribution of <span class="math inline">\(k\)</span> in our population, and don’t really give a hoot about <span class="math inline">\(\rho_i\)</span> and <span class="math inline">\(\lambda_i\)</span>. In this second case, <span class="math inline">\(\rho_i\)</span> and <span class="math inline">\(\lambda_i\)</span> are <em>nuisance parameters</em>: our goal is to estimate something else, but we have to jointly estimate them in order to do this. If possible, we still want to take participant-level heterogeneity seriously here, because models that assume it away can produce misleading results (see <span class="citation">Wilcox (<a href="#ref-Wilcox2006">2006</a>)</span> for a good example of this). So even though we might not want to use our estimates of <span class="math inline">\(\rho_i\)</span> and <span class="math inline">\(\lambda_i\)</span> to answer our research question, we want to worry about heterogeneity in these parameters.</p>
<p>In order to ensure the parameter restrictions for the individual-level parameters <span class="math inline">\(\lambda_i&gt;0\)</span> and <span class="math inline">\(\rho_i\in(0,1)\)</span>, I used the following transformed normal hierarchical specification:</p>
<p><span class="math display">\[
\theta_i\equiv\begin{pmatrix}\Phi^{-1}(\rho_i) \\ \log\lambda_i  \end{pmatrix}\sim N(\mu,\mathrm{diag\_matrix}(\tau)\Omega\mathrm{diag\_matrix}(\tau))
\]</span></p>
<div id="prior-calibration-3" class="section level3 hasAnchor" number="20.6.1">
<h3><span class="header-section-number">20.6.1</span> Prior calibration<a href="application-level-k-models.html#prior-calibration-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here we need to specify priors over the population-level parameters <span class="math inline">\(\mu\)</span>, <span class="math inline">\(\tau\)</span>, and <span class="math inline">\(\Omega\)</span>. I ended up using:</p>
<p><span class="math display">\[
\begin{aligned}
\mu_\rho&amp;\sim N(0,0.25^2)\\
\mu_\lambda&amp;\sim N(-1.96,1.35^2)\\
\tau_\rho,\tau_\lambda &amp;\sim \mathrm{Cauchy}^+(0,0.05)\\
\Omega&amp;\sim \mathrm{LKJ}(4)
\end{aligned}
\]</span></p>
<p>For <span class="math inline">\(\mu_\lambda\)</span>, I am just using the prior I calibrated for <span class="math inline">\(\lambda\)</span> for the participant-specific models. If anything, this is probably a bit spread out, as it seems reasonable that <span class="math inline">\(\mu_\lambda\)</span>, which pins down the median <span class="math inline">\(\lambda_i\)</span>, should be less spread out that the distribution of <span class="math inline">\(\lambda_i\)</span> itself. For <span class="math inline">\(\mu_\rho\)</span>, we now have a probit-normal marginal distribution for <span class="math inline">\(\rho_i\)</span>, so we can’t stick with the Beta prior we had in the participant-specific models. Setting the prior mean of this parameter to 0 centers the prior median <span class="math inline">\(\rho_i\)</span> on 50%, and a standard deviation of 0.25 means that the prior distribution is single-peaked (at <span class="math inline">\(\rho_i=50\%\)</span>) and covers the unit interval fairly well.</p>
</div>
<div id="stan-program-1" class="section level3 hasAnchor" number="20.6.2">
<h3><span class="header-section-number">20.6.2</span> <em>Stan</em> program<a href="application-level-k-models.html#stan-program-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here is my implementation of the hierarchical model in <em>Stan</em>. This took about 9 hours to run with 10,000 iterations for each of the four chains (run in parallel).<a href="#fn92" class="footnote-ref" id="fnref92"><sup>92</sup></a> This came as quite a relief to me, as the first Bayesian model averaging approach took over a day on the same machine!</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb252-1"><a href="application-level-k-models.html#cb252-1" tabindex="-1"></a>functions <span class="op">{</span></span>
<span id="cb252-2"><a href="application-level-k-models.html#cb252-2" tabindex="-1"></a>  </span>
<span id="cb252-3"><a href="application-level-k-models.html#cb252-3" tabindex="-1"></a>  vector payofffun<span class="op">(</span>vector x1<span class="op">,</span>row_vector x2<span class="op">,</span>real p1<span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-4"><a href="application-level-k-models.html#cb252-4" tabindex="-1"></a>    </span>
<span id="cb252-5"><a href="application-level-k-models.html#cb252-5" tabindex="-1"></a>    <span class="co">/*</span></span>
<span id="cb252-6"><a href="application-level-k-models.html#cb252-6" tabindex="-1"></a><span class="co">    x1 is the action space of the first player</span></span>
<span id="cb252-7"><a href="application-level-k-models.html#cb252-7" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb252-8"><a href="application-level-k-models.html#cb252-8" tabindex="-1"></a><span class="co">    x2 is the distribution of actions of the second player. That is, for level 0 </span></span>
<span id="cb252-9"><a href="application-level-k-models.html#cb252-9" tabindex="-1"></a><span class="co">    player 2, it is the action space (which gets averaged over a uniform </span></span>
<span id="cb252-10"><a href="application-level-k-models.html#cb252-10" tabindex="-1"></a><span class="co">    distribution), and for level k&gt;0 is just populated by the prediction of this</span></span>
<span id="cb252-11"><a href="application-level-k-models.html#cb252-11" tabindex="-1"></a><span class="co">    type</span></span>
<span id="cb252-12"><a href="application-level-k-models.html#cb252-12" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb252-13"><a href="application-level-k-models.html#cb252-13" tabindex="-1"></a>    </span>
<span id="cb252-14"><a href="application-level-k-models.html#cb252-14" tabindex="-1"></a>    <span class="dt">int</span> n1 <span class="op">=</span> size<span class="op">(</span>x1<span class="op">);</span></span>
<span id="cb252-15"><a href="application-level-k-models.html#cb252-15" tabindex="-1"></a>    <span class="dt">int</span> n2 <span class="op">=</span> size<span class="op">(</span>x2<span class="op">);</span></span>
<span id="cb252-16"><a href="application-level-k-models.html#cb252-16" tabindex="-1"></a>    </span>
<span id="cb252-17"><a href="application-level-k-models.html#cb252-17" tabindex="-1"></a>    matrix<span class="op">[</span>n1<span class="op">,</span>n2<span class="op">]</span> err <span class="op">=</span> fabs<span class="op">(</span>rep_matrix<span class="op">(</span>x1<span class="op">,</span>n2<span class="op">)-</span>p1<span class="op">*</span>rep_matrix<span class="op">(</span>x2<span class="op">,</span>n1<span class="op">));</span></span>
<span id="cb252-18"><a href="application-level-k-models.html#cb252-18" tabindex="-1"></a>    </span>
<span id="cb252-19"><a href="application-level-k-models.html#cb252-19" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> pay <span class="op">=</span> <span class="op">(</span>fmax<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span><span class="dv">200</span><span class="op">-</span>err<span class="op">*</span><span class="dv">10</span><span class="op">)+</span>fmax<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span><span class="dv">100</span><span class="op">-</span>err<span class="op">))*</span>rep_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">/</span>n1<span class="op">,</span>n2<span class="op">);</span></span>
<span id="cb252-20"><a href="application-level-k-models.html#cb252-20" tabindex="-1"></a>    </span>
<span id="cb252-21"><a href="application-level-k-models.html#cb252-21" tabindex="-1"></a>    <span class="cf">return</span> pay<span class="op">;</span></span>
<span id="cb252-22"><a href="application-level-k-models.html#cb252-22" tabindex="-1"></a>    </span>
<span id="cb252-23"><a href="application-level-k-models.html#cb252-23" tabindex="-1"></a>    </span>
<span id="cb252-24"><a href="application-level-k-models.html#cb252-24" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb252-25"><a href="application-level-k-models.html#cb252-25" tabindex="-1"></a>  </span>
<span id="cb252-26"><a href="application-level-k-models.html#cb252-26" tabindex="-1"></a>  <span class="dt">int</span> which_max<span class="op">(</span>vector x<span class="op">,</span>real tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-27"><a href="application-level-k-models.html#cb252-27" tabindex="-1"></a>    </span>
<span id="cb252-28"><a href="application-level-k-models.html#cb252-28" tabindex="-1"></a>    <span class="dt">int</span> n <span class="op">=</span> size<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb252-29"><a href="application-level-k-models.html#cb252-29" tabindex="-1"></a>    </span>
<span id="cb252-30"><a href="application-level-k-models.html#cb252-30" tabindex="-1"></a>    <span class="dt">int</span> ind <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb252-31"><a href="application-level-k-models.html#cb252-31" tabindex="-1"></a>    </span>
<span id="cb252-32"><a href="application-level-k-models.html#cb252-32" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>n<span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-33"><a href="application-level-k-models.html#cb252-33" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>abs<span class="op">(</span>x<span class="op">[</span>ii<span class="op">]-</span>max<span class="op">(</span>x<span class="op">))&lt;</span>tol<span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-34"><a href="application-level-k-models.html#cb252-34" tabindex="-1"></a>        ind <span class="op">=</span> ii<span class="op">;</span></span>
<span id="cb252-35"><a href="application-level-k-models.html#cb252-35" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb252-36"><a href="application-level-k-models.html#cb252-36" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb252-37"><a href="application-level-k-models.html#cb252-37" tabindex="-1"></a>    </span>
<span id="cb252-38"><a href="application-level-k-models.html#cb252-38" tabindex="-1"></a>    <span class="cf">return</span> ind<span class="op">;</span></span>
<span id="cb252-39"><a href="application-level-k-models.html#cb252-39" tabindex="-1"></a>    </span>
<span id="cb252-40"><a href="application-level-k-models.html#cb252-40" tabindex="-1"></a>    </span>
<span id="cb252-41"><a href="application-level-k-models.html#cb252-41" tabindex="-1"></a>    </span>
<span id="cb252-42"><a href="application-level-k-models.html#cb252-42" tabindex="-1"></a>    </span>
<span id="cb252-43"><a href="application-level-k-models.html#cb252-43" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb252-44"><a href="application-level-k-models.html#cb252-44" tabindex="-1"></a>  </span>
<span id="cb252-45"><a href="application-level-k-models.html#cb252-45" tabindex="-1"></a>  </span>
<span id="cb252-46"><a href="application-level-k-models.html#cb252-46" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb252-47"><a href="application-level-k-models.html#cb252-47" tabindex="-1"></a></span>
<span id="cb252-48"><a href="application-level-k-models.html#cb252-48" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb252-49"><a href="application-level-k-models.html#cb252-49" tabindex="-1"></a>  </span>
<span id="cb252-50"><a href="application-level-k-models.html#cb252-50" tabindex="-1"></a>  <span class="dt">int</span> ngames<span class="op">;</span> <span class="co">// number of games</span></span>
<span id="cb252-51"><a href="application-level-k-models.html#cb252-51" tabindex="-1"></a>  <span class="dt">int</span> nparticipants<span class="op">;</span> <span class="co">// number of participants</span></span>
<span id="cb252-52"><a href="application-level-k-models.html#cb252-52" tabindex="-1"></a>  </span>
<span id="cb252-53"><a href="application-level-k-models.html#cb252-53" tabindex="-1"></a>  <span class="dt">int</span> kmax<span class="op">;</span> <span class="co">// max level k to evaluate</span></span>
<span id="cb252-54"><a href="application-level-k-models.html#cb252-54" tabindex="-1"></a>  </span>
<span id="cb252-55"><a href="application-level-k-models.html#cb252-55" tabindex="-1"></a>  <span class="co">// game data</span></span>
<span id="cb252-56"><a href="application-level-k-models.html#cb252-56" tabindex="-1"></a>  vector<span class="op">[</span>ngames<span class="op">]</span> P1<span class="op">;</span></span>
<span id="cb252-57"><a href="application-level-k-models.html#cb252-57" tabindex="-1"></a>  vector<span class="op">[</span>ngames<span class="op">]</span> P2<span class="op">;</span></span>
<span id="cb252-58"><a href="application-level-k-models.html#cb252-58" tabindex="-1"></a>  <span class="dt">int</span> LB1<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb252-59"><a href="application-level-k-models.html#cb252-59" tabindex="-1"></a>  <span class="dt">int</span> UB1<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb252-60"><a href="application-level-k-models.html#cb252-60" tabindex="-1"></a>  <span class="dt">int</span> LB2<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb252-61"><a href="application-level-k-models.html#cb252-61" tabindex="-1"></a>  <span class="dt">int</span> UB2<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb252-62"><a href="application-level-k-models.html#cb252-62" tabindex="-1"></a>  </span>
<span id="cb252-63"><a href="application-level-k-models.html#cb252-63" tabindex="-1"></a>  <span class="co">// player 1 choice</span></span>
<span id="cb252-64"><a href="application-level-k-models.html#cb252-64" tabindex="-1"></a>  <span class="dt">int</span> choice1<span class="op">[</span>nparticipants<span class="op">,</span>ngames<span class="op">];</span></span>
<span id="cb252-65"><a href="application-level-k-models.html#cb252-65" tabindex="-1"></a>  </span>
<span id="cb252-66"><a href="application-level-k-models.html#cb252-66" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_MU<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb252-67"><a href="application-level-k-models.html#cb252-67" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_TAU<span class="op">;</span></span>
<span id="cb252-68"><a href="application-level-k-models.html#cb252-68" tabindex="-1"></a>  real prior_OMEGA<span class="op">;</span></span>
<span id="cb252-69"><a href="application-level-k-models.html#cb252-69" tabindex="-1"></a>  </span>
<span id="cb252-70"><a href="application-level-k-models.html#cb252-70" tabindex="-1"></a>  vector<span class="op">[</span>kmax<span class="op">]</span> prior_mix<span class="op">;</span></span>
<span id="cb252-71"><a href="application-level-k-models.html#cb252-71" tabindex="-1"></a>  </span>
<span id="cb252-72"><a href="application-level-k-models.html#cb252-72" tabindex="-1"></a>  <span class="co">// tolerance for identifying a maximum in function which_max(,)</span></span>
<span id="cb252-73"><a href="application-level-k-models.html#cb252-73" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> tol<span class="op">;</span></span>
<span id="cb252-74"><a href="application-level-k-models.html#cb252-74" tabindex="-1"></a>  </span>
<span id="cb252-75"><a href="application-level-k-models.html#cb252-75" tabindex="-1"></a>  </span>
<span id="cb252-76"><a href="application-level-k-models.html#cb252-76" tabindex="-1"></a>  </span>
<span id="cb252-77"><a href="application-level-k-models.html#cb252-77" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb252-78"><a href="application-level-k-models.html#cb252-78" tabindex="-1"></a></span>
<span id="cb252-79"><a href="application-level-k-models.html#cb252-79" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb252-80"><a href="application-level-k-models.html#cb252-80" tabindex="-1"></a>  </span>
<span id="cb252-81"><a href="application-level-k-models.html#cb252-81" tabindex="-1"></a>  <span class="dt">int</span> choice1_i<span class="op">[</span>nparticipants<span class="op">,</span>ngames<span class="op">];</span></span>
<span id="cb252-82"><a href="application-level-k-models.html#cb252-82" tabindex="-1"></a>  </span>
<span id="cb252-83"><a href="application-level-k-models.html#cb252-83" tabindex="-1"></a>  <span class="co">// pre-compute level-k predictions</span></span>
<span id="cb252-84"><a href="application-level-k-models.html#cb252-84" tabindex="-1"></a>  </span>
<span id="cb252-85"><a href="application-level-k-models.html#cb252-85" tabindex="-1"></a>  vector<span class="op">[</span>kmax<span class="op">]</span> LKpredictions1<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb252-86"><a href="application-level-k-models.html#cb252-86" tabindex="-1"></a>  vector<span class="op">[</span>kmax<span class="op">]</span> LKpredictions2<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb252-87"><a href="application-level-k-models.html#cb252-87" tabindex="-1"></a>  </span>
<span id="cb252-88"><a href="application-level-k-models.html#cb252-88" tabindex="-1"></a>  </span>
<span id="cb252-89"><a href="application-level-k-models.html#cb252-89" tabindex="-1"></a>  </span>
<span id="cb252-90"><a href="application-level-k-models.html#cb252-90" tabindex="-1"></a>  </span>
<span id="cb252-91"><a href="application-level-k-models.html#cb252-91" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>gg in <span class="dv">1</span><span class="op">:</span>ngames<span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-92"><a href="application-level-k-models.html#cb252-92" tabindex="-1"></a>    real p1 <span class="op">=</span> P1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb252-93"><a href="application-level-k-models.html#cb252-93" tabindex="-1"></a>    real p2 <span class="op">=</span> P2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb252-94"><a href="application-level-k-models.html#cb252-94" tabindex="-1"></a>    <span class="dt">int</span> lb1 <span class="op">=</span> LB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb252-95"><a href="application-level-k-models.html#cb252-95" tabindex="-1"></a>    <span class="dt">int</span> ub1 <span class="op">=</span> UB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb252-96"><a href="application-level-k-models.html#cb252-96" tabindex="-1"></a>    <span class="dt">int</span> lb2 <span class="op">=</span> LB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb252-97"><a href="application-level-k-models.html#cb252-97" tabindex="-1"></a>    <span class="dt">int</span> ub2 <span class="op">=</span> UB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb252-98"><a href="application-level-k-models.html#cb252-98" tabindex="-1"></a>    </span>
<span id="cb252-99"><a href="application-level-k-models.html#cb252-99" tabindex="-1"></a>    <span class="dt">int</span> n1 <span class="op">=</span> ub1<span class="op">-</span>lb1<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb252-100"><a href="application-level-k-models.html#cb252-100" tabindex="-1"></a>    <span class="dt">int</span> n2 <span class="op">=</span> ub2<span class="op">-</span>lb2<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb252-101"><a href="application-level-k-models.html#cb252-101" tabindex="-1"></a>    </span>
<span id="cb252-102"><a href="application-level-k-models.html#cb252-102" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nparticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-103"><a href="application-level-k-models.html#cb252-103" tabindex="-1"></a>      choice1_i<span class="op">[</span>ii<span class="op">,</span>gg<span class="op">]</span> <span class="op">=</span> choice1<span class="op">[</span>ii<span class="op">,</span>gg<span class="op">]-</span>lb1<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb252-104"><a href="application-level-k-models.html#cb252-104" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb252-105"><a href="application-level-k-models.html#cb252-105" tabindex="-1"></a>    <span class="co">// choice sets</span></span>
<span id="cb252-106"><a href="application-level-k-models.html#cb252-106" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> X1 <span class="op">=</span> linspaced_vector<span class="op">(</span>n1<span class="op">,</span>lb1<span class="op">,</span>ub1<span class="op">);</span></span>
<span id="cb252-107"><a href="application-level-k-models.html#cb252-107" tabindex="-1"></a>    row_vector<span class="op">[</span>n2<span class="op">]</span> X2 <span class="op">=</span> linspaced_row_vector<span class="op">(</span>n2<span class="op">,</span>lb2<span class="op">,</span>ub2<span class="op">);</span></span>
<span id="cb252-108"><a href="application-level-k-models.html#cb252-108" tabindex="-1"></a>    </span>
<span id="cb252-109"><a href="application-level-k-models.html#cb252-109" tabindex="-1"></a>    <span class="co">// choices to get uniform distribution over actions</span></span>
<span id="cb252-110"><a href="application-level-k-models.html#cb252-110" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> x1 <span class="op">=</span> linspaced_vector<span class="op">(</span>n1<span class="op">,</span>lb1<span class="op">,</span>ub1<span class="op">);</span></span>
<span id="cb252-111"><a href="application-level-k-models.html#cb252-111" tabindex="-1"></a>    row_vector<span class="op">[</span>n2<span class="op">]</span> x2 <span class="op">=</span> linspaced_row_vector<span class="op">(</span>n2<span class="op">,</span>lb2<span class="op">,</span>ub2<span class="op">);</span></span>
<span id="cb252-112"><a href="application-level-k-models.html#cb252-112" tabindex="-1"></a>    </span>
<span id="cb252-113"><a href="application-level-k-models.html#cb252-113" tabindex="-1"></a>    </span>
<span id="cb252-114"><a href="application-level-k-models.html#cb252-114" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>kk in <span class="dv">1</span><span class="op">:</span>kmax<span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-115"><a href="application-level-k-models.html#cb252-115" tabindex="-1"></a>      </span>
<span id="cb252-116"><a href="application-level-k-models.html#cb252-116" tabindex="-1"></a>      vector<span class="op">[</span>n1<span class="op">]</span> payoff1 <span class="op">=</span> payofffun<span class="op">(</span>X1<span class="op">,</span>x2<span class="op">,</span>p1<span class="op">);</span></span>
<span id="cb252-117"><a href="application-level-k-models.html#cb252-117" tabindex="-1"></a>      vector<span class="op">[</span>n2<span class="op">]</span> payoff2 <span class="op">=</span> payofffun<span class="op">(</span>X2<span class="ch">&#39;,</span><span class="er">x1</span><span class="ch">&#39;</span><span class="op">,</span>p2<span class="op">);</span></span>
<span id="cb252-118"><a href="application-level-k-models.html#cb252-118" tabindex="-1"></a>      </span>
<span id="cb252-119"><a href="application-level-k-models.html#cb252-119" tabindex="-1"></a>      x1 <span class="op">=</span> rep_vector<span class="op">(</span>X1<span class="op">[</span>which_max<span class="op">(</span>payoff1<span class="op">,</span>tol<span class="op">)],</span>n1<span class="op">);</span></span>
<span id="cb252-120"><a href="application-level-k-models.html#cb252-120" tabindex="-1"></a>      x2 <span class="op">=</span> rep_row_vector<span class="op">(</span>X2<span class="op">[</span>which_max<span class="op">(</span>payoff2<span class="op">,</span>tol<span class="op">)],</span>n2<span class="op">);</span></span>
<span id="cb252-121"><a href="application-level-k-models.html#cb252-121" tabindex="-1"></a>      </span>
<span id="cb252-122"><a href="application-level-k-models.html#cb252-122" tabindex="-1"></a>      LKpredictions1<span class="op">[</span>gg<span class="op">][</span>kk<span class="op">]</span> <span class="op">=</span> X1<span class="op">[</span>which_max<span class="op">(</span>payoff1<span class="op">,</span>tol<span class="op">)];</span></span>
<span id="cb252-123"><a href="application-level-k-models.html#cb252-123" tabindex="-1"></a>      LKpredictions2<span class="op">[</span>gg<span class="op">][</span>kk<span class="op">]</span> <span class="op">=</span> X2<span class="op">[</span>which_max<span class="op">(</span>payoff2<span class="op">,</span>tol<span class="op">)];</span></span>
<span id="cb252-124"><a href="application-level-k-models.html#cb252-124" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb252-125"><a href="application-level-k-models.html#cb252-125" tabindex="-1"></a>    </span>
<span id="cb252-126"><a href="application-level-k-models.html#cb252-126" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb252-127"><a href="application-level-k-models.html#cb252-127" tabindex="-1"></a>  </span>
<span id="cb252-128"><a href="application-level-k-models.html#cb252-128" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb252-129"><a href="application-level-k-models.html#cb252-129" tabindex="-1"></a></span>
<span id="cb252-130"><a href="application-level-k-models.html#cb252-130" tabindex="-1"></a></span>
<span id="cb252-131"><a href="application-level-k-models.html#cb252-131" tabindex="-1"></a></span>
<span id="cb252-132"><a href="application-level-k-models.html#cb252-132" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb252-133"><a href="application-level-k-models.html#cb252-133" tabindex="-1"></a>  </span>
<span id="cb252-134"><a href="application-level-k-models.html#cb252-134" tabindex="-1"></a>  simplex<span class="op">[</span>kmax<span class="op">]</span> mix<span class="op">;</span> </span>
<span id="cb252-135"><a href="application-level-k-models.html#cb252-135" tabindex="-1"></a>  </span>
<span id="cb252-136"><a href="application-level-k-models.html#cb252-136" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> MU<span class="op">;</span></span>
<span id="cb252-137"><a href="application-level-k-models.html#cb252-137" tabindex="-1"></a>  vector<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;[</span><span class="dv">2</span><span class="op">]</span> TAU<span class="op">;</span></span>
<span id="cb252-138"><a href="application-level-k-models.html#cb252-138" tabindex="-1"></a>  cholesky_factor_corr<span class="op">[</span><span class="dv">2</span><span class="op">]</span> L_OMEGA<span class="op">;</span></span>
<span id="cb252-139"><a href="application-level-k-models.html#cb252-139" tabindex="-1"></a>  </span>
<span id="cb252-140"><a href="application-level-k-models.html#cb252-140" tabindex="-1"></a>  matrix<span class="op">[</span><span class="dv">2</span><span class="op">,</span>nparticipants<span class="op">]</span> z<span class="op">;</span></span>
<span id="cb252-141"><a href="application-level-k-models.html#cb252-141" tabindex="-1"></a>  </span>
<span id="cb252-142"><a href="application-level-k-models.html#cb252-142" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb252-143"><a href="application-level-k-models.html#cb252-143" tabindex="-1"></a></span>
<span id="cb252-144"><a href="application-level-k-models.html#cb252-144" tabindex="-1"></a>transformed parameters <span class="op">{</span></span>
<span id="cb252-145"><a href="application-level-k-models.html#cb252-145" tabindex="-1"></a>  </span>
<span id="cb252-146"><a href="application-level-k-models.html#cb252-146" tabindex="-1"></a>  vector<span class="op">[</span>nparticipants<span class="op">]</span> probExact<span class="op">;</span></span>
<span id="cb252-147"><a href="application-level-k-models.html#cb252-147" tabindex="-1"></a>  vector<span class="op">[</span>nparticipants<span class="op">]</span> lambda<span class="op">;</span></span>
<span id="cb252-148"><a href="application-level-k-models.html#cb252-148" tabindex="-1"></a>  </span>
<span id="cb252-149"><a href="application-level-k-models.html#cb252-149" tabindex="-1"></a>  <span class="op">{</span></span>
<span id="cb252-150"><a href="application-level-k-models.html#cb252-150" tabindex="-1"></a>    </span>
<span id="cb252-151"><a href="application-level-k-models.html#cb252-151" tabindex="-1"></a>    matrix<span class="op">[</span><span class="dv">2</span><span class="op">,</span>nparticipants<span class="op">]</span> theta <span class="op">=</span> rep_matrix<span class="op">(</span>MU<span class="op">,</span>nparticipants<span class="op">)</span></span>
<span id="cb252-152"><a href="application-level-k-models.html#cb252-152" tabindex="-1"></a>      <span class="op">+</span> diag_pre_multiply<span class="op">(</span>TAU<span class="op">,</span>L_OMEGA<span class="op">)*</span>z<span class="op">;</span></span>
<span id="cb252-153"><a href="application-level-k-models.html#cb252-153" tabindex="-1"></a>      </span>
<span id="cb252-154"><a href="application-level-k-models.html#cb252-154" tabindex="-1"></a>    probExact <span class="op">=</span> Phi_approx<span class="op">(</span>theta<span class="op">[</span><span class="dv">1</span><span class="op">,]</span><span class="ch">&#39;)</span><span class="er">;</span></span>
<span id="cb252-155"><a href="application-level-k-models.html#cb252-155" tabindex="-1"></a>    lambda <span class="op">=</span> exp<span class="op">(</span>theta<span class="op">[</span><span class="dv">2</span><span class="op">,]</span><span class="ch">&#39;)</span><span class="er">;</span></span>
<span id="cb252-156"><a href="application-level-k-models.html#cb252-156" tabindex="-1"></a>    </span>
<span id="cb252-157"><a href="application-level-k-models.html#cb252-157" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb252-158"><a href="application-level-k-models.html#cb252-158" tabindex="-1"></a>  </span>
<span id="cb252-159"><a href="application-level-k-models.html#cb252-159" tabindex="-1"></a>  </span>
<span id="cb252-160"><a href="application-level-k-models.html#cb252-160" tabindex="-1"></a>  matrix<span class="op">[</span>nparticipants<span class="op">,</span>kmax<span class="op">]</span> like_choices <span class="op">=</span> rep_matrix<span class="op">(</span>log<span class="op">(</span>mix<span class="ch">&#39;)</span><span class="er">,nparticipants);</span></span>
<span id="cb252-161"><a href="application-level-k-models.html#cb252-161" tabindex="-1"></a>  </span>
<span id="cb252-162"><a href="application-level-k-models.html#cb252-162" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>gg in <span class="dv">1</span><span class="op">:</span>ngames<span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-163"><a href="application-level-k-models.html#cb252-163" tabindex="-1"></a>    real p1 <span class="op">=</span> P1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb252-164"><a href="application-level-k-models.html#cb252-164" tabindex="-1"></a>    real p2 <span class="op">=</span> P2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb252-165"><a href="application-level-k-models.html#cb252-165" tabindex="-1"></a>    <span class="dt">int</span> lb1 <span class="op">=</span> LB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb252-166"><a href="application-level-k-models.html#cb252-166" tabindex="-1"></a>    <span class="dt">int</span> ub1 <span class="op">=</span> UB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb252-167"><a href="application-level-k-models.html#cb252-167" tabindex="-1"></a>    <span class="dt">int</span> lb2 <span class="op">=</span> LB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb252-168"><a href="application-level-k-models.html#cb252-168" tabindex="-1"></a>    <span class="dt">int</span> ub2 <span class="op">=</span> UB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb252-169"><a href="application-level-k-models.html#cb252-169" tabindex="-1"></a>    </span>
<span id="cb252-170"><a href="application-level-k-models.html#cb252-170" tabindex="-1"></a>    <span class="dt">int</span> n1 <span class="op">=</span> ub1<span class="op">-</span>lb1<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb252-171"><a href="application-level-k-models.html#cb252-171" tabindex="-1"></a>    <span class="dt">int</span> n2 <span class="op">=</span> ub2<span class="op">-</span>lb2<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb252-172"><a href="application-level-k-models.html#cb252-172" tabindex="-1"></a>    </span>
<span id="cb252-173"><a href="application-level-k-models.html#cb252-173" tabindex="-1"></a>    <span class="co">// choice sets for Player 1</span></span>
<span id="cb252-174"><a href="application-level-k-models.html#cb252-174" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> X1 <span class="op">=</span> linspaced_vector<span class="op">(</span>n1<span class="op">,</span>lb1<span class="op">,</span>ub1<span class="op">);</span></span>
<span id="cb252-175"><a href="application-level-k-models.html#cb252-175" tabindex="-1"></a>    </span>
<span id="cb252-176"><a href="application-level-k-models.html#cb252-176" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>kk in <span class="dv">1</span><span class="op">:</span>kmax<span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-177"><a href="application-level-k-models.html#cb252-177" tabindex="-1"></a>      row_vector<span class="op">[</span>n2<span class="op">]</span> x2<span class="op">;</span></span>
<span id="cb252-178"><a href="application-level-k-models.html#cb252-178" tabindex="-1"></a>      </span>
<span id="cb252-179"><a href="application-level-k-models.html#cb252-179" tabindex="-1"></a>      <span class="co">// action of Player 2</span></span>
<span id="cb252-180"><a href="application-level-k-models.html#cb252-180" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>kk<span class="op">==</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-181"><a href="application-level-k-models.html#cb252-181" tabindex="-1"></a>        x2 <span class="op">=</span> linspaced_vector<span class="op">(</span>n2<span class="op">,</span>lb2<span class="op">,</span>ub2<span class="op">)</span><span class="ch">&#39;;</span></span>
<span id="cb252-182"><a href="application-level-k-models.html#cb252-182" tabindex="-1"></a>      <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb252-183"><a href="application-level-k-models.html#cb252-183" tabindex="-1"></a>        x2 <span class="op">=</span> rep_row_vector<span class="op">(</span>LKpredictions2<span class="op">[</span>gg<span class="op">][</span>kk<span class="op">-</span><span class="dv">1</span><span class="op">],</span>n2<span class="op">);</span></span>
<span id="cb252-184"><a href="application-level-k-models.html#cb252-184" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb252-185"><a href="application-level-k-models.html#cb252-185" tabindex="-1"></a>      </span>
<span id="cb252-186"><a href="application-level-k-models.html#cb252-186" tabindex="-1"></a>      vector<span class="op">[</span>n1<span class="op">]</span> payoff1 <span class="op">=</span> payofffun<span class="op">(</span>X1<span class="op">,</span>x2<span class="op">,</span>p1<span class="op">);</span></span>
<span id="cb252-187"><a href="application-level-k-models.html#cb252-187" tabindex="-1"></a>      </span>
<span id="cb252-188"><a href="application-level-k-models.html#cb252-188" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nparticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-189"><a href="application-level-k-models.html#cb252-189" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>choice1<span class="op">[</span>ii<span class="op">,</span>gg<span class="op">]==</span>LKpredictions1<span class="op">[</span>gg<span class="op">][</span>kk<span class="op">])</span> <span class="op">{</span></span>
<span id="cb252-190"><a href="application-level-k-models.html#cb252-190" tabindex="-1"></a>         <span class="co">// If the choice matches exactly with the prediction, then ...</span></span>
<span id="cb252-191"><a href="application-level-k-models.html#cb252-191" tabindex="-1"></a>           like_choices<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]</span> <span class="op">+=</span> log<span class="op">(</span></span>
<span id="cb252-192"><a href="application-level-k-models.html#cb252-192" tabindex="-1"></a>           probExact<span class="op">[</span>ii<span class="op">]</span></span>
<span id="cb252-193"><a href="application-level-k-models.html#cb252-193" tabindex="-1"></a>              <span class="op">+(</span><span class="fl">1.0</span><span class="op">-</span>probExact<span class="op">[</span>ii<span class="op">])*</span>softmax<span class="op">(</span>lambda<span class="op">[</span>ii<span class="op">]*</span>payoff1<span class="op">)[</span>choice1_i<span class="op">[</span>ii<span class="op">,</span>gg<span class="op">]]</span></span>
<span id="cb252-194"><a href="application-level-k-models.html#cb252-194" tabindex="-1"></a>            <span class="op">);</span></span>
<span id="cb252-195"><a href="application-level-k-models.html#cb252-195" tabindex="-1"></a>      </span>
<span id="cb252-196"><a href="application-level-k-models.html#cb252-196" tabindex="-1"></a>          <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb252-197"><a href="application-level-k-models.html#cb252-197" tabindex="-1"></a>      <span class="co">// if the choice does not match exactly with the prediction, then ...</span></span>
<span id="cb252-198"><a href="application-level-k-models.html#cb252-198" tabindex="-1"></a>           like_choices<span class="op">[</span>ii<span class="op">,</span>kk<span class="op">]</span> <span class="op">+=</span> log<span class="op">(</span></span>
<span id="cb252-199"><a href="application-level-k-models.html#cb252-199" tabindex="-1"></a>            <span class="op">(</span><span class="fl">1.0</span><span class="op">-</span>probExact<span class="op">[</span>ii<span class="op">])*</span>softmax<span class="op">(</span>lambda<span class="op">[</span>ii<span class="op">]*</span>payoff1<span class="op">)[</span>choice1_i<span class="op">[</span>ii<span class="op">,</span>gg<span class="op">]]</span></span>
<span id="cb252-200"><a href="application-level-k-models.html#cb252-200" tabindex="-1"></a>            <span class="op">);</span></span>
<span id="cb252-201"><a href="application-level-k-models.html#cb252-201" tabindex="-1"></a>          <span class="op">}</span></span>
<span id="cb252-202"><a href="application-level-k-models.html#cb252-202" tabindex="-1"></a>      <span class="op">}</span> <span class="co">// loop over participants ends here</span></span>
<span id="cb252-203"><a href="application-level-k-models.html#cb252-203" tabindex="-1"></a>      </span>
<span id="cb252-204"><a href="application-level-k-models.html#cb252-204" tabindex="-1"></a>    <span class="op">}</span> <span class="co">// loop over k ends here</span></span>
<span id="cb252-205"><a href="application-level-k-models.html#cb252-205" tabindex="-1"></a>    </span>
<span id="cb252-206"><a href="application-level-k-models.html#cb252-206" tabindex="-1"></a>  <span class="op">}</span> <span class="co">// loop over games ends here</span></span>
<span id="cb252-207"><a href="application-level-k-models.html#cb252-207" tabindex="-1"></a>  </span>
<span id="cb252-208"><a href="application-level-k-models.html#cb252-208" tabindex="-1"></a>  </span>
<span id="cb252-209"><a href="application-level-k-models.html#cb252-209" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb252-210"><a href="application-level-k-models.html#cb252-210" tabindex="-1"></a></span>
<span id="cb252-211"><a href="application-level-k-models.html#cb252-211" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb252-212"><a href="application-level-k-models.html#cb252-212" tabindex="-1"></a>  </span>
<span id="cb252-213"><a href="application-level-k-models.html#cb252-213" tabindex="-1"></a>  </span>
<span id="cb252-214"><a href="application-level-k-models.html#cb252-214" tabindex="-1"></a>  <span class="co">// priors --------------------------------------------------------------------</span></span>
<span id="cb252-215"><a href="application-level-k-models.html#cb252-215" tabindex="-1"></a>  mix <span class="op">~</span> dirichlet<span class="op">(</span>prior_mix<span class="op">);</span></span>
<span id="cb252-216"><a href="application-level-k-models.html#cb252-216" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>pp in <span class="dv">1</span><span class="op">:</span><span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-217"><a href="application-level-k-models.html#cb252-217" tabindex="-1"></a>    MU<span class="op">[</span>pp<span class="op">]</span> <span class="op">~</span> normal<span class="op">(</span>prior_MU<span class="op">[</span>pp<span class="op">][</span><span class="dv">1</span><span class="op">],</span>prior_MU<span class="op">[</span>pp<span class="op">][</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb252-218"><a href="application-level-k-models.html#cb252-218" tabindex="-1"></a>    TAU<span class="op">[</span>pp<span class="op">]</span> <span class="op">~</span> cauchy<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span>prior_TAU<span class="op">[</span>pp<span class="op">]);</span></span>
<span id="cb252-219"><a href="application-level-k-models.html#cb252-219" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb252-220"><a href="application-level-k-models.html#cb252-220" tabindex="-1"></a>  L_OMEGA <span class="op">~</span> lkj_corr_cholesky<span class="op">(</span>prior_OMEGA<span class="op">);</span></span>
<span id="cb252-221"><a href="application-level-k-models.html#cb252-221" tabindex="-1"></a>  </span>
<span id="cb252-222"><a href="application-level-k-models.html#cb252-222" tabindex="-1"></a>  <span class="co">// hierarchical structure (standardized) -------------------------------------</span></span>
<span id="cb252-223"><a href="application-level-k-models.html#cb252-223" tabindex="-1"></a>  to_vector<span class="op">(</span>z<span class="op">)</span> <span class="op">~</span> std_normal<span class="op">();</span></span>
<span id="cb252-224"><a href="application-level-k-models.html#cb252-224" tabindex="-1"></a>  </span>
<span id="cb252-225"><a href="application-level-k-models.html#cb252-225" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nparticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-226"><a href="application-level-k-models.html#cb252-226" tabindex="-1"></a>    target <span class="op">+=</span> log_sum_exp<span class="op">(</span>like_choices<span class="op">[</span>ii<span class="op">,]);</span></span>
<span id="cb252-227"><a href="application-level-k-models.html#cb252-227" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb252-228"><a href="application-level-k-models.html#cb252-228" tabindex="-1"></a>  </span>
<span id="cb252-229"><a href="application-level-k-models.html#cb252-229" tabindex="-1"></a>  </span>
<span id="cb252-230"><a href="application-level-k-models.html#cb252-230" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb252-231"><a href="application-level-k-models.html#cb252-231" tabindex="-1"></a></span>
<span id="cb252-232"><a href="application-level-k-models.html#cb252-232" tabindex="-1"></a>generated quantities <span class="op">{</span></span>
<span id="cb252-233"><a href="application-level-k-models.html#cb252-233" tabindex="-1"></a>  </span>
<span id="cb252-234"><a href="application-level-k-models.html#cb252-234" tabindex="-1"></a>  matrix<span class="op">[</span><span class="dv">2</span><span class="op">,</span><span class="dv">2</span><span class="op">]</span> OMEGA <span class="op">=</span> L_OMEGA<span class="op">*</span>L_OMEGA<span class="ch">&#39;;</span></span>
<span id="cb252-235"><a href="application-level-k-models.html#cb252-235" tabindex="-1"></a>  </span>
<span id="cb252-236"><a href="application-level-k-models.html#cb252-236" tabindex="-1"></a>  matrix<span class="op">[</span>nparticipants<span class="op">,</span>kmax<span class="op">]</span> postprob<span class="op">;</span></span>
<span id="cb252-237"><a href="application-level-k-models.html#cb252-237" tabindex="-1"></a>  vector<span class="op">[</span>nparticipants<span class="op">]</span> postk<span class="op">;</span></span>
<span id="cb252-238"><a href="application-level-k-models.html#cb252-238" tabindex="-1"></a>  </span>
<span id="cb252-239"><a href="application-level-k-models.html#cb252-239" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nparticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb252-240"><a href="application-level-k-models.html#cb252-240" tabindex="-1"></a>    postprob<span class="op">[</span>ii<span class="op">,]</span> <span class="op">=</span> softmax<span class="op">(</span>like_choices<span class="op">[</span>ii<span class="op">,]</span><span class="ch">&#39;)&#39;</span><span class="op">;</span></span>
<span id="cb252-241"><a href="application-level-k-models.html#cb252-241" tabindex="-1"></a>    postk<span class="op">[</span>ii<span class="op">]</span> <span class="op">=</span> postprob<span class="op">[</span>ii<span class="op">,]*</span>linspaced_vector<span class="op">(</span>kmax<span class="op">,</span><span class="dv">1</span><span class="op">,</span>kmax<span class="op">);</span></span>
<span id="cb252-242"><a href="application-level-k-models.html#cb252-242" tabindex="-1"></a>    </span>
<span id="cb252-243"><a href="application-level-k-models.html#cb252-243" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb252-244"><a href="application-level-k-models.html#cb252-244" tabindex="-1"></a>  </span>
<span id="cb252-245"><a href="application-level-k-models.html#cb252-245" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<div id="results-10" class="section level3 hasAnchor" number="20.6.3">
<h3><span class="header-section-number">20.6.3</span> Results<a href="application-level-k-models.html#results-10" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To begin with, here are the estimates of the mixing probabilities, shown in Table <a href="application-level-k-models.html#tab:CGC2006HierarchicalMixEstimates">20.2</a>. These are not too different from the mixture model assuming homogeneous <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\rho\)</span>, but we didn’t know that before we estimated this model.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="application-level-k-models.html#cb253-1" tabindex="-1"></a>Hierarchical<span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="st">&quot;Code/CGC2006/EstimatesLevelkHierarchicalMixture.rds&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb253-2"><a href="application-level-k-models.html#cb253-2" tabindex="-1"></a>  <span class="fu">readRDS</span>())<span class="sc">$</span>summary <span class="sc">|&gt;</span></span>
<span id="cb253-3"><a href="application-level-k-models.html#cb253-3" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span>
<span id="cb253-4"><a href="application-level-k-models.html#cb253-4" tabindex="-1"></a></span>
<span id="cb253-5"><a href="application-level-k-models.html#cb253-5" tabindex="-1"></a></span>
<span id="cb253-6"><a href="application-level-k-models.html#cb253-6" tabindex="-1"></a></span>
<span id="cb253-7"><a href="application-level-k-models.html#cb253-7" tabindex="-1"></a>TAB<span class="ot">&lt;-</span>Hierarchical[<span class="fu">grepl</span>(<span class="st">&quot;mix&quot;</span>,<span class="fu">rownames</span>(Hierarchical)),]</span>
<span id="cb253-8"><a href="application-level-k-models.html#cb253-8" tabindex="-1"></a></span>
<span id="cb253-9"><a href="application-level-k-models.html#cb253-9" tabindex="-1"></a>TAB <span class="sc">|&gt;</span> </span>
<span id="cb253-10"><a href="application-level-k-models.html#cb253-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>n_eff,<span class="sc">-</span>Rhat) <span class="sc">|&gt;</span></span>
<span id="cb253-11"><a href="application-level-k-models.html#cb253-11" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb253-12"><a href="application-level-k-models.html#cb253-12" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Mixing probability estimates from the hierarchical/mixture level-$k$ model. &quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb253-13"><a href="application-level-k-models.html#cb253-13" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<table class=" lightable-classic" style="color: black; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:CGC2006HierarchicalMixEstimates">Table 20.2: </span>Mixing probability estimates from the hierarchical/mixture level-<span class="math inline">\(k\)</span> model.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
se_mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
X2.5.
</th>
<th style="text-align:right;">
X25.
</th>
<th style="text-align:right;">
X50.
</th>
<th style="text-align:right;">
X75.
</th>
<th style="text-align:right;">
X97.5.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
mix[1]
</td>
<td style="text-align:right;">
0.604
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.056
</td>
<td style="text-align:right;">
0.493
</td>
<td style="text-align:right;">
0.567
</td>
<td style="text-align:right;">
0.605
</td>
<td style="text-align:right;">
0.643
</td>
<td style="text-align:right;">
0.711
</td>
</tr>
<tr>
<td style="text-align:left;">
mix[2]
</td>
<td style="text-align:right;">
0.221
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.048
</td>
<td style="text-align:right;">
0.134
</td>
<td style="text-align:right;">
0.189
</td>
<td style="text-align:right;">
0.219
</td>
<td style="text-align:right;">
0.252
</td>
<td style="text-align:right;">
0.321
</td>
</tr>
<tr>
<td style="text-align:left;">
mix[3]
</td>
<td style="text-align:right;">
0.069
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.029
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
0.047
</td>
<td style="text-align:right;">
0.066
</td>
<td style="text-align:right;">
0.087
</td>
<td style="text-align:right;">
0.134
</td>
</tr>
<tr>
<td style="text-align:left;">
mix[4]
</td>
<td style="text-align:right;">
0.033
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.023
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
0.028
</td>
<td style="text-align:right;">
0.045
</td>
<td style="text-align:right;">
0.089
</td>
</tr>
<tr>
<td style="text-align:left;">
mix[5]
</td>
<td style="text-align:right;">
0.073
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.030
</td>
<td style="text-align:right;">
0.024
</td>
<td style="text-align:right;">
0.051
</td>
<td style="text-align:right;">
0.069
</td>
<td style="text-align:right;">
0.091
</td>
<td style="text-align:right;">
0.142
</td>
</tr>
</tbody>
</table>
<p>Finally, we can look at the posterior means of the individual-level parameters in Figure <a href="application-level-k-models.html#fig:CGC2006HierarchicalMixPostmeans">20.5</a>. These are not too different from our participant-specific estimates (Figure <a href="application-level-k-models.html#fig:CGC2006individual">20.3</a>).</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="application-level-k-models.html#cb254-1" tabindex="-1"></a>Hierarchical<span class="sc">$</span>parameter<span class="ot">&lt;-</span><span class="fu">gsub</span>(<span class="st">&#39;[[:digit:]]+&#39;</span>, <span class="st">&#39;&#39;</span>,<span class="fu">rownames</span>(Hierarchical))</span>
<span id="cb254-2"><a href="application-level-k-models.html#cb254-2" tabindex="-1"></a></span>
<span id="cb254-3"><a href="application-level-k-models.html#cb254-3" tabindex="-1"></a>d<span class="ot">&lt;-</span>Hierarchical[<span class="fu">grepl</span>(<span class="st">&quot;postk&quot;</span>,<span class="fu">rownames</span>(Hierarchical))</span>
<span id="cb254-4"><a href="application-level-k-models.html#cb254-4" tabindex="-1"></a>                <span class="sc">|</span>  <span class="fu">grepl</span>(<span class="st">&quot;probExact&quot;</span>,<span class="fu">rownames</span>(Hierarchical))</span>
<span id="cb254-5"><a href="application-level-k-models.html#cb254-5" tabindex="-1"></a>                <span class="sc">|</span> <span class="fu">grepl</span>(<span class="st">&quot;lambda&quot;</span>,<span class="fu">rownames</span>(Hierarchical))</span>
<span id="cb254-6"><a href="application-level-k-models.html#cb254-6" tabindex="-1"></a>                ,] </span>
<span id="cb254-7"><a href="application-level-k-models.html#cb254-7" tabindex="-1"></a></span>
<span id="cb254-8"><a href="application-level-k-models.html#cb254-8" tabindex="-1"></a>d<span class="sc">$</span>id<span class="ot">&lt;-</span><span class="fu">parse_number</span>(<span class="fu">rownames</span>(d))</span>
<span id="cb254-9"><a href="application-level-k-models.html#cb254-9" tabindex="-1"></a></span>
<span id="cb254-10"><a href="application-level-k-models.html#cb254-10" tabindex="-1"></a>d<span class="ot">&lt;-</span>d <span class="sc">|&gt;</span></span>
<span id="cb254-11"><a href="application-level-k-models.html#cb254-11" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> id,</span>
<span id="cb254-12"><a href="application-level-k-models.html#cb254-12" tabindex="-1"></a>              <span class="at">names_from =</span> <span class="st">&quot;parameter&quot;</span>,</span>
<span id="cb254-13"><a href="application-level-k-models.html#cb254-13" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">&quot;mean&quot;</span>)</span>
<span id="cb254-14"><a href="application-level-k-models.html#cb254-14" tabindex="-1"></a></span>
<span id="cb254-15"><a href="application-level-k-models.html#cb254-15" tabindex="-1"></a>(</span>
<span id="cb254-16"><a href="application-level-k-models.html#cb254-16" tabindex="-1"></a>  <span class="fu">ggplot</span>(d,<span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">postk[]</span><span class="st">`</span>,<span class="at">y=</span><span class="st">`</span><span class="at">probExact[]</span><span class="st">`</span>,<span class="at">color =</span> <span class="fu">log</span>(<span class="st">`</span><span class="at">lambda[]</span><span class="st">`</span>)))</span>
<span id="cb254-17"><a href="application-level-k-models.html#cb254-17" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">geom_point</span>()</span>
<span id="cb254-18"><a href="application-level-k-models.html#cb254-18" tabindex="-1"></a>    <span class="sc">+</span><span class="fu">labs</span>(<span class="at">color=</span><span class="fu">expression</span>(<span class="st">&quot;log(&quot;</span><span class="sc">~</span>lambda<span class="sc">~</span><span class="st">&quot;)&quot;</span>))</span>
<span id="cb254-19"><a href="application-level-k-models.html#cb254-19" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">theme_bw</span>()</span>
<span id="cb254-20"><a href="application-level-k-models.html#cb254-20" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">scale_color_viridis</span>()</span>
<span id="cb254-21"><a href="application-level-k-models.html#cb254-21" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">xlab</span>(<span class="st">&quot;k&quot;</span>)</span>
<span id="cb254-22"><a href="application-level-k-models.html#cb254-22" tabindex="-1"></a>  <span class="sc">+</span><span class="fu">ylab</span>(<span class="fu">expression</span>(rho))</span>
<span id="cb254-23"><a href="application-level-k-models.html#cb254-23" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:CGC2006HierarchicalMixPostmeans"></span>
<img src="index_files/figure-html/CGC2006HierarchicalMixPostmeans-1.png" alt="Shrinkage estimates of individual-level parameters from the heirarchical/mixture level-$k$ model. " width="672" />
<p class="caption">
Figure 20.5: Shrinkage estimates of individual-level parameters from the heirarchical/mixture level-<span class="math inline">\(k\)</span> model.
</p>
</div>
</div>
</div>
<div id="a-different-assumption-about-mixing" class="section level2 hasAnchor" number="20.7">
<h2><span class="header-section-number">20.7</span> A different assumption about mixing<a href="application-level-k-models.html#a-different-assumption-about-mixing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Up to this point, we maintained the simplifying assumption that a level-<span class="math inline">\(k\)</span> type believes that they are playing against the level-<span class="math inline">\((k-1)\)</span> prediction <em>without any probabilistic choice</em>. This allowed us to pre-compute the model’s deterministic predictions in the <code>transformed data</code> block. Here we will instead assume something much closer to the model proposed by <span class="citation">Stahl and Wilson (<a href="#ref-Stahl1994">1994</a>)</span>. Specifically, we will assume that the level-<span class="math inline">\(k\)</span> type probabilistically best responds to the aggregate mixed strategy played by all types with lower levels of strategic reasoning. That is, if each level-<span class="math inline">\(k\)</span> type plays mixed strategy <span class="math inline">\(\sigma_k\)</span>, then this aggregate strategy that the level-<span class="math inline">\(k\)</span> type believes is being played is:</p>
<p><span class="math display">\[
\tilde\sigma_{k-1}=\frac{\sum_{j=1}^{k-1} \psi_j\sigma_j}{\sum_{j=1}^{k-1} \psi_j}
\]</span></p>
<p>That is, a level-<span class="math inline">\(k\)</span> player’s beliefs are consistent with the true distribution of types <span class="math inline">\(\psi\)</span>, if it is truncated to only include types with lower <span class="math inline">\(k\)</span> than the player’s.</p>
<p>To keep things simple here, I will drop the “spike” part of the spike-logit probabilistic choice rule (i.e. <span class="math inline">\(\rho=0\)</span>), and assume that all participants have the same choice precision <span class="math inline">\(\lambda\)</span>. This new model is therefore most closely related to the mixture model <em>without</em> the hierarchical specification for <span class="math inline">\(\lambda_i\)</span> and <span class="math inline">\(\rho_i\)</span>.<a href="#fn93" class="footnote-ref" id="fnref93"><sup>93</sup></a></p>
<div id="stan-program-2" class="section level3 hasAnchor" number="20.7.1">
<h3><span class="header-section-number">20.7.1</span> <em>Stan</em> program<a href="application-level-k-models.html#stan-program-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here is the <em>Stan</em> file that implements this model. Note now that we have to compute the predictions in the <code>transformed parameters</code> block, because they are a function of <span class="math inline">\(\lambda\)</span> and <span class="math inline">\(\psi\)</span>.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb255-1"><a href="application-level-k-models.html#cb255-1" tabindex="-1"></a>functions <span class="op">{</span></span>
<span id="cb255-2"><a href="application-level-k-models.html#cb255-2" tabindex="-1"></a>  </span>
<span id="cb255-3"><a href="application-level-k-models.html#cb255-3" tabindex="-1"></a>  vector logitresponse<span class="op">(</span>real lambda<span class="op">,</span> vector x1<span class="op">,</span>row_vector x2<span class="op">,</span>vector prob2<span class="op">,</span>real p1<span class="op">)</span> <span class="op">{</span></span>
<span id="cb255-4"><a href="application-level-k-models.html#cb255-4" tabindex="-1"></a>    </span>
<span id="cb255-5"><a href="application-level-k-models.html#cb255-5" tabindex="-1"></a>    <span class="co">/*</span></span>
<span id="cb255-6"><a href="application-level-k-models.html#cb255-6" tabindex="-1"></a><span class="co">    x1 is the action space of the first player</span></span>
<span id="cb255-7"><a href="application-level-k-models.html#cb255-7" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb255-8"><a href="application-level-k-models.html#cb255-8" tabindex="-1"></a><span class="co">    x2 is the action space of the second player</span></span>
<span id="cb255-9"><a href="application-level-k-models.html#cb255-9" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb255-10"><a href="application-level-k-models.html#cb255-10" tabindex="-1"></a><span class="co">    prob2 is the mixed strategy of player 2</span></span>
<span id="cb255-11"><a href="application-level-k-models.html#cb255-11" tabindex="-1"></a><span class="co">    */</span></span>
<span id="cb255-12"><a href="application-level-k-models.html#cb255-12" tabindex="-1"></a>    </span>
<span id="cb255-13"><a href="application-level-k-models.html#cb255-13" tabindex="-1"></a>    <span class="dt">int</span> n1 <span class="op">=</span> size<span class="op">(</span>x1<span class="op">);</span></span>
<span id="cb255-14"><a href="application-level-k-models.html#cb255-14" tabindex="-1"></a>    <span class="dt">int</span> n2 <span class="op">=</span> size<span class="op">(</span>x2<span class="op">);</span></span>
<span id="cb255-15"><a href="application-level-k-models.html#cb255-15" tabindex="-1"></a>    </span>
<span id="cb255-16"><a href="application-level-k-models.html#cb255-16" tabindex="-1"></a>    matrix<span class="op">[</span>n1<span class="op">,</span>n2<span class="op">]</span> err <span class="op">=</span> fabs<span class="op">(</span>rep_matrix<span class="op">(</span>x1<span class="op">,</span>n2<span class="op">)-</span>p1<span class="op">*</span>rep_matrix<span class="op">(</span>x2<span class="op">,</span>n1<span class="op">));</span></span>
<span id="cb255-17"><a href="application-level-k-models.html#cb255-17" tabindex="-1"></a>    </span>
<span id="cb255-18"><a href="application-level-k-models.html#cb255-18" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> pay <span class="op">=</span> lambda<span class="op">*(</span>fmax<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span><span class="dv">200</span><span class="op">-</span>err<span class="op">*</span><span class="dv">10</span><span class="op">)+</span>fmax<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span><span class="dv">100</span><span class="op">-</span>err<span class="op">))*</span>prob2<span class="op">;</span></span>
<span id="cb255-19"><a href="application-level-k-models.html#cb255-19" tabindex="-1"></a>    </span>
<span id="cb255-20"><a href="application-level-k-models.html#cb255-20" tabindex="-1"></a>    </span>
<span id="cb255-21"><a href="application-level-k-models.html#cb255-21" tabindex="-1"></a>    </span>
<span id="cb255-22"><a href="application-level-k-models.html#cb255-22" tabindex="-1"></a>    <span class="cf">return</span> softmax<span class="op">(</span>pay<span class="op">);</span></span>
<span id="cb255-23"><a href="application-level-k-models.html#cb255-23" tabindex="-1"></a>    </span>
<span id="cb255-24"><a href="application-level-k-models.html#cb255-24" tabindex="-1"></a>    </span>
<span id="cb255-25"><a href="application-level-k-models.html#cb255-25" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb255-26"><a href="application-level-k-models.html#cb255-26" tabindex="-1"></a>  </span>
<span id="cb255-27"><a href="application-level-k-models.html#cb255-27" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb255-28"><a href="application-level-k-models.html#cb255-28" tabindex="-1"></a></span>
<span id="cb255-29"><a href="application-level-k-models.html#cb255-29" tabindex="-1"></a>data <span class="op">{</span></span>
<span id="cb255-30"><a href="application-level-k-models.html#cb255-30" tabindex="-1"></a>  </span>
<span id="cb255-31"><a href="application-level-k-models.html#cb255-31" tabindex="-1"></a>  <span class="dt">int</span> ngames<span class="op">;</span> <span class="co">// number of games</span></span>
<span id="cb255-32"><a href="application-level-k-models.html#cb255-32" tabindex="-1"></a>  <span class="dt">int</span> nparticipants<span class="op">;</span> <span class="co">// number of participants</span></span>
<span id="cb255-33"><a href="application-level-k-models.html#cb255-33" tabindex="-1"></a>  </span>
<span id="cb255-34"><a href="application-level-k-models.html#cb255-34" tabindex="-1"></a>  <span class="dt">int</span> kmax<span class="op">;</span> <span class="co">// max level k to evaluate</span></span>
<span id="cb255-35"><a href="application-level-k-models.html#cb255-35" tabindex="-1"></a>  </span>
<span id="cb255-36"><a href="application-level-k-models.html#cb255-36" tabindex="-1"></a>  <span class="co">// game data</span></span>
<span id="cb255-37"><a href="application-level-k-models.html#cb255-37" tabindex="-1"></a>  vector<span class="op">[</span>ngames<span class="op">]</span> P1<span class="op">;</span></span>
<span id="cb255-38"><a href="application-level-k-models.html#cb255-38" tabindex="-1"></a>  vector<span class="op">[</span>ngames<span class="op">]</span> P2<span class="op">;</span></span>
<span id="cb255-39"><a href="application-level-k-models.html#cb255-39" tabindex="-1"></a>  <span class="dt">int</span> LB1<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb255-40"><a href="application-level-k-models.html#cb255-40" tabindex="-1"></a>  <span class="dt">int</span> UB1<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb255-41"><a href="application-level-k-models.html#cb255-41" tabindex="-1"></a>  <span class="dt">int</span> LB2<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb255-42"><a href="application-level-k-models.html#cb255-42" tabindex="-1"></a>  <span class="dt">int</span> UB2<span class="op">[</span>ngames<span class="op">];</span></span>
<span id="cb255-43"><a href="application-level-k-models.html#cb255-43" tabindex="-1"></a>  </span>
<span id="cb255-44"><a href="application-level-k-models.html#cb255-44" tabindex="-1"></a>  <span class="co">// player 1 choice</span></span>
<span id="cb255-45"><a href="application-level-k-models.html#cb255-45" tabindex="-1"></a>  <span class="dt">int</span> choice1<span class="op">[</span>nparticipants<span class="op">,</span>ngames<span class="op">];</span></span>
<span id="cb255-46"><a href="application-level-k-models.html#cb255-46" tabindex="-1"></a>  </span>
<span id="cb255-47"><a href="application-level-k-models.html#cb255-47" tabindex="-1"></a>  vector<span class="op">[</span><span class="dv">2</span><span class="op">]</span> prior_lambda<span class="op">;</span></span>
<span id="cb255-48"><a href="application-level-k-models.html#cb255-48" tabindex="-1"></a>  </span>
<span id="cb255-49"><a href="application-level-k-models.html#cb255-49" tabindex="-1"></a>  vector<span class="op">[</span>kmax<span class="op">]</span> prior_mix<span class="op">;</span></span>
<span id="cb255-50"><a href="application-level-k-models.html#cb255-50" tabindex="-1"></a>  </span>
<span id="cb255-51"><a href="application-level-k-models.html#cb255-51" tabindex="-1"></a>  <span class="co">// tolerance for identifying a maximum in function which_max(,)</span></span>
<span id="cb255-52"><a href="application-level-k-models.html#cb255-52" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> tol<span class="op">;</span></span>
<span id="cb255-53"><a href="application-level-k-models.html#cb255-53" tabindex="-1"></a>  </span>
<span id="cb255-54"><a href="application-level-k-models.html#cb255-54" tabindex="-1"></a>  </span>
<span id="cb255-55"><a href="application-level-k-models.html#cb255-55" tabindex="-1"></a>  </span>
<span id="cb255-56"><a href="application-level-k-models.html#cb255-56" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb255-57"><a href="application-level-k-models.html#cb255-57" tabindex="-1"></a></span>
<span id="cb255-58"><a href="application-level-k-models.html#cb255-58" tabindex="-1"></a>transformed data <span class="op">{</span></span>
<span id="cb255-59"><a href="application-level-k-models.html#cb255-59" tabindex="-1"></a>  </span>
<span id="cb255-60"><a href="application-level-k-models.html#cb255-60" tabindex="-1"></a>  <span class="dt">int</span> choice1_i<span class="op">[</span>nparticipants<span class="op">,</span>ngames<span class="op">];</span></span>
<span id="cb255-61"><a href="application-level-k-models.html#cb255-61" tabindex="-1"></a>  </span>
<span id="cb255-62"><a href="application-level-k-models.html#cb255-62" tabindex="-1"></a>  </span>
<span id="cb255-63"><a href="application-level-k-models.html#cb255-63" tabindex="-1"></a>  </span>
<span id="cb255-64"><a href="application-level-k-models.html#cb255-64" tabindex="-1"></a>  </span>
<span id="cb255-65"><a href="application-level-k-models.html#cb255-65" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>gg in <span class="dv">1</span><span class="op">:</span>ngames<span class="op">)</span> <span class="op">{</span></span>
<span id="cb255-66"><a href="application-level-k-models.html#cb255-66" tabindex="-1"></a>    <span class="dt">int</span> lb1 <span class="op">=</span> LB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb255-67"><a href="application-level-k-models.html#cb255-67" tabindex="-1"></a>    </span>
<span id="cb255-68"><a href="application-level-k-models.html#cb255-68" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nparticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb255-69"><a href="application-level-k-models.html#cb255-69" tabindex="-1"></a>      choice1_i<span class="op">[</span>ii<span class="op">,</span>gg<span class="op">]</span> <span class="op">=</span> choice1<span class="op">[</span>ii<span class="op">,</span>gg<span class="op">]-</span>lb1<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb255-70"><a href="application-level-k-models.html#cb255-70" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb255-71"><a href="application-level-k-models.html#cb255-71" tabindex="-1"></a>    </span>
<span id="cb255-72"><a href="application-level-k-models.html#cb255-72" tabindex="-1"></a>    </span>
<span id="cb255-73"><a href="application-level-k-models.html#cb255-73" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb255-74"><a href="application-level-k-models.html#cb255-74" tabindex="-1"></a>  </span>
<span id="cb255-75"><a href="application-level-k-models.html#cb255-75" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb255-76"><a href="application-level-k-models.html#cb255-76" tabindex="-1"></a></span>
<span id="cb255-77"><a href="application-level-k-models.html#cb255-77" tabindex="-1"></a></span>
<span id="cb255-78"><a href="application-level-k-models.html#cb255-78" tabindex="-1"></a></span>
<span id="cb255-79"><a href="application-level-k-models.html#cb255-79" tabindex="-1"></a>parameters <span class="op">{</span></span>
<span id="cb255-80"><a href="application-level-k-models.html#cb255-80" tabindex="-1"></a>  </span>
<span id="cb255-81"><a href="application-level-k-models.html#cb255-81" tabindex="-1"></a>  simplex<span class="op">[</span>kmax<span class="op">]</span> mix<span class="op">;</span> </span>
<span id="cb255-82"><a href="application-level-k-models.html#cb255-82" tabindex="-1"></a>  </span>
<span id="cb255-83"><a href="application-level-k-models.html#cb255-83" tabindex="-1"></a>  real<span class="op">&lt;</span>lower<span class="op">=</span><span class="dv">0</span><span class="op">&gt;</span> lambda<span class="op">;</span></span>
<span id="cb255-84"><a href="application-level-k-models.html#cb255-84" tabindex="-1"></a></span>
<span id="cb255-85"><a href="application-level-k-models.html#cb255-85" tabindex="-1"></a>  </span>
<span id="cb255-86"><a href="application-level-k-models.html#cb255-86" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb255-87"><a href="application-level-k-models.html#cb255-87" tabindex="-1"></a></span>
<span id="cb255-88"><a href="application-level-k-models.html#cb255-88" tabindex="-1"></a>transformed parameters <span class="op">{</span></span>
<span id="cb255-89"><a href="application-level-k-models.html#cb255-89" tabindex="-1"></a>  </span>
<span id="cb255-90"><a href="application-level-k-models.html#cb255-90" tabindex="-1"></a>  matrix<span class="op">[</span>nparticipants<span class="op">,</span>kmax<span class="op">]</span> like_choices <span class="op">=</span> rep_matrix<span class="op">(</span>log<span class="op">(</span>mix<span class="ch">&#39;)</span><span class="er">,nparticipants);</span></span>
<span id="cb255-91"><a href="application-level-k-models.html#cb255-91" tabindex="-1"></a>  </span>
<span id="cb255-92"><a href="application-level-k-models.html#cb255-92" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>gg in <span class="dv">1</span><span class="op">:</span>ngames<span class="op">)</span> <span class="op">{</span></span>
<span id="cb255-93"><a href="application-level-k-models.html#cb255-93" tabindex="-1"></a>    real p1 <span class="op">=</span> P1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb255-94"><a href="application-level-k-models.html#cb255-94" tabindex="-1"></a>    real p2 <span class="op">=</span> P2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb255-95"><a href="application-level-k-models.html#cb255-95" tabindex="-1"></a>    <span class="dt">int</span> lb1 <span class="op">=</span> LB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb255-96"><a href="application-level-k-models.html#cb255-96" tabindex="-1"></a>    <span class="dt">int</span> ub1 <span class="op">=</span> UB1<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb255-97"><a href="application-level-k-models.html#cb255-97" tabindex="-1"></a>    <span class="dt">int</span> lb2 <span class="op">=</span> LB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb255-98"><a href="application-level-k-models.html#cb255-98" tabindex="-1"></a>    <span class="dt">int</span> ub2 <span class="op">=</span> UB2<span class="op">[</span>gg<span class="op">];</span></span>
<span id="cb255-99"><a href="application-level-k-models.html#cb255-99" tabindex="-1"></a>    </span>
<span id="cb255-100"><a href="application-level-k-models.html#cb255-100" tabindex="-1"></a>    <span class="dt">int</span> n1 <span class="op">=</span> ub1<span class="op">-</span>lb1<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb255-101"><a href="application-level-k-models.html#cb255-101" tabindex="-1"></a>    <span class="dt">int</span> n2 <span class="op">=</span> ub2<span class="op">-</span>lb2<span class="op">+</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb255-102"><a href="application-level-k-models.html#cb255-102" tabindex="-1"></a>    </span>
<span id="cb255-103"><a href="application-level-k-models.html#cb255-103" tabindex="-1"></a>    <span class="co">// choice set for Player 1</span></span>
<span id="cb255-104"><a href="application-level-k-models.html#cb255-104" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> X1 <span class="op">=</span> linspaced_vector<span class="op">(</span>n1<span class="op">,</span>lb1<span class="op">,</span>ub1<span class="op">);</span></span>
<span id="cb255-105"><a href="application-level-k-models.html#cb255-105" tabindex="-1"></a>    <span class="co">// choice set for Player 2</span></span>
<span id="cb255-106"><a href="application-level-k-models.html#cb255-106" tabindex="-1"></a>    vector<span class="op">[</span>n2<span class="op">]</span> X2 <span class="op">=</span> linspaced_vector<span class="op">(</span>n2<span class="op">,</span>lb2<span class="op">,</span>ub2<span class="op">);</span></span>
<span id="cb255-107"><a href="application-level-k-models.html#cb255-107" tabindex="-1"></a>    <span class="co">// level-0 strategies</span></span>
<span id="cb255-108"><a href="application-level-k-models.html#cb255-108" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> prob1 <span class="op">=</span> rep_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">/</span>n1<span class="op">,</span>n1<span class="op">);</span></span>
<span id="cb255-109"><a href="application-level-k-models.html#cb255-109" tabindex="-1"></a>    vector<span class="op">[</span>n2<span class="op">]</span> prob2 <span class="op">=</span> rep_vector<span class="op">(</span><span class="fl">1.0</span><span class="op">/</span>n2<span class="op">,</span>n2<span class="op">);</span></span>
<span id="cb255-110"><a href="application-level-k-models.html#cb255-110" tabindex="-1"></a>    </span>
<span id="cb255-111"><a href="application-level-k-models.html#cb255-111" tabindex="-1"></a>    <span class="co">// aggregate strategies</span></span>
<span id="cb255-112"><a href="application-level-k-models.html#cb255-112" tabindex="-1"></a>    vector<span class="op">[</span>n1<span class="op">]</span> sigma1<span class="op">=</span>prob1<span class="op">;</span></span>
<span id="cb255-113"><a href="application-level-k-models.html#cb255-113" tabindex="-1"></a>    vector<span class="op">[</span>n2<span class="op">]</span> sigma2<span class="op">=</span>prob2<span class="op">;</span></span>
<span id="cb255-114"><a href="application-level-k-models.html#cb255-114" tabindex="-1"></a>    </span>
<span id="cb255-115"><a href="application-level-k-models.html#cb255-115" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span>kk in <span class="dv">1</span><span class="op">:</span>kmax<span class="op">)</span> <span class="op">{</span></span>
<span id="cb255-116"><a href="application-level-k-models.html#cb255-116" tabindex="-1"></a>      </span>
<span id="cb255-117"><a href="application-level-k-models.html#cb255-117" tabindex="-1"></a>      <span class="co">// compute logit response to mixed strategy</span></span>
<span id="cb255-118"><a href="application-level-k-models.html#cb255-118" tabindex="-1"></a>      prob1 <span class="op">=</span> logitresponse<span class="op">(</span>lambda<span class="op">,</span> X1<span class="op">,</span>X2<span class="ch">&#39;,</span><span class="er">sigma2,p1);</span></span>
<span id="cb255-119"><a href="application-level-k-models.html#cb255-119" tabindex="-1"></a>      prob2 <span class="op">=</span> logitresponse<span class="op">(</span>lambda<span class="op">,</span> X2<span class="op">,</span>X1<span class="ch">&#39;,</span><span class="er">sigma1,p2);</span></span>
<span id="cb255-120"><a href="application-level-k-models.html#cb255-120" tabindex="-1"></a>      </span>
<span id="cb255-121"><a href="application-level-k-models.html#cb255-121" tabindex="-1"></a>      <span class="co">// add to likelihood</span></span>
<span id="cb255-122"><a href="application-level-k-models.html#cb255-122" tabindex="-1"></a>      like_choices<span class="op">[,</span>kk<span class="op">]</span> <span class="op">+=</span> log<span class="op">(</span>prob1<span class="op">)[</span>choice1_i<span class="op">[,</span>gg<span class="op">]];</span></span>
<span id="cb255-123"><a href="application-level-k-models.html#cb255-123" tabindex="-1"></a>      </span>
<span id="cb255-124"><a href="application-level-k-models.html#cb255-124" tabindex="-1"></a>      <span class="co">// update mixed strategy</span></span>
<span id="cb255-125"><a href="application-level-k-models.html#cb255-125" tabindex="-1"></a>      <span class="cf">if</span> <span class="op">(</span>kk <span class="op">==</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb255-126"><a href="application-level-k-models.html#cb255-126" tabindex="-1"></a>        <span class="co">// aggregate strategy is the level-1 strategy</span></span>
<span id="cb255-127"><a href="application-level-k-models.html#cb255-127" tabindex="-1"></a>        sigma1 <span class="op">=</span> prob1<span class="op">;</span></span>
<span id="cb255-128"><a href="application-level-k-models.html#cb255-128" tabindex="-1"></a>        sigma2 <span class="op">=</span> prob2<span class="op">;</span></span>
<span id="cb255-129"><a href="application-level-k-models.html#cb255-129" tabindex="-1"></a>      <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb255-130"><a href="application-level-k-models.html#cb255-130" tabindex="-1"></a>        <span class="co">// aggregate strategy is a convex combination of what we had before </span></span>
<span id="cb255-131"><a href="application-level-k-models.html#cb255-131" tabindex="-1"></a>        <span class="co">// and the logit response</span></span>
<span id="cb255-132"><a href="application-level-k-models.html#cb255-132" tabindex="-1"></a>        </span>
<span id="cb255-133"><a href="application-level-k-models.html#cb255-133" tabindex="-1"></a>        sigma1 <span class="op">=</span> <span class="op">(</span>mix<span class="op">[</span>kk<span class="op">]*</span>prob1 <span class="op">+</span> sum<span class="op">(</span>mix<span class="op">[</span><span class="dv">1</span><span class="op">:(</span>kk<span class="op">-</span><span class="dv">1</span><span class="op">)])*</span>sigma1<span class="op">)/</span>sum<span class="op">(</span>mix<span class="op">[</span><span class="dv">1</span><span class="op">:</span>kk<span class="op">]);</span></span>
<span id="cb255-134"><a href="application-level-k-models.html#cb255-134" tabindex="-1"></a>        sigma2 <span class="op">=</span> <span class="op">(</span>mix<span class="op">[</span>kk<span class="op">]*</span>prob2 <span class="op">+</span> sum<span class="op">(</span>mix<span class="op">[</span><span class="dv">1</span><span class="op">:(</span>kk<span class="op">-</span><span class="dv">1</span><span class="op">)])*</span>sigma2<span class="op">)/</span>sum<span class="op">(</span>mix<span class="op">[</span><span class="dv">1</span><span class="op">:</span>kk<span class="op">]);</span></span>
<span id="cb255-135"><a href="application-level-k-models.html#cb255-135" tabindex="-1"></a>        </span>
<span id="cb255-136"><a href="application-level-k-models.html#cb255-136" tabindex="-1"></a>        </span>
<span id="cb255-137"><a href="application-level-k-models.html#cb255-137" tabindex="-1"></a>      <span class="op">}</span> </span>
<span id="cb255-138"><a href="application-level-k-models.html#cb255-138" tabindex="-1"></a>      </span>
<span id="cb255-139"><a href="application-level-k-models.html#cb255-139" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb255-140"><a href="application-level-k-models.html#cb255-140" tabindex="-1"></a>    </span>
<span id="cb255-141"><a href="application-level-k-models.html#cb255-141" tabindex="-1"></a>    </span>
<span id="cb255-142"><a href="application-level-k-models.html#cb255-142" tabindex="-1"></a>    </span>
<span id="cb255-143"><a href="application-level-k-models.html#cb255-143" tabindex="-1"></a>    </span>
<span id="cb255-144"><a href="application-level-k-models.html#cb255-144" tabindex="-1"></a>    </span>
<span id="cb255-145"><a href="application-level-k-models.html#cb255-145" tabindex="-1"></a>  <span class="op">}</span> <span class="co">// loop over games ends here</span></span>
<span id="cb255-146"><a href="application-level-k-models.html#cb255-146" tabindex="-1"></a>  </span>
<span id="cb255-147"><a href="application-level-k-models.html#cb255-147" tabindex="-1"></a>  </span>
<span id="cb255-148"><a href="application-level-k-models.html#cb255-148" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb255-149"><a href="application-level-k-models.html#cb255-149" tabindex="-1"></a></span>
<span id="cb255-150"><a href="application-level-k-models.html#cb255-150" tabindex="-1"></a>model <span class="op">{</span></span>
<span id="cb255-151"><a href="application-level-k-models.html#cb255-151" tabindex="-1"></a>  </span>
<span id="cb255-152"><a href="application-level-k-models.html#cb255-152" tabindex="-1"></a>  </span>
<span id="cb255-153"><a href="application-level-k-models.html#cb255-153" tabindex="-1"></a>  <span class="co">// priors --------------------------------------------------------------------</span></span>
<span id="cb255-154"><a href="application-level-k-models.html#cb255-154" tabindex="-1"></a>  target <span class="op">+=</span> dirichlet_lpdf<span class="op">(</span>mix <span class="op">|</span> prior_mix<span class="op">);</span></span>
<span id="cb255-155"><a href="application-level-k-models.html#cb255-155" tabindex="-1"></a>  target <span class="op">+=</span> lognormal_lpdf<span class="op">(</span>lambda <span class="op">|</span> prior_lambda<span class="op">[</span><span class="dv">1</span><span class="op">],</span>prior_lambda<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span>
<span id="cb255-156"><a href="application-level-k-models.html#cb255-156" tabindex="-1"></a>  </span>
<span id="cb255-157"><a href="application-level-k-models.html#cb255-157" tabindex="-1"></a></span>
<span id="cb255-158"><a href="application-level-k-models.html#cb255-158" tabindex="-1"></a>  </span>
<span id="cb255-159"><a href="application-level-k-models.html#cb255-159" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nparticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb255-160"><a href="application-level-k-models.html#cb255-160" tabindex="-1"></a>    target <span class="op">+=</span> log_sum_exp<span class="op">(</span>like_choices<span class="op">[</span>ii<span class="op">,]);</span></span>
<span id="cb255-161"><a href="application-level-k-models.html#cb255-161" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb255-162"><a href="application-level-k-models.html#cb255-162" tabindex="-1"></a>  </span>
<span id="cb255-163"><a href="application-level-k-models.html#cb255-163" tabindex="-1"></a>  </span>
<span id="cb255-164"><a href="application-level-k-models.html#cb255-164" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb255-165"><a href="application-level-k-models.html#cb255-165" tabindex="-1"></a></span>
<span id="cb255-166"><a href="application-level-k-models.html#cb255-166" tabindex="-1"></a></span>
<span id="cb255-167"><a href="application-level-k-models.html#cb255-167" tabindex="-1"></a></span>
<span id="cb255-168"><a href="application-level-k-models.html#cb255-168" tabindex="-1"></a>generated quantities <span class="op">{</span></span>
<span id="cb255-169"><a href="application-level-k-models.html#cb255-169" tabindex="-1"></a>  </span>
<span id="cb255-170"><a href="application-level-k-models.html#cb255-170" tabindex="-1"></a>  matrix<span class="op">[</span>nparticipants<span class="op">,</span>kmax<span class="op">]</span> postprob<span class="op">;</span></span>
<span id="cb255-171"><a href="application-level-k-models.html#cb255-171" tabindex="-1"></a>  vector<span class="op">[</span>nparticipants<span class="op">]</span> postk<span class="op">;</span></span>
<span id="cb255-172"><a href="application-level-k-models.html#cb255-172" tabindex="-1"></a>  </span>
<span id="cb255-173"><a href="application-level-k-models.html#cb255-173" tabindex="-1"></a>  <span class="cf">for</span> <span class="op">(</span>ii in <span class="dv">1</span><span class="op">:</span>nparticipants<span class="op">)</span> <span class="op">{</span></span>
<span id="cb255-174"><a href="application-level-k-models.html#cb255-174" tabindex="-1"></a>    postprob<span class="op">[</span>ii<span class="op">,]</span> <span class="op">=</span> softmax<span class="op">(</span>like_choices<span class="op">[</span>ii<span class="op">,]</span><span class="ch">&#39;)&#39;</span><span class="op">;</span></span>
<span id="cb255-175"><a href="application-level-k-models.html#cb255-175" tabindex="-1"></a>    postk<span class="op">[</span>ii<span class="op">]</span> <span class="op">=</span> postprob<span class="op">[</span>ii<span class="op">,]*</span>linspaced_vector<span class="op">(</span>kmax<span class="op">,</span><span class="dv">1</span><span class="op">,</span>kmax<span class="op">);</span></span>
<span id="cb255-176"><a href="application-level-k-models.html#cb255-176" tabindex="-1"></a>    </span>
<span id="cb255-177"><a href="application-level-k-models.html#cb255-177" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb255-178"><a href="application-level-k-models.html#cb255-178" tabindex="-1"></a>  </span>
<span id="cb255-179"><a href="application-level-k-models.html#cb255-179" tabindex="-1"></a>  </span>
<span id="cb255-180"><a href="application-level-k-models.html#cb255-180" tabindex="-1"></a>  </span>
<span id="cb255-181"><a href="application-level-k-models.html#cb255-181" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</div>
<div id="results-11" class="section level3 hasAnchor" number="20.7.2">
<h3><span class="header-section-number">20.7.2</span> Results<a href="application-level-k-models.html#results-11" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Estimates from this model are show in Table <a href="application-level-k-models.html#tab:CGC2006EqTable">20.3</a>. Probably the most similar model for comparison is to Table <a href="application-level-k-models.html#tab:CGC2006MixEstimates">20.1</a>. Here we have a slightly smaller fraction of level-1 types, and a more uniform distribution over the remaining types.</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="application-level-k-models.html#cb256-1" tabindex="-1"></a>Eq<span class="ot">&lt;-</span><span class="fu">summary</span>(<span class="st">&quot;Code/CGC2006/EstimatesLevelkEq.rds&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb256-2"><a href="application-level-k-models.html#cb256-2" tabindex="-1"></a>  <span class="fu">readRDS</span>())<span class="sc">$</span>summary <span class="sc">|&gt;</span></span>
<span id="cb256-3"><a href="application-level-k-models.html#cb256-3" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span>
<span id="cb256-4"><a href="application-level-k-models.html#cb256-4" tabindex="-1"></a></span>
<span id="cb256-5"><a href="application-level-k-models.html#cb256-5" tabindex="-1"></a>Eq <span class="sc">|&gt;</span></span>
<span id="cb256-6"><a href="application-level-k-models.html#cb256-6" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb256-7"><a href="application-level-k-models.html#cb256-7" tabindex="-1"></a>    <span class="fu">grepl</span>(<span class="st">&quot;mix&quot;</span>,<span class="fu">rownames</span>(Eq))</span>
<span id="cb256-8"><a href="application-level-k-models.html#cb256-8" tabindex="-1"></a>    <span class="sc">|</span> <span class="fu">grepl</span>(<span class="st">&quot;lambda&quot;</span>,<span class="fu">rownames</span>(Eq))</span>
<span id="cb256-9"><a href="application-level-k-models.html#cb256-9" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb256-10"><a href="application-level-k-models.html#cb256-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>n_eff,<span class="sc">-</span>Rhat) <span class="sc">|&gt;</span></span>
<span id="cb256-11"><a href="application-level-k-models.html#cb256-11" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">3</span>)<span class="sc">|&gt;</span> </span>
<span id="cb256-12"><a href="application-level-k-models.html#cb256-12" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Estimates from the mixture model assuming beliefs consistent with the truncated distribution of level-$k$ types. &quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb256-13"><a href="application-level-k-models.html#cb256-13" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<table class=" lightable-classic" style="color: black; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:CGC2006EqTable">Table 20.3: </span>Estimates from the mixture model assuming beliefs consistent with the truncated distribution of level-<span class="math inline">\(k\)</span> types.
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
se_mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
X2.5.
</th>
<th style="text-align:right;">
X25.
</th>
<th style="text-align:right;">
X50.
</th>
<th style="text-align:right;">
X75.
</th>
<th style="text-align:right;">
X97.5.
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
mix[1]
</td>
<td style="text-align:right;">
0.473
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.067
</td>
<td style="text-align:right;">
0.342
</td>
<td style="text-align:right;">
0.428
</td>
<td style="text-align:right;">
0.473
</td>
<td style="text-align:right;">
0.518
</td>
<td style="text-align:right;">
0.604
</td>
</tr>
<tr>
<td style="text-align:left;">
mix[2]
</td>
<td style="text-align:right;">
0.145
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.117
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.047
</td>
<td style="text-align:right;">
0.114
</td>
<td style="text-align:right;">
0.221
</td>
<td style="text-align:right;">
0.412
</td>
</tr>
<tr>
<td style="text-align:left;">
mix[3]
</td>
<td style="text-align:right;">
0.133
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.110
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.044
</td>
<td style="text-align:right;">
0.105
</td>
<td style="text-align:right;">
0.198
</td>
<td style="text-align:right;">
0.395
</td>
</tr>
<tr>
<td style="text-align:left;">
mix[4]
</td>
<td style="text-align:right;">
0.123
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.102
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.043
</td>
<td style="text-align:right;">
0.097
</td>
<td style="text-align:right;">
0.178
</td>
<td style="text-align:right;">
0.376
</td>
</tr>
<tr>
<td style="text-align:left;">
mix[5]
</td>
<td style="text-align:right;">
0.125
</td>
<td style="text-align:right;">
0.002
</td>
<td style="text-align:right;">
0.104
</td>
<td style="text-align:right;">
0.004
</td>
<td style="text-align:right;">
0.041
</td>
<td style="text-align:right;">
0.098
</td>
<td style="text-align:right;">
0.182
</td>
<td style="text-align:right;">
0.384
</td>
</tr>
<tr>
<td style="text-align:left;">
lambda
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.001
</td>
<td style="text-align:right;">
0.015
</td>
<td style="text-align:right;">
0.016
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
0.017
</td>
<td style="text-align:right;">
0.018
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="r-code-to-estimate-the-models" class="section level2 hasAnchor" number="20.8">
<h2><span class="header-section-number">20.8</span> <em>R</em> code to estimate the models<a href="application-level-k-models.html#r-code-to-estimate-the-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="participant-specific-estimation-conditional-on-k-with-bayesian-model-averaging" class="section level3 hasAnchor" number="20.8.1">
<h3><span class="header-section-number">20.8.1</span> Participant-specific estimation conditional on <span class="math inline">\(k\)</span> with Bayesian model averaging<a href="application-level-k-models.html#participant-specific-estimation-conditional-on-k-with-bayesian-model-averaging" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="application-level-k-models.html#cb257-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb257-2"><a href="application-level-k-models.html#cb257-2" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb257-3"><a href="application-level-k-models.html#cb257-3" tabindex="-1"></a>  <span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb257-4"><a href="application-level-k-models.html#cb257-4" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb257-5"><a href="application-level-k-models.html#cb257-5" tabindex="-1"></a><span class="fu">library</span>(bridgesampling)</span>
<span id="cb257-6"><a href="application-level-k-models.html#cb257-6" tabindex="-1"></a></span>
<span id="cb257-7"><a href="application-level-k-models.html#cb257-7" tabindex="-1"></a>kmax<span class="ot">&lt;-</span><span class="dv">5</span></span>
<span id="cb257-8"><a href="application-level-k-models.html#cb257-8" tabindex="-1"></a></span>
<span id="cb257-9"><a href="application-level-k-models.html#cb257-9" tabindex="-1"></a>model<span class="ot">&lt;-</span><span class="st">&quot;Code/CGC2006/LevelkRepAgent.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb257-10"><a href="application-level-k-models.html#cb257-10" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb257-11"><a href="application-level-k-models.html#cb257-11" tabindex="-1"></a></span>
<span id="cb257-12"><a href="application-level-k-models.html#cb257-12" tabindex="-1"></a>D<span class="ot">&lt;-</span><span class="st">&quot;Code/CGC2006/CGC2006rounded.rds&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb257-13"><a href="application-level-k-models.html#cb257-13" tabindex="-1"></a>  <span class="fu">readRDS</span>() <span class="sc">|&gt;</span></span>
<span id="cb257-14"><a href="application-level-k-models.html#cb257-14" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb257-15"><a href="application-level-k-models.html#cb257-15" tabindex="-1"></a>    <span class="co"># convert choices to adjusted choices</span></span>
<span id="cb257-16"><a href="application-level-k-models.html#cb257-16" tabindex="-1"></a>    <span class="at">choice =</span> <span class="fu">ifelse</span>(choice<span class="sc">&lt;</span>lb1,lb1,choice),</span>
<span id="cb257-17"><a href="application-level-k-models.html#cb257-17" tabindex="-1"></a>    <span class="at">choice =</span> <span class="fu">ifelse</span>(choice<span class="sc">&gt;</span>ub1,ub1,choice)</span>
<span id="cb257-18"><a href="application-level-k-models.html#cb257-18" tabindex="-1"></a>  )</span>
<span id="cb257-19"><a href="application-level-k-models.html#cb257-19" tabindex="-1"></a></span>
<span id="cb257-20"><a href="application-level-k-models.html#cb257-20" tabindex="-1"></a>ESTIMATES<span class="ot">&lt;-</span><span class="fu">tibble</span>()</span>
<span id="cb257-21"><a href="application-level-k-models.html#cb257-21" tabindex="-1"></a></span>
<span id="cb257-22"><a href="application-level-k-models.html#cb257-22" tabindex="-1"></a><span class="cf">for</span> (ii <span class="cf">in</span> <span class="fu">unique</span>(D<span class="sc">$</span>id)) {</span>
<span id="cb257-23"><a href="application-level-k-models.html#cb257-23" tabindex="-1"></a></span>
<span id="cb257-24"><a href="application-level-k-models.html#cb257-24" tabindex="-1"></a>  d<span class="ot">&lt;-</span> D <span class="sc">|&gt;</span> <span class="fu">filter</span>(id<span class="sc">==</span>ii)</span>
<span id="cb257-25"><a href="application-level-k-models.html#cb257-25" tabindex="-1"></a></span>
<span id="cb257-26"><a href="application-level-k-models.html#cb257-26" tabindex="-1"></a>  <span class="cf">for</span> (kk <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>kmax) {  </span>
<span id="cb257-27"><a href="application-level-k-models.html#cb257-27" tabindex="-1"></a>    </span>
<span id="cb257-28"><a href="application-level-k-models.html#cb257-28" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;estimating for id&quot;</span>,ii,<span class="st">&quot;k =&quot;</span>,kk))</span>
<span id="cb257-29"><a href="application-level-k-models.html#cb257-29" tabindex="-1"></a>    </span>
<span id="cb257-30"><a href="application-level-k-models.html#cb257-30" tabindex="-1"></a>    dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb257-31"><a href="application-level-k-models.html#cb257-31" tabindex="-1"></a>      </span>
<span id="cb257-32"><a href="application-level-k-models.html#cb257-32" tabindex="-1"></a>      <span class="at">ngames =</span> <span class="dv">16</span>,</span>
<span id="cb257-33"><a href="application-level-k-models.html#cb257-33" tabindex="-1"></a>      </span>
<span id="cb257-34"><a href="application-level-k-models.html#cb257-34" tabindex="-1"></a>      <span class="at">k =</span> kk,</span>
<span id="cb257-35"><a href="application-level-k-models.html#cb257-35" tabindex="-1"></a>      </span>
<span id="cb257-36"><a href="application-level-k-models.html#cb257-36" tabindex="-1"></a>      <span class="at">P1 =</span> d<span class="sc">$</span>p_1,</span>
<span id="cb257-37"><a href="application-level-k-models.html#cb257-37" tabindex="-1"></a>      <span class="at">P2 =</span> d<span class="sc">$</span>p_2,</span>
<span id="cb257-38"><a href="application-level-k-models.html#cb257-38" tabindex="-1"></a>      <span class="at">LB1 =</span> d<span class="sc">$</span>lb1,</span>
<span id="cb257-39"><a href="application-level-k-models.html#cb257-39" tabindex="-1"></a>      <span class="at">UB1 =</span> d<span class="sc">$</span>ub1,</span>
<span id="cb257-40"><a href="application-level-k-models.html#cb257-40" tabindex="-1"></a>      <span class="at">LB2 =</span> d<span class="sc">$</span>lb2,</span>
<span id="cb257-41"><a href="application-level-k-models.html#cb257-41" tabindex="-1"></a>      <span class="at">UB2 =</span> d<span class="sc">$</span>ub2,</span>
<span id="cb257-42"><a href="application-level-k-models.html#cb257-42" tabindex="-1"></a>      </span>
<span id="cb257-43"><a href="application-level-k-models.html#cb257-43" tabindex="-1"></a>      <span class="at">choice1 =</span> d<span class="sc">$</span>choice,</span>
<span id="cb257-44"><a href="application-level-k-models.html#cb257-44" tabindex="-1"></a>      </span>
<span id="cb257-45"><a href="application-level-k-models.html#cb257-45" tabindex="-1"></a>      <span class="at">prior_probExact =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb257-46"><a href="application-level-k-models.html#cb257-46" tabindex="-1"></a>      <span class="at">prior_lambda =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.96</span>,<span class="fl">1.35</span>),</span>
<span id="cb257-47"><a href="application-level-k-models.html#cb257-47" tabindex="-1"></a>      </span>
<span id="cb257-48"><a href="application-level-k-models.html#cb257-48" tabindex="-1"></a>      <span class="at">tol =</span> <span class="fl">0.001</span></span>
<span id="cb257-49"><a href="application-level-k-models.html#cb257-49" tabindex="-1"></a>      </span>
<span id="cb257-50"><a href="application-level-k-models.html#cb257-50" tabindex="-1"></a>      </span>
<span id="cb257-51"><a href="application-level-k-models.html#cb257-51" tabindex="-1"></a>    )</span>
<span id="cb257-52"><a href="application-level-k-models.html#cb257-52" tabindex="-1"></a>    </span>
<span id="cb257-53"><a href="application-level-k-models.html#cb257-53" tabindex="-1"></a>    Fit<span class="ot">&lt;-</span>model <span class="sc">|&gt;</span></span>
<span id="cb257-54"><a href="application-level-k-models.html#cb257-54" tabindex="-1"></a>      <span class="fu">sampling</span>(</span>
<span id="cb257-55"><a href="application-level-k-models.html#cb257-55" tabindex="-1"></a>        <span class="at">data=</span>dStan,</span>
<span id="cb257-56"><a href="application-level-k-models.html#cb257-56" tabindex="-1"></a>        <span class="at">seed=</span><span class="dv">42</span></span>
<span id="cb257-57"><a href="application-level-k-models.html#cb257-57" tabindex="-1"></a>      )</span>
<span id="cb257-58"><a href="application-level-k-models.html#cb257-58" tabindex="-1"></a>    </span>
<span id="cb257-59"><a href="application-level-k-models.html#cb257-59" tabindex="-1"></a>    lml<span class="ot">&lt;-</span><span class="fu">bridge_sampler</span>(Fit,<span class="at">silent=</span><span class="cn">TRUE</span>)</span>
<span id="cb257-60"><a href="application-level-k-models.html#cb257-60" tabindex="-1"></a>    </span>
<span id="cb257-61"><a href="application-level-k-models.html#cb257-61" tabindex="-1"></a>    ESTIMATES <span class="ot">&lt;-</span> ESTIMATES <span class="sc">|&gt;</span> </span>
<span id="cb257-62"><a href="application-level-k-models.html#cb257-62" tabindex="-1"></a>      <span class="fu">rbind</span>(</span>
<span id="cb257-63"><a href="application-level-k-models.html#cb257-63" tabindex="-1"></a>        <span class="fu">summary</span>(Fit)<span class="sc">$</span>summary <span class="sc">|&gt;</span> </span>
<span id="cb257-64"><a href="application-level-k-models.html#cb257-64" tabindex="-1"></a>          <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb257-65"><a href="application-level-k-models.html#cb257-65" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">id =</span> ii,</span>
<span id="cb257-66"><a href="application-level-k-models.html#cb257-66" tabindex="-1"></a>                 <span class="at">k =</span> kk,</span>
<span id="cb257-67"><a href="application-level-k-models.html#cb257-67" tabindex="-1"></a>                 <span class="at">logml =</span> lml<span class="sc">$</span>logml</span>
<span id="cb257-68"><a href="application-level-k-models.html#cb257-68" tabindex="-1"></a>                 )</span>
<span id="cb257-69"><a href="application-level-k-models.html#cb257-69" tabindex="-1"></a>      )</span>
<span id="cb257-70"><a href="application-level-k-models.html#cb257-70" tabindex="-1"></a>  }</span>
<span id="cb257-71"><a href="application-level-k-models.html#cb257-71" tabindex="-1"></a>  </span>
<span id="cb257-72"><a href="application-level-k-models.html#cb257-72" tabindex="-1"></a>  ESTIMATES <span class="sc">|&gt;</span> </span>
<span id="cb257-73"><a href="application-level-k-models.html#cb257-73" tabindex="-1"></a>    <span class="fu">saveRDS</span>(<span class="st">&quot;Code/CGC2006/EstimatesLevelkRepAgent.rds&quot;</span>)</span>
<span id="cb257-74"><a href="application-level-k-models.html#cb257-74" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="participant-specific-estimation-with-a-prior-over-k" class="section level3 hasAnchor" number="20.8.2">
<h3><span class="header-section-number">20.8.2</span> Participant-specific estimation with a prior over <span class="math inline">\(k\)</span><a href="application-level-k-models.html#participant-specific-estimation-with-a-prior-over-k" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="application-level-k-models.html#cb258-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb258-2"><a href="application-level-k-models.html#cb258-2" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb258-3"><a href="application-level-k-models.html#cb258-3" tabindex="-1"></a>  <span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb258-4"><a href="application-level-k-models.html#cb258-4" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb258-5"><a href="application-level-k-models.html#cb258-5" tabindex="-1"></a></span>
<span id="cb258-6"><a href="application-level-k-models.html#cb258-6" tabindex="-1"></a></span>
<span id="cb258-7"><a href="application-level-k-models.html#cb258-7" tabindex="-1"></a>model<span class="ot">&lt;-</span><span class="st">&quot;Code/CGC2006/LevelkBMA.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb258-8"><a href="application-level-k-models.html#cb258-8" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb258-9"><a href="application-level-k-models.html#cb258-9" tabindex="-1"></a></span>
<span id="cb258-10"><a href="application-level-k-models.html#cb258-10" tabindex="-1"></a>D<span class="ot">&lt;-</span><span class="st">&quot;Code/CGC2006/CGC2006rounded.rds&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb258-11"><a href="application-level-k-models.html#cb258-11" tabindex="-1"></a>  <span class="fu">readRDS</span>() <span class="sc">|&gt;</span></span>
<span id="cb258-12"><a href="application-level-k-models.html#cb258-12" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb258-13"><a href="application-level-k-models.html#cb258-13" tabindex="-1"></a>    <span class="co"># convert choices to adjusted choices</span></span>
<span id="cb258-14"><a href="application-level-k-models.html#cb258-14" tabindex="-1"></a>    <span class="at">choice =</span> <span class="fu">ifelse</span>(choice<span class="sc">&lt;</span>lb1,lb1,choice),</span>
<span id="cb258-15"><a href="application-level-k-models.html#cb258-15" tabindex="-1"></a>    <span class="at">choice =</span> <span class="fu">ifelse</span>(choice<span class="sc">&gt;</span>ub1,ub1,choice)</span>
<span id="cb258-16"><a href="application-level-k-models.html#cb258-16" tabindex="-1"></a>  )</span>
<span id="cb258-17"><a href="application-level-k-models.html#cb258-17" tabindex="-1"></a></span>
<span id="cb258-18"><a href="application-level-k-models.html#cb258-18" tabindex="-1"></a></span>
<span id="cb258-19"><a href="application-level-k-models.html#cb258-19" tabindex="-1"></a></span>
<span id="cb258-20"><a href="application-level-k-models.html#cb258-20" tabindex="-1"></a></span>
<span id="cb258-21"><a href="application-level-k-models.html#cb258-21" tabindex="-1"></a>ESTIMATES<span class="ot">&lt;-</span><span class="fu">tibble</span>()</span>
<span id="cb258-22"><a href="application-level-k-models.html#cb258-22" tabindex="-1"></a></span>
<span id="cb258-23"><a href="application-level-k-models.html#cb258-23" tabindex="-1"></a><span class="cf">for</span> (ii <span class="cf">in</span> <span class="fu">unique</span>(D<span class="sc">$</span>id)) {</span>
<span id="cb258-24"><a href="application-level-k-models.html#cb258-24" tabindex="-1"></a></span>
<span id="cb258-25"><a href="application-level-k-models.html#cb258-25" tabindex="-1"></a>  d<span class="ot">&lt;-</span> D <span class="sc">|&gt;</span> <span class="fu">filter</span>(id<span class="sc">==</span>ii)</span>
<span id="cb258-26"><a href="application-level-k-models.html#cb258-26" tabindex="-1"></a>    </span>
<span id="cb258-27"><a href="application-level-k-models.html#cb258-27" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;estimating for id&quot;</span>,ii))</span>
<span id="cb258-28"><a href="application-level-k-models.html#cb258-28" tabindex="-1"></a>    </span>
<span id="cb258-29"><a href="application-level-k-models.html#cb258-29" tabindex="-1"></a>    dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb258-30"><a href="application-level-k-models.html#cb258-30" tabindex="-1"></a>      </span>
<span id="cb258-31"><a href="application-level-k-models.html#cb258-31" tabindex="-1"></a>      <span class="at">ngames =</span> <span class="dv">16</span>,</span>
<span id="cb258-32"><a href="application-level-k-models.html#cb258-32" tabindex="-1"></a>      </span>
<span id="cb258-33"><a href="application-level-k-models.html#cb258-33" tabindex="-1"></a>      <span class="at">kmax =</span> <span class="dv">5</span>,</span>
<span id="cb258-34"><a href="application-level-k-models.html#cb258-34" tabindex="-1"></a>      </span>
<span id="cb258-35"><a href="application-level-k-models.html#cb258-35" tabindex="-1"></a>      <span class="at">P1 =</span> d<span class="sc">$</span>p_1,</span>
<span id="cb258-36"><a href="application-level-k-models.html#cb258-36" tabindex="-1"></a>      <span class="at">P2 =</span> d<span class="sc">$</span>p_2,</span>
<span id="cb258-37"><a href="application-level-k-models.html#cb258-37" tabindex="-1"></a>      <span class="at">LB1 =</span> d<span class="sc">$</span>lb1,</span>
<span id="cb258-38"><a href="application-level-k-models.html#cb258-38" tabindex="-1"></a>      <span class="at">UB1 =</span> d<span class="sc">$</span>ub1,</span>
<span id="cb258-39"><a href="application-level-k-models.html#cb258-39" tabindex="-1"></a>      <span class="at">LB2 =</span> d<span class="sc">$</span>lb2,</span>
<span id="cb258-40"><a href="application-level-k-models.html#cb258-40" tabindex="-1"></a>      <span class="at">UB2 =</span> d<span class="sc">$</span>ub2,</span>
<span id="cb258-41"><a href="application-level-k-models.html#cb258-41" tabindex="-1"></a>      </span>
<span id="cb258-42"><a href="application-level-k-models.html#cb258-42" tabindex="-1"></a>      <span class="at">choice1 =</span> d<span class="sc">$</span>choice,</span>
<span id="cb258-43"><a href="application-level-k-models.html#cb258-43" tabindex="-1"></a>      </span>
<span id="cb258-44"><a href="application-level-k-models.html#cb258-44" tabindex="-1"></a>      <span class="at">prior_probExact =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb258-45"><a href="application-level-k-models.html#cb258-45" tabindex="-1"></a>      <span class="at">prior_lambda =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.96</span>,<span class="fl">1.35</span>),</span>
<span id="cb258-46"><a href="application-level-k-models.html#cb258-46" tabindex="-1"></a>      <span class="at">prior_k =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>,<span class="dv">5</span>),</span>
<span id="cb258-47"><a href="application-level-k-models.html#cb258-47" tabindex="-1"></a>      </span>
<span id="cb258-48"><a href="application-level-k-models.html#cb258-48" tabindex="-1"></a>      <span class="at">tol =</span> <span class="fl">0.001</span></span>
<span id="cb258-49"><a href="application-level-k-models.html#cb258-49" tabindex="-1"></a>      </span>
<span id="cb258-50"><a href="application-level-k-models.html#cb258-50" tabindex="-1"></a>      </span>
<span id="cb258-51"><a href="application-level-k-models.html#cb258-51" tabindex="-1"></a>    )</span>
<span id="cb258-52"><a href="application-level-k-models.html#cb258-52" tabindex="-1"></a>    </span>
<span id="cb258-53"><a href="application-level-k-models.html#cb258-53" tabindex="-1"></a>    Fit<span class="ot">&lt;-</span>model <span class="sc">|&gt;</span></span>
<span id="cb258-54"><a href="application-level-k-models.html#cb258-54" tabindex="-1"></a>      <span class="fu">sampling</span>(</span>
<span id="cb258-55"><a href="application-level-k-models.html#cb258-55" tabindex="-1"></a>        <span class="at">data=</span>dStan,</span>
<span id="cb258-56"><a href="application-level-k-models.html#cb258-56" tabindex="-1"></a>        <span class="at">seed=</span><span class="dv">42</span></span>
<span id="cb258-57"><a href="application-level-k-models.html#cb258-57" tabindex="-1"></a>      )</span>
<span id="cb258-58"><a href="application-level-k-models.html#cb258-58" tabindex="-1"></a>    </span>
<span id="cb258-59"><a href="application-level-k-models.html#cb258-59" tabindex="-1"></a>    addThis<span class="ot">&lt;-</span><span class="fu">summary</span>(Fit)<span class="sc">$</span>summary <span class="sc">|&gt;</span> </span>
<span id="cb258-60"><a href="application-level-k-models.html#cb258-60" tabindex="-1"></a>      <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb258-61"><a href="application-level-k-models.html#cb258-61" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">id =</span> ii)</span>
<span id="cb258-62"><a href="application-level-k-models.html#cb258-62" tabindex="-1"></a>    </span>
<span id="cb258-63"><a href="application-level-k-models.html#cb258-63" tabindex="-1"></a>    addThis<span class="sc">$</span>parameter<span class="ot">&lt;-</span><span class="fu">rownames</span>(addThis)</span>
<span id="cb258-64"><a href="application-level-k-models.html#cb258-64" tabindex="-1"></a>    </span>
<span id="cb258-65"><a href="application-level-k-models.html#cb258-65" tabindex="-1"></a>    ESTIMATES <span class="ot">&lt;-</span> ESTIMATES <span class="sc">|&gt;</span> </span>
<span id="cb258-66"><a href="application-level-k-models.html#cb258-66" tabindex="-1"></a>      <span class="fu">rbind</span>(addThis)</span>
<span id="cb258-67"><a href="application-level-k-models.html#cb258-67" tabindex="-1"></a>  </span>
<span id="cb258-68"><a href="application-level-k-models.html#cb258-68" tabindex="-1"></a>  ESTIMATES <span class="sc">|&gt;</span> </span>
<span id="cb258-69"><a href="application-level-k-models.html#cb258-69" tabindex="-1"></a>    <span class="fu">saveRDS</span>(<span class="st">&quot;Code/CGC2006/EstimatesLevelkBMA.rds&quot;</span>)</span>
<span id="cb258-70"><a href="application-level-k-models.html#cb258-70" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="mixture-model" class="section level3 hasAnchor" number="20.8.3">
<h3><span class="header-section-number">20.8.3</span> Mixture model<a href="application-level-k-models.html#mixture-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="application-level-k-models.html#cb259-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb259-2"><a href="application-level-k-models.html#cb259-2" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb259-3"><a href="application-level-k-models.html#cb259-3" tabindex="-1"></a>  <span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb259-4"><a href="application-level-k-models.html#cb259-4" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb259-5"><a href="application-level-k-models.html#cb259-5" tabindex="-1"></a></span>
<span id="cb259-6"><a href="application-level-k-models.html#cb259-6" tabindex="-1"></a>model<span class="ot">&lt;-</span><span class="st">&quot;Code/CGC2006/LevelkMixture.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb259-7"><a href="application-level-k-models.html#cb259-7" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb259-8"><a href="application-level-k-models.html#cb259-8" tabindex="-1"></a></span>
<span id="cb259-9"><a href="application-level-k-models.html#cb259-9" tabindex="-1"></a></span>
<span id="cb259-10"><a href="application-level-k-models.html#cb259-10" tabindex="-1"></a></span>
<span id="cb259-11"><a href="application-level-k-models.html#cb259-11" tabindex="-1"></a></span>
<span id="cb259-12"><a href="application-level-k-models.html#cb259-12" tabindex="-1"></a></span>
<span id="cb259-13"><a href="application-level-k-models.html#cb259-13" tabindex="-1"></a>D<span class="ot">&lt;-</span><span class="st">&quot;Code/CGC2006/CGC2006rounded.rds&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb259-14"><a href="application-level-k-models.html#cb259-14" tabindex="-1"></a>  <span class="fu">readRDS</span>() <span class="sc">|&gt;</span></span>
<span id="cb259-15"><a href="application-level-k-models.html#cb259-15" tabindex="-1"></a>  <span class="fu">arrange</span>(id,game) <span class="sc">|&gt;</span></span>
<span id="cb259-16"><a href="application-level-k-models.html#cb259-16" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb259-17"><a href="application-level-k-models.html#cb259-17" tabindex="-1"></a>    <span class="co"># convert choices to adjusted choices</span></span>
<span id="cb259-18"><a href="application-level-k-models.html#cb259-18" tabindex="-1"></a>    <span class="at">choice =</span> <span class="fu">ifelse</span>(choice<span class="sc">&lt;</span>lb1,lb1,choice),</span>
<span id="cb259-19"><a href="application-level-k-models.html#cb259-19" tabindex="-1"></a>    <span class="at">choice =</span> <span class="fu">ifelse</span>(choice<span class="sc">&gt;</span>ub1,ub1,choice)</span>
<span id="cb259-20"><a href="application-level-k-models.html#cb259-20" tabindex="-1"></a>  )</span>
<span id="cb259-21"><a href="application-level-k-models.html#cb259-21" tabindex="-1"></a></span>
<span id="cb259-22"><a href="application-level-k-models.html#cb259-22" tabindex="-1"></a>choices<span class="ot">&lt;-</span>D <span class="sc">|&gt;</span></span>
<span id="cb259-23"><a href="application-level-k-models.html#cb259-23" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb259-24"><a href="application-level-k-models.html#cb259-24" tabindex="-1"></a>              <span class="at">names_from =</span> game,</span>
<span id="cb259-25"><a href="application-level-k-models.html#cb259-25" tabindex="-1"></a>              <span class="at">values_from =</span> choice) <span class="sc">|&gt;</span></span>
<span id="cb259-26"><a href="application-level-k-models.html#cb259-26" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">|&gt;</span></span>
<span id="cb259-27"><a href="application-level-k-models.html#cb259-27" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb259-28"><a href="application-level-k-models.html#cb259-28" tabindex="-1"></a></span>
<span id="cb259-29"><a href="application-level-k-models.html#cb259-29" tabindex="-1"></a>d<span class="ot">&lt;-</span>D <span class="sc">|&gt;</span> <span class="fu">filter</span>(id<span class="sc">==</span><span class="dv">101</span>)</span>
<span id="cb259-30"><a href="application-level-k-models.html#cb259-30" tabindex="-1"></a></span>
<span id="cb259-31"><a href="application-level-k-models.html#cb259-31" tabindex="-1"></a></span>
<span id="cb259-32"><a href="application-level-k-models.html#cb259-32" tabindex="-1"></a>dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb259-33"><a href="application-level-k-models.html#cb259-33" tabindex="-1"></a>  <span class="at">ngames =</span> <span class="dv">16</span>,</span>
<span id="cb259-34"><a href="application-level-k-models.html#cb259-34" tabindex="-1"></a>  <span class="at">nparticipants =</span> <span class="fu">dim</span>(choices)[<span class="dv">1</span>],</span>
<span id="cb259-35"><a href="application-level-k-models.html#cb259-35" tabindex="-1"></a>  </span>
<span id="cb259-36"><a href="application-level-k-models.html#cb259-36" tabindex="-1"></a>  <span class="at">kmax =</span> <span class="dv">5</span>,</span>
<span id="cb259-37"><a href="application-level-k-models.html#cb259-37" tabindex="-1"></a>  <span class="at">P1 =</span> d<span class="sc">$</span>p_1,</span>
<span id="cb259-38"><a href="application-level-k-models.html#cb259-38" tabindex="-1"></a>  <span class="at">P2 =</span> d<span class="sc">$</span>p_2,</span>
<span id="cb259-39"><a href="application-level-k-models.html#cb259-39" tabindex="-1"></a>  <span class="at">LB1 =</span> d<span class="sc">$</span>lb1,</span>
<span id="cb259-40"><a href="application-level-k-models.html#cb259-40" tabindex="-1"></a>  <span class="at">UB1 =</span> d<span class="sc">$</span>ub1,</span>
<span id="cb259-41"><a href="application-level-k-models.html#cb259-41" tabindex="-1"></a>  <span class="at">LB2 =</span> d<span class="sc">$</span>lb2,</span>
<span id="cb259-42"><a href="application-level-k-models.html#cb259-42" tabindex="-1"></a>  <span class="at">UB2 =</span> d<span class="sc">$</span>ub2,</span>
<span id="cb259-43"><a href="application-level-k-models.html#cb259-43" tabindex="-1"></a>  </span>
<span id="cb259-44"><a href="application-level-k-models.html#cb259-44" tabindex="-1"></a>  <span class="at">choice1 =</span> choices,</span>
<span id="cb259-45"><a href="application-level-k-models.html#cb259-45" tabindex="-1"></a>  </span>
<span id="cb259-46"><a href="application-level-k-models.html#cb259-46" tabindex="-1"></a>  <span class="at">prior_probExact =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb259-47"><a href="application-level-k-models.html#cb259-47" tabindex="-1"></a>  <span class="at">prior_lambda =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.96</span>,<span class="fl">1.35</span>),</span>
<span id="cb259-48"><a href="application-level-k-models.html#cb259-48" tabindex="-1"></a>  </span>
<span id="cb259-49"><a href="application-level-k-models.html#cb259-49" tabindex="-1"></a>  <span class="at">prior_mix =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">5</span>),</span>
<span id="cb259-50"><a href="application-level-k-models.html#cb259-50" tabindex="-1"></a>  </span>
<span id="cb259-51"><a href="application-level-k-models.html#cb259-51" tabindex="-1"></a>  <span class="at">tol =</span> <span class="fl">0.001</span></span>
<span id="cb259-52"><a href="application-level-k-models.html#cb259-52" tabindex="-1"></a>  </span>
<span id="cb259-53"><a href="application-level-k-models.html#cb259-53" tabindex="-1"></a>  </span>
<span id="cb259-54"><a href="application-level-k-models.html#cb259-54" tabindex="-1"></a>  </span>
<span id="cb259-55"><a href="application-level-k-models.html#cb259-55" tabindex="-1"></a>)</span>
<span id="cb259-56"><a href="application-level-k-models.html#cb259-56" tabindex="-1"></a></span>
<span id="cb259-57"><a href="application-level-k-models.html#cb259-57" tabindex="-1"></a>Fit<span class="ot">&lt;-</span>model <span class="sc">|&gt;</span></span>
<span id="cb259-58"><a href="application-level-k-models.html#cb259-58" tabindex="-1"></a>  <span class="fu">sampling</span>(</span>
<span id="cb259-59"><a href="application-level-k-models.html#cb259-59" tabindex="-1"></a>    <span class="at">data=</span>dStan,</span>
<span id="cb259-60"><a href="application-level-k-models.html#cb259-60" tabindex="-1"></a>    <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;like_choices&quot;</span>),<span class="at">include=</span><span class="cn">FALSE</span>,</span>
<span id="cb259-61"><a href="application-level-k-models.html#cb259-61" tabindex="-1"></a>    <span class="at">iter=</span><span class="dv">2000</span>,</span>
<span id="cb259-62"><a href="application-level-k-models.html#cb259-62" tabindex="-1"></a>    <span class="at">seed=</span><span class="dv">42</span></span>
<span id="cb259-63"><a href="application-level-k-models.html#cb259-63" tabindex="-1"></a>      )</span>
<span id="cb259-64"><a href="application-level-k-models.html#cb259-64" tabindex="-1"></a></span>
<span id="cb259-65"><a href="application-level-k-models.html#cb259-65" tabindex="-1"></a>Fit <span class="sc">|&gt;</span></span>
<span id="cb259-66"><a href="application-level-k-models.html#cb259-66" tabindex="-1"></a>  <span class="fu">saveRDS</span>(<span class="at">file=</span><span class="st">&quot;Code/CGC2006/EstimatesLevelkMixture.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="hierarchical-model-1" class="section level3 hasAnchor" number="20.8.4">
<h3><span class="header-section-number">20.8.4</span> Hierarchical model<a href="application-level-k-models.html#hierarchical-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="application-level-k-models.html#cb260-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb260-2"><a href="application-level-k-models.html#cb260-2" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb260-3"><a href="application-level-k-models.html#cb260-3" tabindex="-1"></a>  <span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb260-4"><a href="application-level-k-models.html#cb260-4" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb260-5"><a href="application-level-k-models.html#cb260-5" tabindex="-1"></a></span>
<span id="cb260-6"><a href="application-level-k-models.html#cb260-6" tabindex="-1"></a>model<span class="ot">&lt;-</span><span class="st">&quot;Code/CGC2006/LevelkHierarchicalMixture.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb260-7"><a href="application-level-k-models.html#cb260-7" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb260-8"><a href="application-level-k-models.html#cb260-8" tabindex="-1"></a></span>
<span id="cb260-9"><a href="application-level-k-models.html#cb260-9" tabindex="-1"></a></span>
<span id="cb260-10"><a href="application-level-k-models.html#cb260-10" tabindex="-1"></a></span>
<span id="cb260-11"><a href="application-level-k-models.html#cb260-11" tabindex="-1"></a></span>
<span id="cb260-12"><a href="application-level-k-models.html#cb260-12" tabindex="-1"></a></span>
<span id="cb260-13"><a href="application-level-k-models.html#cb260-13" tabindex="-1"></a>D<span class="ot">&lt;-</span><span class="st">&quot;Code/CGC2006/CGC2006rounded.rds&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb260-14"><a href="application-level-k-models.html#cb260-14" tabindex="-1"></a>  <span class="fu">readRDS</span>() <span class="sc">|&gt;</span></span>
<span id="cb260-15"><a href="application-level-k-models.html#cb260-15" tabindex="-1"></a>  <span class="fu">arrange</span>(id,game) <span class="sc">|&gt;</span></span>
<span id="cb260-16"><a href="application-level-k-models.html#cb260-16" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb260-17"><a href="application-level-k-models.html#cb260-17" tabindex="-1"></a>    <span class="co"># convert choices to adjusted choices</span></span>
<span id="cb260-18"><a href="application-level-k-models.html#cb260-18" tabindex="-1"></a>    <span class="at">choice =</span> <span class="fu">ifelse</span>(choice<span class="sc">&lt;</span>lb1,lb1,choice),</span>
<span id="cb260-19"><a href="application-level-k-models.html#cb260-19" tabindex="-1"></a>    <span class="at">choice =</span> <span class="fu">ifelse</span>(choice<span class="sc">&gt;</span>ub1,ub1,choice)</span>
<span id="cb260-20"><a href="application-level-k-models.html#cb260-20" tabindex="-1"></a>  )</span>
<span id="cb260-21"><a href="application-level-k-models.html#cb260-21" tabindex="-1"></a></span>
<span id="cb260-22"><a href="application-level-k-models.html#cb260-22" tabindex="-1"></a>choices<span class="ot">&lt;-</span>D <span class="sc">|&gt;</span></span>
<span id="cb260-23"><a href="application-level-k-models.html#cb260-23" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb260-24"><a href="application-level-k-models.html#cb260-24" tabindex="-1"></a>              <span class="at">names_from =</span> game,</span>
<span id="cb260-25"><a href="application-level-k-models.html#cb260-25" tabindex="-1"></a>              <span class="at">values_from =</span> choice) <span class="sc">|&gt;</span></span>
<span id="cb260-26"><a href="application-level-k-models.html#cb260-26" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">|&gt;</span></span>
<span id="cb260-27"><a href="application-level-k-models.html#cb260-27" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb260-28"><a href="application-level-k-models.html#cb260-28" tabindex="-1"></a></span>
<span id="cb260-29"><a href="application-level-k-models.html#cb260-29" tabindex="-1"></a>d<span class="ot">&lt;-</span>D <span class="sc">|&gt;</span> <span class="fu">filter</span>(id<span class="sc">==</span><span class="dv">101</span>)</span>
<span id="cb260-30"><a href="application-level-k-models.html#cb260-30" tabindex="-1"></a></span>
<span id="cb260-31"><a href="application-level-k-models.html#cb260-31" tabindex="-1"></a></span>
<span id="cb260-32"><a href="application-level-k-models.html#cb260-32" tabindex="-1"></a>dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb260-33"><a href="application-level-k-models.html#cb260-33" tabindex="-1"></a>  <span class="at">ngames =</span> <span class="dv">16</span>,</span>
<span id="cb260-34"><a href="application-level-k-models.html#cb260-34" tabindex="-1"></a>  <span class="at">nparticipants =</span> <span class="fu">dim</span>(choices)[<span class="dv">1</span>],</span>
<span id="cb260-35"><a href="application-level-k-models.html#cb260-35" tabindex="-1"></a>  </span>
<span id="cb260-36"><a href="application-level-k-models.html#cb260-36" tabindex="-1"></a>  <span class="at">kmax =</span> <span class="dv">5</span>,</span>
<span id="cb260-37"><a href="application-level-k-models.html#cb260-37" tabindex="-1"></a>  <span class="at">P1 =</span> d<span class="sc">$</span>p_1,</span>
<span id="cb260-38"><a href="application-level-k-models.html#cb260-38" tabindex="-1"></a>  <span class="at">P2 =</span> d<span class="sc">$</span>p_2,</span>
<span id="cb260-39"><a href="application-level-k-models.html#cb260-39" tabindex="-1"></a>  <span class="at">LB1 =</span> d<span class="sc">$</span>lb1,</span>
<span id="cb260-40"><a href="application-level-k-models.html#cb260-40" tabindex="-1"></a>  <span class="at">UB1 =</span> d<span class="sc">$</span>ub1,</span>
<span id="cb260-41"><a href="application-level-k-models.html#cb260-41" tabindex="-1"></a>  <span class="at">LB2 =</span> d<span class="sc">$</span>lb2,</span>
<span id="cb260-42"><a href="application-level-k-models.html#cb260-42" tabindex="-1"></a>  <span class="at">UB2 =</span> d<span class="sc">$</span>ub2,</span>
<span id="cb260-43"><a href="application-level-k-models.html#cb260-43" tabindex="-1"></a>  </span>
<span id="cb260-44"><a href="application-level-k-models.html#cb260-44" tabindex="-1"></a>  <span class="at">choice1 =</span> choices,</span>
<span id="cb260-45"><a href="application-level-k-models.html#cb260-45" tabindex="-1"></a>  </span>
<span id="cb260-46"><a href="application-level-k-models.html#cb260-46" tabindex="-1"></a>  <span class="at">prior_MU =</span> <span class="fu">list</span>(</span>
<span id="cb260-47"><a href="application-level-k-models.html#cb260-47" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.25</span>),</span>
<span id="cb260-48"><a href="application-level-k-models.html#cb260-48" tabindex="-1"></a>    <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.96</span>,<span class="fl">1.35</span>)</span>
<span id="cb260-49"><a href="application-level-k-models.html#cb260-49" tabindex="-1"></a>  ),</span>
<span id="cb260-50"><a href="application-level-k-models.html#cb260-50" tabindex="-1"></a>  <span class="at">prior_TAU =</span> <span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.05</span>),</span>
<span id="cb260-51"><a href="application-level-k-models.html#cb260-51" tabindex="-1"></a>  <span class="at">prior_OMEGA =</span> <span class="dv">4</span>,</span>
<span id="cb260-52"><a href="application-level-k-models.html#cb260-52" tabindex="-1"></a>  <span class="at">prior_mix =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">5</span>),</span>
<span id="cb260-53"><a href="application-level-k-models.html#cb260-53" tabindex="-1"></a>  </span>
<span id="cb260-54"><a href="application-level-k-models.html#cb260-54" tabindex="-1"></a>  <span class="at">tol =</span> <span class="fl">0.001</span></span>
<span id="cb260-55"><a href="application-level-k-models.html#cb260-55" tabindex="-1"></a>  </span>
<span id="cb260-56"><a href="application-level-k-models.html#cb260-56" tabindex="-1"></a>  </span>
<span id="cb260-57"><a href="application-level-k-models.html#cb260-57" tabindex="-1"></a>  </span>
<span id="cb260-58"><a href="application-level-k-models.html#cb260-58" tabindex="-1"></a>)</span>
<span id="cb260-59"><a href="application-level-k-models.html#cb260-59" tabindex="-1"></a></span>
<span id="cb260-60"><a href="application-level-k-models.html#cb260-60" tabindex="-1"></a>Fit<span class="ot">&lt;-</span>model <span class="sc">|&gt;</span></span>
<span id="cb260-61"><a href="application-level-k-models.html#cb260-61" tabindex="-1"></a>  <span class="fu">sampling</span>(</span>
<span id="cb260-62"><a href="application-level-k-models.html#cb260-62" tabindex="-1"></a>    <span class="at">data=</span>dStan,</span>
<span id="cb260-63"><a href="application-level-k-models.html#cb260-63" tabindex="-1"></a>    <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;z&quot;</span>,<span class="st">&quot;L_OMEGA&quot;</span>,<span class="st">&quot;like_choices&quot;</span>),<span class="at">include=</span><span class="cn">FALSE</span>,</span>
<span id="cb260-64"><a href="application-level-k-models.html#cb260-64" tabindex="-1"></a>    <span class="co"># I got the bulk and tail ESS warnings when running this with iter = 2000</span></span>
<span id="cb260-65"><a href="application-level-k-models.html#cb260-65" tabindex="-1"></a>    <span class="at">iter=</span><span class="dv">10000</span>,</span>
<span id="cb260-66"><a href="application-level-k-models.html#cb260-66" tabindex="-1"></a>    <span class="at">seed=</span><span class="dv">42</span></span>
<span id="cb260-67"><a href="application-level-k-models.html#cb260-67" tabindex="-1"></a>      )</span>
<span id="cb260-68"><a href="application-level-k-models.html#cb260-68" tabindex="-1"></a></span>
<span id="cb260-69"><a href="application-level-k-models.html#cb260-69" tabindex="-1"></a>Fit <span class="sc">|&gt;</span></span>
<span id="cb260-70"><a href="application-level-k-models.html#cb260-70" tabindex="-1"></a>  <span class="fu">saveRDS</span>(<span class="at">file=</span><span class="st">&quot;Code/CGC2006/EstimatesLevelkHierarchicalMixture.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="mixture-model-with-beliefs-consistent-with-truncated-type-distribution" class="section level3 hasAnchor" number="20.8.5">
<h3><span class="header-section-number">20.8.5</span> Mixture model with beliefs consistent with truncated type distribution<a href="application-level-k-models.html#mixture-model-with-beliefs-consistent-with-truncated-type-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="application-level-k-models.html#cb261-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb261-2"><a href="application-level-k-models.html#cb261-2" tabindex="-1"></a><span class="fu">library</span>(rstan)</span>
<span id="cb261-3"><a href="application-level-k-models.html#cb261-3" tabindex="-1"></a>  <span class="fu">rstan_options</span>(<span class="at">auto_write =</span> <span class="cn">TRUE</span>)</span>
<span id="cb261-4"><a href="application-level-k-models.html#cb261-4" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">mc.cores =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>())</span>
<span id="cb261-5"><a href="application-level-k-models.html#cb261-5" tabindex="-1"></a></span>
<span id="cb261-6"><a href="application-level-k-models.html#cb261-6" tabindex="-1"></a>model<span class="ot">&lt;-</span><span class="st">&quot;Code/CGC2006/LevelkEq.stan&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb261-7"><a href="application-level-k-models.html#cb261-7" tabindex="-1"></a>  <span class="fu">stan_model</span>()</span>
<span id="cb261-8"><a href="application-level-k-models.html#cb261-8" tabindex="-1"></a></span>
<span id="cb261-9"><a href="application-level-k-models.html#cb261-9" tabindex="-1"></a></span>
<span id="cb261-10"><a href="application-level-k-models.html#cb261-10" tabindex="-1"></a></span>
<span id="cb261-11"><a href="application-level-k-models.html#cb261-11" tabindex="-1"></a></span>
<span id="cb261-12"><a href="application-level-k-models.html#cb261-12" tabindex="-1"></a></span>
<span id="cb261-13"><a href="application-level-k-models.html#cb261-13" tabindex="-1"></a>D<span class="ot">&lt;-</span><span class="st">&quot;Code/CGC2006/CGC2006rounded.rds&quot;</span> <span class="sc">|&gt;</span></span>
<span id="cb261-14"><a href="application-level-k-models.html#cb261-14" tabindex="-1"></a>  <span class="fu">readRDS</span>() <span class="sc">|&gt;</span></span>
<span id="cb261-15"><a href="application-level-k-models.html#cb261-15" tabindex="-1"></a>  <span class="fu">arrange</span>(id,game) <span class="sc">|&gt;</span></span>
<span id="cb261-16"><a href="application-level-k-models.html#cb261-16" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb261-17"><a href="application-level-k-models.html#cb261-17" tabindex="-1"></a>    <span class="co"># convert choices to adjusted choices</span></span>
<span id="cb261-18"><a href="application-level-k-models.html#cb261-18" tabindex="-1"></a>    <span class="at">choice =</span> <span class="fu">ifelse</span>(choice<span class="sc">&lt;</span>lb1,lb1,choice),</span>
<span id="cb261-19"><a href="application-level-k-models.html#cb261-19" tabindex="-1"></a>    <span class="at">choice =</span> <span class="fu">ifelse</span>(choice<span class="sc">&gt;</span>ub1,ub1,choice)</span>
<span id="cb261-20"><a href="application-level-k-models.html#cb261-20" tabindex="-1"></a>  )</span>
<span id="cb261-21"><a href="application-level-k-models.html#cb261-21" tabindex="-1"></a></span>
<span id="cb261-22"><a href="application-level-k-models.html#cb261-22" tabindex="-1"></a>choices<span class="ot">&lt;-</span>D <span class="sc">|&gt;</span></span>
<span id="cb261-23"><a href="application-level-k-models.html#cb261-23" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb261-24"><a href="application-level-k-models.html#cb261-24" tabindex="-1"></a>              <span class="at">names_from =</span> game,</span>
<span id="cb261-25"><a href="application-level-k-models.html#cb261-25" tabindex="-1"></a>              <span class="at">values_from =</span> choice) <span class="sc">|&gt;</span></span>
<span id="cb261-26"><a href="application-level-k-models.html#cb261-26" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">|&gt;</span></span>
<span id="cb261-27"><a href="application-level-k-models.html#cb261-27" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb261-28"><a href="application-level-k-models.html#cb261-28" tabindex="-1"></a></span>
<span id="cb261-29"><a href="application-level-k-models.html#cb261-29" tabindex="-1"></a>d<span class="ot">&lt;-</span>D <span class="sc">|&gt;</span> <span class="fu">filter</span>(id<span class="sc">==</span><span class="dv">101</span>)</span>
<span id="cb261-30"><a href="application-level-k-models.html#cb261-30" tabindex="-1"></a></span>
<span id="cb261-31"><a href="application-level-k-models.html#cb261-31" tabindex="-1"></a></span>
<span id="cb261-32"><a href="application-level-k-models.html#cb261-32" tabindex="-1"></a>dStan<span class="ot">&lt;-</span><span class="fu">list</span>(</span>
<span id="cb261-33"><a href="application-level-k-models.html#cb261-33" tabindex="-1"></a>  <span class="at">ngames =</span> <span class="dv">16</span>,</span>
<span id="cb261-34"><a href="application-level-k-models.html#cb261-34" tabindex="-1"></a>  <span class="at">nparticipants =</span> <span class="fu">dim</span>(choices)[<span class="dv">1</span>],</span>
<span id="cb261-35"><a href="application-level-k-models.html#cb261-35" tabindex="-1"></a>  </span>
<span id="cb261-36"><a href="application-level-k-models.html#cb261-36" tabindex="-1"></a>  <span class="at">kmax =</span> <span class="dv">5</span>,</span>
<span id="cb261-37"><a href="application-level-k-models.html#cb261-37" tabindex="-1"></a>  <span class="at">P1 =</span> d<span class="sc">$</span>p_1,</span>
<span id="cb261-38"><a href="application-level-k-models.html#cb261-38" tabindex="-1"></a>  <span class="at">P2 =</span> d<span class="sc">$</span>p_2,</span>
<span id="cb261-39"><a href="application-level-k-models.html#cb261-39" tabindex="-1"></a>  <span class="at">LB1 =</span> d<span class="sc">$</span>lb1,</span>
<span id="cb261-40"><a href="application-level-k-models.html#cb261-40" tabindex="-1"></a>  <span class="at">UB1 =</span> d<span class="sc">$</span>ub1,</span>
<span id="cb261-41"><a href="application-level-k-models.html#cb261-41" tabindex="-1"></a>  <span class="at">LB2 =</span> d<span class="sc">$</span>lb2,</span>
<span id="cb261-42"><a href="application-level-k-models.html#cb261-42" tabindex="-1"></a>  <span class="at">UB2 =</span> d<span class="sc">$</span>ub2,</span>
<span id="cb261-43"><a href="application-level-k-models.html#cb261-43" tabindex="-1"></a>  </span>
<span id="cb261-44"><a href="application-level-k-models.html#cb261-44" tabindex="-1"></a>  <span class="at">choice1 =</span> choices,</span>
<span id="cb261-45"><a href="application-level-k-models.html#cb261-45" tabindex="-1"></a>  </span>
<span id="cb261-46"><a href="application-level-k-models.html#cb261-46" tabindex="-1"></a>  <span class="at">prior_probExact =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb261-47"><a href="application-level-k-models.html#cb261-47" tabindex="-1"></a>  <span class="at">prior_lambda =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.96</span>,<span class="fl">1.35</span>),</span>
<span id="cb261-48"><a href="application-level-k-models.html#cb261-48" tabindex="-1"></a>  </span>
<span id="cb261-49"><a href="application-level-k-models.html#cb261-49" tabindex="-1"></a>  <span class="at">prior_mix =</span> <span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">5</span>),</span>
<span id="cb261-50"><a href="application-level-k-models.html#cb261-50" tabindex="-1"></a>  </span>
<span id="cb261-51"><a href="application-level-k-models.html#cb261-51" tabindex="-1"></a>  <span class="at">tol =</span> <span class="fl">0.001</span></span>
<span id="cb261-52"><a href="application-level-k-models.html#cb261-52" tabindex="-1"></a>  </span>
<span id="cb261-53"><a href="application-level-k-models.html#cb261-53" tabindex="-1"></a>  </span>
<span id="cb261-54"><a href="application-level-k-models.html#cb261-54" tabindex="-1"></a>  </span>
<span id="cb261-55"><a href="application-level-k-models.html#cb261-55" tabindex="-1"></a>)</span>
<span id="cb261-56"><a href="application-level-k-models.html#cb261-56" tabindex="-1"></a></span>
<span id="cb261-57"><a href="application-level-k-models.html#cb261-57" tabindex="-1"></a>Fit<span class="ot">&lt;-</span>model <span class="sc">|&gt;</span></span>
<span id="cb261-58"><a href="application-level-k-models.html#cb261-58" tabindex="-1"></a>  <span class="fu">sampling</span>(</span>
<span id="cb261-59"><a href="application-level-k-models.html#cb261-59" tabindex="-1"></a>    <span class="at">data=</span>dStan,</span>
<span id="cb261-60"><a href="application-level-k-models.html#cb261-60" tabindex="-1"></a>    <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;like_choices&quot;</span>),<span class="at">include=</span><span class="cn">FALSE</span>,</span>
<span id="cb261-61"><a href="application-level-k-models.html#cb261-61" tabindex="-1"></a>    <span class="at">iter=</span><span class="dv">2000</span>,</span>
<span id="cb261-62"><a href="application-level-k-models.html#cb261-62" tabindex="-1"></a>    <span class="at">seed=</span><span class="dv">42</span></span>
<span id="cb261-63"><a href="application-level-k-models.html#cb261-63" tabindex="-1"></a>      )</span>
<span id="cb261-64"><a href="application-level-k-models.html#cb261-64" tabindex="-1"></a></span>
<span id="cb261-65"><a href="application-level-k-models.html#cb261-65" tabindex="-1"></a>Fit <span class="sc">|&gt;</span></span>
<span id="cb261-66"><a href="application-level-k-models.html#cb261-66" tabindex="-1"></a>  <span class="fu">saveRDS</span>(<span class="at">file=</span><span class="st">&quot;Code/CGC2006/EstimatesLevelkEq.rds&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-CGC2006" class="csl-entry">
Costa-Gomes, Miguel A, and Vincent P Crawford. 2006. <span>“Cognition and Behavior in Two-Person Guessing Games: An Experimental Study.”</span> <em>American Economic Review</em> 96 (5): 1737–68.
</div>
<div id="ref-Stahl1994" class="csl-entry">
Stahl, Dale O, and Paul W Wilson. 1994. <span>“Experimental Evidence on Players’ Models of Other Players.”</span> <em>Journal of Economic Behavior &amp; Organization</em> 25 (3): 309–27.
</div>
<div id="ref-Wilcox2006" class="csl-entry">
Wilcox, Nathaniel T. 2006. <span>“Theories of Learning in Games and Heterogeneity Bias.”</span> <em>Econometrica</em> 74 (5): 1271–92.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="88">
<li id="fn88"><p>Participants in the experiment were in fact allowed to choose outside these bounds, but such choices were adjusted to the closer of the bounds. For simplicity, I describe the game in terms of these “adjusted” choices.<a href="application-level-k-models.html#fnref88" class="footnote-back">↩︎</a></p></li>
<li id="fn89"><p>There are many permutations of how the level-<span class="math inline">\(k\)</span> model is set up. I am using this one here for simplicity. <span class="citation">Stahl and Wilson (<a href="#ref-Stahl1994">1994</a>)</span>, for example, assumes that the level-2 type best responds to the mixture of level-0 and level-1 types, rather than just the level-1 type. This alternative assumption is in principle implementable in both the mixture and hierarchical specifications outlined below, but would be more computationally intensive. <a href="application-level-k-models.html#fnref89" class="footnote-back">↩︎</a></p></li>
<li id="fn90"><p>We need to be careful here. A participant may be <em>able</em> to do many steps of strategic reasoning, but might believe that others only do a few. For example, suppose that a participant can reason their way through all of the steps (possibly infinitely many) to get to the Nash equilibrium prediction, but they believe that their opponent will make <span class="math inline">\(k=2\)</span> steps. This participant would then behave as if they are a level-3 type. <a href="application-level-k-models.html#fnref90" class="footnote-back">↩︎</a></p></li>
<li id="fn91"><p>If you haven’t found enough shrines to get enough heart containers for the Master Sword, now is your time! This took about a day on my laptop. <a href="application-level-k-models.html#fnref91" class="footnote-back">↩︎</a></p></li>
<li id="fn92"><p>My initial run using <em>RStan</em>’s default 2,000 iterations per chain yielded some ESS warnings, which were easily fixed by increasing the number of iterations. <a href="application-level-k-models.html#fnref92" class="footnote-back">↩︎</a></p></li>
<li id="fn93"><p>Attempts to incorporate a hierarchical specification for <span class="math inline">\(\lambda_i\)</span> were made, however at the time of writing there has been no joy. The added complication is that we would need to integrate out <span class="math inline">\(\lambda_i\)</span> to compute the aggregate mixed strategy.<a href="application-level-k-models.html#fnref93" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="application-qre-in-a-bayesian-game-and-cursed-equilibrium.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="application-estimating-risk-preferences.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": false,
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
